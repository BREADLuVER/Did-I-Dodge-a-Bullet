"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[720],{720:function(e,t,a){a.d(t,{lj:function(){return f},SY:function(){return u}});var i=a(9403),n=a(994),r=a(2601);let o={apiKey:"AIzaSyCTMqWzORaG1eK0Tp-T8e0h39rDJpLMPPQ",authDomain:"did-i-dodge-a-bullet.firebaseapp.com",projectId:"did-i-dodge-a-bullet",storageBucket:"did-i-dodge-a-bullet.firebasestorage.app",messagingSenderId:"190454478964",appId:"1:190454478964:web:8b54426780fe1792627921"},s=null,l=null,c=()=>{if(!s){let e=(0,n.C6)();s=e.length>0?e[0]:(0,n.ZF)(o)}return l||(l=(0,i.ad)(s)),{app:s,db:l}},d=()=>{if(!l){let{db:e}=c();return e}return l};d(),(()=>{if(!s){let{app:e}=c()}})();try{(()=>{let e=["NEXT_PUBLIC_FIREBASE_API_KEY","NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN","NEXT_PUBLIC_FIREBASE_PROJECT_ID","NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET","NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID","NEXT_PUBLIC_FIREBASE_APP_ID"].filter(e=>!r.env[e]);return!(e.length>0)||(console.error("Missing Firebase configuration keys:",e),!1)})()?(c(),console.log("✅ Firebase initialized successfully")):console.warn("⚠️ Firebase configuration incomplete")}catch(e){console.error("❌ Firebase initialization failed:",e)}let m={companies:[],lastUpdated:0,isLoaded:!1},u=e=>e?e.trim().toLowerCase().replace(/\s+/g," ").replace(/[^\w\s-]/g,"").replace(/\b(inc|corp|corporation|llc|ltd|limited|co|company|group|holdings|enterprises|ventures|partners|associates)\b/g,"").replace(/\b(the|a|an)\b/g,"").replace(/\s+/g," ").trim():"",p=(e,t)=>{let a=[];if(!e)return a;a.push(e.trim()),a.push(e.toLowerCase().trim());let i=e.toLowerCase().replace(/\b(inc|corp|corporation|llc|ltd|limited|co|company|group|holdings|enterprises|ventures|partners|associates)\b/g,"").replace(/\s+/g," ").trim();if(i&&i!==e.toLowerCase().trim()&&a.push(i),t)try{let i=new URL(t).hostname;i&&i!==e.toLowerCase()&&(a.push(i),i.startsWith("www.")&&a.push(i.substring(4)))}catch(e){}return Array.from(new Set(a.filter(e=>e.trim())))},h=(e,t)=>{if(!e||!t)return 0;let a=[],i=e.length,n=t.length;for(let e=0;e<=n;e++)a[e]=[e];for(let e=0;e<=i;e++)a[0][e]=e;for(let r=1;r<=n;r++)for(let n=1;n<=i;n++)t.charAt(r-1)===e.charAt(n-1)?a[r][n]=a[r-1][n-1]:a[r][n]=Math.min(a[r-1][n-1]+1,a[r][n-1]+1,a[r-1][n]+1);let r=Math.max(i,n);return 0===r?1:(r-a[n][i])/r};class g{static getInstance(){return g.instance||(g.instance=new g),g.instance}async loadAllCompanies(){let e=Date.now();if(m.isLoaded&&e-m.lastUpdated<3e5)return m.companies;try{if(!this.db)return console.warn("Firebase not initialized"),[];let t=(0,i.hJ)(this.db,"companies"),a=(await (0,i.PL)(t)).docs.map(e=>{var t,a,i;let n=e.data();return{id:e.id,name:n.name||"",normalizedName:n.normalizedName||"",aliases:n.aliases||[],website:n.website,location:n.location,industry:n.industry,company_size:n.company_size,company_type:n.company_type,founded_year:n.founded_year,specialities:n.specialities,locations:n.locations,submissionCount:n.submissionCount||0,lastSubmission:null===(t=n.lastSubmission)||void 0===t?void 0:t.toDate(),commonFlags:n.commonFlags||[],averageFlagCount:n.averageFlagCount||0,severityTrends:n.severityTrends||{light:0,medium:0},createdAt:null===(a=n.createdAt)||void 0===a?void 0:a.toDate(),updatedAt:null===(i=n.updatedAt)||void 0===i?void 0:i.toDate()}});return m={companies:a,lastUpdated:e,isLoaded:!0},console.log("Loaded ".concat(a.length," companies")),a}catch(e){return console.error("Error loading companies:",e),[]}}async searchCompanies(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(!e.trim())return[];let a=await this.loadAllCompanies(),i=u(e),n=[];for(let t of a){let a=0,r="fuzzy";if(t.normalizedName===i)a=1,r="exact";else if(t.name.toLowerCase().includes(e.toLowerCase()))a=.9,r="partial";else{for(let e of t.aliases)if(u(e)===i){a=.8,r="alias";break}if(0===a){let e=h(i,t.normalizedName);e>.7&&(a=e,r="fuzzy")}}a>0&&n.push({company:t,relevanceScore:a,matchType:r})}return n.sort((e,t)=>t.relevanceScore-e.relevanceScore).slice(0,t).map(e=>e.company)}async findOrCreateCompany(e){if(!e.trim())throw Error("Company name cannot be empty");let t=await this.searchCompanies(e,1);if(t.length>0){let a=t[0];if(h(u(e),a.normalizedName)>.8)return a}return this.createCompany(e)}async createCompany(e){if(!this.db)throw Error("Firebase not initialized");let t=u(e),a=p(e),n={name:e.trim(),normalizedName:t,aliases:a,submissionCount:0,commonFlags:[],averageFlagCount:0,severityTrends:{light:0,medium:0},createdAt:(0,i.Bt)(),updatedAt:(0,i.Bt)()};try{let e={id:(await (0,i.ET)((0,i.hJ)(this.db,"companies"),n)).id,...n,createdAt:new Date,updatedAt:new Date};return m.companies.push(e),e}catch(e){throw console.error("Error creating company:",e),e}}async updateCompanyWithSubmission(e,t){if(!this.db){console.warn("Firebase not initialized. Skipping company update.");return}try{let a=(0,i.JU)(this.db,"companies",e),n=m.companies.find(t=>t.id===e);if(!n){console.warn("Company not found in cache for update");return}let r={submissionCount:n.submissionCount+1,commonFlags:Array.from(new Set([...n.commonFlags,...t.markedFlags])),averageFlagCount:(n.averageFlagCount*n.submissionCount+t.markedFlags.length)/(n.submissionCount+1),severityTrends:{light:n.severityTrends.light+t.severityBreakdown.light,medium:n.severityTrends.medium+t.severityBreakdown.medium},lastSubmission:(0,i.Bt)(),updatedAt:(0,i.Bt)()};await (0,i.r7)(a,r);let o=m.companies.findIndex(t=>t.id===e);-1!==o&&(m.companies[o]={...n,...r,lastSubmission:new Date,updatedAt:new Date})}catch(e){console.error("Error updating company with submission:",e)}}async refreshCompanies(){m={companies:[],lastUpdated:0,isLoaded:!1},await this.loadAllCompanies()}async getAllCompanies(){return this.loadAllCompanies()}constructor(){this.db=d()}}let f=g.getInstance()}}]);