(()=>{var exports={};exports.id=499,exports.ids=[499],exports.modules={517:S=>{"use strict";S.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:S=>{"use strict";S.exports=require("crypto")},9523:S=>{"use strict";S.exports=require("dns")},2361:S=>{"use strict";S.exports=require("events")},7147:S=>{"use strict";S.exports=require("fs")},3685:S=>{"use strict";S.exports=require("http")},5158:S=>{"use strict";S.exports=require("http2")},1808:S=>{"use strict";S.exports=require("net")},2037:S=>{"use strict";S.exports=require("os")},1017:S=>{"use strict";S.exports=require("path")},7282:S=>{"use strict";S.exports=require("process")},2781:S=>{"use strict";S.exports=require("stream")},4404:S=>{"use strict";S.exports=require("tls")},7310:S=>{"use strict";S.exports=require("url")},3837:S=>{"use strict";S.exports=require("util")},9796:S=>{"use strict";S.exports=require("zlib")},6520:(S,T,R)=>{"use strict";let N,O;R.r(T),R.d(T,{headerHooks:()=>bb,originalPathname:()=>bT,patchFetch:()=>bE,requestAsyncStorage:()=>bg,routeModule:()=>bm,serverHooks:()=>bv,staticGenerationAsyncStorage:()=>by,staticGenerationBailout:()=>bS});var P,M,L,U,V,$={};R.r($),R.d($,{POST:()=>bp});var K=R(5419),W=R(9108),Q=R(9678),Y=R(8070);let X=()=>void 0,Z={NODE_CLIENT:!1,SDK_VERSION:"${JSCORE_VERSION}"},ee=function(S){let T=[],R=0;for(let N=0;N<S.length;N++){let O=S.charCodeAt(N);O<128?T[R++]=O:(O<2048?T[R++]=O>>6|192:((64512&O)==55296&&N+1<S.length&&(64512&S.charCodeAt(N+1))==56320?(O=65536+((1023&O)<<10)+(1023&S.charCodeAt(++N)),T[R++]=O>>18|240,T[R++]=O>>12&63|128):T[R++]=O>>12|224,T[R++]=O>>6&63|128),T[R++]=63&O|128)}return T},et=function(S){let T=[],R=0,N=0;for(;R<S.length;){let O=S[R++];if(O<128)T[N++]=String.fromCharCode(O);else if(O>191&&O<224){let P=S[R++];T[N++]=String.fromCharCode((31&O)<<6|63&P)}else if(O>239&&O<365){let P=((7&O)<<18|(63&S[R++])<<12|(63&S[R++])<<6|63&S[R++])-65536;T[N++]=String.fromCharCode(55296+(P>>10)),T[N++]=String.fromCharCode(56320+(1023&P))}else{let P=S[R++],M=S[R++];T[N++]=String.fromCharCode((15&O)<<12|(63&P)<<6|63&M)}}return T.join("")},er={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(S,T){if(!Array.isArray(S))throw Error("encodeByteArray takes an array as a parameter");this.init_();let R=T?this.byteToCharMapWebSafe_:this.byteToCharMap_,N=[];for(let T=0;T<S.length;T+=3){let O=S[T],P=T+1<S.length,M=P?S[T+1]:0,L=T+2<S.length,U=L?S[T+2]:0,V=O>>2,$=(3&O)<<4|M>>4,K=(15&M)<<2|U>>6,W=63&U;L||(W=64,P||(K=64)),N.push(R[V],R[$],R[K],R[W])}return N.join("")},encodeString(S,T){return this.HAS_NATIVE_SUPPORT&&!T?btoa(S):this.encodeByteArray(ee(S),T)},decodeString(S,T){return this.HAS_NATIVE_SUPPORT&&!T?atob(S):et(this.decodeStringToByteArray(S,T))},decodeStringToByteArray(S,T){this.init_();let R=T?this.charToByteMapWebSafe_:this.charToByteMap_,N=[];for(let T=0;T<S.length;){let O=R[S.charAt(T++)],P=T<S.length?R[S.charAt(T)]:0,M=++T<S.length?R[S.charAt(T)]:64,L=++T<S.length?R[S.charAt(T)]:64;if(++T,null==O||null==P||null==M||null==L)throw new en;let U=O<<2|P>>4;if(N.push(U),64!==M){let S=P<<4&240|M>>2;if(N.push(S),64!==L){let S=M<<6&192|L;N.push(S)}}}return N},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let S=0;S<this.ENCODED_VALS.length;S++)this.byteToCharMap_[S]=this.ENCODED_VALS.charAt(S),this.charToByteMap_[this.byteToCharMap_[S]]=S,this.byteToCharMapWebSafe_[S]=this.ENCODED_VALS_WEBSAFE.charAt(S),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[S]]=S,S>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(S)]=S,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(S)]=S)}}};class en extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let ei=function(S){let T=ee(S);return er.encodeByteArray(T,!0)},es=function(S){return ei(S).replace(/\./g,"")},ea=function(S){try{return er.decodeString(S,!0)}catch(S){console.error("base64Decode failed: ",S)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eo(){if("undefined"!=typeof self)return self;if("undefined"!=typeof global)return global;throw Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eu=()=>eo().__FIREBASE_DEFAULTS__,ec=()=>{if("undefined"==typeof process||void 0===process.env)return;let S=process.env.__FIREBASE_DEFAULTS__;if(S)return JSON.parse(S)},ed=()=>{let S;if("undefined"==typeof document)return;try{S=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(S){return}let T=S&&ea(S[1]);return T&&JSON.parse(T)},eh=()=>{try{return X()||eu()||ec()||ed()}catch(S){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${S}`);return}},ep=S=>{var T,R;return null===(R=null===(T=eh())||void 0===T?void 0:T.emulatorHosts)||void 0===R?void 0:R[S]},ef=S=>{let T=ep(S);if(!T)return;let R=T.lastIndexOf(":");if(R<=0||R+1===T.length)throw Error(`Invalid host ${T} with no separate hostname and port!`);let N=parseInt(T.substring(R+1),10);return"["===T[0]?[T.substring(1,R-1),N]:[T.substring(0,R),N]},em=()=>{var S;return null===(S=eh())||void 0===S?void 0:S.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eg{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((S,T)=>{this.resolve=S,this.reject=T})}wrapCallback(S){return(T,R)=>{T?this.reject(T):this.resolve(R),"function"==typeof S&&(this.promise.catch(()=>{}),1===S.length?S(T):S(T,R))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ey(S){try{return(S.startsWith("http://")||S.startsWith("https://")?new URL(S).hostname:S).endsWith(".cloudworkstations.dev")}catch(S){return!1}}async function ev(S){return(await fetch(S,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eb(S,T){if(S.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let R={alg:"none",type:"JWT"},N=T||"demo-project",O=S.iat||0,P=S.sub||S.user_id;if(!P)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let M=Object.assign({iss:`https://securetoken.google.com/${N}`,aud:N,iat:O,exp:O+3600,auth_time:O,sub:P,user_id:P,firebase:{sign_in_provider:"custom",identities:{}}},S),L="";return[es(JSON.stringify(R)),es(JSON.stringify(M)),L].join(".")}function eS(S,T){}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eT(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function eE(){var S;let T=null===(S=eh())||void 0===S?void 0:S.forceEnvironment;if("node"===T)return!0;if("browser"===T)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(S){return!1}}function eC(){return!eE()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ew(){try{return"object"==typeof indexedDB}catch(S){return!1}}function e_(){return new Promise((S,T)=>{try{let R=!0,N="validate-browser-context-for-indexeddb-analytics-module",O=self.indexedDB.open(N);O.onsuccess=()=>{O.result.close(),R||self.indexedDB.deleteDatabase(N),S(!0)},O.onupgradeneeded=()=>{R=!1},O.onerror=()=>{var S;T((null===(S=O.error)||void 0===S?void 0:S.message)||"")}}catch(S){T(S)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eI="FirebaseError";class eR extends Error{constructor(S,T,R){super(T),this.code=S,this.customData=R,this.name=eI,Object.setPrototypeOf(this,eR.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,eD.prototype.create)}}class eD{constructor(S,T,R){this.service=S,this.serviceName=T,this.errors=R}create(S,...T){let R=T[0]||{},N=`${this.service}/${S}`,O=this.errors[S],P=O?eA(O,R):"Error",M=`${this.serviceName}: ${P} (${N}).`;return new eR(N,M,R)}}function eA(S,T){return S.replace(ek,(S,R)=>{let N=T[R];return null!=N?String(N):`<${R}?>`})}let ek=/\{\$([^}]+)}/g;function eN(S,T){if(S===T)return!0;let R=Object.keys(S),N=Object.keys(T);for(let O of R){if(!N.includes(O))return!1;let R=S[O],P=T[O];if(eO(R)&&eO(P)){if(!eN(R,P))return!1}else if(R!==P)return!1}for(let S of N)if(!R.includes(S))return!1;return!0}function eO(S){return null!==S&&"object"==typeof S}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ex(S){return S&&S._delegate?S._delegate:S}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Z.NODE_CLIENT=!0;class eP{constructor(S,T,R){this.name=S,this.instanceFactory=T,this.type=R,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(S){return this.instantiationMode=S,this}setMultipleInstances(S){return this.multipleInstances=S,this}setServiceProps(S){return this.serviceProps=S,this}setInstanceCreatedCallback(S){return this.onInstanceCreated=S,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eM="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eL{constructor(S,T){this.name=S,this.container=T,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(S){let T=this.normalizeInstanceIdentifier(S);if(!this.instancesDeferred.has(T)){let S=new eg;if(this.instancesDeferred.set(T,S),this.isInitialized(T)||this.shouldAutoInitialize())try{let R=this.getOrInitializeService({instanceIdentifier:T});R&&S.resolve(R)}catch(S){}}return this.instancesDeferred.get(T).promise}getImmediate(S){var T;let R=this.normalizeInstanceIdentifier(null==S?void 0:S.identifier),N=null!==(T=null==S?void 0:S.optional)&&void 0!==T&&T;if(this.isInitialized(R)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:R})}catch(S){if(N)return null;throw S}else{if(N)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(S){if(S.name!==this.name)throw Error(`Mismatching Component ${S.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=S,this.shouldAutoInitialize()){if(eB(S))try{this.getOrInitializeService({instanceIdentifier:eM})}catch(S){}for(let[S,T]of this.instancesDeferred.entries()){let R=this.normalizeInstanceIdentifier(S);try{let S=this.getOrInitializeService({instanceIdentifier:R});T.resolve(S)}catch(S){}}}}clearInstance(S=eM){this.instancesDeferred.delete(S),this.instancesOptions.delete(S),this.instances.delete(S)}async delete(){let S=Array.from(this.instances.values());await Promise.all([...S.filter(S=>"INTERNAL"in S).map(S=>S.INTERNAL.delete()),...S.filter(S=>"_delete"in S).map(S=>S._delete())])}isComponentSet(){return null!=this.component}isInitialized(S=eM){return this.instances.has(S)}getOptions(S=eM){return this.instancesOptions.get(S)||{}}initialize(S={}){let{options:T={}}=S,R=this.normalizeInstanceIdentifier(S.instanceIdentifier);if(this.isInitialized(R))throw Error(`${this.name}(${R}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let N=this.getOrInitializeService({instanceIdentifier:R,options:T});for(let[S,T]of this.instancesDeferred.entries())R===this.normalizeInstanceIdentifier(S)&&T.resolve(N);return N}onInit(S,T){var R;let N=this.normalizeInstanceIdentifier(T),O=null!==(R=this.onInitCallbacks.get(N))&&void 0!==R?R:new Set;O.add(S),this.onInitCallbacks.set(N,O);let P=this.instances.get(N);return P&&S(P,N),()=>{O.delete(S)}}invokeOnInitCallbacks(S,T){let R=this.onInitCallbacks.get(T);if(R)for(let N of R)try{N(S,T)}catch(S){}}getOrInitializeService({instanceIdentifier:S,options:T={}}){let R=this.instances.get(S);if(!R&&this.component&&(R=this.component.instanceFactory(this.container,{instanceIdentifier:eF(S),options:T}),this.instances.set(S,R),this.instancesOptions.set(S,T),this.invokeOnInitCallbacks(R,S),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,S,R)}catch(S){}return R||null}normalizeInstanceIdentifier(S=eM){return this.component?this.component.multipleInstances?S:eM:S}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function eF(S){return S===eM?void 0:S}function eB(S){return"EAGER"===S.instantiationMode}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ej{constructor(S){this.name=S,this.providers=new Map}addComponent(S){let T=this.getProvider(S.name);if(T.isComponentSet())throw Error(`Component ${S.name} has already been registered with ${this.name}`);T.setComponent(S)}addOrOverwriteComponent(S){this.getProvider(S.name).isComponentSet()&&this.providers.delete(S.name),this.addComponent(S)}getProvider(S){if(this.providers.has(S))return this.providers.get(S);let T=new eL(S,this);return this.providers.set(S,T),T}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eU=[];!function(S){S[S.DEBUG=0]="DEBUG",S[S.VERBOSE=1]="VERBOSE",S[S.INFO=2]="INFO",S[S.WARN=3]="WARN",S[S.ERROR=4]="ERROR",S[S.SILENT=5]="SILENT"}(P||(P={}));let eV={debug:P.DEBUG,verbose:P.VERBOSE,info:P.INFO,warn:P.WARN,error:P.ERROR,silent:P.SILENT},ez=P.INFO,eq={[P.DEBUG]:"log",[P.VERBOSE]:"log",[P.INFO]:"info",[P.WARN]:"warn",[P.ERROR]:"error"},e$=(S,T,...R)=>{if(T<S.logLevel)return;let N=new Date().toISOString(),O=eq[T];if(O)console[O](`[${N}]  ${S.name}:`,...R);else throw Error(`Attempted to log a message with an invalid logType (value: ${T})`)};class eG{constructor(S){this.name=S,this._logLevel=ez,this._logHandler=e$,this._userLogHandler=null,eU.push(this)}get logLevel(){return this._logLevel}set logLevel(S){if(!(S in P))throw TypeError(`Invalid value "${S}" assigned to \`logLevel\``);this._logLevel=S}setLogLevel(S){this._logLevel="string"==typeof S?eV[S]:S}get logHandler(){return this._logHandler}set logHandler(S){if("function"!=typeof S)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=S}get userLogHandler(){return this._userLogHandler}set userLogHandler(S){this._userLogHandler=S}debug(...S){this._userLogHandler&&this._userLogHandler(this,P.DEBUG,...S),this._logHandler(this,P.DEBUG,...S)}log(...S){this._userLogHandler&&this._userLogHandler(this,P.VERBOSE,...S),this._logHandler(this,P.VERBOSE,...S)}info(...S){this._userLogHandler&&this._userLogHandler(this,P.INFO,...S),this._logHandler(this,P.INFO,...S)}warn(...S){this._userLogHandler&&this._userLogHandler(this,P.WARN,...S),this._logHandler(this,P.WARN,...S)}error(...S){this._userLogHandler&&this._userLogHandler(this,P.ERROR,...S),this._logHandler(this,P.ERROR,...S)}}let eK=(S,T)=>T.some(T=>S instanceof T);function eW(){return N||(N=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function eH(){return O||(O=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}let eQ=new WeakMap,eY=new WeakMap,eJ=new WeakMap,eX=new WeakMap,eZ=new WeakMap;function e0(S){let T=new Promise((T,R)=>{let N=()=>{S.removeEventListener("success",O),S.removeEventListener("error",P)},O=()=>{T(e9(S.result)),N()},P=()=>{R(S.error),N()};S.addEventListener("success",O),S.addEventListener("error",P)});return T.then(T=>{T instanceof IDBCursor&&eQ.set(T,S)}).catch(()=>{}),eZ.set(T,S),T}function e1(S){if(eY.has(S))return;let T=new Promise((T,R)=>{let N=()=>{S.removeEventListener("complete",O),S.removeEventListener("error",P),S.removeEventListener("abort",P)},O=()=>{T(),N()},P=()=>{R(S.error||new DOMException("AbortError","AbortError")),N()};S.addEventListener("complete",O),S.addEventListener("error",P),S.addEventListener("abort",P)});eY.set(S,T)}let e2={get(S,T,R){if(S instanceof IDBTransaction){if("done"===T)return eY.get(S);if("objectStoreNames"===T)return S.objectStoreNames||eJ.get(S);if("store"===T)return R.objectStoreNames[1]?void 0:R.objectStore(R.objectStoreNames[0])}return e9(S[T])},set:(S,T,R)=>(S[T]=R,!0),has:(S,T)=>S instanceof IDBTransaction&&("done"===T||"store"===T)||T in S};function e3(S){e2=S(e2)}function e4(S){return S!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?eH().includes(S)?function(...T){return S.apply(e5(this),T),e9(eQ.get(this))}:function(...T){return e9(S.apply(e5(this),T))}:function(T,...R){let N=S.call(e5(this),T,...R);return eJ.set(N,T.sort?T.sort():[T]),e9(N)}}function e6(S){return"function"==typeof S?e4(S):(S instanceof IDBTransaction&&e1(S),eK(S,eW()))?new Proxy(S,e2):S}function e9(S){if(S instanceof IDBRequest)return e0(S);if(eX.has(S))return eX.get(S);let T=e6(S);return T!==S&&(eX.set(S,T),eZ.set(T,S)),T}let e5=S=>eZ.get(S);function e8(S,T,{blocked:R,upgrade:N,blocking:O,terminated:P}={}){let M=indexedDB.open(S,T),L=e9(M);return N&&M.addEventListener("upgradeneeded",S=>{N(e9(M.result),S.oldVersion,S.newVersion,e9(M.transaction),S)}),R&&M.addEventListener("blocked",S=>R(S.oldVersion,S.newVersion,S)),L.then(S=>{P&&S.addEventListener("close",()=>P()),O&&S.addEventListener("versionchange",S=>O(S.oldVersion,S.newVersion,S))}).catch(()=>{}),L}let e7=["get","getKey","getAll","getAllKeys","count"],te=["put","add","delete","clear"],tt=new Map;function tr(S,T){if(!(S instanceof IDBDatabase&&!(T in S)&&"string"==typeof T))return;if(tt.get(T))return tt.get(T);let R=T.replace(/FromIndex$/,""),N=T!==R,O=te.includes(R);if(!(R in(N?IDBIndex:IDBObjectStore).prototype)||!(O||e7.includes(R)))return;let P=async function(S,...T){let P=this.transaction(S,O?"readwrite":"readonly"),M=P.store;return N&&(M=M.index(T.shift())),(await Promise.all([M[R](...T),O&&P.done]))[0]};return tt.set(T,P),P}e3(S=>({...S,get:(T,R,N)=>tr(T,R)||S.get(T,R,N),has:(T,R)=>!!tr(T,R)||S.has(T,R)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ti{constructor(S){this.container=S}getPlatformInfoString(){return this.container.getProviders().map(S=>{if(!ts(S))return null;{let T=S.getImmediate();return`${T.library}/${T.version}`}}).filter(S=>S).join(" ")}}function ts(S){let T=S.getComponent();return(null==T?void 0:T.type)==="VERSION"}let ta="@firebase/app",tl="0.13.2",tu=new eG("@firebase/app"),tc="11.10.0",td="[DEFAULT]",th={[ta]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},tp=new Map,tf=new Map,tm=new Map;function tg(S,T){try{S.container.addComponent(T)}catch(R){tu.debug(`Component ${T.name} failed to register with FirebaseApp ${S.name}`,R)}}function ty(S){let T=S.name;if(tm.has(T))return tu.debug(`There were multiple attempts to register component ${T}.`),!1;for(let R of(tm.set(T,S),tp.values()))tg(R,S);for(let T of tf.values())tg(T,S);return!0}function tv(S,T){let R=S.container.getProvider("heartbeat").getImmediate({optional:!0});return R&&R.triggerHeartbeat(),S.container.getProvider(T)}function tb(S){return null!=S&&void 0!==S.settings}let tS=new eD("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tT{constructor(S,T,R){this._isDeleted=!1,this._options=Object.assign({},S),this._config=Object.assign({},T),this._name=T.name,this._automaticDataCollectionEnabled=T.automaticDataCollectionEnabled,this._container=R,this.container.addComponent(new eP("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(S){this.checkDestroyed(),this._automaticDataCollectionEnabled=S}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(S){this._isDeleted=S}checkDestroyed(){if(this.isDeleted)throw tS.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tE=tc;function tC(S,T={}){let R=S;"object"!=typeof T&&(T={name:T});let N=Object.assign({name:td,automaticDataCollectionEnabled:!0},T),O=N.name;if("string"!=typeof O||!O)throw tS.create("bad-app-name",{appName:String(O)});if(R||(R=em()),!R)throw tS.create("no-options");let P=tp.get(O);if(P){if(eN(R,P.options)&&eN(N,P.config))return P;throw tS.create("duplicate-app",{appName:O})}let M=new ej(O);for(let S of tm.values())M.addComponent(S);let L=new tT(R,N,M);return tp.set(O,L),L}function tw(S=td){let T=tp.get(S);if(!T&&S===td&&em())return tC();if(!T)throw tS.create("no-app",{appName:S});return T}function t_(){return Array.from(tp.values())}function tI(S,T,R){var N;let O=null!==(N=th[S])&&void 0!==N?N:S;R&&(O+=`-${R}`);let P=O.match(/\s|\//),M=T.match(/\s|\//);if(P||M){let S=[`Unable to register library "${O}" with version "${T}":`];P&&S.push(`library name "${O}" contains illegal characters (whitespace or "/")`),P&&M&&S.push("and"),M&&S.push(`version name "${T}" contains illegal characters (whitespace or "/")`),tu.warn(S.join(" "));return}ty(new eP(`${O}-version`,()=>({library:O,version:T}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tR="firebase-heartbeat-database",tD=1,tA="firebase-heartbeat-store",tk=null;function tN(){return tk||(tk=e8(tR,tD,{upgrade:(S,T)=>{if(0===T)try{S.createObjectStore(tA)}catch(S){console.warn(S)}}}).catch(S=>{throw tS.create("idb-open",{originalErrorMessage:S.message})})),tk}async function tO(S){try{let T=(await tN()).transaction(tA),R=await T.objectStore(tA).get(tM(S));return await T.done,R}catch(S){if(S instanceof eR)tu.warn(S.message);else{let T=tS.create("idb-get",{originalErrorMessage:null==S?void 0:S.message});tu.warn(T.message)}}}async function tP(S,T){try{let R=(await tN()).transaction(tA,"readwrite"),N=R.objectStore(tA);await N.put(T,tM(S)),await R.done}catch(S){if(S instanceof eR)tu.warn(S.message);else{let T=tS.create("idb-set",{originalErrorMessage:null==S?void 0:S.message});tu.warn(T.message)}}}function tM(S){return`${S.name}!${S.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tL=1024,tF=30;class tB{constructor(S){this.container=S,this._heartbeatsCache=null;let T=this.container.getProvider("app").getImmediate();this._storage=new tV(T),this._heartbeatsCachePromise=this._storage.read().then(S=>(this._heartbeatsCache=S,S))}async triggerHeartbeat(){var S,T;try{let R=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),N=tj();if((null===(S=this._heartbeatsCache)||void 0===S?void 0:S.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,(null===(T=this._heartbeatsCache)||void 0===T?void 0:T.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===N||this._heartbeatsCache.heartbeats.some(S=>S.date===N))return;if(this._heartbeatsCache.heartbeats.push({date:N,agent:R}),this._heartbeatsCache.heartbeats.length>tF){let S=tq(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(S,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(S){tu.warn(S)}}async getHeartbeatsHeader(){var S;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null===(S=this._heartbeatsCache)||void 0===S?void 0:S.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let T=tj(),{heartbeatsToSend:R,unsentEntries:N}=tU(this._heartbeatsCache.heartbeats),O=es(JSON.stringify({version:2,heartbeats:R}));return this._heartbeatsCache.lastSentHeartbeatDate=T,N.length>0?(this._heartbeatsCache.heartbeats=N,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),O}catch(S){return tu.warn(S),""}}}function tj(){return new Date().toISOString().substring(0,10)}function tU(S,T=tL){let R=[],N=S.slice();for(let O of S){let S=R.find(S=>S.agent===O.agent);if(S){if(S.dates.push(O.date),tz(R)>T){S.dates.pop();break}}else if(R.push({agent:O.agent,dates:[O.date]}),tz(R)>T){R.pop();break}N=N.slice(1)}return{heartbeatsToSend:R,unsentEntries:N}}class tV{constructor(S){this.app=S,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!ew()&&e_().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let S=await tO(this.app);return(null==S?void 0:S.heartbeats)?S:{heartbeats:[]}}}async overwrite(S){var T;if(await this._canUseIndexedDBPromise){let R=await this.read();return tP(this.app,{lastSentHeartbeatDate:null!==(T=S.lastSentHeartbeatDate)&&void 0!==T?T:R.lastSentHeartbeatDate,heartbeats:S.heartbeats})}}async add(S){var T;if(await this._canUseIndexedDBPromise){let R=await this.read();return tP(this.app,{lastSentHeartbeatDate:null!==(T=S.lastSentHeartbeatDate)&&void 0!==T?T:R.lastSentHeartbeatDate,heartbeats:[...R.heartbeats,...S.heartbeats]})}}}function tz(S){return es(JSON.stringify({version:2,heartbeats:S})).length}function tq(S){if(0===S.length)return -1;let T=0,R=S[0].date;for(let N=1;N<S.length;N++)S[N].date<R&&(R=S[N].date,T=N);return T}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function(S){ty(new eP("platform-logger",S=>new ti(S),"PRIVATE")),ty(new eP("heartbeat",S=>new tB(S),"PRIVATE")),tI(ta,tl,""),tI(ta,tl,"esm2017"),tI("fire-js","")})(0),/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */tI("firebase","11.10.0","app");var t$=R(3837),tG="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},tK={};(function(){function S(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function T(S,T,R){R||(R=0);var N=Array(16);if("string"==typeof T)for(var O=0;16>O;++O)N[O]=T.charCodeAt(R++)|T.charCodeAt(R++)<<8|T.charCodeAt(R++)<<16|T.charCodeAt(R++)<<24;else for(O=0;16>O;++O)N[O]=T[R++]|T[R++]<<8|T[R++]<<16|T[R++]<<24;T=S.g[0],R=S.g[1],O=S.g[2];var P=S.g[3],M=T+(P^R&(O^P))+N[0]+3614090360&4294967295;M=P+(O^(T=R+(M<<7&4294967295|M>>>25))&(R^O))+N[1]+3905402710&4294967295,M=O+(R^(P=T+(M<<12&4294967295|M>>>20))&(T^R))+N[2]+606105819&4294967295,M=R+(T^(O=P+(M<<17&4294967295|M>>>15))&(P^T))+N[3]+3250441966&4294967295,M=T+(P^(R=O+(M<<22&4294967295|M>>>10))&(O^P))+N[4]+4118548399&4294967295,M=P+(O^(T=R+(M<<7&4294967295|M>>>25))&(R^O))+N[5]+1200080426&4294967295,M=O+(R^(P=T+(M<<12&4294967295|M>>>20))&(T^R))+N[6]+2821735955&4294967295,M=R+(T^(O=P+(M<<17&4294967295|M>>>15))&(P^T))+N[7]+4249261313&4294967295,M=T+(P^(R=O+(M<<22&4294967295|M>>>10))&(O^P))+N[8]+1770035416&4294967295,M=P+(O^(T=R+(M<<7&4294967295|M>>>25))&(R^O))+N[9]+2336552879&4294967295,M=O+(R^(P=T+(M<<12&4294967295|M>>>20))&(T^R))+N[10]+4294925233&4294967295,M=R+(T^(O=P+(M<<17&4294967295|M>>>15))&(P^T))+N[11]+2304563134&4294967295,M=T+(P^(R=O+(M<<22&4294967295|M>>>10))&(O^P))+N[12]+1804603682&4294967295,M=P+(O^(T=R+(M<<7&4294967295|M>>>25))&(R^O))+N[13]+4254626195&4294967295,M=O+(R^(P=T+(M<<12&4294967295|M>>>20))&(T^R))+N[14]+2792965006&4294967295,M=R+(T^(O=P+(M<<17&4294967295|M>>>15))&(P^T))+N[15]+1236535329&4294967295,R=O+(M<<22&4294967295|M>>>10),M=T+(O^P&(R^O))+N[1]+4129170786&4294967295,T=R+(M<<5&4294967295|M>>>27),M=P+(R^O&(T^R))+N[6]+3225465664&4294967295,P=T+(M<<9&4294967295|M>>>23),M=O+(T^R&(P^T))+N[11]+643717713&4294967295,O=P+(M<<14&4294967295|M>>>18),M=R+(P^T&(O^P))+N[0]+3921069994&4294967295,R=O+(M<<20&4294967295|M>>>12),M=T+(O^P&(R^O))+N[5]+3593408605&4294967295,T=R+(M<<5&4294967295|M>>>27),M=P+(R^O&(T^R))+N[10]+38016083&4294967295,P=T+(M<<9&4294967295|M>>>23),M=O+(T^R&(P^T))+N[15]+3634488961&4294967295,O=P+(M<<14&4294967295|M>>>18),M=R+(P^T&(O^P))+N[4]+3889429448&4294967295,R=O+(M<<20&4294967295|M>>>12),M=T+(O^P&(R^O))+N[9]+568446438&4294967295,T=R+(M<<5&4294967295|M>>>27),M=P+(R^O&(T^R))+N[14]+3275163606&4294967295,P=T+(M<<9&4294967295|M>>>23),M=O+(T^R&(P^T))+N[3]+4107603335&4294967295,O=P+(M<<14&4294967295|M>>>18),M=R+(P^T&(O^P))+N[8]+1163531501&4294967295,R=O+(M<<20&4294967295|M>>>12),M=T+(O^P&(R^O))+N[13]+2850285829&4294967295,T=R+(M<<5&4294967295|M>>>27),M=P+(R^O&(T^R))+N[2]+4243563512&4294967295,P=T+(M<<9&4294967295|M>>>23),M=O+(T^R&(P^T))+N[7]+1735328473&4294967295,O=P+(M<<14&4294967295|M>>>18),M=R+(P^T&(O^P))+N[12]+2368359562&4294967295,M=T+((R=O+(M<<20&4294967295|M>>>12))^O^P)+N[5]+4294588738&4294967295,M=P+((T=R+(M<<4&4294967295|M>>>28))^R^O)+N[8]+2272392833&4294967295,M=O+((P=T+(M<<11&4294967295|M>>>21))^T^R)+N[11]+1839030562&4294967295,M=R+((O=P+(M<<16&4294967295|M>>>16))^P^T)+N[14]+4259657740&4294967295,M=T+((R=O+(M<<23&4294967295|M>>>9))^O^P)+N[1]+2763975236&4294967295,M=P+((T=R+(M<<4&4294967295|M>>>28))^R^O)+N[4]+1272893353&4294967295,M=O+((P=T+(M<<11&4294967295|M>>>21))^T^R)+N[7]+4139469664&4294967295,M=R+((O=P+(M<<16&4294967295|M>>>16))^P^T)+N[10]+3200236656&4294967295,M=T+((R=O+(M<<23&4294967295|M>>>9))^O^P)+N[13]+681279174&4294967295,M=P+((T=R+(M<<4&4294967295|M>>>28))^R^O)+N[0]+3936430074&4294967295,M=O+((P=T+(M<<11&4294967295|M>>>21))^T^R)+N[3]+3572445317&4294967295,M=R+((O=P+(M<<16&4294967295|M>>>16))^P^T)+N[6]+76029189&4294967295,M=T+((R=O+(M<<23&4294967295|M>>>9))^O^P)+N[9]+3654602809&4294967295,M=P+((T=R+(M<<4&4294967295|M>>>28))^R^O)+N[12]+3873151461&4294967295,M=O+((P=T+(M<<11&4294967295|M>>>21))^T^R)+N[15]+530742520&4294967295,M=R+((O=P+(M<<16&4294967295|M>>>16))^P^T)+N[2]+3299628645&4294967295,R=O+(M<<23&4294967295|M>>>9),M=T+(O^(R|~P))+N[0]+4096336452&4294967295,T=R+(M<<6&4294967295|M>>>26),M=P+(R^(T|~O))+N[7]+1126891415&4294967295,P=T+(M<<10&4294967295|M>>>22),M=O+(T^(P|~R))+N[14]+2878612391&4294967295,O=P+(M<<15&4294967295|M>>>17),M=R+(P^(O|~T))+N[5]+4237533241&4294967295,R=O+(M<<21&4294967295|M>>>11),M=T+(O^(R|~P))+N[12]+1700485571&4294967295,T=R+(M<<6&4294967295|M>>>26),M=P+(R^(T|~O))+N[3]+2399980690&4294967295,P=T+(M<<10&4294967295|M>>>22),M=O+(T^(P|~R))+N[10]+4293915773&4294967295,O=P+(M<<15&4294967295|M>>>17),M=R+(P^(O|~T))+N[1]+2240044497&4294967295,R=O+(M<<21&4294967295|M>>>11),M=T+(O^(R|~P))+N[8]+1873313359&4294967295,T=R+(M<<6&4294967295|M>>>26),M=P+(R^(T|~O))+N[15]+4264355552&4294967295,P=T+(M<<10&4294967295|M>>>22),M=O+(T^(P|~R))+N[6]+2734768916&4294967295,O=P+(M<<15&4294967295|M>>>17),M=R+(P^(O|~T))+N[13]+1309151649&4294967295,R=O+(M<<21&4294967295|M>>>11),M=T+(O^(R|~P))+N[4]+4149444226&4294967295,T=R+(M<<6&4294967295|M>>>26),M=P+(R^(T|~O))+N[11]+3174756917&4294967295,P=T+(M<<10&4294967295|M>>>22),M=O+(T^(P|~R))+N[2]+718787259&4294967295,O=P+(M<<15&4294967295|M>>>17),M=R+(P^(O|~T))+N[9]+3951481745&4294967295,S.g[0]=S.g[0]+T&4294967295,S.g[1]=S.g[1]+(O+(M<<21&4294967295|M>>>11))&4294967295,S.g[2]=S.g[2]+O&4294967295,S.g[3]=S.g[3]+P&4294967295}function R(S,T){var R=P;return Object.prototype.hasOwnProperty.call(R,S)?R[S]:R[S]=T(S)}function N(S,T){this.h=T;for(var R=[],N=!0,O=S.length-1;0<=O;O--){var P=0|S[O];N&&P==T||(R[O]=P,N=!1)}this.g=R}(function(S,T){function R(){}R.prototype=T.prototype,S.D=T.prototype,S.prototype=new R,S.prototype.constructor=S,S.C=function(S,R,N){for(var O=Array(arguments.length-2),P=2;P<arguments.length;P++)O[P-2]=arguments[P];return T.prototype[R].apply(S,O)}})(S,function(){this.blockSize=-1}),S.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},S.prototype.u=function(S,R){void 0===R&&(R=S.length);for(var N=R-this.blockSize,O=this.B,P=this.h,M=0;M<R;){if(0==P)for(;M<=N;)T(this,S,M),M+=this.blockSize;if("string"==typeof S){for(;M<R;)if(O[P++]=S.charCodeAt(M++),P==this.blockSize){T(this,O),P=0;break}}else for(;M<R;)if(O[P++]=S[M++],P==this.blockSize){T(this,O),P=0;break}}this.h=P,this.o+=R},S.prototype.v=function(){var S=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);S[0]=128;for(var T=1;T<S.length-8;++T)S[T]=0;var R=8*this.o;for(T=S.length-8;T<S.length;++T)S[T]=255&R,R/=256;for(this.u(S),S=Array(16),T=R=0;4>T;++T)for(var N=0;32>N;N+=8)S[R++]=this.g[T]>>>N&255;return S};var O,P={};function U(S){return -128<=S&&128>S?R(S,function(S){return new N([0|S],0>S?-1:0)}):new N([0|S],0>S?-1:0)}function V(S){if(isNaN(S)||!isFinite(S))return K;if(0>S)return Z(V(-S));for(var T=[],R=1,O=0;S>=R;O++)T[O]=S/R|0,R*=4294967296;return new N(T,0)}function $(S,T){if(0==S.length)throw Error("number format error: empty string");if(2>(T=T||10)||36<T)throw Error("radix out of range: "+T);if("-"==S.charAt(0))return Z($(S.substring(1),T));if(0<=S.indexOf("-"))throw Error('number format error: interior "-" character');for(var R=V(Math.pow(T,8)),N=K,O=0;O<S.length;O+=8){var P=Math.min(8,S.length-O),M=parseInt(S.substring(O,O+P),T);8>P?(P=V(Math.pow(T,P)),N=N.j(P).add(V(M))):N=(N=N.j(R)).add(V(M))}return N}var K=U(0),W=U(1),Q=U(16777216);function Y(S){if(0!=S.h)return!1;for(var T=0;T<S.g.length;T++)if(0!=S.g[T])return!1;return!0}function X(S){return -1==S.h}function Z(S){for(var T=S.g.length,R=[],O=0;O<T;O++)R[O]=~S.g[O];return new N(R,~S.h).add(W)}function ee(S,T){return S.add(Z(T))}function et(S,T){for(;(65535&S[T])!=S[T];)S[T+1]+=S[T]>>>16,S[T]&=65535,T++}function er(S,T){this.g=S,this.h=T}function en(S,T){if(Y(T))throw Error("division by zero");if(Y(S))return new er(K,K);if(X(S))return T=en(Z(S),T),new er(Z(T.g),Z(T.h));if(X(T))return T=en(S,Z(T)),new er(Z(T.g),T.h);if(30<S.g.length){if(X(S)||X(T))throw Error("slowDivide_ only works with positive integers.");for(var R=W,N=T;0>=N.l(S);)R=ei(R),N=ei(N);var O=es(R,1),P=es(N,1);for(N=es(N,2),R=es(R,2);!Y(N);){var M=P.add(N);0>=M.l(S)&&(O=O.add(R),P=M),N=es(N,1),R=es(R,1)}return T=ee(S,O.j(T)),new er(O,T)}for(O=K;0<=S.l(T);){for(N=48>=(N=Math.ceil(Math.log(R=Math.max(1,Math.floor(S.m()/T.m())))/Math.LN2))?1:Math.pow(2,N-48),M=(P=V(R)).j(T);X(M)||0<M.l(S);)R-=N,M=(P=V(R)).j(T);Y(P)&&(P=W),O=O.add(P),S=ee(S,M)}return new er(O,S)}function ei(S){for(var T=S.g.length+1,R=[],O=0;O<T;O++)R[O]=S.i(O)<<1|S.i(O-1)>>>31;return new N(R,S.h)}function es(S,T){var R=T>>5;T%=32;for(var O=S.g.length-R,P=[],M=0;M<O;M++)P[M]=0<T?S.i(M+R)>>>T|S.i(M+R+1)<<32-T:S.i(M+R);return new N(P,S.h)}(O=N.prototype).m=function(){if(X(this))return-Z(this).m();for(var S=0,T=1,R=0;R<this.g.length;R++){var N=this.i(R);S+=(0<=N?N:4294967296+N)*T,T*=4294967296}return S},O.toString=function(S){if(2>(S=S||10)||36<S)throw Error("radix out of range: "+S);if(Y(this))return"0";if(X(this))return"-"+Z(this).toString(S);for(var T=V(Math.pow(S,6)),R=this,N="";;){var O=en(R,T).g,P=((0<(R=ee(R,O.j(T))).g.length?R.g[0]:R.h)>>>0).toString(S);if(Y(R=O))return P+N;for(;6>P.length;)P="0"+P;N=P+N}},O.i=function(S){return 0>S?0:S<this.g.length?this.g[S]:this.h},O.l=function(S){return X(S=ee(this,S))?-1:Y(S)?0:1},O.abs=function(){return X(this)?Z(this):this},O.add=function(S){for(var T=Math.max(this.g.length,S.g.length),R=[],O=0,P=0;P<=T;P++){var M=O+(65535&this.i(P))+(65535&S.i(P)),L=(M>>>16)+(this.i(P)>>>16)+(S.i(P)>>>16);O=L>>>16,M&=65535,L&=65535,R[P]=L<<16|M}return new N(R,-2147483648&R[R.length-1]?-1:0)},O.j=function(S){if(Y(this)||Y(S))return K;if(X(this))return X(S)?Z(this).j(Z(S)):Z(Z(this).j(S));if(X(S))return Z(this.j(Z(S)));if(0>this.l(Q)&&0>S.l(Q))return V(this.m()*S.m());for(var T=this.g.length+S.g.length,R=[],O=0;O<2*T;O++)R[O]=0;for(O=0;O<this.g.length;O++)for(var P=0;P<S.g.length;P++){var M=this.i(O)>>>16,L=65535&this.i(O),U=S.i(P)>>>16,$=65535&S.i(P);R[2*O+2*P]+=L*$,et(R,2*O+2*P),R[2*O+2*P+1]+=M*$,et(R,2*O+2*P+1),R[2*O+2*P+1]+=L*U,et(R,2*O+2*P+1),R[2*O+2*P+2]+=M*U,et(R,2*O+2*P+2)}for(O=0;O<T;O++)R[O]=R[2*O+1]<<16|R[2*O];for(O=T;O<2*T;O++)R[O]=0;return new N(R,0)},O.A=function(S){return en(this,S).h},O.and=function(S){for(var T=Math.max(this.g.length,S.g.length),R=[],O=0;O<T;O++)R[O]=this.i(O)&S.i(O);return new N(R,this.h&S.h)},O.or=function(S){for(var T=Math.max(this.g.length,S.g.length),R=[],O=0;O<T;O++)R[O]=this.i(O)|S.i(O);return new N(R,this.h|S.h)},O.xor=function(S){for(var T=Math.max(this.g.length,S.g.length),R=[],O=0;O<T;O++)R[O]=this.i(O)^S.i(O);return new N(R,this.h^S.h)},S.prototype.digest=S.prototype.v,S.prototype.reset=S.prototype.s,S.prototype.update=S.prototype.u,L=tK.Md5=S,N.prototype.add=N.prototype.add,N.prototype.multiply=N.prototype.j,N.prototype.modulo=N.prototype.A,N.prototype.compare=N.prototype.l,N.prototype.toNumber=N.prototype.m,N.prototype.toString=N.prototype.toString,N.prototype.getBits=N.prototype.i,N.fromNumber=V,N.fromString=$,M=tK.Integer=N}).apply(void 0!==tG?tG:"undefined"!=typeof self?self:{});var tW=R(6113),tH=R(8388),tQ=R(4663);let tY="@firebase/firestore",tJ="4.8.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tX{constructor(S){this.uid=S}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(S){return S.uid===this.uid}}tX.UNAUTHENTICATED=new tX(null),tX.GOOGLE_CREDENTIALS=new tX("google-credentials-uid"),tX.FIRST_PARTY=new tX("first-party-uid"),tX.MOCK_USER=new tX("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tZ="11.10.0";function t0(S){tZ=S}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t1(S){return(0,t$.inspect)(S,{depth:100})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let t2=new eG("@firebase/firestore");function t3(){return t2.logLevel}function t4(S,...T){if(t2.logLevel<=P.DEBUG){let R=T.map(t5);t2.debug(`Firestore (${tZ}): ${S}`,...R)}}function t6(S,...T){if(t2.logLevel<=P.ERROR){let R=T.map(t5);t2.error(`Firestore (${tZ}): ${S}`,...R)}}function t9(S,...T){if(t2.logLevel<=P.WARN){let R=T.map(t5);t2.warn(`Firestore (${tZ}): ${S}`,...R)}}function t5(S){if("string"==typeof S)return S;try{return t1(S)}catch(T){return S}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t8(S,T,R){let N="Unexpected state";"string"==typeof T?N=T:R=T,t7(S,N,R)}function t7(S,T,R){let N=`FIRESTORE (${tZ}) INTERNAL ASSERTION FAILED: ${T} (ID: ${S.toString(16)})`;if(void 0!==R)try{let S=JSON.stringify(R);N+=" CONTEXT: "+S}catch(S){N+=" CONTEXT: "+R}throw t6(N),Error(N)}function rt(S,T,R,N){let O="Unexpected state";"string"==typeof R?O=R:N=R,S||t7(T,O,N)}function rr(S,T){return S}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rn={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ri extends eR{constructor(S,T){super(S,T),this.code=S,this.message=T,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rs{constructor(){this.promise=new Promise((S,T)=>{this.resolve=S,this.reject=T})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ra{constructor(S,T){this.user=T,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${S}`)}}class ro{getToken(){return Promise.resolve(null)}invalidateToken(){}start(S,T){S.enqueueRetryable(()=>T(tX.UNAUTHENTICATED))}shutdown(){}}class rl{constructor(S){this.token=S,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(S,T){this.changeListener=T,S.enqueueRetryable(()=>T(this.token.user))}shutdown(){this.changeListener=null}}class ru{constructor(S){this.authProvider=S,this.currentUser=tX.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(S,T){rt(void 0===this.tokenListener,42304);let R=this.tokenCounter,N=S=>this.tokenCounter!==R?(R=this.tokenCounter,T(S)):Promise.resolve(),O=new rs;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),O.resolve(),O=new rs,S.enqueueRetryable(()=>N(this.currentUser))};let P=()=>{let T=O;S.enqueueRetryable(async()=>{await T.promise,await N(this.currentUser)})},M=S=>{t4("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=S,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),P())};this.authProvider.onInit(S=>M(S)),setTimeout(()=>{if(!this.auth){let S=this.authProvider.getImmediate({optional:!0});S?M(S):(t4("FirebaseAuthCredentialsProvider","Auth not yet detected"),O.resolve(),O=new rs)}},0),P()}getToken(){let S=this.tokenCounter,T=this.forceRefresh;return(this.forceRefresh=!1,this.auth)?this.auth.getToken(T).then(T=>this.tokenCounter!==S?(t4("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):T?(rt("string"==typeof T.accessToken,31837,{tokenData:T}),new ra(T.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let S=this.auth&&this.auth.getUid();return rt(null===S||"string"==typeof S,2055,{currentUid:S}),new tX(S)}}class rc{constructor(S,T,R){this.sessionIndex=S,this.iamToken=T,this.authTokenFactory=R,this.type="FirstParty",this.user=tX.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let S=this.getAuthToken();return S&&this._headers.set("Authorization",S),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}}class rd{constructor(S,T,R){this.sessionIndex=S,this.iamToken=T,this.authTokenFactory=R}getToken(){return Promise.resolve(new rc(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(S,T){S.enqueueRetryable(()=>T(tX.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class rh{constructor(S){this.value=S,this.type="AppCheck",this.headers=new Map,S&&S.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class rp{constructor(S,T){this.appCheckProvider=T,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null,this.serverAppAppCheckToken=null,tb(S)&&S.settings.appCheckToken&&(this.serverAppAppCheckToken=S.settings.appCheckToken)}start(S,T){rt(void 0===this.tokenListener,3512);let R=S=>{null!=S.error&&t4("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${S.error.message}`);let R=S.token!==this.latestAppCheckToken;return this.latestAppCheckToken=S.token,t4("FirebaseAppCheckTokenProvider",`Received ${R?"new":"existing"} token.`),R?T(S.token):Promise.resolve()};this.tokenListener=T=>{S.enqueueRetryable(()=>R(T))};let N=S=>{t4("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=S,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(S=>N(S)),setTimeout(()=>{if(!this.appCheck){let S=this.appCheckProvider.getImmediate({optional:!0});S?N(S):t4("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.serverAppAppCheckToken)return Promise.resolve(new rh(this.serverAppAppCheckToken));let S=this.forceRefresh;return(this.forceRefresh=!1,this.appCheck)?this.appCheck.getToken(S).then(S=>S?(rt("string"==typeof S.token,44558,{tokenResult:S}),this.latestAppCheckToken=S.token,new rh(S.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}}function rf(S){if(!S)return new ro;switch(S.type){case"firstParty":return new rd(S.sessionIndex||"0",S.iamToken||null,S.authTokenFactory||null);case"provider":return S.client;default:throw new ri(rn.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rm(S){return(0,tW.randomBytes)(S)}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rg(){return new t$.TextEncoder}function ry(){return new TextDecoder("utf-8")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rv{static newId(){let S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",T=Math.floor(256/S.length)*S.length,R="",N=20;for(;R.length<N;){let O=rm(40);for(let P=0;P<O.length;++P)R.length<N&&O[P]<T&&(R+=S.charAt(O[P]%S.length))}return R}}function rb(S,T){return S<T?-1:S>T?1:0}function rS(S,T){let R=0;for(;R<S.length&&R<T.length;){let N=S.codePointAt(R),O=T.codePointAt(R);if(N!==O){if(N<128&&O<128)return rb(N,O);{let P=rg(),M=rE(P.encode(rT(S,R)),P.encode(rT(T,R)));if(0!==M)return M;return rb(N,O)}}R+=N>65535?2:1}return rb(S.length,T.length)}function rT(S,T){return S.codePointAt(T)>65535?S.substring(T,T+2):S.substring(T,T+1)}function rE(S,T){for(let R=0;R<S.length&&R<T.length;++R)if(S[R]!==T[R])return rb(S[R],T[R]);return rb(S.length,T.length)}function rC(S,T,R){return S.length===T.length&&S.every((S,N)=>R(S,T[N]))}function rw(S){return S+"\x00"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let r_="__name__";class rI{constructor(S,T,R){void 0===T?T=0:T>S.length&&t8(637,{offset:T,range:S.length}),void 0===R?R=S.length-T:R>S.length-T&&t8(1746,{length:R,range:S.length-T}),this.segments=S,this.offset=T,this.len=R}get length(){return this.len}isEqual(S){return 0===rI.comparator(this,S)}child(S){let T=this.segments.slice(this.offset,this.limit());return S instanceof rI?S.forEach(S=>{T.push(S)}):T.push(S),this.construct(T)}limit(){return this.offset+this.length}popFirst(S){return S=void 0===S?1:S,this.construct(this.segments,this.offset+S,this.length-S)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(S){return this.segments[this.offset+S]}isEmpty(){return 0===this.length}isPrefixOf(S){if(S.length<this.length)return!1;for(let T=0;T<this.length;T++)if(this.get(T)!==S.get(T))return!1;return!0}isImmediateParentOf(S){if(this.length+1!==S.length)return!1;for(let T=0;T<this.length;T++)if(this.get(T)!==S.get(T))return!1;return!0}forEach(S){for(let T=this.offset,R=this.limit();T<R;T++)S(this.segments[T])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(S,T){let R=Math.min(S.length,T.length);for(let N=0;N<R;N++){let R=rI.compareSegments(S.get(N),T.get(N));if(0!==R)return R}return rb(S.length,T.length)}static compareSegments(S,T){let R=rI.isNumericId(S),N=rI.isNumericId(T);return R&&!N?-1:!R&&N?1:R&&N?rI.extractNumericId(S).compare(rI.extractNumericId(T)):rS(S,T)}static isNumericId(S){return S.startsWith("__id")&&S.endsWith("__")}static extractNumericId(S){return M.fromString(S.substring(4,S.length-2))}}class rR extends rI{construct(S,T,R){return new rR(S,T,R)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...S){let T=[];for(let R of S){if(R.indexOf("//")>=0)throw new ri(rn.INVALID_ARGUMENT,`Invalid segment (${R}). Paths must not contain // in them.`);T.push(...R.split("/").filter(S=>S.length>0))}return new rR(T)}static emptyPath(){return new rR([])}}let rD=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class rA extends rI{construct(S,T,R){return new rA(S,T,R)}static isValidIdentifier(S){return rD.test(S)}canonicalString(){return this.toArray().map(S=>(S=S.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),rA.isValidIdentifier(S)||(S="`"+S+"`"),S)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===r_}static keyField(){return new rA([r_])}static fromServerFormat(S){let T=[],R="",N=0,O=()=>{if(0===R.length)throw new ri(rn.INVALID_ARGUMENT,`Invalid field path (${S}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);T.push(R),R=""},P=!1;for(;N<S.length;){let T=S[N];if("\\"===T){if(N+1===S.length)throw new ri(rn.INVALID_ARGUMENT,"Path has trailing escape character: "+S);let T=S[N+1];if(!("\\"===T||"."===T||"`"===T))throw new ri(rn.INVALID_ARGUMENT,"Path has invalid escape sequence: "+S);R+=T,N+=2}else"`"===T?P=!P:"."!==T||P?R+=T:O(),N++}if(O(),P)throw new ri(rn.INVALID_ARGUMENT,"Unterminated ` in path: "+S);return new rA(T)}static emptyPath(){return new rA([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rk{constructor(S){this.path=S}static fromPath(S){return new rk(rR.fromString(S))}static fromName(S){return new rk(rR.fromString(S).popFirst(5))}static empty(){return new rk(rR.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(S){return this.path.length>=2&&this.path.get(this.path.length-2)===S}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(S){return null!==S&&0===rR.comparator(this.path,S.path)}toString(){return this.path.toString()}static comparator(S,T){return rR.comparator(S.path,T.path)}static isDocumentKey(S){return S.length%2==0}static fromSegments(S){return new rk(new rR(S.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rN(S,T,R){if(!R)throw new ri(rn.INVALID_ARGUMENT,`Function ${S}() cannot be called with an empty ${T}.`)}function rO(S,T,R,N){if(!0===T&&!0===N)throw new ri(rn.INVALID_ARGUMENT,`${S} and ${R} cannot be used together.`)}function rx(S){if(!rk.isDocumentKey(S))throw new ri(rn.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${S} has ${S.length}.`)}function rP(S){if(rk.isDocumentKey(S))throw new ri(rn.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${S} has ${S.length}.`)}function rM(S){return"object"==typeof S&&null!==S&&(Object.getPrototypeOf(S)===Object.prototype||null===Object.getPrototypeOf(S))}function rL(S){if(void 0===S)return"undefined";if(null===S)return"null";if("string"==typeof S)return S.length>20&&(S=`${S.substring(0,20)}...`),JSON.stringify(S);if("number"==typeof S||"boolean"==typeof S)return""+S;if("object"==typeof S){if(S instanceof Array)return"an array";{let T=rF(S);return T?`a custom ${T} object`:"an object"}}if("function"==typeof S)return"a function";return t8(12329,{type:typeof S})}function rF(S){return S.constructor?S.constructor.name:null}function rB(S,T){if("_delegate"in S&&(S=S._delegate),!(S instanceof T)){if(T.name===S.constructor.name)throw new ri(rn.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let R=rL(S);throw new ri(rn.INVALID_ARGUMENT,`Expected type '${T.name}', but it was: ${R}`)}}return S}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rj(S,T){let R={typeString:S};return T&&(R.value=T),R}function rU(S,T){let R;if(!rM(S))throw new ri(rn.INVALID_ARGUMENT,"JSON must be an object");for(let N in T)if(T[N]){let O=T[N].typeString,P="value"in T[N]?{value:T[N].value}:void 0;if(!(N in S)){R=`JSON missing required field: '${N}'`;break}let M=S[N];if(O&&typeof M!==O){R=`JSON field '${N}' must be a ${O}.`;break}if(void 0!==P&&M!==P.value){R=`Expected '${N}' field to equal '${P.value}'`;break}}if(R)throw new ri(rn.INVALID_ARGUMENT,R);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rV=-62135596800,rz=1e6;class rq{static now(){return rq.fromMillis(Date.now())}static fromDate(S){return rq.fromMillis(S.getTime())}static fromMillis(S){let T=Math.floor(S/1e3),R=Math.floor((S-1e3*T)*rz);return new rq(T,R)}constructor(S,T){if(this.seconds=S,this.nanoseconds=T,T<0||T>=1e9)throw new ri(rn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+T);if(S<rV||S>=253402300800)throw new ri(rn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+S)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/rz}_compareTo(S){return this.seconds===S.seconds?rb(this.nanoseconds,S.nanoseconds):rb(this.seconds,S.seconds)}isEqual(S){return S.seconds===this.seconds&&S.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:rq._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(S){if(rU(S,rq._jsonSchema))return new rq(S.seconds,S.nanoseconds)}valueOf(){return String(this.seconds-rV).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}rq._jsonSchemaVersion="firestore/timestamp/1.0",rq._jsonSchema={type:rj("string",rq._jsonSchemaVersion),seconds:rj("number"),nanoseconds:rj("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r${static fromTimestamp(S){return new r$(S)}static min(){return new r$(new rq(0,0))}static max(){return new r$(new rq(253402300799,1e9-1))}constructor(S){this.timestamp=S}compareTo(S){return this.timestamp._compareTo(S.timestamp)}isEqual(S){return this.timestamp.isEqual(S.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rG=-1,rK=0;class rW{constructor(S,T,R,N){this.indexId=S,this.collectionGroup=T,this.fields=R,this.indexState=N}}function rH(S){return S.fields.find(S=>2===S.kind)}function rQ(S){return S.fields.filter(S=>2!==S.kind)}function rY(S){let T=rQ(S);return 0===T.length?0:T[T.length-1].kind}function rJ(S,T){let R=rb(S.collectionGroup,T.collectionGroup);if(0!==R)return R;for(let N=0;N<Math.min(S.fields.length,T.fields.length);++N)if(0!==(R=r0(S.fields[N],T.fields[N])))return R;return rb(S.fields.length,T.fields.length)}function rX(S){return`id=${S.indexId}|cg=${S.collectionGroup}|f=${S.fields.map(S=>`${S.fieldPath}:${S.kind}`).join(",")}`}rW.UNKNOWN_ID=-1;class rZ{constructor(S,T){this.fieldPath=S,this.kind=T}}function r0(S,T){let R=rA.comparator(S.fieldPath,T.fieldPath);return 0!==R?R:rb(S.kind,T.kind)}class r1{constructor(S,T){this.sequenceNumber=S,this.offset=T}static empty(){return new r1(rK,r4.min())}}function r2(S,T){let R=S.toTimestamp().seconds,N=S.toTimestamp().nanoseconds+1;return new r4(r$.fromTimestamp(1e9===N?new rq(R+1,0):new rq(R,N)),rk.empty(),T)}function r3(S){return new r4(S.readTime,S.key,rG)}class r4{constructor(S,T,R){this.readTime=S,this.documentKey=T,this.largestBatchId=R}static min(){return new r4(r$.min(),rk.empty(),rG)}static max(){return new r4(r$.max(),rk.empty(),rG)}}function r6(S,T){let R=S.readTime.compareTo(T.readTime);return 0!==R||0!==(R=rk.comparator(S.documentKey,T.documentKey))?R:rb(S.largestBatchId,T.largestBatchId)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let r9="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class r5{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(S){this.onCommittedListeners.push(S)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(S=>S())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function r8(S){if(S.code===rn.FAILED_PRECONDITION&&S.message===r9)t4("LocalStore","Unexpectedly lost primary lease");else throw S}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r7{constructor(S){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,S(S=>{this.isDone=!0,this.result=S,this.nextCallback&&this.nextCallback(S)},S=>{this.isDone=!0,this.error=S,this.catchCallback&&this.catchCallback(S)})}catch(S){return this.next(void 0,S)}next(S,T){return(this.callbackAttached&&t8(59440),this.callbackAttached=!0,this.isDone)?this.error?this.wrapFailure(T,this.error):this.wrapSuccess(S,this.result):new r7((R,N)=>{this.nextCallback=T=>{this.wrapSuccess(S,T).next(R,N)},this.catchCallback=S=>{this.wrapFailure(T,S).next(R,N)}})}toPromise(){return new Promise((S,T)=>{this.next(S,T)})}wrapUserFunction(S){try{let T=S();if(T instanceof r7)return T;return r7.resolve(T)}catch(S){return r7.reject(S)}}wrapSuccess(S,T){return S?this.wrapUserFunction(()=>S(T)):r7.resolve(T)}wrapFailure(S,T){return S?this.wrapUserFunction(()=>S(T)):r7.reject(T)}static resolve(S){return new r7((T,R)=>{T(S)})}static reject(S){return new r7((T,R)=>{R(S)})}static waitFor(S){return new r7((T,R)=>{let N=0,O=0,P=!1;S.forEach(S=>{++N,S.next(()=>{++O,P&&O===N&&T()},S=>R(S))}),P=!0,O===N&&T()})}static or(S){let T=r7.resolve(!1);for(let R of S)T=T.next(S=>S?r7.resolve(S):R());return T}static forEach(S,T){let R=[];return S.forEach((S,N)=>{R.push(T.call(this,S,N))}),this.waitFor(R)}static mapArray(S,T){return new r7((R,N)=>{let O=S.length,P=Array(O),M=0;for(let L=0;L<O;L++){let U=L;T(S[U]).next(S=>{P[U]=S,++M===O&&R(P)},S=>N(S))}})}static doWhile(S,T){return new r7((R,N)=>{let O=()=>{!0===S()?T().next(()=>{O()},N):R()};O()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ne="SimpleDb",nt=3;class nn{static open(S,T,R,N){try{return new nn(T,S.transaction(N,R))}catch(S){throw new nu(T,S)}}constructor(S,T){this.action=S,this.transaction=T,this.aborted=!1,this.completionDeferred=new rs,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{T.error?this.completionDeferred.reject(new nu(S,T.error)):this.completionDeferred.resolve()},this.transaction.onerror=T=>{let R=nf(T.target.error);this.completionDeferred.reject(new nu(S,R))}}get completionPromise(){return this.completionDeferred.promise}abort(S){S&&this.completionDeferred.reject(S),this.aborted||(t4(ne,"Aborting transaction:",S?S.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let S=this.transaction;this.aborted||"function"!=typeof S.commit||S.commit()}store(S){return new nd(this.transaction.objectStore(S))}}class ni{static delete(S){return t4(ne,"Removing database:",S),nh(getGlobal().indexedDB.deleteDatabase(S)).toPromise()}static isAvailable(){if(!isIndexedDBAvailable())return!1;if(ni.isMockPersistence())return!0;let S=getUA(),T=ni.getIOSVersion(S),R=0<T&&T<10,N=na(S),O=0<N&&N<4.5;return!(S.indexOf("MSIE ")>0||S.indexOf("Trident/")>0||S.indexOf("Edge/")>0)&&!R&&!O}static isMockPersistence(){var S;return"undefined"!=typeof process&&(null===(S=process.env)||void 0===S?void 0:S.USE_MOCK_PERSISTENCE)==="YES"}static getStore(S,T){return S.store(T)}static getIOSVersion(S){let T=S.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(T?T[1].split("_").slice(0,2).join("."):"-1")}constructor(S,T,R){this.name=S,this.version=T,this.schemaConverter=R,this.lastClosedDbVersion=null,12.2===ni.getIOSVersion(getUA())&&t6("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async ensureDb(S){return this.db||(t4(ne,"Opening database:",this.name),this.db=await new Promise((T,R)=>{let N=indexedDB.open(this.name,this.version);N.onsuccess=S=>{T(S.target.result)},N.onblocked=()=>{R(new nu(S,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},N.onerror=T=>{let N=T.target.error;"VersionError"===N.name?R(new ri(rn.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===N.name?R(new ri(rn.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+N)):R(new nu(S,N))},N.onupgradeneeded=S=>{t4(ne,'Database "'+this.name+'" requires upgrade from version:',S.oldVersion);let T=S.target.result;if(null!==this.lastClosedDbVersion&&this.lastClosedDbVersion!==S.oldVersion)throw Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.lastClosedDbVersion}, event.oldVersion=${S.oldVersion}, event.newVersion=${S.newVersion}, db.version=${T.version}`);this.schemaConverter.createOrUpgrade(T,N.transaction,S.oldVersion,this.version).next(()=>{t4(ne,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",S=>{let T=S.target;this.lastClosedDbVersion=T.version},{passive:!0})),this.db.addEventListener("versionchange",S=>{var T;null===S.newVersion&&(t9('Received "versionchange" event with newVersion===null; notifying the registered DatabaseDeletedListener, if any'),null===(T=this.databaseDeletedListener)||void 0===T||T.call(this))},{passive:!0}),this.db}setDatabaseDeletedListener(S){if(this.databaseDeletedListener)throw Error("setDatabaseDeletedListener() may only be called once, and it has already been called");this.databaseDeletedListener=S}async runTransaction(S,T,R,N){let O="readonly"===T,P=0;for(;;){++P;try{this.db=await this.ensureDb(S);let T=nn.open(this.db,S,O?"readonly":"readwrite",R),P=N(T).next(S=>(T.maybeCommit(),S)).catch(S=>(T.abort(S),r7.reject(S))).toPromise();return P.catch(()=>{}),await T.completionPromise,P}catch(R){let S=R,T="FirebaseError"!==S.name&&P<nt;if(t4(ne,"Transaction failed with error:",S.message,"Retrying:",T),this.close(),!T)return Promise.reject(S)}}}close(){this.db&&this.db.close(),this.db=void 0}}function na(S){let T=S.match(/Android ([\d.]+)/i);return Number(T?T[1].split(".").slice(0,2).join("."):"-1")}class no{constructor(S){this.dbCursor=S,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(S){this.dbCursor=S}done(){this.shouldStop=!0}skip(S){this.nextKey=S}delete(){return nh(this.dbCursor.delete())}}class nu extends null{constructor(S,T){super(rn.UNAVAILABLE,`IndexedDB transaction '${S}' failed: ${T}`),this.name="IndexedDbTransactionError"}}function nc(S){return"IndexedDbTransactionError"===S.name}class nd{constructor(S){this.store=S}put(S,T){let R;return void 0!==T?(t4(ne,"PUT",this.store.name,S,T),R=this.store.put(T,S)):(t4(ne,"PUT",this.store.name,"<auto-key>",S),R=this.store.put(S)),nh(R)}add(S){return t4(ne,"ADD",this.store.name,S,S),nh(this.store.add(S))}get(S){return nh(this.store.get(S)).next(T=>(void 0===T&&(T=null),t4(ne,"GET",this.store.name,S,T),T))}delete(S){return t4(ne,"DELETE",this.store.name,S),nh(this.store.delete(S))}count(){return t4(ne,"COUNT",this.store.name),nh(this.store.count())}loadAll(S,T){let R=this.options(S,T),N=R.index?this.store.index(R.index):this.store;if("function"==typeof N.getAll){let S=N.getAll(R.range);return new r7((T,R)=>{S.onerror=S=>{R(S.target.error)},S.onsuccess=S=>{T(S.target.result)}})}{let S=this.cursor(R),T=[];return this.iterateCursor(S,(S,R)=>{T.push(R)}).next(()=>T)}}loadFirst(S,T){let R=this.store.getAll(S,null===T?void 0:T);return new r7((S,T)=>{R.onerror=S=>{T(S.target.error)},R.onsuccess=T=>{S(T.target.result)}})}deleteAll(S,T){t4(ne,"DELETE ALL",this.store.name);let R=this.options(S,T);R.keysOnly=!1;let N=this.cursor(R);return this.iterateCursor(N,(S,T,R)=>R.delete())}iterate(S,T){let R;T?R=S:(R={},T=S);let N=this.cursor(R);return this.iterateCursor(N,T)}iterateSerial(S){let T=this.cursor({});return new r7((R,N)=>{T.onerror=S=>{N(nf(S.target.error))},T.onsuccess=T=>{let N=T.target.result;if(!N){R();return}S(N.primaryKey,N.value).next(S=>{S?N.continue():R()})}})}iterateCursor(S,T){let R=[];return new r7((N,O)=>{S.onerror=S=>{O(S.target.error)},S.onsuccess=S=>{let O=S.target.result;if(!O){N();return}let P=new no(O),M=T(O.primaryKey,O.value,P);if(M instanceof r7){let S=M.catch(S=>(P.done(),r7.reject(S)));R.push(S)}P.isDone?N():null===P.skipToKey?O.continue():O.continue(P.skipToKey)}}).next(()=>r7.waitFor(R))}options(S,T){let R;return void 0!==S&&("string"==typeof S?R=S:T=S),{index:R,range:T}}cursor(S){let T="next";if(S.reverse&&(T="prev"),!S.index)return this.store.openCursor(S.range,T);{let R=this.store.index(S.index);return S.keysOnly?R.openKeyCursor(S.range,T):R.openCursor(S.range,T)}}}function nh(S){return new r7((T,R)=>{S.onsuccess=S=>{T(S.target.result)},S.onerror=S=>{R(nf(S.target.error))}})}let np=!1;function nf(S){let T=ni.getIOSVersion(getUA());if(T>=12.2&&T<13){let T="An internal error was encountered in the Indexed Database server";if(S.message.indexOf(T)>=0){let S=new ri("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${T}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return np||(np=!0,setTimeout(()=>{throw S},0)),S}}return S}let nm="IndexBackfiller",ng=null,ny=null,nv=50;class nb{constructor(S,T){this.asyncQueue=S,this.backfiller=T,this.task=null}start(){this.schedule(ng)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}schedule(S){t4(nm,`Scheduled in ${S}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",S,async()=>{this.task=null;try{let S=await this.backfiller.backfill();t4(nm,`Documents written: ${S}`)}catch(S){nc(S)?t4(nm,"Ignoring IndexedDB error during index backfill: ",S):await r8(S)}await this.schedule(ny)})}}class nS{constructor(S,T){this.localStore=S,this.persistence=T}async backfill(S=nv){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",T=>this.writeIndexEntries(T,S))}writeIndexEntries(S,T){let R=new Set,N=T,O=!0;return r7.doWhile(()=>!0===O&&N>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(S).next(T=>{if(!(null===T||R.has(T)))return t4(nm,`Processing collection: ${T}`),this.writeEntriesForCollectionGroup(S,T,N).next(S=>{N-=S,R.add(T)});O=!1})).next(()=>T-N)}writeEntriesForCollectionGroup(S,T,R){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(S,T).next(N=>this.localStore.localDocuments.getNextDocuments(S,T,N,R).next(R=>{let O=R.changes;return this.localStore.indexManager.updateIndexEntries(S,O).next(()=>this.getNewOffset(N,R)).next(R=>(t4(nm,`Updating offset: ${R}`),this.localStore.indexManager.updateCollectionGroup(S,T,R))).next(()=>O.size)}))}getNewOffset(S,T){let R=S;return T.changes.forEach((S,T)=>{let N=r3(T);r6(N,R)>0&&(R=N)}),new r4(R.readTime,R.documentKey,Math.max(T.batchId,S.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nT{constructor(S,T){this.previousValue=S,T&&(T.sequenceNumberHandler=S=>this.setPreviousValue(S),this.writeNewSequenceNumber=S=>T.writeSequenceNumber(S))}setPreviousValue(S){return this.previousValue=Math.max(S,this.previousValue),this.previousValue}next(){let S=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(S),S}}nT.INVALID=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nE="\x01",nC="\x01",nw="\x10",n_="\x11";function nI(S){let T="";for(let R=0;R<S.length;R++)T.length>0&&(T=nD(T)),T=nR(S.get(R),T);return nD(T)}function nR(S,T){let R=T,N=S.length;for(let T=0;T<N;T++){let N=S.charAt(T);switch(N){case"\x00":R+=nE+nw;break;case nE:R+=nE+n_;break;default:R+=N}}return R}function nD(S){return S+nE+nC}function nA(S){let T=S.length;if(rt(T>=2,64408,{path:S}),2===T)return rt(S.charAt(0)===nE&&S.charAt(1)===nC,56145,{path:S}),rR.emptyPath();let R=T-2,N=[],O="";for(let P=0;P<T;){let T=S.indexOf(nE,P);switch((T<0||T>R)&&t8(50515,{path:S}),S.charAt(T+1)){case nC:let M;let L=S.substring(P,T);0===O.length?M=L:(O+=L,M=O,O=""),N.push(M);break;case nw:O+=S.substring(P,T)+"\x00";break;case n_:O+=S.substring(P,T+1);break;default:t8(61167,{path:S})}P=T+2}return new rR(N)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nk="remoteDocuments",nN="owner",nO="owner",nx="mutationQueues",nP="userId",nM="mutations",nL="batchId",nF="userMutationsIndex",nB=null;function nj(S){return[S]}function nU(S,T){return[S,nI(T)]}function nV(S,T,R){return[S,nI(T),R]}let nz={},nq="documentMutations",n$="remoteDocumentsV14",nG=null,nK="documentKeyIndex",nW=null,nH="collectionGroupIndex",nQ=null,nY="remoteDocumentGlobal",nJ="remoteDocumentGlobalKey",nX="targets",nZ="targetId",n0="queryTargetsIndex",n3=null,n4="targetDocuments",n6=null,n9="documentTargetsIndex",n5=null,n8="targetGlobalKey",n7="targetGlobal",ie="collectionParents",ir=null,ii="clientMetadata",is="clientId",ia="bundles",io="bundleId",il="namedQueries",iu="name",ic="indexConfiguration",ih="indexId",im="collectionGroupIndex",ig="collectionGroup",iy="indexState",iv=null,ib="sequenceNumberIndex",iS=null,iT="indexEntries",iE=null,iC="documentKeyIndex",iw=null,i_="documentOverlays",iI=null,iR="collectionPathOverlayIndex",iD=null,iA="collectionGroupOverlayIndex",ik=null,iN="globals",iO="name",ix=[nx,nM,nq,nk,nX,nN,n7,n4,ii,nY,ie,ia,il],iP=[...ix,i_],iM=[nx,nM,nq,n$,nX,nN,n7,n4,ii,nY,ie,ia,il,i_],iL=iM,iF=[...iL,ic,iy,iT],iB=null,ij=[...iF,iN],iU=null;function iV(S){return 18===S?iU:17===S?ij:16===S?iB:15===S?iF:14===S?iL:13===S?iM:12===S?iP:11===S?ix:void t8(60245)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iz extends null{constructor(S,T){super(),this.simpleDbTransaction=S,this.currentSequenceNumber=T}}function iq(S,T){let R=rr(S);return ni.getStore(R.simpleDbTransaction,T)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i$(S){let T=0;for(let R in S)Object.prototype.hasOwnProperty.call(S,R)&&T++;return T}function iG(S,T){for(let R in S)Object.prototype.hasOwnProperty.call(S,R)&&T(R,S[R])}function iK(S){for(let T in S)if(Object.prototype.hasOwnProperty.call(S,T))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iW{constructor(S,T){this.comparator=S,this.root=T||iQ.EMPTY}insert(S,T){return new iW(this.comparator,this.root.insert(S,T,this.comparator).copy(null,null,iQ.BLACK,null,null))}remove(S){return new iW(this.comparator,this.root.remove(S,this.comparator).copy(null,null,iQ.BLACK,null,null))}get(S){let T=this.root;for(;!T.isEmpty();){let R=this.comparator(S,T.key);if(0===R)return T.value;R<0?T=T.left:R>0&&(T=T.right)}return null}indexOf(S){let T=0,R=this.root;for(;!R.isEmpty();){let N=this.comparator(S,R.key);if(0===N)return T+R.left.size;N<0?R=R.left:(T+=R.left.size+1,R=R.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(S){return this.root.inorderTraversal(S)}forEach(S){this.inorderTraversal((T,R)=>(S(T,R),!1))}toString(){let S=[];return this.inorderTraversal((T,R)=>(S.push(`${T}:${R}`),!1)),`{${S.join(", ")}}`}reverseTraversal(S){return this.root.reverseTraversal(S)}getIterator(){return new iH(this.root,null,this.comparator,!1)}getIteratorFrom(S){return new iH(this.root,S,this.comparator,!1)}getReverseIterator(){return new iH(this.root,null,this.comparator,!0)}getReverseIteratorFrom(S){return new iH(this.root,S,this.comparator,!0)}}class iH{constructor(S,T,R,N){this.isReverse=N,this.nodeStack=[];let O=1;for(;!S.isEmpty();)if(O=T?R(S.key,T):1,T&&N&&(O*=-1),O<0)S=this.isReverse?S.left:S.right;else if(0===O){this.nodeStack.push(S);break}else this.nodeStack.push(S),S=this.isReverse?S.right:S.left}getNext(){let S=this.nodeStack.pop(),T={key:S.key,value:S.value};if(this.isReverse)for(S=S.left;!S.isEmpty();)this.nodeStack.push(S),S=S.right;else for(S=S.right;!S.isEmpty();)this.nodeStack.push(S),S=S.left;return T}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let S=this.nodeStack[this.nodeStack.length-1];return{key:S.key,value:S.value}}}class iQ{constructor(S,T,R,N,O){this.key=S,this.value=T,this.color=null!=R?R:iQ.RED,this.left=null!=N?N:iQ.EMPTY,this.right=null!=O?O:iQ.EMPTY,this.size=this.left.size+1+this.right.size}copy(S,T,R,N,O){return new iQ(null!=S?S:this.key,null!=T?T:this.value,null!=R?R:this.color,null!=N?N:this.left,null!=O?O:this.right)}isEmpty(){return!1}inorderTraversal(S){return this.left.inorderTraversal(S)||S(this.key,this.value)||this.right.inorderTraversal(S)}reverseTraversal(S){return this.right.reverseTraversal(S)||S(this.key,this.value)||this.left.reverseTraversal(S)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(S,T,R){let N=this,O=R(S,N.key);return(N=O<0?N.copy(null,null,null,N.left.insert(S,T,R),null):0===O?N.copy(null,T,null,null,null):N.copy(null,null,null,null,N.right.insert(S,T,R))).fixUp()}removeMin(){if(this.left.isEmpty())return iQ.EMPTY;let S=this;return S.left.isRed()||S.left.left.isRed()||(S=S.moveRedLeft()),(S=S.copy(null,null,null,S.left.removeMin(),null)).fixUp()}remove(S,T){let R;let N=this;if(0>T(S,N.key))N.left.isEmpty()||N.left.isRed()||N.left.left.isRed()||(N=N.moveRedLeft()),N=N.copy(null,null,null,N.left.remove(S,T),null);else{if(N.left.isRed()&&(N=N.rotateRight()),N.right.isEmpty()||N.right.isRed()||N.right.left.isRed()||(N=N.moveRedRight()),0===T(S,N.key)){if(N.right.isEmpty())return iQ.EMPTY;R=N.right.min(),N=N.copy(R.key,R.value,null,null,N.right.removeMin())}N=N.copy(null,null,null,null,N.right.remove(S,T))}return N.fixUp()}isRed(){return this.color}fixUp(){let S=this;return S.right.isRed()&&!S.left.isRed()&&(S=S.rotateLeft()),S.left.isRed()&&S.left.left.isRed()&&(S=S.rotateRight()),S.left.isRed()&&S.right.isRed()&&(S=S.colorFlip()),S}moveRedLeft(){let S=this.colorFlip();return S.right.left.isRed()&&(S=(S=(S=S.copy(null,null,null,null,S.right.rotateRight())).rotateLeft()).colorFlip()),S}moveRedRight(){let S=this.colorFlip();return S.left.left.isRed()&&(S=(S=S.rotateRight()).colorFlip()),S}rotateLeft(){let S=this.copy(null,null,iQ.RED,null,this.right.left);return this.right.copy(null,null,this.color,S,null)}rotateRight(){let S=this.copy(null,null,iQ.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,S)}colorFlip(){let S=this.left.copy(null,null,!this.left.color,null,null),T=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,S,T)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw t8(43730,{key:this.key,value:this.value});if(this.right.isRed())throw t8(14113,{key:this.key,value:this.value});let S=this.left.check();if(S===this.right.check())return S+(this.isRed()?0:1);throw t8(27949)}}iQ.EMPTY=null,iQ.RED=!0,iQ.BLACK=!1;class iY{constructor(){this.size=0}get key(){throw t8(57766)}get value(){throw t8(16141)}get color(){throw t8(16727)}get left(){throw t8(29726)}get right(){throw t8(36894)}copy(S,T,R,N,O){return this}insert(S,T,R){return new iQ(S,T)}remove(S,T){return this}isEmpty(){return!0}inorderTraversal(S){return!1}reverseTraversal(S){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}}iQ.EMPTY=new iY;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iJ{constructor(S){this.comparator=S,this.data=new iW(this.comparator)}has(S){return null!==this.data.get(S)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(S){return this.data.indexOf(S)}forEach(S){this.data.inorderTraversal((T,R)=>(S(T),!1))}forEachInRange(S,T){let R=this.data.getIteratorFrom(S[0]);for(;R.hasNext();){let N=R.getNext();if(this.comparator(N.key,S[1])>=0)return;T(N.key)}}forEachWhile(S,T){let R;for(R=void 0!==T?this.data.getIteratorFrom(T):this.data.getIterator();R.hasNext();)if(!S(R.getNext().key))return}firstAfterOrEqual(S){let T=this.data.getIteratorFrom(S);return T.hasNext()?T.getNext().key:null}getIterator(){return new iX(this.data.getIterator())}getIteratorFrom(S){return new iX(this.data.getIteratorFrom(S))}add(S){return this.copy(this.data.remove(S).insert(S,!0))}delete(S){return this.has(S)?this.copy(this.data.remove(S)):this}isEmpty(){return this.data.isEmpty()}unionWith(S){let T=this;return T.size<S.size&&(T=S,S=this),S.forEach(S=>{T=T.add(S)}),T}isEqual(S){if(!(S instanceof iJ)||this.size!==S.size)return!1;let T=this.data.getIterator(),R=S.data.getIterator();for(;T.hasNext();){let S=T.getNext().key,N=R.getNext().key;if(0!==this.comparator(S,N))return!1}return!0}toArray(){let S=[];return this.forEach(T=>{S.push(T)}),S}toString(){let S=[];return this.forEach(T=>S.push(T)),"SortedSet("+S.toString()+")"}copy(S){let T=new iJ(this.comparator);return T.data=S,T}}class iX{constructor(S){this.iter=S}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function iZ(S,T,R,N,O){let P=S.getIterator(),M=T.getIterator(),L=i0(P),U=i0(M);for(;L||U;){let S=!1,T=!1;if(L&&U){let N=R(L,U);N<0?T=!0:N>0&&(S=!0)}else null!=L?T=!0:S=!0;S?(N(U),U=i0(M)):T?(O(L),L=i0(P)):(L=i0(P),U=i0(M))}}function i0(S){return S.hasNext()?S.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i1{constructor(S){this.fields=S,S.sort(rA.comparator)}static empty(){return new i1([])}unionWith(S){let T=new iJ(rA.comparator);for(let S of this.fields)T=T.add(S);for(let R of S)T=T.add(R);return new i1(T.toArray())}covers(S){for(let T of this.fields)if(T.isPrefixOf(S))return!0;return!1}isEqual(S){return rC(this.fields,S.fields,(S,T)=>S.isEqual(T))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i2(S){return Buffer.from(S,"base64").toString("binary")}function i3(S){return Buffer.from(S,"binary").toString("base64")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i4{constructor(S){this.binaryString=S}static fromBase64String(S){return new i4(i2(S))}static fromUint8Array(S){return new i4(i6(S))}[Symbol.iterator](){let S=0;return{next:()=>S<this.binaryString.length?{value:this.binaryString.charCodeAt(S++),done:!1}:{value:void 0,done:!0}}}toBase64(){return i3(this.binaryString)}toUint8Array(){return i9(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(S){return rb(this.binaryString,S.binaryString)}isEqual(S){return this.binaryString===S.binaryString}}function i6(S){let T="";for(let R=0;R<S.length;++R)T+=String.fromCharCode(S[R]);return T}function i9(S){let T=new Uint8Array(S.length);for(let R=0;R<S.length;R++)T[R]=S.charCodeAt(R);return T}i4.EMPTY_BYTE_STRING=new i4("");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let i5=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function i8(S){if(rt(!!S,39018),"string"==typeof S){let T=0,R=i5.exec(S);if(rt(!!R,46558,{timestamp:S}),R[1]){let S=R[1];T=Number(S=(S+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(S).getTime()/1e3),nanos:T}}return{seconds:i7(S.seconds),nanos:i7(S.nanos)}}function i7(S){return"number"==typeof S?S:"string"==typeof S?Number(S):0}function se(S){return"string"==typeof S?i4.fromBase64String(S):i4.fromUint8Array(S)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let st="server_timestamp",sr="__type__",sn="__previous_value__",si="__local_write_time__";function ss(S){var T,R;return(null===(R=((null===(T=null==S?void 0:S.mapValue)||void 0===T?void 0:T.fields)||{})[sr])||void 0===R?void 0:R.stringValue)===st}function sa(S,T){let R={fields:{[sr]:{stringValue:st},[si]:{timestampValue:{seconds:S.seconds,nanos:S.nanoseconds}}}};return T&&ss(T)&&(T=so(T)),T&&(R.fields[sn]=T),{mapValue:R}}function so(S){let T=S.mapValue.fields[sn];return ss(T)?so(T):T}function sl(S){let T=i8(S.mapValue.fields[si].timestampValue);return new rq(T.seconds,T.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class su{constructor(S,T,R,N,O,P,M,L,U,V){this.databaseId=S,this.appId=T,this.persistenceKey=R,this.host=N,this.ssl=O,this.forceLongPolling=P,this.autoDetectLongPolling=M,this.longPollingOptions=L,this.useFetchStreams=U,this.isUsingEmulator=V}}let sc="(default)";class sd{constructor(S,T){this.projectId=S,this.database=T||sc}static empty(){return new sd("","")}get isDefaultDatabase(){return this.database===sc}isEqual(S){return S instanceof sd&&S.projectId===this.projectId&&S.database===this.database}}function sh(S,T){if(!Object.prototype.hasOwnProperty.apply(S.options,["projectId"]))throw new ri(rn.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new sd(S.options.projectId,T)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sp=-1;function sf(S){return null==S}function sm(S){return 0===S&&1/S==-1/0}function sg(S){return"number"==typeof S&&Number.isInteger(S)&&!sm(S)&&S<=Number.MAX_SAFE_INTEGER&&S>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sy="__type__",sv="__max__",sb={mapValue:{fields:{__type__:{stringValue:sv}}}},sS="__vector__",sT="value",sE={nullValue:"NULL_VALUE"};function sC(S){return"nullValue"in S?0:"booleanValue"in S?1:"integerValue"in S||"doubleValue"in S?2:"timestampValue"in S?3:"stringValue"in S?5:"bytesValue"in S?6:"referenceValue"in S?7:"geoPointValue"in S?8:"arrayValue"in S?9:"mapValue"in S?ss(S)?4:s5(S)?9007199254740991:s6(S)?10:11:t8(28295,{value:S})}function sw(S,T){if(S===T)return!0;let R=sC(S);if(R!==sC(T))return!1;switch(R){case 0:case 9007199254740991:return!0;case 1:return S.booleanValue===T.booleanValue;case 4:return sl(S).isEqual(sl(T));case 3:return s_(S,T);case 5:return S.stringValue===T.stringValue;case 6:return sR(S,T);case 7:return S.referenceValue===T.referenceValue;case 8:return sI(S,T);case 2:return sD(S,T);case 9:return rC(S.arrayValue.values||[],T.arrayValue.values||[],sw);case 10:case 11:return sA(S,T);default:return t8(52216,{left:S})}}function s_(S,T){if("string"==typeof S.timestampValue&&"string"==typeof T.timestampValue&&S.timestampValue.length===T.timestampValue.length)return S.timestampValue===T.timestampValue;let R=i8(S.timestampValue),N=i8(T.timestampValue);return R.seconds===N.seconds&&R.nanos===N.nanos}function sI(S,T){return i7(S.geoPointValue.latitude)===i7(T.geoPointValue.latitude)&&i7(S.geoPointValue.longitude)===i7(T.geoPointValue.longitude)}function sR(S,T){return se(S.bytesValue).isEqual(se(T.bytesValue))}function sD(S,T){if("integerValue"in S&&"integerValue"in T)return i7(S.integerValue)===i7(T.integerValue);if("doubleValue"in S&&"doubleValue"in T){let R=i7(S.doubleValue),N=i7(T.doubleValue);return R===N?sm(R)===sm(N):isNaN(R)&&isNaN(N)}return!1}function sA(S,T){let R=S.mapValue.fields||{},N=T.mapValue.fields||{};if(i$(R)!==i$(N))return!1;for(let S in R)if(R.hasOwnProperty(S)&&(void 0===N[S]||!sw(R[S],N[S])))return!1;return!0}function sk(S,T){return void 0!==(S.values||[]).find(S=>sw(S,T))}function sN(S,T){if(S===T)return 0;let R=sC(S),N=sC(T);if(R!==N)return rb(R,N);switch(R){case 0:case 9007199254740991:return 0;case 1:return rb(S.booleanValue,T.booleanValue);case 2:return sO(S,T);case 3:return sx(S.timestampValue,T.timestampValue);case 4:return sx(sl(S),sl(T));case 5:return rS(S.stringValue,T.stringValue);case 6:return sL(S.bytesValue,T.bytesValue);case 7:return sP(S.referenceValue,T.referenceValue);case 8:return sM(S.geoPointValue,T.geoPointValue);case 9:return sF(S.arrayValue,T.arrayValue);case 10:return sB(S.mapValue,T.mapValue);case 11:return sj(S.mapValue,T.mapValue);default:throw t8(23264,{leftType:R})}}function sO(S,T){let R=i7(S.integerValue||S.doubleValue),N=i7(T.integerValue||T.doubleValue);return R<N?-1:R>N?1:R===N?0:isNaN(R)?isNaN(N)?0:-1:1}function sx(S,T){if("string"==typeof S&&"string"==typeof T&&S.length===T.length)return rb(S,T);let R=i8(S),N=i8(T),O=rb(R.seconds,N.seconds);return 0!==O?O:rb(R.nanos,N.nanos)}function sP(S,T){let R=S.split("/"),N=T.split("/");for(let S=0;S<R.length&&S<N.length;S++){let T=rb(R[S],N[S]);if(0!==T)return T}return rb(R.length,N.length)}function sM(S,T){let R=rb(i7(S.latitude),i7(T.latitude));return 0!==R?R:rb(i7(S.longitude),i7(T.longitude))}function sL(S,T){let R=se(S),N=se(T);return R.compareTo(N)}function sF(S,T){let R=S.values||[],N=T.values||[];for(let S=0;S<R.length&&S<N.length;++S){let T=sN(R[S],N[S]);if(T)return T}return rb(R.length,N.length)}function sB(S,T){var R,N,O,P;let M=S.fields||{},L=T.fields||{},U=null===(R=M[sT])||void 0===R?void 0:R.arrayValue,V=null===(N=L[sT])||void 0===N?void 0:N.arrayValue,$=rb((null===(O=null==U?void 0:U.values)||void 0===O?void 0:O.length)||0,(null===(P=null==V?void 0:V.values)||void 0===P?void 0:P.length)||0);return 0!==$?$:sF(U,V)}function sj(S,T){if(S===sb.mapValue&&T===sb.mapValue)return 0;if(S===sb.mapValue)return 1;if(T===sb.mapValue)return -1;let R=S.fields||{},N=Object.keys(R),O=T.fields||{},P=Object.keys(O);N.sort(),P.sort();for(let S=0;S<N.length&&S<P.length;++S){let T=rS(N[S],P[S]);if(0!==T)return T;let M=sN(R[N[S]],O[P[S]]);if(0!==M)return M}return rb(N.length,P.length)}function sU(S){return sV(S)}function sV(S){if("nullValue"in S)return"null";if("booleanValue"in S)return""+S.booleanValue;if("integerValue"in S)return""+S.integerValue;if("doubleValue"in S)return""+S.doubleValue;if("timestampValue"in S)return sq(S.timestampValue);if("stringValue"in S)return S.stringValue;if("bytesValue"in S)return sz(S.bytesValue);else if("referenceValue"in S)return sG(S.referenceValue);else if("geoPointValue"in S)return s$(S.geoPointValue);else if("arrayValue"in S)return sW(S.arrayValue);else if("mapValue"in S)return sK(S.mapValue);else return t8(61005,{value:S})}function sz(S){return se(S).toBase64()}function sq(S){let T=i8(S);return`time(${T.seconds},${T.nanos})`}function s$(S){return`geo(${S.latitude},${S.longitude})`}function sG(S){return rk.fromName(S).toString()}function sK(S){let T=Object.keys(S.fields||{}).sort(),R="{",N=!0;for(let O of T)N?N=!1:R+=",",R+=`${O}:${sV(S.fields[O])}`;return R+"}"}function sW(S){let T="[",R=!0;for(let N of S.values||[])R?R=!1:T+=",",T+=sV(N);return T+"]"}function sH(S){switch(sC(S)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let T=so(S);return T?16+sH(T):16;case 5:return 2*S.stringValue.length;case 6:return se(S.bytesValue).approximateByteSize();case 7:return S.referenceValue.length;case 9:return sY(S.arrayValue);case 10:case 11:return sQ(S.mapValue);default:throw t8(13486,{value:S})}}function sQ(S){let T=0;return iG(S.fields,(S,R)=>{T+=S.length+sH(R)}),T}function sY(S){return(S.values||[]).reduce((S,T)=>S+sH(T),0)}function sJ(S,T){return{referenceValue:`projects/${S.projectId}/databases/${S.database}/documents/${T.path.canonicalString()}`}}function sX(S){return!!S&&"integerValue"in S}function sZ(S){return!!S&&"doubleValue"in S}function s0(S){return sX(S)||sZ(S)}function s1(S){return!!S&&"arrayValue"in S}function s2(S){return!!S&&"nullValue"in S}function s3(S){return!!S&&"doubleValue"in S&&isNaN(Number(S.doubleValue))}function s4(S){return!!S&&"mapValue"in S}function s6(S){var T,R;return(null===(R=((null===(T=null==S?void 0:S.mapValue)||void 0===T?void 0:T.fields)||{})[sy])||void 0===R?void 0:R.stringValue)===sS}function s9(S){if(S.geoPointValue)return{geoPointValue:Object.assign({},S.geoPointValue)};if(S.timestampValue&&"object"==typeof S.timestampValue)return{timestampValue:Object.assign({},S.timestampValue)};if(S.mapValue){let T={mapValue:{fields:{}}};return iG(S.mapValue.fields,(S,R)=>T.mapValue.fields[S]=s9(R)),T}{if(!S.arrayValue)return Object.assign({},S);let T={arrayValue:{values:[]}};for(let R=0;R<(S.arrayValue.values||[]).length;++R)T.arrayValue.values[R]=s9(S.arrayValue.values[R]);return T}}function s5(S){return(((S.mapValue||{}).fields||{}).__type__||{}).stringValue===sv}let s8={mapValue:{fields:{[sy]:{stringValue:sS},[sT]:{arrayValue:{}}}}};function s7(S){if("nullValue"in S)return sE;if("booleanValue"in S)return{booleanValue:!1};if("integerValue"in S||"doubleValue"in S)return{doubleValue:NaN};if("timestampValue"in S)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("stringValue"in S)return{stringValue:""};if("bytesValue"in S)return{bytesValue:""};if("referenceValue"in S)return sJ(sd.empty(),rk.empty());else if("geoPointValue"in S)return{geoPointValue:{latitude:-90,longitude:-180}};else if("arrayValue"in S)return{arrayValue:{}};else if(!("mapValue"in S))return t8(35942,{value:S});else return s6(S)?s8:{mapValue:{}}}function ae(S){if("nullValue"in S)return{booleanValue:!1};if("booleanValue"in S)return{doubleValue:NaN};if("integerValue"in S||"doubleValue"in S)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("timestampValue"in S)return{stringValue:""};if("stringValue"in S)return{bytesValue:""};if("bytesValue"in S)return sJ(sd.empty(),rk.empty());if("referenceValue"in S)return{geoPointValue:{latitude:-90,longitude:-180}};else if("geoPointValue"in S)return{arrayValue:{}};else if("arrayValue"in S)return s8;else if(!("mapValue"in S))return t8(61959,{value:S});else return s6(S)?{mapValue:{}}:sb}function at(S,T){let R=sN(S.value,T.value);return 0!==R?R:S.inclusive&&!T.inclusive?-1:!S.inclusive&&T.inclusive?1:0}function ar(S,T){let R=sN(S.value,T.value);return 0!==R?R:S.inclusive&&!T.inclusive?1:!S.inclusive&&T.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an{constructor(S){this.value=S}static empty(){return new an({mapValue:{}})}field(S){if(S.isEmpty())return this.value;{let T=this.value;for(let R=0;R<S.length-1;++R)if(!s4(T=(T.mapValue.fields||{})[S.get(R)]))return null;return(T=(T.mapValue.fields||{})[S.lastSegment()])||null}}set(S,T){this.getFieldsMap(S.popLast())[S.lastSegment()]=s9(T)}setAll(S){let T=rA.emptyPath(),R={},N=[];S.forEach((S,O)=>{if(!T.isImmediateParentOf(O)){let S=this.getFieldsMap(T);this.applyChanges(S,R,N),R={},N=[],T=O.popLast()}S?R[O.lastSegment()]=s9(S):N.push(O.lastSegment())});let O=this.getFieldsMap(T);this.applyChanges(O,R,N)}delete(S){let T=this.field(S.popLast());s4(T)&&T.mapValue.fields&&delete T.mapValue.fields[S.lastSegment()]}isEqual(S){return sw(this.value,S.value)}getFieldsMap(S){let T=this.value;T.mapValue.fields||(T.mapValue={fields:{}});for(let R=0;R<S.length;++R){let N=T.mapValue.fields[S.get(R)];s4(N)&&N.mapValue.fields||(N={mapValue:{fields:{}}},T.mapValue.fields[S.get(R)]=N),T=N}return T.mapValue.fields}applyChanges(S,T,R){for(let N of(iG(T,(T,R)=>S[T]=R),R))delete S[N]}clone(){return new an(s9(this.value))}}function ai(S){let T=[];return iG(S.fields,(S,R)=>{let N=new rA([S]);if(s4(R)){let S=ai(R.mapValue).fields;if(0===S.length)T.push(N);else for(let R of S)T.push(N.child(R))}else T.push(N)}),new i1(T)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class as{constructor(S,T,R,N,O,P,M){this.key=S,this.documentType=T,this.version=R,this.readTime=N,this.createTime=O,this.data=P,this.documentState=M}static newInvalidDocument(S){return new as(S,0,r$.min(),r$.min(),r$.min(),an.empty(),0)}static newFoundDocument(S,T,R,N){return new as(S,1,T,r$.min(),R,N,0)}static newNoDocument(S,T){return new as(S,2,T,r$.min(),r$.min(),an.empty(),0)}static newUnknownDocument(S,T){return new as(S,3,T,r$.min(),r$.min(),an.empty(),2)}convertToFoundDocument(S,T){return this.createTime.isEqual(r$.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=S),this.version=S,this.documentType=1,this.data=T,this.documentState=0,this}convertToNoDocument(S){return this.version=S,this.documentType=2,this.data=an.empty(),this.documentState=0,this}convertToUnknownDocument(S){return this.version=S,this.documentType=3,this.data=an.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=r$.min(),this}setReadTime(S){return this.readTime=S,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(S){return S instanceof as&&this.key.isEqual(S.key)&&this.version.isEqual(S.version)&&this.documentType===S.documentType&&this.documentState===S.documentState&&this.data.isEqual(S.data)}mutableCopy(){return new as(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}function aa(S,T,R){let N=T.data.field(S),O=R.data.field(S);return null!==N&&null!==O?sN(N,O):t8(42886)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ao{constructor(S,T){this.position=S,this.inclusive=T}}function al(S,T,R){let N=0;for(let O=0;O<S.position.length;O++){let P=T[O],M=S.position[O];if(N=P.field.isKeyField()?rk.comparator(rk.fromName(M.referenceValue),R.key):sN(M,R.data.field(P.field)),"desc"===P.dir&&(N*=-1),0!==N)break}return N}function au(S,T,R){let N=al(S,T,R);return S.inclusive?N>=0:N>0}function ac(S,T,R){let N=al(S,T,R);return S.inclusive?N<=0:N<0}function ad(S,T){if(null===S)return null===T;if(null===T||S.inclusive!==T.inclusive||S.position.length!==T.position.length)return!1;for(let R=0;R<S.position.length;R++)if(!sw(S.position[R],T.position[R]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ah{constructor(S,T="asc"){this.field=S,this.dir=T}}function ap(S){return S.field.canonicalString()+S.dir}function af(S){return`${S.field.canonicalString()} (${S.dir})`}function am(S,T){return S.dir===T.dir&&S.field.isEqual(T.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ag{}class ay extends ag{constructor(S,T,R){super(),this.field=S,this.op=T,this.value=R}static create(S,T,R){return S.isKeyField()?"in"===T||"not-in"===T?this.createKeyFieldInFilter(S,T,R):new aN(S,T,R):"array-contains"===T?new aM(S,R):"in"===T?new aL(S,R):"not-in"===T?new aF(S,R):"array-contains-any"===T?new aB(S,R):new ay(S,T,R)}static createKeyFieldInFilter(S,T,R){return"in"===T?new aO(S,R):new ax(S,R)}matches(S){let T=S.data.field(this.field);return"!="===this.op?null!==T&&void 0===T.nullValue&&this.matchesComparison(sN(T,this.value)):null!==T&&sC(this.value)===sC(T)&&this.matchesComparison(sN(T,this.value))}matchesComparison(S){switch(this.op){case"<":return S<0;case"<=":return S<=0;case"==":return 0===S;case"!=":return 0!==S;case">":return S>0;case">=":return S>=0;default:return t8(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class av extends ag{constructor(S,T){super(),this.filters=S,this.op=T,this.memoizedFlattenedFilters=null}static create(S,T){return new av(S,T)}matches(S){return ab(this)?void 0===this.filters.find(T=>!T.matches(S)):void 0!==this.filters.find(T=>T.matches(S))}getFlattenedFilters(){return null!==this.memoizedFlattenedFilters||(this.memoizedFlattenedFilters=this.filters.reduce((S,T)=>S.concat(T.getFlattenedFilters()),[])),this.memoizedFlattenedFilters}getFilters(){return Object.assign([],this.filters)}}function ab(S){return"and"===S.op}function aS(S){return"or"===S.op}function aT(S){return aE(S)&&ab(S)}function aE(S){for(let T of S.filters)if(T instanceof av)return!1;return!0}function aC(S){if(S instanceof ay)return S.field.canonicalString()+S.op.toString()+sU(S.value);if(aT(S))return S.filters.map(S=>aC(S)).join(",");{let T=S.filters.map(S=>aC(S)).join(",");return`${S.op}(${T})`}}function aw(S,T){return S instanceof ay?a_(S,T):S instanceof av?aI(S,T):void t8(19439)}function a_(S,T){return T instanceof ay&&S.op===T.op&&S.field.isEqual(T.field)&&sw(S.value,T.value)}function aI(S,T){return T instanceof av&&S.op===T.op&&S.filters.length===T.filters.length&&S.filters.reduce((S,R,N)=>S&&aw(R,T.filters[N]),!0)}function aR(S,T){let R=S.filters.concat(T);return av.create(R,S.op)}function aD(S){return S instanceof ay?ak(S):S instanceof av?aA(S):"Filter"}function aA(S){return S.op.toString()+" {"+S.getFilters().map(aD).join(" ,")+"}"}function ak(S){return`${S.field.canonicalString()} ${S.op} ${sU(S.value)}`}class aN extends ay{constructor(S,T,R){super(S,T,R),this.key=rk.fromName(R.referenceValue)}matches(S){let T=rk.comparator(S.key,this.key);return this.matchesComparison(T)}}class aO extends ay{constructor(S,T){super(S,"in",T),this.keys=aP("in",T)}matches(S){return this.keys.some(T=>T.isEqual(S.key))}}class ax extends ay{constructor(S,T){super(S,"not-in",T),this.keys=aP("not-in",T)}matches(S){return!this.keys.some(T=>T.isEqual(S.key))}}function aP(S,T){var R;return((null===(R=T.arrayValue)||void 0===R?void 0:R.values)||[]).map(S=>rk.fromName(S.referenceValue))}class aM extends ay{constructor(S,T){super(S,"array-contains",T)}matches(S){let T=S.data.field(this.field);return s1(T)&&sk(T.arrayValue,this.value)}}class aL extends ay{constructor(S,T){super(S,"in",T)}matches(S){let T=S.data.field(this.field);return null!==T&&sk(this.value.arrayValue,T)}}class aF extends ay{constructor(S,T){super(S,"not-in",T)}matches(S){if(sk(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let T=S.data.field(this.field);return null!==T&&void 0===T.nullValue&&!sk(this.value.arrayValue,T)}}class aB extends ay{constructor(S,T){super(S,"array-contains-any",T)}matches(S){let T=S.data.field(this.field);return!!s1(T)&&!!T.arrayValue.values&&T.arrayValue.values.some(S=>sk(this.value.arrayValue,S))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aj{constructor(S,T=null,R=[],N=[],O=null,P=null,M=null){this.path=S,this.collectionGroup=T,this.orderBy=R,this.filters=N,this.limit=O,this.startAt=P,this.endAt=M,this.memoizedCanonicalId=null}}function aU(S,T=null,R=[],N=[],O=null,P=null,M=null){return new aj(S,T,R,N,O,P,M)}function aV(S){let T=rr(S);if(null===T.memoizedCanonicalId){let S=T.path.canonicalString();null!==T.collectionGroup&&(S+="|cg:"+T.collectionGroup),S+="|f:"+T.filters.map(S=>aC(S)).join(",")+"|ob:"+T.orderBy.map(S=>ap(S)).join(","),sf(T.limit)||(S+="|l:"+T.limit),T.startAt&&(S+="|lb:"+(T.startAt.inclusive?"b:":"a:")+T.startAt.position.map(S=>sU(S)).join(",")),T.endAt&&(S+="|ub:"+(T.endAt.inclusive?"a:":"b:")+T.endAt.position.map(S=>sU(S)).join(",")),T.memoizedCanonicalId=S}return T.memoizedCanonicalId}function az(S){let T=S.path.canonicalString();return null!==S.collectionGroup&&(T+=" collectionGroup="+S.collectionGroup),S.filters.length>0&&(T+=`, filters: [${S.filters.map(S=>aD(S)).join(", ")}]`),sf(S.limit)||(T+=", limit: "+S.limit),S.orderBy.length>0&&(T+=`, orderBy: [${S.orderBy.map(S=>af(S)).join(", ")}]`),S.startAt&&(T+=", startAt: "+(S.startAt.inclusive?"b:":"a:")+S.startAt.position.map(S=>sU(S)).join(",")),S.endAt&&(T+=", endAt: "+(S.endAt.inclusive?"a:":"b:")+S.endAt.position.map(S=>sU(S)).join(",")),`Target(${T})`}function aq(S,T){if(S.limit!==T.limit||S.orderBy.length!==T.orderBy.length)return!1;for(let R=0;R<S.orderBy.length;R++)if(!am(S.orderBy[R],T.orderBy[R]))return!1;if(S.filters.length!==T.filters.length)return!1;for(let R=0;R<S.filters.length;R++)if(!aw(S.filters[R],T.filters[R]))return!1;return!!(S.collectionGroup===T.collectionGroup&&S.path.isEqual(T.path)&&ad(S.startAt,T.startAt))&&ad(S.endAt,T.endAt)}function a$(S){return rk.isDocumentKey(S.path)&&null===S.collectionGroup&&0===S.filters.length}function aG(S,T){return S.filters.filter(S=>S instanceof ay&&S.field.isEqual(T))}function aK(S,T){let R=rH(T);if(void 0===R)return null;for(let T of aG(S,R.fieldPath))switch(T.op){case"array-contains-any":return T.value.arrayValue.values||[];case"array-contains":return[T.value]}return null}function aW(S,T){let R=new Map;for(let N of rQ(T))for(let T of aG(S,N.fieldPath))switch(T.op){case"==":case"in":R.set(N.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return R.set(N.fieldPath.canonicalString(),T.value),Array.from(R.values())}return null}function aH(S,T){let R=[],N=!0;for(let O of rQ(T)){let T=0===O.kind?aY(S,O.fieldPath,S.startAt):aJ(S,O.fieldPath,S.startAt);R.push(T.value),N&&(N=T.inclusive)}return new ao(R,N)}function aQ(S,T){let R=[],N=!0;for(let O of rQ(T)){let T=0===O.kind?aJ(S,O.fieldPath,S.endAt):aY(S,O.fieldPath,S.endAt);R.push(T.value),N&&(N=T.inclusive)}return new ao(R,N)}function aY(S,T,R){let N=sE,O=!0;for(let R of aG(S,T)){let S=sE,T=!0;switch(R.op){case"<":case"<=":S=s7(R.value);break;case"==":case"in":case">=":S=R.value;break;case">":S=R.value,T=!1;break;case"!=":case"not-in":S=sE}0>at({value:N,inclusive:O},{value:S,inclusive:T})&&(N=S,O=T)}if(null!==R){for(let P=0;P<S.orderBy.length;++P)if(S.orderBy[P].field.isEqual(T)){let S=R.position[P];0>at({value:N,inclusive:O},{value:S,inclusive:R.inclusive})&&(N=S,O=R.inclusive);break}}return{value:N,inclusive:O}}function aJ(S,T,R){let N=sb,O=!0;for(let R of aG(S,T)){let S=sb,T=!0;switch(R.op){case">=":case">":S=ae(R.value),T=!1;break;case"==":case"in":case"<=":S=R.value;break;case"<":S=R.value,T=!1;break;case"!=":case"not-in":S=sb}ar({value:N,inclusive:O},{value:S,inclusive:T})>0&&(N=S,O=T)}if(null!==R){for(let P=0;P<S.orderBy.length;++P)if(S.orderBy[P].field.isEqual(T)){let S=R.position[P];ar({value:N,inclusive:O},{value:S,inclusive:R.inclusive})>0&&(N=S,O=R.inclusive);break}}return{value:N,inclusive:O}}function aX(S){let T=new iJ(rA.comparator),R=!1;for(let N of S.filters)for(let S of N.getFlattenedFilters())S.field.isKeyField()||("array-contains"===S.op||"array-contains-any"===S.op?R=!0:T=T.add(S.field));for(let R of S.orderBy)R.field.isKeyField()||(T=T.add(R.field));return T.size+(R?1:0)}function aZ(S){return null!==S.limit}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a0{constructor(S,T=null,R=[],N=[],O=null,P="F",M=null,L=null){this.path=S,this.collectionGroup=T,this.explicitOrderBy=R,this.filters=N,this.limit=O,this.limitType=P,this.startAt=M,this.endAt=L,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}}function a1(S,T,R,N,O,P,M,L){return new a0(S,T,R,N,O,P,M,L)}function a2(S){return new a0(S)}function a3(S,T){return new a0(T,null,S.explicitOrderBy.slice(),S.filters.slice(),S.limit,S.limitType,S.startAt,S.endAt)}function a4(S){return 0===S.filters.length&&null===S.limit&&null==S.startAt&&null==S.endAt&&(0===S.explicitOrderBy.length||1===S.explicitOrderBy.length&&S.explicitOrderBy[0].field.isKeyField())}function a6(S){let T=new iJ(rA.comparator);return S.filters.forEach(S=>{S.getFlattenedFilters().forEach(S=>{S.isInequality()&&(T=T.add(S.field))})}),T}function a9(S){return rk.isDocumentKey(S.path)&&null===S.collectionGroup&&0===S.filters.length}function a5(S){return null!==S.collectionGroup}function a8(S){let T=rr(S);if(null===T.memoizedNormalizedOrderBy){T.memoizedNormalizedOrderBy=[];let S=new Set;for(let R of T.explicitOrderBy)T.memoizedNormalizedOrderBy.push(R),S.add(R.field.canonicalString());let R=T.explicitOrderBy.length>0?T.explicitOrderBy[T.explicitOrderBy.length-1].dir:"asc";a6(T).forEach(N=>{S.has(N.canonicalString())||N.isKeyField()||T.memoizedNormalizedOrderBy.push(new ah(N,R))}),S.has(rA.keyField().canonicalString())||T.memoizedNormalizedOrderBy.push(new ah(rA.keyField(),R))}return T.memoizedNormalizedOrderBy}function a7(S){let T=rr(S);return T.memoizedTarget||(T.memoizedTarget=ot(T,a8(S))),T.memoizedTarget}function oe(S){let T=rr(S);return T.memoizedAggregateTarget||(T.memoizedAggregateTarget=ot(T,S.explicitOrderBy)),T.memoizedAggregateTarget}function ot(S,T){if("F"===S.limitType)return aU(S.path,S.collectionGroup,T,S.filters,S.limit,S.startAt,S.endAt);{T=T.map(S=>{let T="desc"===S.dir?"asc":"desc";return new ah(S.field,T)});let R=S.endAt?new ao(S.endAt.position,S.endAt.inclusive):null,N=S.startAt?new ao(S.startAt.position,S.startAt.inclusive):null;return aU(S.path,S.collectionGroup,T,S.filters,S.limit,R,N)}}function or(S,T){let R=S.filters.concat([T]);return new a0(S.path,S.collectionGroup,S.explicitOrderBy.slice(),R,S.limit,S.limitType,S.startAt,S.endAt)}function on(S,T){let R=S.explicitOrderBy.concat([T]);return new a0(S.path,S.collectionGroup,R,S.filters.slice(),S.limit,S.limitType,S.startAt,S.endAt)}function oi(S,T,R){return new a0(S.path,S.collectionGroup,S.explicitOrderBy.slice(),S.filters.slice(),T,R,S.startAt,S.endAt)}function oa(S,T){return new a0(S.path,S.collectionGroup,S.explicitOrderBy.slice(),S.filters.slice(),S.limit,S.limitType,T,S.endAt)}function oo(S,T){return new a0(S.path,S.collectionGroup,S.explicitOrderBy.slice(),S.filters.slice(),S.limit,S.limitType,S.startAt,T)}function ol(S,T){return aq(a7(S),a7(T))&&S.limitType===T.limitType}function ou(S){return`${aV(a7(S))}|lt:${S.limitType}`}function oc(S){return`Query(target=${az(a7(S))}; limitType=${S.limitType})`}function od(S,T){return T.isFoundDocument()&&oh(S,T)&&of(S,T)&&om(S,T)&&og(S,T)}function oh(S,T){let R=T.key.path;return null!==S.collectionGroup?T.key.hasCollectionId(S.collectionGroup)&&S.path.isPrefixOf(R):rk.isDocumentKey(S.path)?S.path.isEqual(R):S.path.isImmediateParentOf(R)}function of(S,T){for(let R of a8(S))if(!R.field.isKeyField()&&null===T.data.field(R.field))return!1;return!0}function om(S,T){for(let R of S.filters)if(!R.matches(T))return!1;return!0}function og(S,T){return(!S.startAt||!!ac(S.startAt,a8(S),T))&&(!S.endAt||!!au(S.endAt,a8(S),T))}function oy(S){return S.collectionGroup||(S.path.length%2==1?S.path.lastSegment():S.path.get(S.path.length-2))}function ov(S){return(T,R)=>{let N=!1;for(let O of a8(S)){let S=ob(O,T,R);if(0!==S)return S;N=N||O.field.isKeyField()}return 0}}function ob(S,T,R){let N=S.field.isKeyField()?rk.comparator(T.key,R.key):aa(S.field,T,R);switch(S.dir){case"asc":return N;case"desc":return -1*N;default:return t8(19790,{direction:S.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oS{constructor(S,T){this.mapKeyFn=S,this.equalsFn=T,this.inner={},this.innerSize=0}get(S){let T=this.mapKeyFn(S),R=this.inner[T];if(void 0!==R){for(let[T,N]of R)if(this.equalsFn(T,S))return N}}has(S){return void 0!==this.get(S)}set(S,T){let R=this.mapKeyFn(S),N=this.inner[R];if(void 0===N){this.inner[R]=[[S,T]],this.innerSize++;return}for(let R=0;R<N.length;R++)if(this.equalsFn(N[R][0],S)){N[R]=[S,T];return}N.push([S,T]),this.innerSize++}delete(S){let T=this.mapKeyFn(S),R=this.inner[T];if(void 0===R)return!1;for(let N=0;N<R.length;N++)if(this.equalsFn(R[N][0],S))return 1===R.length?delete this.inner[T]:R.splice(N,1),this.innerSize--,!0;return!1}forEach(S){iG(this.inner,(T,R)=>{for(let[T,N]of R)S(T,N)})}isEmpty(){return iK(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oT=new iW(rk.comparator);function oE(){return oT}let oC=new iW(rk.comparator);function ow(...S){let T=oC;for(let R of S)T=T.insert(R.key,R);return T}function o_(){return oA()}function oI(S){let T=oC;return S.forEach((S,R)=>T=T.insert(S,R.overlayedDocument)),T}function oR(){return oA()}function oD(){return oA()}function oA(){return new oS(S=>S.toString(),(S,T)=>S.isEqual(T))}let ok=new iW(rk.comparator);function oN(){return ok}let oO=new iJ(rk.comparator);function ox(...S){let T=oO;for(let R of S)T=T.add(R);return T}let oP=new iJ(rb);function oM(){return oP}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oL(S,T){if(S.useProto3Json){if(isNaN(T))return{doubleValue:"NaN"};if(T===1/0)return{doubleValue:"Infinity"};if(T===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:sm(T)?"-0":T}}function oF(S){return{integerValue:""+S}}function oB(S,T){return sg(T)?oF(T):oL(S,T)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oj{constructor(){this._=void 0}}function oU(S,T,R){return S instanceof o$?sa(R,T):S instanceof oG?oK(S,T):S instanceof oW?oH(S,T):oY(S,T)}function oV(S,T,R){return S instanceof oG?oK(S,T):S instanceof oW?oH(S,T):R}function oz(S,T){return S instanceof oQ?s0(T)?T:{integerValue:0}:null}function oq(S,T){return S instanceof oG&&T instanceof oG||S instanceof oW&&T instanceof oW?rC(S.elements,T.elements,sw):S instanceof oQ&&T instanceof oQ?sw(S.operand,T.operand):S instanceof o$&&T instanceof o$}class o$ extends oj{}class oG extends oj{constructor(S){super(),this.elements=S}}function oK(S,T){let R=oX(T);for(let T of S.elements)R.some(S=>sw(S,T))||R.push(T);return{arrayValue:{values:R}}}class oW extends oj{constructor(S){super(),this.elements=S}}function oH(S,T){let R=oX(T);for(let T of S.elements)R=R.filter(S=>!sw(S,T));return{arrayValue:{values:R}}}class oQ extends oj{constructor(S,T){super(),this.serializer=S,this.operand=T}}function oY(S,T){let R=oz(S,T),N=oJ(R)+oJ(S.operand);return sX(R)&&sX(S.operand)?oF(N):oL(S.serializer,N)}function oJ(S){return i7(S.integerValue||S.doubleValue)}function oX(S){return s1(S)&&S.arrayValue.values?S.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oZ{constructor(S,T){this.field=S,this.transform=T}}function o0(S,T){return S.field.isEqual(T.field)&&oq(S.transform,T.transform)}function o1(S,T){return void 0===S&&void 0===T||!!S&&!!T&&rC(S,T,(S,T)=>o0(S,T))}class o2{constructor(S,T){this.version=S,this.transformResults=T}}class o3{constructor(S,T){this.updateTime=S,this.exists=T}static none(){return new o3}static exists(S){return new o3(void 0,S)}static updateTime(S){return new o3(S)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(S){return this.exists===S.exists&&(this.updateTime?!!S.updateTime&&this.updateTime.isEqual(S.updateTime):!S.updateTime)}}function o4(S,T){return void 0!==S.updateTime?T.isFoundDocument()&&T.version.isEqual(S.updateTime):void 0===S.exists||S.exists===T.isFoundDocument()}class o6{}function o9(S,T){if(!S.hasLocalMutations||T&&0===T.fields.length)return null;if(null===T)return S.isNoDocument()?new lh(S.key,o3.none()):new lr(S.key,S.data,o3.none());{let R=S.data,N=an.empty(),O=new iJ(rA.comparator);for(let S of T.fields)if(!O.has(S)){let T=R.field(S);null===T&&S.length>1&&(S=S.popLast(),T=R.field(S)),null===T?N.delete(S):N.set(S,T),O=O.add(S)}return new ls(S.key,N,new i1(O.toArray()),o3.none())}}function o5(S,T,R){S instanceof lr?ln(S,T,R):S instanceof ls?la(S,T,R):lp(S,T,R)}function o8(S,T,R,N){return S instanceof lr?li(S,T,R,N):S instanceof ls?ll(S,T,R,N):lf(S,T,R)}function o7(S,T){let R=null;for(let N of S.fieldTransforms){let S=T.data.field(N.field),O=oz(N.transform,S||null);null!=O&&(null===R&&(R=an.empty()),R.set(N.field,O))}return R||null}function lt(S,T){return!!(S.type===T.type&&S.key.isEqual(T.key)&&S.precondition.isEqual(T.precondition)&&o1(S.fieldTransforms,T.fieldTransforms))&&(0===S.type?S.value.isEqual(T.value):1!==S.type||S.data.isEqual(T.data)&&S.fieldMask.isEqual(T.fieldMask))}class lr extends o6{constructor(S,T,R,N=[]){super(),this.key=S,this.value=T,this.precondition=R,this.fieldTransforms=N,this.type=0}getFieldMask(){return null}}function ln(S,T,R){let N=S.value.clone(),O=lc(S.fieldTransforms,T,R.transformResults);N.setAll(O),T.convertToFoundDocument(R.version,N).setHasCommittedMutations()}function li(S,T,R,N){if(!o4(S.precondition,T))return R;let O=S.value.clone(),P=ld(S.fieldTransforms,N,T);return O.setAll(P),T.convertToFoundDocument(T.version,O).setHasLocalMutations(),null}class ls extends o6{constructor(S,T,R,N,O=[]){super(),this.key=S,this.data=T,this.fieldMask=R,this.precondition=N,this.fieldTransforms=O,this.type=1}getFieldMask(){return this.fieldMask}}function la(S,T,R){if(!o4(S.precondition,T)){T.convertToUnknownDocument(R.version);return}let N=lc(S.fieldTransforms,T,R.transformResults),O=T.data;O.setAll(lu(S)),O.setAll(N),T.convertToFoundDocument(R.version,O).setHasCommittedMutations()}function ll(S,T,R,N){if(!o4(S.precondition,T))return R;let O=ld(S.fieldTransforms,N,T),P=T.data;return(P.setAll(lu(S)),P.setAll(O),T.convertToFoundDocument(T.version,P).setHasLocalMutations(),null===R)?null:R.unionWith(S.fieldMask.fields).unionWith(S.fieldTransforms.map(S=>S.field))}function lu(S){let T=new Map;return S.fieldMask.fields.forEach(R=>{if(!R.isEmpty()){let N=S.data.field(R);T.set(R,N)}}),T}function lc(S,T,R){let N=new Map;rt(S.length===R.length,32656,{serverTransformResultCount:R.length,fieldTransformCount:S.length});for(let O=0;O<R.length;O++){let P=S[O],M=P.transform,L=T.data.field(P.field);N.set(P.field,oV(M,L,R[O]))}return N}function ld(S,T,R){let N=new Map;for(let O of S){let S=O.transform,P=R.data.field(O.field);N.set(O.field,oU(S,P,T))}return N}class lh extends o6{constructor(S,T){super(),this.key=S,this.precondition=T,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}function lp(S,T,R){T.convertToNoDocument(R.version).setHasCommittedMutations()}function lf(S,T,R){return o4(S.precondition,T)?(T.convertToNoDocument(T.version).setHasLocalMutations(),null):R}class lm extends o6{constructor(S,T){super(),this.key=S,this.precondition=T,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lg{constructor(S,T,R,N){this.batchId=S,this.localWriteTime=T,this.baseMutations=R,this.mutations=N}applyToRemoteDocument(S,T){let R=T.mutationResults;for(let T=0;T<this.mutations.length;T++){let N=this.mutations[T];N.key.isEqual(S.key)&&o5(N,S,R[T])}}applyToLocalView(S,T){for(let R of this.baseMutations)R.key.isEqual(S.key)&&(T=o8(R,S,T,this.localWriteTime));for(let R of this.mutations)R.key.isEqual(S.key)&&(T=o8(R,S,T,this.localWriteTime));return T}applyToLocalDocumentSet(S,T){let R=oD();return this.mutations.forEach(N=>{let O=S.get(N.key),P=O.overlayedDocument,M=this.applyToLocalView(P,O.mutatedFields),L=o9(P,M=T.has(N.key)?null:M);null!==L&&R.set(N.key,L),P.isValidDocument()||P.convertToNoDocument(r$.min())}),R}keys(){return this.mutations.reduce((S,T)=>S.add(T.key),ox())}isEqual(S){return this.batchId===S.batchId&&rC(this.mutations,S.mutations,(S,T)=>lt(S,T))&&rC(this.baseMutations,S.baseMutations,(S,T)=>lt(S,T))}}class ly{constructor(S,T,R,N){this.batch=S,this.commitVersion=T,this.mutationResults=R,this.docVersions=N}static from(S,T,R){rt(S.mutations.length===R.length,58842,{mutationsSent:S.mutations.length,resultsReceived:R.length});let N=oN(),O=S.mutations;for(let S=0;S<O.length;S++)N=N.insert(O[S].key,R[S].version);return new ly(S,T,R,N)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lv{constructor(S,T){this.largestBatchId=S,this.mutation=T}getKey(){return this.mutation.key}isEqual(S){return null!==S&&this.mutation===S.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lb{constructor(S,T){this.count=S,this.unchangedNames=T}}function lS(S){switch(S){case rn.OK:return t8(64938);case rn.CANCELLED:case rn.UNKNOWN:case rn.DEADLINE_EXCEEDED:case rn.RESOURCE_EXHAUSTED:case rn.INTERNAL:case rn.UNAVAILABLE:case rn.UNAUTHENTICATED:return!1;case rn.INVALID_ARGUMENT:case rn.NOT_FOUND:case rn.ALREADY_EXISTS:case rn.PERMISSION_DENIED:case rn.FAILED_PRECONDITION:case rn.ABORTED:case rn.OUT_OF_RANGE:case rn.UNIMPLEMENTED:case rn.DATA_LOSS:return!0;default:return t8(15467,{code:S})}}function lT(S){return lS(S)&&S!==rn.ABORTED}function lE(S){if(void 0===S)return t6("GRPC error has no .code"),rn.UNKNOWN;switch(S){case U.OK:return rn.OK;case U.CANCELLED:return rn.CANCELLED;case U.UNKNOWN:return rn.UNKNOWN;case U.DEADLINE_EXCEEDED:return rn.DEADLINE_EXCEEDED;case U.RESOURCE_EXHAUSTED:return rn.RESOURCE_EXHAUSTED;case U.INTERNAL:return rn.INTERNAL;case U.UNAVAILABLE:return rn.UNAVAILABLE;case U.UNAUTHENTICATED:return rn.UNAUTHENTICATED;case U.INVALID_ARGUMENT:return rn.INVALID_ARGUMENT;case U.NOT_FOUND:return rn.NOT_FOUND;case U.ALREADY_EXISTS:return rn.ALREADY_EXISTS;case U.PERMISSION_DENIED:return rn.PERMISSION_DENIED;case U.FAILED_PRECONDITION:return rn.FAILED_PRECONDITION;case U.ABORTED:return rn.ABORTED;case U.OUT_OF_RANGE:return rn.OUT_OF_RANGE;case U.UNIMPLEMENTED:return rn.UNIMPLEMENTED;case U.DATA_LOSS:return rn.DATA_LOSS;default:return t8(39323,{code:S})}}!function(S){S[S.OK=0]="OK",S[S.CANCELLED=1]="CANCELLED",S[S.UNKNOWN=2]="UNKNOWN",S[S.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",S[S.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",S[S.NOT_FOUND=5]="NOT_FOUND",S[S.ALREADY_EXISTS=6]="ALREADY_EXISTS",S[S.PERMISSION_DENIED=7]="PERMISSION_DENIED",S[S.UNAUTHENTICATED=16]="UNAUTHENTICATED",S[S.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",S[S.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",S[S.ABORTED=10]="ABORTED",S[S.OUT_OF_RANGE=11]="OUT_OF_RANGE",S[S.UNIMPLEMENTED=12]="UNIMPLEMENTED",S[S.INTERNAL=13]="INTERNAL",S[S.UNAVAILABLE=14]="UNAVAILABLE",S[S.DATA_LOSS=15]="DATA_LOSS"}(U||(U={}));/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lC extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lw=null;function l_(S){if(lw)throw Error("a TestingHooksSpi instance is already set");lw=S}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lI=new M([4294967295,4294967295],0);function lR(S){let T=rg().encode(S),R=new L;return R.update(T),new Uint8Array(R.digest())}function lD(S){let T=new DataView(S.buffer),R=T.getUint32(0,!0),N=T.getUint32(4,!0),O=T.getUint32(8,!0),P=T.getUint32(12,!0);return[new M([R,N],0),new M([O,P],0)]}class lA{constructor(S,T,R){if(this.bitmap=S,this.padding=T,this.hashCount=R,T<0||T>=8)throw new lk(`Invalid padding: ${T}`);if(R<0||S.length>0&&0===this.hashCount)throw new lk(`Invalid hash count: ${R}`);if(0===S.length&&0!==T)throw new lk(`Invalid padding when bitmap length is 0: ${T}`);this.bitCount=8*S.length-T,this.bitCountInInteger=M.fromNumber(this.bitCount)}getBitIndex(S,T,R){let N=S.add(T.multiply(M.fromNumber(R)));return 1===N.compare(lI)&&(N=new M([N.getBits(0),N.getBits(1)],0)),N.modulo(this.bitCountInInteger).toNumber()}isBitSet(S){return(this.bitmap[Math.floor(S/8)]&1<<S%8)!=0}mightContain(S){if(0===this.bitCount)return!1;let[T,R]=lD(lR(S));for(let S=0;S<this.hashCount;S++){let N=this.getBitIndex(T,R,S);if(!this.isBitSet(N))return!1}return!0}static create(S,T,R){let N=S%8==0?0:8-S%8,O=new lA(new Uint8Array(Math.ceil(S/8)),N,T);return R.forEach(S=>O.insert(S)),O}insert(S){if(0===this.bitCount)return;let[T,R]=lD(lR(S));for(let S=0;S<this.hashCount;S++){let N=this.getBitIndex(T,R,S);this.setBit(N)}}setBit(S){let T=Math.floor(S/8),R=S%8;this.bitmap[T]|=1<<R}}class lk extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lN{constructor(S,T,R,N,O){this.snapshotVersion=S,this.targetChanges=T,this.targetMismatches=R,this.documentUpdates=N,this.resolvedLimboDocuments=O}static createSynthesizedRemoteEventForCurrentChange(S,T,R){let N=new Map;return N.set(S,lO.createSynthesizedTargetChangeForCurrentChange(S,T,R)),new lN(r$.min(),N,new iW(rb),oE(),ox())}}class lO{constructor(S,T,R,N,O){this.resumeToken=S,this.current=T,this.addedDocuments=R,this.modifiedDocuments=N,this.removedDocuments=O}static createSynthesizedTargetChangeForCurrentChange(S,T,R){return new lO(R,T,ox(),ox(),ox())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lx{constructor(S,T,R,N){this.updatedTargetIds=S,this.removedTargetIds=T,this.key=R,this.newDoc=N}}class lP{constructor(S,T){this.targetId=S,this.existenceFilter=T}}class lM{constructor(S,T,R=i4.EMPTY_BYTE_STRING,N=null){this.state=S,this.targetIds=T,this.resumeToken=R,this.cause=N}}class lL{constructor(){this.pendingResponses=0,this.documentChanges=lU(),this._resumeToken=i4.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return 0!==this.pendingResponses}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(S){S.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=S)}toTargetChange(){let S=ox(),T=ox(),R=ox();return this.documentChanges.forEach((N,O)=>{switch(O){case 0:S=S.add(N);break;case 2:T=T.add(N);break;case 1:R=R.add(N);break;default:t8(38017,{changeType:O})}}),new lO(this._resumeToken,this._current,S,T,R)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=lU()}addDocumentChange(S,T){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(S,T)}removeDocumentChange(S){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(S)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,rt(this.pendingResponses>=0,3241,{pendingResponses:this.pendingResponses})}markCurrent(){this._hasPendingChanges=!0,this._current=!0}}let lF="WatchChangeAggregator";class lB{constructor(S){this.metadataProvider=S,this.targetStates=new Map,this.pendingDocumentUpdates=oE(),this.pendingDocumentUpdatesByTarget=lj(),this.pendingDocumentTargetMapping=lj(),this.pendingTargetResets=new iW(rb)}handleDocumentChange(S){for(let T of S.updatedTargetIds)S.newDoc&&S.newDoc.isFoundDocument()?this.addDocumentToTarget(T,S.newDoc):this.removeDocumentFromTarget(T,S.key,S.newDoc);for(let T of S.removedTargetIds)this.removeDocumentFromTarget(T,S.key,S.newDoc)}handleTargetChange(S){this.forEachTarget(S,T=>{let R=this.ensureTargetState(T);switch(S.state){case 0:this.isActiveTarget(T)&&R.updateResumeToken(S.resumeToken);break;case 1:R.recordTargetResponse(),R.isPending||R.clearPendingChanges(),R.updateResumeToken(S.resumeToken);break;case 2:R.recordTargetResponse(),R.isPending||this.removeTarget(T);break;case 3:this.isActiveTarget(T)&&(R.markCurrent(),R.updateResumeToken(S.resumeToken));break;case 4:this.isActiveTarget(T)&&(this.resetTarget(T),R.updateResumeToken(S.resumeToken));break;default:t8(56790,{state:S.state})}})}forEachTarget(S,T){S.targetIds.length>0?S.targetIds.forEach(T):this.targetStates.forEach((S,R)=>{this.isActiveTarget(R)&&T(R)})}handleExistenceFilter(S){let T=S.targetId,R=S.existenceFilter.count,N=this.targetDataForActiveTarget(T);if(N){let O=N.target;if(a$(O)){if(0===R){let S=new rk(O.path);this.removeDocumentFromTarget(T,S,as.newNoDocument(S,r$.min()))}else rt(1===R,20013,{expectedCount:R})}else{let N=this.getCurrentDocumentCountForTarget(T);if(N!==R){let R=this.parseBloomFilter(S),O=R?this.applyBloomFilter(R,S,N):1;if(0!==O){this.resetTarget(T);let S=2===O?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(T,S)}null==lw||lw.notifyOnExistenceFilterMismatch(lV(N,S.existenceFilter,this.metadataProvider.getDatabaseId(),R,O))}}}}parseBloomFilter(S){let T,R;let N=S.existenceFilter.unchangedNames;if(!N||!N.bits)return null;let{bits:{bitmap:O="",padding:P=0},hashCount:M=0}=N;try{T=se(O).toUint8Array()}catch(S){if(S instanceof lC)return t9("Decoding the base64 bloom filter in existence filter failed ("+S.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw S}try{R=new lA(T,P,M)}catch(S){return S instanceof lk?t9("BloomFilter error: ",S):t9("Applying bloom filter failed: ",S),null}return 0===R.bitCount?null:R}applyBloomFilter(S,T,R){return T.existenceFilter.count===R-this.filterRemovedDocuments(S,T.targetId)?0:2}filterRemovedDocuments(S,T){let R=this.metadataProvider.getRemoteKeysForTarget(T),N=0;return R.forEach(R=>{let O=this.metadataProvider.getDatabaseId(),P=`projects/${O.projectId}/databases/${O.database}/documents/${R.path.canonicalString()}`;!S.mightContain(P)&&(this.removeDocumentFromTarget(T,R,null),N++)}),N}createRemoteEvent(S){let T=new Map;this.targetStates.forEach((R,N)=>{let O=this.targetDataForActiveTarget(N);if(O){if(R.current&&a$(O.target)){let T=new rk(O.target.path);this.ensureDocumentUpdateByTarget(T).has(N)||this.targetContainsDocument(N,T)||this.removeDocumentFromTarget(N,T,as.newNoDocument(T,S))}R.hasPendingChanges&&(T.set(N,R.toTargetChange()),R.clearPendingChanges())}});let R=ox();this.pendingDocumentTargetMapping.forEach((S,T)=>{let N=!0;T.forEachWhile(S=>{let T=this.targetDataForActiveTarget(S);return!T||"TargetPurposeLimboResolution"===T.purpose||(N=!1,!1)}),N&&(R=R.add(S))}),this.pendingDocumentUpdates.forEach((T,R)=>R.setReadTime(S));let N=new lN(S,T,this.pendingTargetResets,this.pendingDocumentUpdates,R);return this.pendingDocumentUpdates=oE(),this.pendingDocumentUpdatesByTarget=lj(),this.pendingDocumentTargetMapping=lj(),this.pendingTargetResets=new iW(rb),N}addDocumentToTarget(S,T){if(!this.isActiveTarget(S))return;let R=this.targetContainsDocument(S,T.key)?2:0;this.ensureTargetState(S).addDocumentChange(T.key,R),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(T.key,T),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(T.key,this.ensureDocumentUpdateByTarget(T.key).add(S)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(T.key,this.ensureDocumentTargetMapping(T.key).add(S))}removeDocumentFromTarget(S,T,R){if(!this.isActiveTarget(S))return;let N=this.ensureTargetState(S);this.targetContainsDocument(S,T)?N.addDocumentChange(T,1):N.removeDocumentChange(T),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(T,this.ensureDocumentTargetMapping(T).delete(S)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(T,this.ensureDocumentTargetMapping(T).add(S)),R&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(T,R))}removeTarget(S){this.targetStates.delete(S)}getCurrentDocumentCountForTarget(S){let T=this.ensureTargetState(S).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(S).size+T.addedDocuments.size-T.removedDocuments.size}recordPendingTargetRequest(S){this.ensureTargetState(S).recordPendingTargetRequest()}ensureTargetState(S){let T=this.targetStates.get(S);return T||(T=new lL,this.targetStates.set(S,T)),T}ensureDocumentTargetMapping(S){let T=this.pendingDocumentTargetMapping.get(S);return T||(T=new iJ(rb),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(S,T)),T}ensureDocumentUpdateByTarget(S){let T=this.pendingDocumentUpdatesByTarget.get(S);return T||(T=new iJ(rb),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(S,T)),T}isActiveTarget(S){let T=null!==this.targetDataForActiveTarget(S);return T||t4(lF,"Detected inactive target",S),T}targetDataForActiveTarget(S){let T=this.targetStates.get(S);return T&&T.isPending?null:this.metadataProvider.getTargetDataForTarget(S)}resetTarget(S){this.targetStates.set(S,new lL),this.metadataProvider.getRemoteKeysForTarget(S).forEach(T=>{this.removeDocumentFromTarget(S,T,null)})}targetContainsDocument(S,T){return this.metadataProvider.getRemoteKeysForTarget(S).has(T)}}function lj(){return new iW(rk.comparator)}function lU(){return new iW(rk.comparator)}function lV(S,T,R,N,O){var P,M,L,U,V,$;let K={localCacheCount:S,existenceFilterCount:T.count,databaseId:R.database,projectId:R.projectId},W=T.unchangedNames;return W&&(K.bloomFilter={applied:0===O,hashCount:null!==(P=null==W?void 0:W.hashCount)&&void 0!==P?P:0,bitmapLength:null!==(U=null===(L=null===(M=null==W?void 0:W.bits)||void 0===M?void 0:M.bitmap)||void 0===L?void 0:L.length)&&void 0!==U?U:0,padding:null!==($=null===(V=null==W?void 0:W.bits)||void 0===V?void 0:V.padding)&&void 0!==$?$:0,mightContain:S=>{var T;return null!==(T=null==N?void 0:N.mightContain(S))&&void 0!==T&&T}}),K}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lz=(()=>{let S={};return S.asc="ASCENDING",S.desc="DESCENDING",S})(),lq=(()=>{let S={};return S["<"]="LESS_THAN",S["<="]="LESS_THAN_OR_EQUAL",S[">"]="GREATER_THAN",S[">="]="GREATER_THAN_OR_EQUAL",S["=="]="EQUAL",S["!="]="NOT_EQUAL",S["array-contains"]="ARRAY_CONTAINS",S.in="IN",S["not-in"]="NOT_IN",S["array-contains-any"]="ARRAY_CONTAINS_ANY",S})(),l$=(()=>{let S={};return S.and="AND",S.or="OR",S})();class lG{constructor(S,T){this.databaseId=S,this.useProto3Json=T}}function lK(S){return new ri(void 0===S.code?rn.UNKNOWN:lE(S.code),S.message||"")}function lW(S,T){return S.useProto3Json||sf(T)?T:{value:T}}function lH(S){let T;return sf(T="object"==typeof S?S.value:S)?null:T}function lQ(S,T){if(!S.useProto3Json)return{seconds:""+T.seconds,nanos:T.nanoseconds};{let S=new Date(1e3*T.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),R=("000000000"+T.nanoseconds).slice(-9);return`${S}.${R}Z`}}function lY(S){let T=i8(S);return new rq(T.seconds,T.nanos)}function lJ(S,T){return S.useProto3Json?T.toBase64():T.toUint8Array()}function lX(S,T){return S.useProto3Json?(rt(void 0===T||"string"==typeof T,58123),i4.fromBase64String(T||"")):(rt(void 0===T||T instanceof Buffer||T instanceof Uint8Array,16193),i4.fromUint8Array(T||new Uint8Array))}function lZ(S,T){return lQ(S,T.toTimestamp())}function l0(S){return rt(!!S,49232),r$.fromTimestamp(lY(S))}function l1(S,T){return l2(S,T).canonicalString()}function l2(S,T){let R=l7(S).child("documents");return void 0===T?R:R.child(T)}function l3(S){let T=rR.fromString(S);return rt(u1(T),10190,{key:T.toString()}),T}function l4(S,T){return l1(S.databaseId,T.path)}function l6(S,T){let R=l3(T);if(R.get(1)!==S.databaseId.projectId)throw new ri(rn.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+R.get(1)+" vs "+S.databaseId.projectId);if(R.get(3)!==S.databaseId.database)throw new ri(rn.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+R.get(3)+" vs "+S.databaseId.database);return new rk(ue(R))}function l9(S,T){return l1(S.databaseId,T)}function l5(S){let T=l3(S);return 4===T.length?rR.emptyPath():ue(T)}function l8(S){return new rR(["projects",S.databaseId.projectId,"databases",S.databaseId.database]).canonicalString()}function l7(S){return new rR(["projects",S.projectId,"databases",S.database])}function ue(S){return rt(S.length>4&&"documents"===S.get(4),29091,{key:S.toString()}),S.popFirst(5)}function ut(S,T,R){return{name:l4(S,T),fields:R.value.mapValue.fields}}function ur(S,T){return{name:l4(S,T.key),fields:T.data.value.mapValue.fields,updateTime:lQ(S,T.version.toTimestamp()),createTime:lQ(S,T.createTime.toTimestamp())}}function un(S,T,R){let N=l6(S,T.name),O=l0(T.updateTime),P=T.createTime?l0(T.createTime):r$.min(),M=new an({mapValue:{fields:T.fields}}),L=as.newFoundDocument(N,O,P,M);return R&&L.setHasCommittedMutations(),R?L.setHasCommittedMutations():L}function ui(S,T){rt(!!T.found,43571),T.found.name,T.found.updateTime;let R=l6(S,T.found.name),N=l0(T.found.updateTime),O=T.found.createTime?l0(T.found.createTime):r$.min(),P=new an({mapValue:{fields:T.found.fields}});return as.newFoundDocument(R,N,O,P)}function us(S,T){rt(!!T.missing,3894),rt(!!T.readTime,22933);let R=l6(S,T.missing),N=l0(T.readTime);return as.newNoDocument(R,N)}function uo(S,T){return"found"in T?ui(S,T):"missing"in T?us(S,T):t8(7234,{result:T})}function ul(S,T){let R;if("targetChange"in T){T.targetChange;let N=uu(T.targetChange.targetChangeType||"NO_CHANGE"),O=T.targetChange.targetIds||[],P=lX(S,T.targetChange.resumeToken),M=T.targetChange.cause;R=new lM(N,O,P,M&&lK(M)||null)}else if("documentChange"in T){T.documentChange;let N=T.documentChange;N.document,N.document.name,N.document.updateTime;let O=l6(S,N.document.name),P=l0(N.document.updateTime),M=N.document.createTime?l0(N.document.createTime):r$.min(),L=new an({mapValue:{fields:N.document.fields}}),U=as.newFoundDocument(O,P,M,L);R=new lx(N.targetIds||[],N.removedTargetIds||[],U.key,U)}else if("documentDelete"in T){T.documentDelete;let N=T.documentDelete;N.document;let O=l6(S,N.document),P=N.readTime?l0(N.readTime):r$.min(),M=as.newNoDocument(O,P);R=new lx([],N.removedTargetIds||[],M.key,M)}else if("documentRemove"in T){T.documentRemove;let N=T.documentRemove;N.document;let O=l6(S,N.document);R=new lx([],N.removedTargetIds||[],O,null)}else{if(!("filter"in T))return t8(11601,{change:T});T.filter;let S=T.filter;S.targetId;let{count:N=0,unchangedNames:O}=S,P=new lb(N,O);R=new lP(S.targetId,P)}return R}function uu(S){return"NO_CHANGE"===S?0:"ADD"===S?1:"REMOVE"===S?2:"CURRENT"===S?3:"RESET"===S?4:t8(39313,{state:S})}function uc(S){if(!("targetChange"in S))return r$.min();let T=S.targetChange;return T.targetIds&&T.targetIds.length||!T.readTime?r$.min():l0(T.readTime)}function ud(S,T){let R;if(T instanceof lr)R={update:ut(S,T.key,T.value)};else if(T instanceof lh)R={delete:l4(S,T.key)};else if(T instanceof ls)R={update:ut(S,T.key,T.data),updateMask:uZ(T.fieldMask)};else{if(!(T instanceof lm))return t8(16599,{mutationType:T.type});R={verify:l4(S,T.key)}}return T.fieldTransforms.length>0&&(R.updateTransforms=T.fieldTransforms.map(T=>uy(S,T))),T.precondition.isNone||(R.currentDocument=up(S,T.precondition)),R}function uh(S,T){let R=T.currentDocument?uf(T.currentDocument):o3.none(),N=T.updateTransforms?T.updateTransforms.map(T=>uv(S,T)):[];if(T.update){T.update.name;let O=l6(S,T.update.name),P=new an({mapValue:{fields:T.update.fields}});return T.updateMask?new ls(O,P,u0(T.updateMask),R,N):new lr(O,P,R,N)}return T.delete?new lh(l6(S,T.delete),R):T.verify?new lm(l6(S,T.verify),R):t8(1463,{proto:T})}function up(S,T){return void 0!==T.updateTime?{updateTime:lZ(S,T.updateTime)}:void 0!==T.exists?{exists:T.exists}:t8(27497)}function uf(S){return void 0!==S.updateTime?o3.updateTime(l0(S.updateTime)):void 0!==S.exists?o3.exists(S.exists):o3.none()}function um(S,T){let R=S.updateTime?l0(S.updateTime):l0(T);return R.isEqual(r$.min())&&(R=l0(T)),new o2(R,S.transformResults||[])}function ug(S,T){return S&&S.length>0?(rt(void 0!==T,14353),S.map(S=>um(S,T))):[]}function uy(S,T){let R=T.transform;if(R instanceof o$)return{fieldPath:T.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(R instanceof oG)return{fieldPath:T.field.canonicalString(),appendMissingElements:{values:R.elements}};if(R instanceof oW)return{fieldPath:T.field.canonicalString(),removeAllFromArray:{values:R.elements}};if(R instanceof oQ)return{fieldPath:T.field.canonicalString(),increment:R.operand};throw t8(20930,{transform:T.transform})}function uv(S,T){let R=null;return"setToServerValue"in T?(rt("REQUEST_TIME"===T.setToServerValue,16630,{proto:T}),R=new o$):"appendMissingElements"in T?R=new oG(T.appendMissingElements.values||[]):"removeAllFromArray"in T?R=new oW(T.removeAllFromArray.values||[]):"increment"in T?R=new oQ(S,T.increment):t8(16584,{proto:T}),new oZ(rA.fromServerFormat(T.fieldPath),R)}function ub(S,T){return{documents:[l9(S,T.path)]}}function uS(S){let T=S.documents.length;return rt(1===T,1966,{count:T}),a7(a2(l5(S.documents[0])))}function uT(S,T){let R;let N={structuredQuery:{}},O=T.path;null!==T.collectionGroup?(R=O,N.structuredQuery.from=[{collectionId:T.collectionGroup,allDescendants:!0}]):(R=O.popLast(),N.structuredQuery.from=[{collectionId:O.lastSegment()}]),N.parent=l9(S,R);let P=uD(T.filters);P&&(N.structuredQuery.where=P);let M=uN(T.orderBy);M&&(N.structuredQuery.orderBy=M);let L=lW(S,T.limit);return null!==L&&(N.structuredQuery.limit=L),T.startAt&&(N.structuredQuery.startAt=ux(T.startAt)),T.endAt&&(N.structuredQuery.endAt=uP(T.endAt)),{queryTarget:N,parent:R}}function uE(S,T,R,N){let{queryTarget:O,parent:P}=uT(S,T),M={},L=[],U=0;return R.forEach(S=>{let T=N?S.alias:`aggregate_${U++}`;M[T]=S.alias,"count"===S.aggregateType?L.push({alias:T,count:{}}):"avg"===S.aggregateType?L.push({alias:T,avg:{field:uq(S.fieldPath)}}):"sum"===S.aggregateType&&L.push({alias:T,sum:{field:uq(S.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:L,structuredQuery:O.structuredQuery},parent:O.parent},aliasMap:M,parent:P}}function uC(S){let T=l5(S.parent),R=S.structuredQuery,N=R.from?R.from.length:0,O=null;if(N>0){rt(1===N,65062);let S=R.from[0];S.allDescendants?O=S.collectionId:T=T.child(S.collectionId)}let P=[];R.where&&(P=uA(R.where));let M=[];R.orderBy&&(M=uO(R.orderBy));let L=null;R.limit&&(L=lH(R.limit));let U=null;R.startAt&&(U=uM(R.startAt));let V=null;return R.endAt&&(V=uL(R.endAt)),a1(T,O,M,P,L,"F",U,V)}function uw(S){return a7(uC(S))}function u_(S,T){let R=uI(T.purpose);return null==R?null:{"goog-listen-tags":R}}function uI(S){switch(S){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return t8(28987,{purpose:S})}}function uR(S,T){let R;let N=T.target;if((R=a$(N)?{documents:ub(S,N)}:{query:uT(S,N).queryTarget}).targetId=T.targetId,T.resumeToken.approximateByteSize()>0){R.resumeToken=lJ(S,T.resumeToken);let N=lW(S,T.expectedCount);null!==N&&(R.expectedCount=N)}else if(T.snapshotVersion.compareTo(r$.min())>0){R.readTime=lQ(S,T.snapshotVersion.toTimestamp());let N=lW(S,T.expectedCount);null!==N&&(R.expectedCount=N)}return R}function uD(S){if(0!==S.length)return uW(av.create(S,"and"))}function uA(S){let T=uk(S);return T instanceof av&&aT(T)?T.getFilters():[T]}function uk(S){return void 0!==S.unaryFilter?uY(S):void 0!==S.fieldFilter?uJ(S):void 0!==S.compositeFilter?uX(S):t8(30097,{filter:S})}function uN(S){if(0!==S.length)return S.map(S=>uG(S))}function uO(S){return S.map(S=>uK(S))}function ux(S){return{before:S.inclusive,values:S.position}}function uP(S){return{before:!S.inclusive,values:S.position}}function uM(S){let T=!!S.before;return new ao(S.values||[],T)}function uL(S){let T=!S.before;return new ao(S.values||[],T)}function uF(S){return lz[S]}function uB(S){switch(S){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function uj(S){return lq[S]}function uU(S){return l$[S]}function uV(S){switch(S){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return t8(58110);default:return t8(50506)}}function uz(S){switch(S){case"AND":return"and";case"OR":return"or";default:return t8(1026)}}function uq(S){return{fieldPath:S.canonicalString()}}function u$(S){return rA.fromServerFormat(S.fieldPath)}function uG(S){return{field:uq(S.field),direction:uF(S.dir)}}function uK(S){return new ah(u$(S.field),uB(S.direction))}function uW(S){return S instanceof ay?uQ(S):S instanceof av?uH(S):t8(54877,{filter:S})}function uH(S){let T=S.getFilters().map(S=>uW(S));return 1===T.length?T[0]:{compositeFilter:{op:uU(S.op),filters:T}}}function uQ(S){if("=="===S.op){if(s3(S.value))return{unaryFilter:{field:uq(S.field),op:"IS_NAN"}};if(s2(S.value))return{unaryFilter:{field:uq(S.field),op:"IS_NULL"}}}else if("!="===S.op){if(s3(S.value))return{unaryFilter:{field:uq(S.field),op:"IS_NOT_NAN"}};if(s2(S.value))return{unaryFilter:{field:uq(S.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:uq(S.field),op:uj(S.op),value:S.value}}}function uY(S){switch(S.unaryFilter.op){case"IS_NAN":let T=u$(S.unaryFilter.field);return ay.create(T,"==",{doubleValue:NaN});case"IS_NULL":let R=u$(S.unaryFilter.field);return ay.create(R,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let N=u$(S.unaryFilter.field);return ay.create(N,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let O=u$(S.unaryFilter.field);return ay.create(O,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return t8(61313);default:return t8(60726)}}function uJ(S){return ay.create(u$(S.fieldFilter.field),uV(S.fieldFilter.op),S.fieldFilter.value)}function uX(S){return av.create(S.compositeFilter.filters.map(S=>uk(S)),uz(S.compositeFilter.op))}function uZ(S){let T=[];return S.fields.forEach(S=>T.push(S.canonicalString())),{fieldPaths:T}}function u0(S){return new i1((S.fieldPaths||[]).map(S=>rA.fromServerFormat(S)))}function u1(S){return S.length>=4&&"projects"===S.get(0)&&"databases"===S.get(2)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u2{constructor(S,T,R,N,O=r$.min(),P=r$.min(),M=i4.EMPTY_BYTE_STRING,L=null){this.target=S,this.targetId=T,this.purpose=R,this.sequenceNumber=N,this.snapshotVersion=O,this.lastLimboFreeSnapshotVersion=P,this.resumeToken=M,this.expectedCount=L}withSequenceNumber(S){return new u2(this.target,this.targetId,this.purpose,S,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(S,T){return new u2(this.target,this.targetId,this.purpose,this.sequenceNumber,T,this.lastLimboFreeSnapshotVersion,S,null)}withExpectedCount(S){return new u2(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,S)}withLastLimboFreeSnapshotVersion(S){return new u2(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,S,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u3{constructor(S){this.remoteSerializer=S}}function u4(S,T){let R;if(T.document)R=un(S.remoteSerializer,T.document,!!T.hasCommittedMutations);else if(T.noDocument){let S=rk.fromSegments(T.noDocument.path),N=u7(T.noDocument.readTime);R=as.newNoDocument(S,N),T.hasCommittedMutations&&R.setHasCommittedMutations()}else{if(!T.unknownDocument)return t8(56709);let S=rk.fromSegments(T.unknownDocument.path),N=u7(T.unknownDocument.version);R=as.newUnknownDocument(S,N)}return T.readTime&&R.setReadTime(u5(T.readTime)),R}function u6(S,T){let R=T.key,N={prefixPath:R.getCollectionPath().popLast().toArray(),collectionGroup:R.collectionGroup,documentId:R.path.lastSegment(),readTime:u9(T.readTime),hasCommittedMutations:T.hasCommittedMutations};if(T.isFoundDocument())N.document=ur(S.remoteSerializer,T);else if(T.isNoDocument())N.noDocument={path:R.path.toArray(),readTime:u8(T.version)};else{if(!T.isUnknownDocument())return t8(57904,{document:T});N.unknownDocument={path:R.path.toArray(),version:u8(T.version)}}return N}function u9(S){let T=S.toTimestamp();return[T.seconds,T.nanoseconds]}function u5(S){let T=new rq(S[0],S[1]);return r$.fromTimestamp(T)}function u8(S){let T=S.toTimestamp();return{seconds:T.seconds,nanoseconds:T.nanoseconds}}function u7(S){let T=new rq(S.seconds,S.nanoseconds);return r$.fromTimestamp(T)}function ce(S,T,R){let N=R.baseMutations.map(T=>ud(S.remoteSerializer,T)),O=R.mutations.map(T=>ud(S.remoteSerializer,T));return{userId:T,batchId:R.batchId,localWriteTimeMs:R.localWriteTime.toMillis(),baseMutations:N,mutations:O}}function ct(S,T){let R=(T.baseMutations||[]).map(T=>uh(S.remoteSerializer,T));for(let S=0;S<T.mutations.length-1;++S){let R=T.mutations[S];if(S+1<T.mutations.length&&void 0!==T.mutations[S+1].transform){let N=T.mutations[S+1];R.updateTransforms=N.transform.fieldTransforms,T.mutations.splice(S+1,1),++S}}let N=T.mutations.map(T=>uh(S.remoteSerializer,T)),O=rq.fromMillis(T.localWriteTimeMs);return new lg(T.batchId,O,R,N)}function cr(S){let T;let R=u7(S.readTime),N=void 0!==S.lastLimboFreeSnapshotVersion?u7(S.lastLimboFreeSnapshotVersion):r$.min();return new u2(T=ci(S.query)?uS(S.query):uw(S.query),S.targetId,"TargetPurposeListen",S.lastListenSequenceNumber,R,N,i4.fromBase64String(S.resumeToken))}function cn(S,T){let R;let N=u8(T.snapshotVersion),O=u8(T.lastLimboFreeSnapshotVersion);R=a$(T.target)?ub(S.remoteSerializer,T.target):uT(S.remoteSerializer,T.target).queryTarget;let P=T.resumeToken.toBase64();return{targetId:T.targetId,canonicalId:aV(T.target),readTime:N,resumeToken:P,lastListenSequenceNumber:T.sequenceNumber,lastLimboFreeSnapshotVersion:O,query:R}}function ci(S){return void 0!==S.documents}function cs(S){return{id:S.bundleId,createTime:u7(S.createTime),version:S.version}}function ca(S){return{bundleId:S.id,createTime:u8(l0(S.createTime)),version:S.version}}function co(S){return{name:S.name,query:cu(S.bundledQuery),readTime:u7(S.readTime)}}function cl(S){return{name:S.name,readTime:u8(l0(S.readTime)),bundledQuery:S.bundledQuery}}function cu(S){let T=uC({parent:S.parent,structuredQuery:S.structuredQuery});return"LAST"===S.limitType?oi(T,T.limit,"L"):T}function cc(S){return{name:S.name,query:cu(S.bundledQuery),readTime:l0(S.readTime)}}function cd(S){return{id:S.id,version:S.version,createTime:l0(S.createTime)}}function cp(S,T){return new lv(T.largestBatchId,uh(S.remoteSerializer,T.overlayMutation))}function cf(S,T,R){let[N,O,P]=cm(T,R.mutation.key);return{userId:T,collectionPath:O,documentId:P,collectionGroup:R.mutation.key.getCollectionGroup(),largestBatchId:R.largestBatchId,overlayMutation:ud(S.remoteSerializer,R.mutation)}}function cm(S,T){let R=T.path.lastSegment();return[S,nI(T.path.popLast()),R]}function cy(S){return{indexId:S.indexId,collectionGroup:S.collectionGroup,fields:S.fields.map(S=>[S.fieldPath.canonicalString(),S.kind])}}function cv(S,T){let R=T?new r1(T.sequenceNumber,new r4(u7(T.readTime),new rk(nA(T.documentKey)),T.largestBatchId)):r1.empty(),N=S.fields.map(([S,T])=>new rZ(rA.fromServerFormat(S),T));return new rW(S.indexId,S.collectionGroup,N,R)}function cS(S,T,R,N){return{indexId:S,uid:T,sequenceNumber:R,readTime:u8(N.readTime),documentKey:nI(N.documentKey.path),largestBatchId:N.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cT{getBundleMetadata(S,T){return cE(S).get(T).next(S=>{if(S)return cs(S)})}saveBundleMetadata(S,T){return cE(S).put(ca(T))}getNamedQuery(S,T){return cC(S).get(T).next(S=>{if(S)return co(S)})}saveNamedQuery(S,T){return cC(S).put(cl(T))}}function cE(S){return iq(S,ia)}function cC(S){return iq(S,il)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cw{constructor(S,T){this.serializer=S,this.userId=T}static forUser(S,T){return new cw(S,T.uid||"")}getOverlay(S,T){return c_(S).get(cm(this.userId,T)).next(S=>S?cp(this.serializer,S):null)}getOverlays(S,T){let R=oR();return r7.forEach(T,T=>this.getOverlay(S,T).next(S=>{null!==S&&R.set(T,S)})).next(()=>R)}saveOverlays(S,T,R){let N=[];return R.forEach((R,O)=>{let P=new lv(T,O);N.push(this.saveOverlay(S,P))}),r7.waitFor(N)}removeOverlaysForBatchId(S,T,R){let N=new Set;T.forEach(S=>N.add(nI(S.getCollectionPath())));let O=[];return N.forEach(T=>{let N=IDBKeyRange.bound([this.userId,T,R],[this.userId,T,R+1],!1,!0);O.push(c_(S).deleteAll(iR,N))}),r7.waitFor(O)}getOverlaysForCollection(S,T,R){let N=oR(),O=nI(T),P=IDBKeyRange.bound([this.userId,O,R],[this.userId,O,Number.POSITIVE_INFINITY],!0);return c_(S).loadAll(iR,P).next(S=>{for(let T of S){let S=cp(this.serializer,T);N.set(S.getKey(),S)}return N})}getOverlaysForCollectionGroup(S,T,R,N){let O;let P=oR(),M=IDBKeyRange.bound([this.userId,T,R],[this.userId,T,Number.POSITIVE_INFINITY],!0);return c_(S).iterate({index:iA,range:M},(S,T,R)=>{let M=cp(this.serializer,T);P.size()<N||M.largestBatchId===O?(P.set(M.getKey(),M),O=M.largestBatchId):R.done()}).next(()=>P)}saveOverlay(S,T){return c_(S).put(cf(this.serializer,this.userId,T))}}function c_(S){return iq(S,i_)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cI{globalsStore(S){return iq(S,iN)}getSessionToken(S){return this.globalsStore(S).get("sessionToken").next(S=>{let T=null==S?void 0:S.value;return T?i4.fromUint8Array(T):i4.EMPTY_BYTE_STRING})}setSessionToken(S,T){return this.globalsStore(S).put({name:"sessionToken",value:T.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cR=5,cD=10,cA=13,ck=15,cN=20,cO=25,cx=30,cP=37,cM=45,cL=50,cF=53,cB=55,cj=60,cU=2;class cV{constructor(){}writeIndexValue(S,T){this.writeIndexValueAux(S,T),T.writeInfinity()}writeIndexValueAux(S,T){if("nullValue"in S)this.writeValueTypeLabel(T,cR);else if("booleanValue"in S)this.writeValueTypeLabel(T,cD),T.writeNumber(S.booleanValue?1:0);else if("integerValue"in S)this.writeValueTypeLabel(T,ck),T.writeNumber(i7(S.integerValue));else if("doubleValue"in S){let R=i7(S.doubleValue);isNaN(R)?this.writeValueTypeLabel(T,cA):(this.writeValueTypeLabel(T,ck),sm(R)?T.writeNumber(0):T.writeNumber(R))}else if("timestampValue"in S){let R=S.timestampValue;this.writeValueTypeLabel(T,cN),"string"==typeof R&&(R=i8(R)),T.writeString(`${R.seconds||""}`),T.writeNumber(R.nanos||0)}else if("stringValue"in S)this.writeIndexString(S.stringValue,T),this.writeTruncationMarker(T);else if("bytesValue"in S)this.writeValueTypeLabel(T,cx),T.writeBytes(se(S.bytesValue)),this.writeTruncationMarker(T);else if("referenceValue"in S)this.writeIndexEntityRef(S.referenceValue,T);else if("geoPointValue"in S){let R=S.geoPointValue;this.writeValueTypeLabel(T,cM),T.writeNumber(R.latitude||0),T.writeNumber(R.longitude||0)}else"mapValue"in S?s5(S)?this.writeValueTypeLabel(T,Number.MAX_SAFE_INTEGER):s6(S)?this.writeIndexVector(S.mapValue,T):(this.writeIndexMap(S.mapValue,T),this.writeTruncationMarker(T)):"arrayValue"in S?(this.writeIndexArray(S.arrayValue,T),this.writeTruncationMarker(T)):t8(19022,{indexValue:S})}writeIndexString(S,T){this.writeValueTypeLabel(T,cO),this.writeUnlabeledIndexString(S,T)}writeUnlabeledIndexString(S,T){T.writeString(S)}writeIndexMap(S,T){let R=S.fields||{};for(let S of(this.writeValueTypeLabel(T,cB),Object.keys(R)))this.writeIndexString(S,T),this.writeIndexValueAux(R[S],T)}writeIndexVector(S,T){var R,N;let O=S.fields||{};this.writeValueTypeLabel(T,cF);let P=sT,M=(null===(N=null===(R=O[P].arrayValue)||void 0===R?void 0:R.values)||void 0===N?void 0:N.length)||0;this.writeValueTypeLabel(T,ck),T.writeNumber(i7(M)),this.writeIndexString(P,T),this.writeIndexValueAux(O[P],T)}writeIndexArray(S,T){let R=S.values||[];for(let S of(this.writeValueTypeLabel(T,cL),R))this.writeIndexValueAux(S,T)}writeIndexEntityRef(S,T){this.writeValueTypeLabel(T,cP),rk.fromName(S).path.forEach(S=>{this.writeValueTypeLabel(T,cj),this.writeUnlabeledIndexString(S,T)})}writeValueTypeLabel(S,T){S.writeNumber(T)}writeTruncationMarker(S){S.writeNumber(cU)}}cV.INSTANCE=new cV;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cz="\uD800",cq="\uDBFF",c$=0,cG=255,cK=1,cW=255,cH=255,cQ=0,cY=64,cJ=8,cX=1024;function cZ(S){let T=new DataView(new ArrayBuffer(8));return T.setFloat64(0,S,!1),new Uint8Array(T.buffer)}function c0(S){if(0===S)return 8;let T=0;return S>>4==0&&(T+=4,S<<=4),S>>6==0&&(T+=2,S<<=2),S>>7==0&&(T+=1),T}function c4(S){let T=0;for(let R=0;R<8;++R){let N=c0(255&S[R]);if(T+=N,8!==N)break}return T}function c6(S){return Math.ceil((cY-c4(S))/cJ)}class c9{constructor(){this.buffer=new Uint8Array(cX),this.position=0}writeBytesAscending(S){let T=S[Symbol.iterator](),R=T.next();for(;!R.done;)this.writeByteAscending(R.value),R=T.next();this.writeSeparatorAscending()}writeBytesDescending(S){let T=S[Symbol.iterator](),R=T.next();for(;!R.done;)this.writeByteDescending(R.value),R=T.next();this.writeSeparatorDescending()}writeUtf8Ascending(S){for(let T of S){let S=T.charCodeAt(0);if(S<128)this.writeByteAscending(S);else if(S<2048)this.writeByteAscending(960|S>>>6),this.writeByteAscending(128|63&S);else if(T<cz||cq<T)this.writeByteAscending(480|S>>>12),this.writeByteAscending(128|63&S>>>6),this.writeByteAscending(128|63&S);else{let S=T.codePointAt(0);this.writeByteAscending(240|S>>>18),this.writeByteAscending(128|63&S>>>12),this.writeByteAscending(128|63&S>>>6),this.writeByteAscending(128|63&S)}}this.writeSeparatorAscending()}writeUtf8Descending(S){for(let T of S){let S=T.charCodeAt(0);if(S<128)this.writeByteDescending(S);else if(S<2048)this.writeByteDescending(960|S>>>6),this.writeByteDescending(128|63&S);else if(T<cz||cq<T)this.writeByteDescending(480|S>>>12),this.writeByteDescending(128|63&S>>>6),this.writeByteDescending(128|63&S);else{let S=T.codePointAt(0);this.writeByteDescending(240|S>>>18),this.writeByteDescending(128|63&S>>>12),this.writeByteDescending(128|63&S>>>6),this.writeByteDescending(128|63&S)}}this.writeSeparatorDescending()}writeNumberAscending(S){let T=this.toOrderedBits(S),R=c6(T);this.ensureAvailable(1+R),this.buffer[this.position++]=255&R;for(let S=T.length-R;S<T.length;++S)this.buffer[this.position++]=255&T[S]}writeNumberDescending(S){let T=this.toOrderedBits(S),R=c6(T);this.ensureAvailable(1+R),this.buffer[this.position++]=~(255&R);for(let S=T.length-R;S<T.length;++S)this.buffer[this.position++]=~(255&T[S])}writeInfinityAscending(){this.writeEscapedByteAscending(cW),this.writeEscapedByteAscending(cH)}writeInfinityDescending(){this.writeEscapedByteDescending(cW),this.writeEscapedByteDescending(cH)}reset(){this.position=0}seed(S){this.ensureAvailable(S.length),this.buffer.set(S,this.position),this.position+=S.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(S){let T=cZ(S),R=(128&T[0])!=0;T[0]^=R?255:128;for(let S=1;S<T.length;++S)T[S]^=R?255:0;return T}writeByteAscending(S){let T=255&S;T===c$?(this.writeEscapedByteAscending(c$),this.writeEscapedByteAscending(cG)):T===cW?(this.writeEscapedByteAscending(cW),this.writeEscapedByteAscending(cQ)):this.writeEscapedByteAscending(T)}writeByteDescending(S){let T=255&S;T===c$?(this.writeEscapedByteDescending(c$),this.writeEscapedByteDescending(cG)):T===cW?(this.writeEscapedByteDescending(cW),this.writeEscapedByteDescending(cQ)):this.writeEscapedByteDescending(S)}writeSeparatorAscending(){this.writeEscapedByteAscending(c$),this.writeEscapedByteAscending(cK)}writeSeparatorDescending(){this.writeEscapedByteDescending(c$),this.writeEscapedByteDescending(cK)}writeEscapedByteAscending(S){this.ensureAvailable(1),this.buffer[this.position++]=S}writeEscapedByteDescending(S){this.ensureAvailable(1),this.buffer[this.position++]=~S}ensureAvailable(S){let T=S+this.position;if(T<=this.buffer.length)return;let R=2*this.buffer.length;R<T&&(R=T);let N=new Uint8Array(R);N.set(this.buffer),this.buffer=N}}class c5{constructor(S){this.orderedCode=S}writeBytes(S){this.orderedCode.writeBytesAscending(S)}writeString(S){this.orderedCode.writeUtf8Ascending(S)}writeNumber(S){this.orderedCode.writeNumberAscending(S)}writeInfinity(){this.orderedCode.writeInfinityAscending()}}class c8{constructor(S){this.orderedCode=S}writeBytes(S){this.orderedCode.writeBytesDescending(S)}writeString(S){this.orderedCode.writeUtf8Descending(S)}writeNumber(S){this.orderedCode.writeNumberDescending(S)}writeInfinity(){this.orderedCode.writeInfinityDescending()}}class c7{constructor(){this.orderedCode=new c9,this.ascending=new c5(this.orderedCode),this.descending=new c8(this.orderedCode)}seed(S){this.orderedCode.seed(S)}forKind(S){return 0===S?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class de{constructor(S,T,R,N){this._indexId=S,this._documentKey=T,this._arrayValue=R,this._directionalValue=N}successor(){let S=this._directionalValue.length,T=0===S||255===this._directionalValue[S-1]?S+1:S,R=new Uint8Array(T);return R.set(this._directionalValue,0),T!==S?R.set([0],this._directionalValue.length):++R[R.length-1],new de(this._indexId,this._documentKey,this._arrayValue,R)}dbIndexEntry(S,T,R){return{indexId:this._indexId,uid:S,arrayValue:dn(this._arrayValue),directionalValue:dn(this._directionalValue),orderedDocumentKey:dn(T),documentKey:R.path.toArray()}}dbIndexEntryKey(S,T,R){let N=this.dbIndexEntry(S,T,R);return[N.indexId,N.uid,N.arrayValue,N.directionalValue,N.orderedDocumentKey,N.documentKey]}}function dt(S,T){let R=S._indexId-T._indexId;return 0!==R||0!==(R=dr(S._arrayValue,T._arrayValue))||0!==(R=dr(S._directionalValue,T._directionalValue))?R:rk.comparator(S._documentKey,T._documentKey)}function dr(S,T){for(let R=0;R<S.length&&R<T.length;++R){let N=S[R]-T[R];if(0!==N)return N}return S.length-T.length}function dn(S){return isSafariOrWebkit()?ds(S):S}function di(S){return"string"!=typeof S?S:da(S)}function ds(S){let T="";for(let R=0;R<S.length;R++)T+=String.fromCharCode(S[R]);return T}function da(S){let T=new Uint8Array(S.length);for(let R=0;R<S.length;R++)T[R]=S.charCodeAt(R);return T}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dl{constructor(S){for(let T of(this.inequalityFilters=new iJ((S,T)=>rA.comparator(S.field,T.field)),this.collectionId=null!=S.collectionGroup?S.collectionGroup:S.path.lastSegment(),this.orderBys=S.orderBy,this.equalityFilters=[],S.filters)){let S=T;S.isInequality()?this.inequalityFilters=this.inequalityFilters.add(S):this.equalityFilters.push(S)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(S){if(rt(S.collectionGroup===this.collectionId,49279),this.hasMultipleInequality)return!1;let T=rH(S);if(void 0!==T&&!this.hasMatchingEqualityFilter(T))return!1;let R=rQ(S),N=new Set,O=0,P=0;for(;O<R.length;++O)if(this.hasMatchingEqualityFilter(R[O]))N=N.add(R[O].fieldPath.canonicalString());else break;if(O===R.length)return!0;if(this.inequalityFilters.size>0){let S=this.inequalityFilters.getIterator().getNext();if(!N.has(S.field.canonicalString())){let T=R[O];if(!this.matchesFilter(S,T)||!this.matchesOrderBy(this.orderBys[P++],T))return!1}++O}for(;O<R.length;++O){let S=R[O];if(P>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[P++],S))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let S=new iJ(rA.comparator),T=[];for(let R of this.equalityFilters)if(!R.field.isKeyField()){if("array-contains"===R.op||"array-contains-any"===R.op)T.push(new rZ(R.field,2));else{if(S.has(R.field))continue;S=S.add(R.field),T.push(new rZ(R.field,0))}}for(let R of this.orderBys)R.field.isKeyField()||S.has(R.field)||(S=S.add(R.field),T.push(new rZ(R.field,"asc"===R.dir?0:1)));return new rW(rW.UNKNOWN_ID,this.collectionId,T,r1.empty())}hasMatchingEqualityFilter(S){for(let T of this.equalityFilters)if(this.matchesFilter(T,S))return!0;return!1}matchesFilter(S,T){if(void 0===S||!S.field.isEqual(T.fieldPath))return!1;let R="array-contains"===S.op||"array-contains-any"===S.op;return 2===T.kind===R}matchesOrderBy(S,T){return!!S.field.isEqual(T.fieldPath)&&(0===T.kind&&"asc"===S.dir||1===T.kind&&"desc"===S.dir)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function du(S){var T,R;if(rt(S instanceof ay||S instanceof av,20012),S instanceof ay){if(!(S instanceof aL))return S;{let N=(null===(R=null===(T=S.value.arrayValue)||void 0===T?void 0:T.values)||void 0===R?void 0:R.map(T=>ay.create(S.field,"==",T)))||[];return av.create(N,"or")}}let N=S.filters.map(S=>du(S));return av.create(N,S.op)}function dc(S){if(0===S.getFilters().length)return[];let T=dm(du(S));return(rt(dp(T),7391),dd(T)||dh(T))?[T]:T.getFilters()}function dd(S){return S instanceof ay}function dh(S){return S instanceof av&&aT(S)}function dp(S){return dd(S)||dh(S)||df(S)}function df(S){if(S instanceof av&&aS(S)){for(let T of S.getFilters())if(!dd(T)&&!dh(T))return!1;return!0}return!1}function dm(S){if(rt(S instanceof ay||S instanceof av,34018),S instanceof ay)return S;if(1===S.filters.length)return dm(S.filters[0]);let T=S.filters.map(S=>dm(S)),R=av.create(T,S.op);return dp(R=dE(R))?R:(rt(R instanceof av,64498),rt(ab(R),40251),rt(R.filters.length>1,57927),R.filters.reduce((S,T)=>dg(S,T)))}function dg(S,T){let R;return rt(S instanceof ay||S instanceof av,38388),rt(T instanceof ay||T instanceof av,25473),dE(R=S instanceof ay?T instanceof ay?dy(S,T):dT(S,T):T instanceof ay?dT(T,S):dS(S,T))}function dy(S,T){return av.create([S,T],"and")}function dS(S,T){if(rt(S.filters.length>0&&T.filters.length>0,48005),ab(S)&&ab(T))return aR(S,T.getFilters());let R=aS(S)?S:T,N=aS(S)?T:S,O=R.filters.map(S=>dg(S,N));return av.create(O,"or")}function dT(S,T){if(ab(T))return aR(T,S.getFilters());{let R=T.filters.map(T=>dg(S,T));return av.create(R,"or")}}function dE(S){if(rt(S instanceof ay||S instanceof av,11850),S instanceof ay)return S;let T=S.getFilters();if(1===T.length)return dE(T[0]);if(aE(S))return S;let R=T.map(S=>dE(S)),N=[];return(R.forEach(T=>{T instanceof ay?N.push(T):T instanceof av&&(T.op===S.op?N.push(...T.filters):N.push(T))}),1===N.length)?N[0]:av.create(N,S.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dC{constructor(){this.collectionParentIndex=new dw}addToCollectionParentIndex(S,T){return this.collectionParentIndex.add(T),r7.resolve()}getCollectionParents(S,T){return r7.resolve(this.collectionParentIndex.getEntries(T))}addFieldIndex(S,T){return r7.resolve()}deleteFieldIndex(S,T){return r7.resolve()}deleteAllFieldIndexes(S){return r7.resolve()}createTargetIndexes(S,T){return r7.resolve()}getDocumentsMatchingTarget(S,T){return r7.resolve(null)}getIndexType(S,T){return r7.resolve(0)}getFieldIndexes(S,T){return r7.resolve([])}getNextCollectionGroupToUpdate(S){return r7.resolve(null)}getMinOffset(S,T){return r7.resolve(r4.min())}getMinOffsetFromCollectionGroup(S,T){return r7.resolve(r4.min())}updateCollectionGroup(S,T,R){return r7.resolve()}updateIndexEntries(S,T){return r7.resolve()}}class dw{constructor(){this.index={}}add(S){let T=S.lastSegment(),R=S.popLast(),N=this.index[T]||new iJ(rR.comparator),O=!N.has(R);return this.index[T]=N.add(R),O}has(S){let T=S.lastSegment(),R=S.popLast(),N=this.index[T];return N&&N.has(R)}getEntries(S){return(this.index[S]||new iJ(rR.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let d_="IndexedDbIndexManager",dI=new Uint8Array(0);class dR{constructor(S,T){this.databaseId=T,this.collectionParentsCache=new dw,this.targetToDnfSubTargets=new oS(S=>aV(S),(S,T)=>aq(S,T)),this.uid=S.uid||""}addToCollectionParentIndex(S,T){if(!this.collectionParentsCache.has(T)){let R=T.lastSegment(),N=T.popLast();S.addOnCommittedListener(()=>{this.collectionParentsCache.add(T)});let O={collectionId:R,parent:nI(N)};return dD(S).put(O)}return r7.resolve()}getCollectionParents(S,T){let R=[],N=IDBKeyRange.bound([T,""],[rw(T),""],!1,!0);return dD(S).loadAll(N).next(S=>{for(let N of S){if(N.collectionId!==T)break;R.push(nA(N.parent))}return R})}addFieldIndex(S,T){let R=dk(S),N=cy(T);delete N.indexId;let O=R.add(N);if(!T.indexState)return O.next();{let R=dN(S);return O.next(S=>{R.put(cS(S,this.uid,T.indexState.sequenceNumber,T.indexState.offset))})}}deleteFieldIndex(S,T){let R=dk(S),N=dN(S),O=dA(S);return R.delete(T.indexId).next(()=>N.delete(IDBKeyRange.bound([T.indexId],[T.indexId+1],!1,!0))).next(()=>O.delete(IDBKeyRange.bound([T.indexId],[T.indexId+1],!1,!0)))}deleteAllFieldIndexes(S){let T=dk(S),R=dA(S),N=dN(S);return T.deleteAll().next(()=>R.deleteAll()).next(()=>N.deleteAll())}createTargetIndexes(S,T){return r7.forEach(this.getSubTargets(T),T=>this.getIndexType(S,T).next(R=>{if(0===R||1===R){let R=new dl(T).buildTargetIndex();if(null!=R)return this.addFieldIndex(S,R)}}))}getDocumentsMatchingTarget(S,T){let R=dA(S),N=!0,O=new Map;return r7.forEach(this.getSubTargets(T),T=>this.getFieldIndex(S,T).next(S=>{N&&(N=!!S),O.set(T,S)})).next(()=>{if(!N)return r7.resolve(null);{let S=ox(),N=[];return r7.forEach(O,(O,P)=>{t4(d_,`Using index ${rX(O)} to execute ${aV(T)}`);let M=aK(P,O),L=aW(P,O),U=aH(P,O),V=aQ(P,O),$=this.encodeBound(O,P,U),K=this.encodeBound(O,P,V),W=this.encodeValues(O,P,L),Q=this.generateIndexRanges(O.indexId,M,$,U.inclusive,K,V.inclusive,W);return r7.forEach(Q,O=>R.loadFirst(O,T.limit).next(T=>{T.forEach(T=>{let R=rk.fromSegments(T.documentKey);S.has(R)||(S=S.add(R),N.push(R))})}))}).next(()=>N)}})}getSubTargets(S){let T=this.targetToDnfSubTargets.get(S);return T||(T=0===S.filters.length?[S]:dc(av.create(S.filters,"and")).map(T=>aU(S.path,S.collectionGroup,S.orderBy,T.getFilters(),S.limit,S.startAt,S.endAt)),this.targetToDnfSubTargets.set(S,T)),T}generateIndexRanges(S,T,R,N,O,P,M){let L=(null!=T?T.length:1)*Math.max(R.length,O.length),U=L/(null!=T?T.length:1),V=[];for(let $=0;$<L;++$){let L=T?this.encodeSingleElement(T[$/U]):dI,K=this.generateLowerBound(S,L,R[$%U],N),W=this.generateUpperBound(S,L,O[$%U],P),Q=M.map(T=>this.generateLowerBound(S,L,T,!0));V.push(...this.createRange(K,W,Q))}return V}generateLowerBound(S,T,R,N){let O=new de(S,rk.empty(),T,R);return N?O:O.successor()}generateUpperBound(S,T,R,N){let O=new de(S,rk.empty(),T,R);return N?O.successor():O}getFieldIndex(S,T){let R=new dl(T),N=null!=T.collectionGroup?T.collectionGroup:T.path.lastSegment();return this.getFieldIndexes(S,N).next(S=>{let T=null;for(let N of S)R.servedByIndex(N)&&(!T||N.fields.length>T.fields.length)&&(T=N);return T})}getIndexType(S,T){let R=2,N=this.getSubTargets(T);return r7.forEach(N,T=>this.getFieldIndex(S,T).next(S=>{S?0!==R&&S.fields.length<aX(T)&&(R=1):R=0})).next(()=>aZ(T)&&N.length>1&&2===R?1:R)}encodeDirectionalElements(S,T){let R=new c7;for(let N of rQ(S)){let S=T.data.field(N.fieldPath);if(null==S)return null;let O=R.forKind(N.kind);cV.INSTANCE.writeIndexValue(S,O)}return R.encodedBytes()}encodeSingleElement(S){let T=new c7;return cV.INSTANCE.writeIndexValue(S,T.forKind(0)),T.encodedBytes()}encodeDirectionalKey(S,T){let R=new c7;return cV.INSTANCE.writeIndexValue(sJ(this.databaseId,T),R.forKind(rY(S))),R.encodedBytes()}encodeValues(S,T,R){if(null===R)return[];let N=[];N.push(new c7);let O=0;for(let P of rQ(S)){let S=R[O++];for(let R of N)if(this.isInFilter(T,P.fieldPath)&&s1(S))N=this.expandIndexValues(N,P,S);else{let T=R.forKind(P.kind);cV.INSTANCE.writeIndexValue(S,T)}}return this.getEncodedBytes(N)}encodeBound(S,T,R){return this.encodeValues(S,T,R.position)}getEncodedBytes(S){let T=[];for(let R=0;R<S.length;++R)T[R]=S[R].encodedBytes();return T}expandIndexValues(S,T,R){let N=[...S],O=[];for(let S of R.arrayValue.values||[])for(let R of N){let N=new c7;N.seed(R.encodedBytes()),cV.INSTANCE.writeIndexValue(S,N.forKind(T.kind)),O.push(N)}return O}isInFilter(S,T){return!!S.filters.find(S=>S instanceof ay&&S.field.isEqual(T)&&("in"===S.op||"not-in"===S.op))}getFieldIndexes(S,T){let R=dk(S),N=dN(S);return(T?R.loadAll(im,IDBKeyRange.bound(T,T)):R.loadAll()).next(S=>{let T=[];return r7.forEach(S,S=>N.get([S.indexId,this.uid]).next(R=>{T.push(cv(S,R))})).next(()=>T)})}getNextCollectionGroupToUpdate(S){return this.getFieldIndexes(S).next(S=>0===S.length?null:(S.sort((S,T)=>{let R=S.indexState.sequenceNumber-T.indexState.sequenceNumber;return 0!==R?R:rb(S.collectionGroup,T.collectionGroup)}),S[0].collectionGroup))}updateCollectionGroup(S,T,R){let N=dk(S),O=dN(S);return this.getNextSequenceNumber(S).next(S=>N.loadAll(im,IDBKeyRange.bound(T,T)).next(T=>r7.forEach(T,T=>O.put(cS(T.indexId,this.uid,S,R)))))}updateIndexEntries(S,T){let R=new Map;return r7.forEach(T,(T,N)=>{let O=R.get(T.collectionGroup);return(O?r7.resolve(O):this.getFieldIndexes(S,T.collectionGroup)).next(O=>(R.set(T.collectionGroup,O),r7.forEach(O,R=>this.getExistingIndexEntries(S,T,R).next(T=>{let O=this.computeIndexEntries(N,R);return T.isEqual(O)?r7.resolve():this.updateEntries(S,N,R,T,O)}))))})}addIndexEntry(S,T,R,N){return dA(S).put(N.dbIndexEntry(this.uid,this.encodeDirectionalKey(R,T.key),T.key))}deleteIndexEntry(S,T,R,N){return dA(S).delete(N.dbIndexEntryKey(this.uid,this.encodeDirectionalKey(R,T.key),T.key))}getExistingIndexEntries(S,T,R){let N=dA(S),O=new iJ(dt);return N.iterate({index:iC,range:IDBKeyRange.only([R.indexId,this.uid,dn(this.encodeDirectionalKey(R,T))])},(S,N)=>{O=O.add(new de(R.indexId,T,di(N.arrayValue),di(N.directionalValue)))}).next(()=>O)}computeIndexEntries(S,T){let R=new iJ(dt),N=this.encodeDirectionalElements(T,S);if(null==N)return R;let O=rH(T);if(null!=O){let P=S.data.field(O.fieldPath);if(s1(P))for(let O of P.arrayValue.values||[])R=R.add(new de(T.indexId,S.key,this.encodeSingleElement(O),N))}else R=R.add(new de(T.indexId,S.key,dI,N));return R}updateEntries(S,T,R,N,O){t4(d_,"Updating index entries for document '%s'",T.key);let P=[];return iZ(N,O,dt,N=>{P.push(this.addIndexEntry(S,T,R,N))},N=>{P.push(this.deleteIndexEntry(S,T,R,N))}),r7.waitFor(P)}getNextSequenceNumber(S){let T=1;return dN(S).iterate({index:ib,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(S,R,N)=>{N.done(),T=R.sequenceNumber+1}).next(()=>T)}createRange(S,T,R){R=R.sort((S,T)=>dt(S,T)).filter((S,T,R)=>!T||0!==dt(S,R[T-1]));let N=[];for(let O of(N.push(S),R)){let R=dt(O,S),P=dt(O,T);if(0===R)N[0]=S.successor();else if(R>0&&P<0)N.push(O),N.push(O.successor());else if(P>0)break}N.push(T);let O=[];for(let S=0;S<N.length;S+=2){if(this.isRangeMatchable(N[S],N[S+1]))return[];let T=N[S].dbIndexEntryKey(this.uid,dI,rk.empty()),R=N[S+1].dbIndexEntryKey(this.uid,dI,rk.empty());O.push(IDBKeyRange.bound(T,R))}return O}isRangeMatchable(S,T){return dt(S,T)>0}getMinOffsetFromCollectionGroup(S,T){return this.getFieldIndexes(S,T).next(dO)}getMinOffset(S,T){return r7.mapArray(this.getSubTargets(T),T=>this.getFieldIndex(S,T).next(S=>S||t8(44426))).next(dO)}}function dD(S){return iq(S,ie)}function dA(S){return iq(S,iT)}function dk(S){return iq(S,ic)}function dN(S){return iq(S,iy)}function dO(S){rt(0!==S.length,28825);let T=S[0].indexState.offset,R=T.largestBatchId;for(let N=1;N<S.length;N++){let O=S[N].indexState.offset;0>r6(O,T)&&(T=O),R<O.largestBatchId&&(R=O.largestBatchId)}return new r4(T.readTime,T.documentKey,R)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dx(S,T,R){let N=S.store(nM),O=S.store(nq),P=[],M=IDBKeyRange.only(R.batchId),L=0,U=N.iterate({range:M},(S,T,R)=>(L++,R.delete()));P.push(U.next(()=>{rt(1===L,47070,{batchId:R.batchId})}));let V=[];for(let S of R.mutations){let N=nV(T,S.key.path,R.batchId);P.push(O.delete(N)),V.push(S.key)}return r7.waitFor(P).next(()=>V)}function dP(S){let T;if(!S)return 0;if(S.document)T=S.document;else if(S.unknownDocument)T=S.unknownDocument;else if(S.noDocument)T=S.noDocument;else throw t8(14731);return JSON.stringify(T).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dM{constructor(S,T,R,N){this.userId=S,this.serializer=T,this.indexManager=R,this.referenceDelegate=N,this.documentKeysByBatchId={}}static forUser(S,T,R,N){return rt(""!==S.uid,64387),new dM(S.isAuthenticated()?S.uid:"",T,R,N)}checkEmpty(S){let T=!0,R=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return dB(S).iterate({index:nF,range:R},(S,R,N)=>{T=!1,N.done()}).next(()=>T)}addMutationBatch(S,T,R,N){let O=dj(S),P=dB(S);return P.add({}).next(M=>{rt("number"==typeof M,49019);let L=new lg(M,T,R,N),U=ce(this.serializer,this.userId,L),V=[],$=new iJ((S,T)=>rb(S.canonicalString(),T.canonicalString()));for(let S of N){let T=nV(this.userId,S.key.path,M);$=$.add(S.key.path.popLast()),V.push(P.put(U)),V.push(O.put(T,nz))}return $.forEach(T=>{V.push(this.indexManager.addToCollectionParentIndex(S,T))}),S.addOnCommittedListener(()=>{this.documentKeysByBatchId[M]=L.keys()}),r7.waitFor(V).next(()=>L)})}lookupMutationBatch(S,T){return dB(S).get(T).next(S=>S?(rt(S.userId===this.userId,48,"Unexpected user for mutation batch",{userId:S.userId,batchId:T}),ct(this.serializer,S)):null)}lookupMutationKeys(S,T){return this.documentKeysByBatchId[T]?r7.resolve(this.documentKeysByBatchId[T]):this.lookupMutationBatch(S,T).next(S=>{if(!S)return null;{let R=S.keys();return this.documentKeysByBatchId[T]=R,R}})}getNextMutationBatchAfterBatchId(S,T){let R=T+1,N=IDBKeyRange.lowerBound([this.userId,R]),O=null;return dB(S).iterate({index:nF,range:N},(S,T,N)=>{T.userId===this.userId&&(rt(T.batchId>=R,47524,{nextBatchId:R}),O=ct(this.serializer,T)),N.done()}).next(()=>O)}getHighestUnacknowledgedBatchId(S){let T=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),R=sp;return dB(S).iterate({index:nF,range:T,reverse:!0},(S,T,N)=>{R=T.batchId,N.done()}).next(()=>R)}getAllMutationBatches(S){let T=IDBKeyRange.bound([this.userId,sp],[this.userId,Number.POSITIVE_INFINITY]);return dB(S).loadAll(nF,T).next(S=>S.map(S=>ct(this.serializer,S)))}getAllMutationBatchesAffectingDocumentKey(S,T){let R=nU(this.userId,T.path),N=IDBKeyRange.lowerBound(R),O=[];return dj(S).iterate({range:N},(R,N,P)=>{let[M,L,U]=R,V=nA(L);if(M!==this.userId||!T.path.isEqual(V)){P.done();return}return dB(S).get(U).next(S=>{if(!S)throw t8(61480,{indexKey:R,batchId:U});rt(S.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:S.userId,batchId:U}),O.push(ct(this.serializer,S))})}).next(()=>O)}getAllMutationBatchesAffectingDocumentKeys(S,T){let R=new iJ(rb),N=[];return T.forEach(T=>{let O=nU(this.userId,T.path),P=IDBKeyRange.lowerBound(O),M=dj(S).iterate({range:P},(S,N,O)=>{let[P,M,L]=S,U=nA(M);if(P!==this.userId||!T.path.isEqual(U)){O.done();return}R=R.add(L)});N.push(M)}),r7.waitFor(N).next(()=>this.lookupMutationBatches(S,R))}getAllMutationBatchesAffectingQuery(S,T){let R=T.path,N=R.length+1,O=nU(this.userId,R),P=IDBKeyRange.lowerBound(O),M=new iJ(rb);return dj(S).iterate({range:P},(S,T,O)=>{let[P,L,U]=S,V=nA(L);if(P!==this.userId||!R.isPrefixOf(V)){O.done();return}V.length===N&&(M=M.add(U))}).next(()=>this.lookupMutationBatches(S,M))}lookupMutationBatches(S,T){let R=[],N=[];return T.forEach(T=>{N.push(dB(S).get(T).next(S=>{if(null===S)throw t8(35274,{batchId:T});rt(S.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:S.userId,batchId:T}),R.push(ct(this.serializer,S))}))}),r7.waitFor(N).next(()=>R)}removeMutationBatch(S,T){return dx(S.simpleDbTransaction,this.userId,T).next(R=>(S.addOnCommittedListener(()=>{this.removeCachedMutationKeys(T.batchId)}),r7.forEach(R,T=>this.referenceDelegate.markPotentiallyOrphaned(S,T))))}removeCachedMutationKeys(S){delete this.documentKeysByBatchId[S]}performConsistencyCheck(S){return this.checkEmpty(S).next(T=>{if(!T)return r7.resolve();let R=IDBKeyRange.lowerBound(nj(this.userId)),N=[];return dj(S).iterate({range:R},(S,T,R)=>{if(S[0]!==this.userId){R.done();return}{let T=nA(S[1]);N.push(T)}}).next(()=>{rt(0===N.length,56720,{danglingKeys:N.map(S=>S.canonicalString())})})})}containsKey(S,T){return dL(S,this.userId,T)}getMutationQueueMetadata(S){return dU(S).get(this.userId).next(S=>S||{userId:this.userId,lastAcknowledgedBatchId:sp,lastStreamToken:""})}}function dL(S,T,R){let N=nU(T,R.path),O=N[1],P=IDBKeyRange.lowerBound(N),M=!1;return dj(S).iterate({range:P,keysOnly:!0},(S,R,N)=>{let[P,L,U]=S;P===T&&L===O&&(M=!0),N.done()}).next(()=>M)}function dF(S,T){let R=!1;return dU(S).iterateSerial(N=>dL(S,N,T).next(S=>(S&&(R=!0),r7.resolve(!S)))).next(()=>R)}function dB(S){return iq(S,nM)}function dj(S){return iq(S,nq)}function dU(S){return iq(S,nx)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dV=2;class dz{constructor(S){this.lastId=S}next(){return this.lastId+=dV,this.lastId}static forTargetCache(){return new dz(2-dV)}static forSyncEngine(){return new dz(1-dV)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dq{constructor(S,T){this.referenceDelegate=S,this.serializer=T}allocateTargetId(S){return this.retrieveMetadata(S).next(T=>{let R=new dz(T.highestTargetId);return T.highestTargetId=R.next(),this.saveMetadata(S,T).next(()=>T.highestTargetId)})}getLastRemoteSnapshotVersion(S){return this.retrieveMetadata(S).next(S=>r$.fromTimestamp(new rq(S.lastRemoteSnapshotVersion.seconds,S.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(S){return this.retrieveMetadata(S).next(S=>S.highestListenSequenceNumber)}setTargetsMetadata(S,T,R){return this.retrieveMetadata(S).next(N=>(N.highestListenSequenceNumber=T,R&&(N.lastRemoteSnapshotVersion=R.toTimestamp()),T>N.highestListenSequenceNumber&&(N.highestListenSequenceNumber=T),this.saveMetadata(S,N)))}addTargetData(S,T){return this.saveTargetData(S,T).next(()=>this.retrieveMetadata(S).next(R=>(R.targetCount+=1,this.updateMetadataFromTargetData(T,R),this.saveMetadata(S,R))))}updateTargetData(S,T){return this.saveTargetData(S,T)}removeTargetData(S,T){return this.removeMatchingKeysForTargetId(S,T.targetId).next(()=>d$(S).delete(T.targetId)).next(()=>this.retrieveMetadata(S)).next(T=>(rt(T.targetCount>0,8065),T.targetCount-=1,this.saveMetadata(S,T)))}removeTargets(S,T,R){let N=0,O=[];return d$(S).iterate((P,M)=>{let L=cr(M);L.sequenceNumber<=T&&null===R.get(L.targetId)&&(N++,O.push(this.removeTargetData(S,L)))}).next(()=>r7.waitFor(O)).next(()=>N)}forEachTarget(S,T){return d$(S).iterate((S,R)=>{T(cr(R))})}retrieveMetadata(S){return dG(S).get(n8).next(S=>(rt(null!==S,2888),S))}saveMetadata(S,T){return dG(S).put(n8,T)}saveTargetData(S,T){return d$(S).put(cn(this.serializer,T))}updateMetadataFromTargetData(S,T){let R=!1;return S.targetId>T.highestTargetId&&(T.highestTargetId=S.targetId,R=!0),S.sequenceNumber>T.highestListenSequenceNumber&&(T.highestListenSequenceNumber=S.sequenceNumber,R=!0),R}getTargetCount(S){return this.retrieveMetadata(S).next(S=>S.targetCount)}getTargetData(S,T){let R=aV(T),N=IDBKeyRange.bound([R,Number.NEGATIVE_INFINITY],[R,Number.POSITIVE_INFINITY]),O=null;return d$(S).iterate({range:N,index:n0},(S,R,N)=>{let P=cr(R);aq(T,P.target)&&(O=P,N.done())}).next(()=>O)}addMatchingKeys(S,T,R){let N=[],O=dK(S);return T.forEach(T=>{let P=nI(T.path);N.push(O.put({targetId:R,path:P})),N.push(this.referenceDelegate.addReference(S,R,T))}),r7.waitFor(N)}removeMatchingKeys(S,T,R){let N=dK(S);return r7.forEach(T,T=>{let O=nI(T.path);return r7.waitFor([N.delete([R,O]),this.referenceDelegate.removeReference(S,R,T)])})}removeMatchingKeysForTargetId(S,T){let R=dK(S),N=IDBKeyRange.bound([T],[T+1],!1,!0);return R.delete(N)}getMatchingKeysForTargetId(S,T){let R=IDBKeyRange.bound([T],[T+1],!1,!0),N=dK(S),O=ox();return N.iterate({range:R,keysOnly:!0},(S,T,R)=>{let N=new rk(nA(S[1]));O=O.add(N)}).next(()=>O)}containsKey(S,T){let R=nI(T.path),N=IDBKeyRange.bound([R],[rw(R)],!1,!0),O=0;return dK(S).iterate({index:n9,keysOnly:!0,range:N},([S,T],R,N)=>{0!==S&&(O++,N.done())}).next(()=>O>0)}getTargetDataForTarget(S,T){return d$(S).get(T).next(S=>S?cr(S):null)}}function d$(S){return iq(S,nX)}function dG(S){return iq(S,n7)}function dK(S){return iq(S,n4)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dW={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},dH=-1,dQ=41943040;class dY{static withCacheSize(S){return new dY(S,dY.DEFAULT_COLLECTION_PERCENTILE,dY.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(S,T,R){this.cacheSizeCollectionThreshold=S,this.percentileToCollect=T,this.maximumSequenceNumbersToCollect=R}}dY.DEFAULT_COLLECTION_PERCENTILE=10,dY.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,dY.DEFAULT=new dY(dQ,dY.DEFAULT_COLLECTION_PERCENTILE,dY.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),dY.DISABLED=new dY(dH,0,0);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dJ="LruGarbageCollector",dX=1048576,dZ=6e4,d0=3e5;function d3([S,T],[R,N]){let O=rb(S,R);return 0===O?rb(T,N):O}class d4{constructor(S){this.maxElements=S,this.buffer=new iJ(d3),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(S){let T=[S,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(T);else{let S=this.buffer.last();0>d3(T,S)&&(this.buffer=this.buffer.delete(S).add(T))}}get maxValue(){return this.buffer.last()[0]}}class d6{constructor(S,T,R){this.garbageCollector=S,this.asyncQueue=T,this.localStore=R,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==dH&&this.scheduleGC(dZ)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return null!==this.gcTask}scheduleGC(S){t4(dJ,`Garbage collection scheduled in ${S}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",S,async()=>{this.gcTask=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(S){nc(S)?t4(dJ,"Ignoring IndexedDB error during garbage collection: ",S):await r8(S)}await this.scheduleGC(d0)})}}class d9{constructor(S,T){this.delegate=S,this.params=T}calculateTargetCount(S,T){return this.delegate.getSequenceNumberCount(S).next(S=>Math.floor(T/100*S))}nthSequenceNumber(S,T){if(0===T)return r7.resolve(nT.INVALID);let R=new d4(T);return this.delegate.forEachTarget(S,S=>R.addElement(S.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(S,S=>R.addElement(S))).next(()=>R.maxValue)}removeTargets(S,T,R){return this.delegate.removeTargets(S,T,R)}removeOrphanedDocuments(S,T){return this.delegate.removeOrphanedDocuments(S,T)}collect(S,T){return this.params.cacheSizeCollectionThreshold===dH?(t4("LruGarbageCollector","Garbage collection skipped; disabled"),r7.resolve(dW)):this.getCacheSize(S).next(R=>R<this.params.cacheSizeCollectionThreshold?(t4("LruGarbageCollector",`Garbage collection skipped; Cache size ${R} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),dW):this.runGarbageCollection(S,T))}getCacheSize(S){return this.delegate.getCacheSize(S)}runGarbageCollection(S,T){let R,N,O,M,L,U,V;let $=Date.now();return this.calculateTargetCount(S,this.params.percentileToCollect).next(T=>(T>this.params.maximumSequenceNumbersToCollect?(t4("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${T}`),N=this.params.maximumSequenceNumbersToCollect):N=T,M=Date.now(),this.nthSequenceNumber(S,N))).next(N=>(R=N,L=Date.now(),this.removeTargets(S,R,T))).next(T=>(O=T,U=Date.now(),this.removeOrphanedDocuments(S,R))).next(S=>(V=Date.now(),t3()<=P.DEBUG&&t4("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${M-$}ms
	Determined least recently used ${N} in ${L-M}ms
	Removed ${O} targets in ${U-L}ms
	Removed ${S} documents in ${V-U}ms
Total Duration: ${V-$}ms`),r7.resolve({didRun:!0,sequenceNumbersCollected:N,targetsRemoved:O,documentsRemoved:S})))}}function d5(S,T){return new d9(S,T)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d8{constructor(S,T){this.db=S,this.garbageCollector=d5(this,T)}getSequenceNumberCount(S){let T=this.orphanedDocumentCount(S);return this.db.getTargetCache().getTargetCount(S).next(S=>T.next(T=>S+T))}orphanedDocumentCount(S){let T=0;return this.forEachOrphanedDocumentSequenceNumber(S,S=>{T++}).next(()=>T)}forEachTarget(S,T){return this.db.getTargetCache().forEachTarget(S,T)}forEachOrphanedDocumentSequenceNumber(S,T){return this.forEachOrphanedDocument(S,(S,R)=>T(R))}addReference(S,T,R){return ht(S,R)}removeReference(S,T,R){return ht(S,R)}removeTargets(S,T,R){return this.db.getTargetCache().removeTargets(S,T,R)}markPotentiallyOrphaned(S,T){return ht(S,T)}isPinned(S,T){return dF(S,T)}removeOrphanedDocuments(S,T){let R=this.db.getRemoteDocumentCache().newChangeBuffer(),N=[],O=0;return this.forEachOrphanedDocument(S,(P,M)=>{if(M<=T){let T=this.isPinned(S,P).next(T=>{if(!T)return O++,R.getEntry(S,P).next(()=>(R.removeEntry(P,r$.min()),dK(S).delete(d7(P))))});N.push(T)}}).next(()=>r7.waitFor(N)).next(()=>R.apply(S)).next(()=>O)}removeTarget(S,T){let R=T.withSequenceNumber(S.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(S,R)}updateLimboDocument(S,T){return ht(S,T)}forEachOrphanedDocument(S,T){let R;let N=dK(S),O=nT.INVALID;return N.iterate({index:n9},([S,N],{path:P,sequenceNumber:M})=>{0===S?(O!==nT.INVALID&&T(new rk(nA(R)),O),O=M,R=P):O=nT.INVALID}).next(()=>{O!==nT.INVALID&&T(new rk(nA(R)),O)})}getCacheSize(S){return this.db.getRemoteDocumentCache().getSize(S)}}function d7(S){return[0,nI(S.path)]}function he(S,T){return{targetId:0,path:nI(S.path),sequenceNumber:T}}function ht(S,T){return dK(S).put(he(T,S.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hr{constructor(){this.changes=new oS(S=>S.toString(),(S,T)=>S.isEqual(T)),this.changesApplied=!1}addEntry(S){this.assertNotApplied(),this.changes.set(S.key,S)}removeEntry(S,T){this.assertNotApplied(),this.changes.set(S,as.newInvalidDocument(S).setReadTime(T))}getEntry(S,T){this.assertNotApplied();let R=this.changes.get(T);return void 0!==R?r7.resolve(R):this.getFromCache(S,T)}getEntries(S,T){return this.getAllFromCache(S,T)}apply(S){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(S)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hn{constructor(S){this.serializer=S}setIndexManager(S){this.indexManager=S}addEntry(S,T,R){return hl(S).put(R)}removeEntry(S,T,R){return hl(S).delete(hc(T,R))}updateMetadata(S,T){return this.getMetadata(S).next(R=>(R.byteSize+=T,this.setMetadata(S,R)))}getEntry(S,T){let R=as.newInvalidDocument(T);return hl(S).iterate({index:nK,range:IDBKeyRange.only(hu(T))},(S,N)=>{R=this.maybeDecodeDocument(T,N)}).next(()=>R)}getSizedEntry(S,T){let R={size:0,document:as.newInvalidDocument(T)};return hl(S).iterate({index:nK,range:IDBKeyRange.only(hu(T))},(S,N)=>{R={document:this.maybeDecodeDocument(T,N),size:dP(N)}}).next(()=>R)}getEntries(S,T){let R=oE();return this.forEachDbEntry(S,T,(S,T)=>{let N=this.maybeDecodeDocument(S,T);R=R.insert(S,N)}).next(()=>R)}getSizedEntries(S,T){let R=oE(),N=new iW(rk.comparator);return this.forEachDbEntry(S,T,(S,T)=>{let O=this.maybeDecodeDocument(S,T);R=R.insert(S,O),N=N.insert(S,dP(T))}).next(()=>({documents:R,sizeMap:N}))}forEachDbEntry(S,T,R){if(T.isEmpty())return r7.resolve();let N=new iJ(hh);T.forEach(S=>N=N.add(S));let O=IDBKeyRange.bound(hu(N.first()),hu(N.last())),P=N.getIterator(),M=P.getNext();return hl(S).iterate({index:nK,range:O},(S,T,N)=>{let O=rk.fromSegments([...T.prefixPath,T.collectionGroup,T.documentId]);for(;M&&0>hh(M,O);)R(M,null),M=P.getNext();M&&M.isEqual(O)&&(R(M,T),M=P.hasNext()?P.getNext():null),M?N.skip(hu(M)):N.done()}).next(()=>{for(;M;)R(M,null),M=P.hasNext()?P.getNext():null})}getDocumentsMatchingQuery(S,T,R,N,O){let P=T.path,M=[P.popLast().toArray(),P.lastSegment(),u9(R.readTime),R.documentKey.path.isEmpty()?"":R.documentKey.path.lastSegment()],L=[P.popLast().toArray(),P.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return hl(S).loadAll(IDBKeyRange.bound(M,L,!0)).next(S=>{null==O||O.incrementDocumentReadCount(S.length);let R=oE();for(let O of S){let S=this.maybeDecodeDocument(rk.fromSegments(O.prefixPath.concat(O.collectionGroup,O.documentId)),O);S.isFoundDocument()&&(od(T,S)||N.has(S.key))&&(R=R.insert(S.key,S))}return R})}getAllFromCollectionGroup(S,T,R,N){let O=oE(),P=hd(T,R),M=hd(T,r4.max());return hl(S).iterate({index:nH,range:IDBKeyRange.bound(P,M,!0)},(S,T,R)=>{let P=this.maybeDecodeDocument(rk.fromSegments(T.prefixPath.concat(T.collectionGroup,T.documentId)),T);(O=O.insert(P.key,P)).size===N&&R.done()}).next(()=>O)}newChangeBuffer(S){return new ha(this,!!S&&S.trackRemovals)}getSize(S){return this.getMetadata(S).next(S=>S.byteSize)}getMetadata(S){return ho(S).get(nJ).next(S=>(rt(!!S,20021),S))}setMetadata(S,T){return ho(S).put(nJ,T)}maybeDecodeDocument(S,T){if(T){let S=u4(this.serializer,T);if(!(S.isNoDocument()&&S.version.isEqual(r$.min())))return S}return as.newInvalidDocument(S)}}function hs(S){return new hn(S)}class ha extends null{constructor(S,T){super(),this.documentCache=S,this.trackRemovals=T,this.documentStates=new oS(S=>S.toString(),(S,T)=>S.isEqual(T))}applyChanges(S){let T=[],R=0,N=new iJ((S,T)=>rb(S.canonicalString(),T.canonicalString()));return this.changes.forEach((O,P)=>{let M=this.documentStates.get(O);if(T.push(this.documentCache.removeEntry(S,O,M.readTime)),P.isValidDocument()){let L=u6(this.documentCache.serializer,P);N=N.add(O.path.popLast());let U=dP(L);R+=U-M.size,T.push(this.documentCache.addEntry(S,O,L))}else if(R-=M.size,this.trackRemovals){let R=u6(this.documentCache.serializer,P.convertToNoDocument(r$.min()));T.push(this.documentCache.addEntry(S,O,R))}}),N.forEach(R=>{T.push(this.documentCache.indexManager.addToCollectionParentIndex(S,R))}),T.push(this.documentCache.updateMetadata(S,R)),r7.waitFor(T)}getFromCache(S,T){return this.documentCache.getSizedEntry(S,T).next(S=>(this.documentStates.set(T,{size:S.size,readTime:S.document.readTime}),S.document))}getAllFromCache(S,T){return this.documentCache.getSizedEntries(S,T).next(({documents:S,sizeMap:T})=>(T.forEach((T,R)=>{this.documentStates.set(T,{size:R,readTime:S.get(T).readTime})}),S))}}function ho(S){return iq(S,nY)}function hl(S){return iq(S,n$)}function hu(S){let T=S.path.toArray();return[T.slice(0,T.length-2),T[T.length-2],T[T.length-1]]}function hc(S,T){let R=S.path.toArray();return[R.slice(0,R.length-2),R[R.length-2],u9(T),R[R.length-1]]}function hd(S,T){let R=T.documentKey.path.toArray();return[S,u9(T.readTime),R.slice(0,R.length-2),R.length>0?R[R.length-1]:""]}function hh(S,T){let R=S.path.toArray(),N=T.path.toArray(),O=0;for(let S=0;S<R.length-2&&S<N.length-2;++S)if(O=rb(R[S],N[S]))return O;return(O=rb(R.length,N.length))||(O=rb(R[R.length-2],N[N.length-2]))?O:rb(R[R.length-1],N[N.length-1])}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hp=18;/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hf{constructor(S,T){this.overlayedDocument=S,this.mutatedFields=T}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hm{constructor(S,T,R,N){this.remoteDocumentCache=S,this.mutationQueue=T,this.documentOverlayCache=R,this.indexManager=N}getDocument(S,T){let R=null;return this.documentOverlayCache.getOverlay(S,T).next(N=>(R=N,this.remoteDocumentCache.getEntry(S,T))).next(S=>(null!==R&&o8(R.mutation,S,i1.empty(),rq.now()),S))}getDocuments(S,T){return this.remoteDocumentCache.getEntries(S,T).next(T=>this.getLocalViewOfDocuments(S,T,ox()).next(()=>T))}getLocalViewOfDocuments(S,T,R=ox()){let N=oR();return this.populateOverlays(S,N,T).next(()=>this.computeViews(S,T,N,R).next(S=>{let T=ow();return S.forEach((S,R)=>{T=T.insert(S,R.overlayedDocument)}),T}))}getOverlayedDocuments(S,T){let R=oR();return this.populateOverlays(S,R,T).next(()=>this.computeViews(S,T,R,ox()))}populateOverlays(S,T,R){let N=[];return R.forEach(S=>{T.has(S)||N.push(S)}),this.documentOverlayCache.getOverlays(S,N).next(S=>{S.forEach((S,R)=>{T.set(S,R)})})}computeViews(S,T,R,N){let O=oE(),P=oA(),M=o_();return T.forEach((S,T)=>{let M=R.get(T.key);N.has(T.key)&&(void 0===M||M.mutation instanceof ls)?O=O.insert(T.key,T):void 0!==M?(P.set(T.key,M.mutation.getFieldMask()),o8(M.mutation,T,M.mutation.getFieldMask(),rq.now())):P.set(T.key,i1.empty())}),this.recalculateAndSaveOverlays(S,O).next(S=>(S.forEach((S,T)=>P.set(S,T)),T.forEach((S,T)=>{var R;return M.set(S,new hf(T,null!==(R=P.get(S))&&void 0!==R?R:null))}),M))}recalculateAndSaveOverlays(S,T){let R=oA(),N=new iW((S,T)=>S-T),O=ox();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(S,T).next(S=>{for(let O of S)O.keys().forEach(S=>{let P=T.get(S);if(null===P)return;let M=R.get(S)||i1.empty();M=O.applyToLocalView(P,M),R.set(S,M);let L=(N.get(O.batchId)||ox()).add(S);N=N.insert(O.batchId,L)})}).next(()=>{let P=[],M=N.getReverseIterator();for(;M.hasNext();){let N=M.getNext(),L=N.key,U=N.value,V=oD();U.forEach(S=>{if(!O.has(S)){let N=o9(T.get(S),R.get(S));null!==N&&V.set(S,N),O=O.add(S)}}),P.push(this.documentOverlayCache.saveOverlays(S,L,V))}return r7.waitFor(P)}).next(()=>R)}recalculateAndSaveOverlaysForDocumentKeys(S,T){return this.remoteDocumentCache.getEntries(S,T).next(T=>this.recalculateAndSaveOverlays(S,T))}getDocumentsMatchingQuery(S,T,R,N){return a9(T)?this.getDocumentsMatchingDocumentQuery(S,T.path):a5(T)?this.getDocumentsMatchingCollectionGroupQuery(S,T,R,N):this.getDocumentsMatchingCollectionQuery(S,T,R,N)}getNextDocuments(S,T,R,N){return this.remoteDocumentCache.getAllFromCollectionGroup(S,T,R,N).next(O=>{let P=N-O.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(S,T,R.largestBatchId,N-O.size):r7.resolve(oR()),M=rG,L=O;return P.next(T=>r7.forEach(T,(T,R)=>(M<R.largestBatchId&&(M=R.largestBatchId),O.get(T))?r7.resolve():this.remoteDocumentCache.getEntry(S,T).next(S=>{L=L.insert(T,S)})).next(()=>this.populateOverlays(S,T,O)).next(()=>this.computeViews(S,L,T,ox())).next(S=>({batchId:M,changes:oI(S)})))})}getDocumentsMatchingDocumentQuery(S,T){return this.getDocument(S,new rk(T)).next(S=>{let T=ow();return S.isFoundDocument()&&(T=T.insert(S.key,S)),T})}getDocumentsMatchingCollectionGroupQuery(S,T,R,N){let O=T.collectionGroup,P=ow();return this.indexManager.getCollectionParents(S,O).next(M=>r7.forEach(M,M=>{let L=a3(T,M.child(O));return this.getDocumentsMatchingCollectionQuery(S,L,R,N).next(S=>{S.forEach((S,T)=>{P=P.insert(S,T)})})}).next(()=>P))}getDocumentsMatchingCollectionQuery(S,T,R,N){let O;return this.documentOverlayCache.getOverlaysForCollection(S,T.path,R.largestBatchId).next(P=>(O=P,this.remoteDocumentCache.getDocumentsMatchingQuery(S,T,R,O,N))).next(S=>{O.forEach((T,R)=>{let N=R.getKey();null===S.get(N)&&(S=S.insert(N,as.newInvalidDocument(N)))});let R=ow();return S.forEach((S,N)=>{let P=O.get(S);void 0!==P&&o8(P.mutation,N,i1.empty(),rq.now()),od(T,N)&&(R=R.insert(S,N))}),R})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hg{constructor(S){this.serializer=S,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(S,T){return r7.resolve(this.bundles.get(T))}saveBundleMetadata(S,T){return this.bundles.set(T.id,cd(T)),r7.resolve()}getNamedQuery(S,T){return r7.resolve(this.namedQueries.get(T))}saveNamedQuery(S,T){return this.namedQueries.set(T.name,cc(T)),r7.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hy{constructor(){this.overlays=new iW(rk.comparator),this.overlayByBatchId=new Map}getOverlay(S,T){return r7.resolve(this.overlays.get(T))}getOverlays(S,T){let R=oR();return r7.forEach(T,T=>this.getOverlay(S,T).next(S=>{null!==S&&R.set(T,S)})).next(()=>R)}saveOverlays(S,T,R){return R.forEach((R,N)=>{this.saveOverlay(S,T,N)}),r7.resolve()}removeOverlaysForBatchId(S,T,R){let N=this.overlayByBatchId.get(R);return void 0!==N&&(N.forEach(S=>this.overlays=this.overlays.remove(S)),this.overlayByBatchId.delete(R)),r7.resolve()}getOverlaysForCollection(S,T,R){let N=oR(),O=T.length+1,P=new rk(T.child("")),M=this.overlays.getIteratorFrom(P);for(;M.hasNext();){let S=M.getNext().value,P=S.getKey();if(!T.isPrefixOf(P.path))break;P.path.length===O&&S.largestBatchId>R&&N.set(S.getKey(),S)}return r7.resolve(N)}getOverlaysForCollectionGroup(S,T,R,N){let O=new iW((S,T)=>S-T),P=this.overlays.getIterator();for(;P.hasNext();){let S=P.getNext().value;if(S.getKey().getCollectionGroup()===T&&S.largestBatchId>R){let T=O.get(S.largestBatchId);null===T&&(T=oR(),O=O.insert(S.largestBatchId,T)),T.set(S.getKey(),S)}}let M=oR(),L=O.getIterator();for(;L.hasNext()&&(L.getNext().value.forEach((S,T)=>M.set(S,T)),!(M.size()>=N)););return r7.resolve(M)}saveOverlay(S,T,R){let N=this.overlays.get(R.key);if(null!==N){let S=this.overlayByBatchId.get(N.largestBatchId).delete(R.key);this.overlayByBatchId.set(N.largestBatchId,S)}this.overlays=this.overlays.insert(R.key,new lv(T,R));let O=this.overlayByBatchId.get(T);void 0===O&&(O=ox(),this.overlayByBatchId.set(T,O)),this.overlayByBatchId.set(T,O.add(R.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hv{constructor(){this.sessionToken=i4.EMPTY_BYTE_STRING}getSessionToken(S){return r7.resolve(this.sessionToken)}setSessionToken(S,T){return this.sessionToken=T,r7.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hS{constructor(){this.refsByKey=new iJ(hT.compareByKey),this.refsByTarget=new iJ(hT.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(S,T){let R=new hT(S,T);this.refsByKey=this.refsByKey.add(R),this.refsByTarget=this.refsByTarget.add(R)}addReferences(S,T){S.forEach(S=>this.addReference(S,T))}removeReference(S,T){this.removeRef(new hT(S,T))}removeReferences(S,T){S.forEach(S=>this.removeReference(S,T))}removeReferencesForId(S){let T=new rk(new rR([])),R=new hT(T,S),N=new hT(T,S+1),O=[];return this.refsByTarget.forEachInRange([R,N],S=>{this.removeRef(S),O.push(S.key)}),O}removeAllReferences(){this.refsByKey.forEach(S=>this.removeRef(S))}removeRef(S){this.refsByKey=this.refsByKey.delete(S),this.refsByTarget=this.refsByTarget.delete(S)}referencesForId(S){let T=new rk(new rR([])),R=new hT(T,S),N=new hT(T,S+1),O=ox();return this.refsByTarget.forEachInRange([R,N],S=>{O=O.add(S.key)}),O}containsKey(S){let T=new hT(S,0),R=this.refsByKey.firstAfterOrEqual(T);return null!==R&&S.isEqual(R.key)}}class hT{constructor(S,T){this.key=S,this.targetOrBatchId=T}static compareByKey(S,T){return rk.comparator(S.key,T.key)||rb(S.targetOrBatchId,T.targetOrBatchId)}static compareByTargetId(S,T){return rb(S.targetOrBatchId,T.targetOrBatchId)||rk.comparator(S.key,T.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hE{constructor(S,T){this.indexManager=S,this.referenceDelegate=T,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new iJ(hT.compareByKey)}checkEmpty(S){return r7.resolve(0===this.mutationQueue.length)}addMutationBatch(S,T,R,N){let O=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let P=new lg(O,T,R,N);for(let T of(this.mutationQueue.push(P),N))this.batchesByDocumentKey=this.batchesByDocumentKey.add(new hT(T.key,O)),this.indexManager.addToCollectionParentIndex(S,T.key.path.popLast());return r7.resolve(P)}lookupMutationBatch(S,T){return r7.resolve(this.findMutationBatch(T))}getNextMutationBatchAfterBatchId(S,T){let R=T+1,N=this.indexOfBatchId(R),O=N<0?0:N;return r7.resolve(this.mutationQueue.length>O?this.mutationQueue[O]:null)}getHighestUnacknowledgedBatchId(){return r7.resolve(0===this.mutationQueue.length?sp:this.nextBatchId-1)}getAllMutationBatches(S){return r7.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(S,T){let R=new hT(T,0),N=new hT(T,Number.POSITIVE_INFINITY),O=[];return this.batchesByDocumentKey.forEachInRange([R,N],S=>{let T=this.findMutationBatch(S.targetOrBatchId);O.push(T)}),r7.resolve(O)}getAllMutationBatchesAffectingDocumentKeys(S,T){let R=new iJ(rb);return T.forEach(S=>{let T=new hT(S,0),N=new hT(S,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([T,N],S=>{R=R.add(S.targetOrBatchId)})}),r7.resolve(this.findMutationBatches(R))}getAllMutationBatchesAffectingQuery(S,T){let R=T.path,N=R.length+1,O=R;rk.isDocumentKey(O)||(O=O.child(""));let P=new hT(new rk(O),0),M=new iJ(rb);return this.batchesByDocumentKey.forEachWhile(S=>{let T=S.key.path;return!!R.isPrefixOf(T)&&(T.length===N&&(M=M.add(S.targetOrBatchId)),!0)},P),r7.resolve(this.findMutationBatches(M))}findMutationBatches(S){let T=[];return S.forEach(S=>{let R=this.findMutationBatch(S);null!==R&&T.push(R)}),T}removeMutationBatch(S,T){rt(0===this.indexOfExistingBatchId(T.batchId,"removed"),55003),this.mutationQueue.shift();let R=this.batchesByDocumentKey;return r7.forEach(T.mutations,N=>{let O=new hT(N.key,T.batchId);return R=R.delete(O),this.referenceDelegate.markPotentiallyOrphaned(S,N.key)}).next(()=>{this.batchesByDocumentKey=R})}removeCachedMutationKeys(S){}containsKey(S,T){let R=new hT(T,0),N=this.batchesByDocumentKey.firstAfterOrEqual(R);return r7.resolve(T.isEqual(N&&N.key))}performConsistencyCheck(S){return this.mutationQueue.length,r7.resolve()}indexOfExistingBatchId(S,T){return this.indexOfBatchId(S)}indexOfBatchId(S){return 0===this.mutationQueue.length?0:S-this.mutationQueue[0].batchId}findMutationBatch(S){let T=this.indexOfBatchId(S);return T<0||T>=this.mutationQueue.length?null:this.mutationQueue[T]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hC="-9223372036854775808";function hw(){return new iW(rk.comparator)}class h_{constructor(S){this.sizer=S,this.docs=hw(),this.size=0}setIndexManager(S){this.indexManager=S}addEntry(S,T){let R=T.key,N=this.docs.get(R),O=N?N.size:0,P=this.sizer(T);return this.docs=this.docs.insert(R,{document:T.mutableCopy(),size:P}),this.size+=P-O,this.indexManager.addToCollectionParentIndex(S,R.path.popLast())}removeEntry(S){let T=this.docs.get(S);T&&(this.docs=this.docs.remove(S),this.size-=T.size)}getEntry(S,T){let R=this.docs.get(T);return r7.resolve(R?R.document.mutableCopy():as.newInvalidDocument(T))}getEntries(S,T){let R=oE();return T.forEach(S=>{let T=this.docs.get(S);R=R.insert(S,T?T.document.mutableCopy():as.newInvalidDocument(S))}),r7.resolve(R)}getDocumentsMatchingQuery(S,T,R,N){let O=oE(),P=T.path,M=new rk(P.child("__id"+hC+"__")),L=this.docs.getIteratorFrom(M);for(;L.hasNext();){let{key:S,value:{document:M}}=L.getNext();if(!P.isPrefixOf(S.path))break;!(S.path.length>P.length+1||0>=r6(r3(M),R))&&(N.has(M.key)||od(T,M))&&(O=O.insert(M.key,M.mutableCopy()))}return r7.resolve(O)}getAllFromCollectionGroup(S,T,R,N){t8(9500)}forEachDocumentKey(S,T){return r7.forEach(this.docs,S=>T(S))}newChangeBuffer(S){return new hR(this)}getSize(S){return r7.resolve(this.size)}}function hI(S){return new h_(S)}class hR extends hr{constructor(S){super(),this.documentCache=S}applyChanges(S){let T=[];return this.changes.forEach((R,N)=>{N.isValidDocument()?T.push(this.documentCache.addEntry(S,N)):this.documentCache.removeEntry(R)}),r7.waitFor(T)}getFromCache(S,T){return this.documentCache.getEntry(S,T)}getAllFromCache(S,T){return this.documentCache.getEntries(S,T)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hD{constructor(S){this.persistence=S,this.targets=new oS(S=>aV(S),aq),this.lastRemoteSnapshotVersion=r$.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new hS,this.targetCount=0,this.targetIdGenerator=dz.forTargetCache()}forEachTarget(S,T){return this.targets.forEach((S,R)=>T(R)),r7.resolve()}getLastRemoteSnapshotVersion(S){return r7.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(S){return r7.resolve(this.highestSequenceNumber)}allocateTargetId(S){return this.highestTargetId=this.targetIdGenerator.next(),r7.resolve(this.highestTargetId)}setTargetsMetadata(S,T,R){return R&&(this.lastRemoteSnapshotVersion=R),T>this.highestSequenceNumber&&(this.highestSequenceNumber=T),r7.resolve()}saveTargetData(S){this.targets.set(S.target,S);let T=S.targetId;T>this.highestTargetId&&(this.targetIdGenerator=new dz(T),this.highestTargetId=T),S.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=S.sequenceNumber)}addTargetData(S,T){return this.saveTargetData(T),this.targetCount+=1,r7.resolve()}updateTargetData(S,T){return this.saveTargetData(T),r7.resolve()}removeTargetData(S,T){return this.targets.delete(T.target),this.references.removeReferencesForId(T.targetId),this.targetCount-=1,r7.resolve()}removeTargets(S,T,R){let N=0,O=[];return this.targets.forEach((P,M)=>{M.sequenceNumber<=T&&null===R.get(M.targetId)&&(this.targets.delete(P),O.push(this.removeMatchingKeysForTargetId(S,M.targetId)),N++)}),r7.waitFor(O).next(()=>N)}getTargetCount(S){return r7.resolve(this.targetCount)}getTargetData(S,T){let R=this.targets.get(T)||null;return r7.resolve(R)}addMatchingKeys(S,T,R){return this.references.addReferences(T,R),r7.resolve()}removeMatchingKeys(S,T,R){this.references.removeReferences(T,R);let N=this.persistence.referenceDelegate,O=[];return N&&T.forEach(T=>{O.push(N.markPotentiallyOrphaned(S,T))}),r7.waitFor(O)}removeMatchingKeysForTargetId(S,T){return this.references.removeReferencesForId(T),r7.resolve()}getMatchingKeysForTargetId(S,T){let R=this.references.referencesForId(T);return r7.resolve(R)}containsKey(S,T){return r7.resolve(this.references.containsKey(T))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hA="MemoryPersistence";class hk{constructor(S,T){this.mutationQueues={},this.overlays={},this.listenSequence=new nT(0),this._started=!1,this._started=!0,this.globalsCache=new hv,this.referenceDelegate=S(this),this.targetCache=new hD(this);let R=S=>this.referenceDelegate.documentSize(S);this.indexManager=new dC,this.remoteDocumentCache=hI(R),this.serializer=new u3(T),this.bundleCache=new hg(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(S){return this.indexManager}getDocumentOverlayCache(S){let T=this.overlays[S.toKey()];return T||(T=new hy,this.overlays[S.toKey()]=T),T}getMutationQueue(S,T){let R=this.mutationQueues[S.toKey()];return R||(R=new hE(T,this.referenceDelegate),this.mutationQueues[S.toKey()]=R),R}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(S,T,R){t4(hA,"Starting transaction:",S);let N=new hN(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),R(N).next(S=>this.referenceDelegate.onTransactionCommitted(N).next(()=>S)).toPromise().then(S=>(N.raiseOnCommittedEvent(),S))}mutationQueuesContainKey(S,T){return r7.or(Object.values(this.mutationQueues).map(R=>()=>R.containsKey(S,T)))}}class hN extends r5{constructor(S){super(),this.currentSequenceNumber=S}}class hO{constructor(S){this.persistence=S,this.localViewReferences=new hS,this._orphanedDocuments=null}static factory(S){return new hO(S)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw t8(60996)}addReference(S,T,R){return this.localViewReferences.addReference(R,T),this.orphanedDocuments.delete(R.toString()),r7.resolve()}removeReference(S,T,R){return this.localViewReferences.removeReference(R,T),this.orphanedDocuments.add(R.toString()),r7.resolve()}markPotentiallyOrphaned(S,T){return this.orphanedDocuments.add(T.toString()),r7.resolve()}removeTarget(S,T){this.localViewReferences.removeReferencesForId(T.targetId).forEach(S=>this.orphanedDocuments.add(S.toString()));let R=this.persistence.getTargetCache();return R.getMatchingKeysForTargetId(S,T.targetId).next(S=>{S.forEach(S=>this.orphanedDocuments.add(S.toString()))}).next(()=>R.removeTargetData(S,T))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(S){let T=this.persistence.getRemoteDocumentCache().newChangeBuffer();return r7.forEach(this.orphanedDocuments,R=>{let N=rk.fromPath(R);return this.isReferenced(S,N).next(S=>{S||T.removeEntry(N,r$.min())})}).next(()=>(this._orphanedDocuments=null,T.apply(S)))}updateLimboDocument(S,T){return this.isReferenced(S,T).next(S=>{S?this.orphanedDocuments.delete(T.toString()):this.orphanedDocuments.add(T.toString())})}documentSize(S){return 0}isReferenced(S,T){return r7.or([()=>r7.resolve(this.localViewReferences.containsKey(T)),()=>this.persistence.getTargetCache().containsKey(S,T),()=>this.persistence.mutationQueuesContainKey(S,T)])}}class hx{constructor(S,T){this.persistence=S,this.orphanedSequenceNumbers=new oS(S=>nI(S.path),(S,T)=>S.isEqual(T)),this.garbageCollector=d5(this,T)}static factory(S,T){return new hx(S,T)}onTransactionStarted(){}onTransactionCommitted(S){return r7.resolve()}forEachTarget(S,T){return this.persistence.getTargetCache().forEachTarget(S,T)}getSequenceNumberCount(S){let T=this.orphanedDocumentCount(S);return this.persistence.getTargetCache().getTargetCount(S).next(S=>T.next(T=>S+T))}orphanedDocumentCount(S){let T=0;return this.forEachOrphanedDocumentSequenceNumber(S,S=>{T++}).next(()=>T)}forEachOrphanedDocumentSequenceNumber(S,T){return r7.forEach(this.orphanedSequenceNumbers,(R,N)=>this.isPinned(S,R,N).next(S=>S?r7.resolve():T(N)))}removeTargets(S,T,R){return this.persistence.getTargetCache().removeTargets(S,T,R)}removeOrphanedDocuments(S,T){let R=0,N=this.persistence.getRemoteDocumentCache(),O=N.newChangeBuffer();return N.forEachDocumentKey(S,N=>this.isPinned(S,N,T).next(S=>{S||(R++,O.removeEntry(N,r$.min()))})).next(()=>O.apply(S)).next(()=>R)}markPotentiallyOrphaned(S,T){return this.orphanedSequenceNumbers.set(T,S.currentSequenceNumber),r7.resolve()}removeTarget(S,T){let R=T.withSequenceNumber(S.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(S,R)}addReference(S,T,R){return this.orphanedSequenceNumbers.set(R,S.currentSequenceNumber),r7.resolve()}removeReference(S,T,R){return this.orphanedSequenceNumbers.set(R,S.currentSequenceNumber),r7.resolve()}updateLimboDocument(S,T){return this.orphanedSequenceNumbers.set(T,S.currentSequenceNumber),r7.resolve()}documentSize(S){let T=S.key.toString().length;return S.isFoundDocument()&&(T+=sH(S.data.value)),T}isPinned(S,T,R){return r7.or([()=>this.persistence.mutationQueuesContainKey(S,T),()=>this.persistence.getTargetCache().containsKey(S,T),()=>{let S=this.orphanedSequenceNumbers.get(T);return r7.resolve(void 0!==S&&S>R)}])}getCacheSize(S){return this.persistence.getRemoteDocumentCache().getSize(S)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hP{constructor(S){this.serializer=S}createOrUpgrade(S,T,R,N){let O=new nn("createOrUpgrade",T);R<1&&N>=1&&(hL(S),hF(S),hz(S),hj(S));let P=r7.resolve();return R<3&&N>=3&&(0!==R&&(hq(S),hz(S)),P=P.next(()=>hG(O))),R<4&&N>=4&&(0!==R&&(P=P.next(()=>hB(S,O))),P=P.next(()=>{hK(S)})),R<5&&N>=5&&(P=P.next(()=>this.removeAcknowledgedMutations(O))),R<6&&N>=6&&(P=P.next(()=>(hV(S),this.addDocumentGlobal(O)))),R<7&&N>=7&&(P=P.next(()=>this.ensureSequenceNumbers(O))),R<8&&N>=8&&(P=P.next(()=>this.createCollectionParentIndex(S,O))),R<9&&N>=9&&(P=P.next(()=>{h$(S)})),R<10&&N>=10&&(P=P.next(()=>this.rewriteCanonicalIds(O))),R<11&&N>=11&&(P=P.next(()=>{hW(S),hH(S)})),R<12&&N>=12&&(P=P.next(()=>{hY(S)})),R<13&&N>=13&&(P=P.next(()=>hU(S)).next(()=>this.rewriteRemoteDocumentCache(S,O)).next(()=>S.deleteObjectStore(nk))),R<14&&N>=14&&(P=P.next(()=>this.runOverlayMigration(S,O))),R<15&&N>=15&&(P=P.next(()=>hQ(S))),R<16&&N>=16&&(P=P.next(()=>{T.objectStore(iy).clear()}).next(()=>{T.objectStore(iT).clear()})),R<17&&N>=17&&(P=P.next(()=>{hJ(S)})),R<18&&N>=18&&isSafariOrWebkit()&&(P=P.next(()=>{T.objectStore(iy).clear()}).next(()=>{T.objectStore(iT).clear()})),P}addDocumentGlobal(S){let T=0;return S.store(nk).iterate((S,R)=>{T+=dP(R)}).next(()=>{let R={byteSize:T};return S.store(nY).put(nJ,R)})}removeAcknowledgedMutations(S){let T=S.store(nx),R=S.store(nM);return T.loadAll().next(T=>r7.forEach(T,T=>{let N=IDBKeyRange.bound([T.userId,sp],[T.userId,T.lastAcknowledgedBatchId]);return R.loadAll(nF,N).next(R=>r7.forEach(R,R=>{rt(R.userId===T.userId,18650,"Cannot process batch from unexpected user",{batchId:R.batchId});let N=ct(this.serializer,R);return dx(S,T.userId,N).next(()=>{})}))}))}ensureSequenceNumbers(S){let T=S.store(n4),R=S.store(nk);return S.store(n7).get(n8).next(S=>{let N=R=>T.put({targetId:0,path:nI(R),sequenceNumber:S.highestListenSequenceNumber}),O=[];return R.iterate((S,R)=>{let P=new rR(S),M=hM(P);O.push(T.get(M).next(S=>S?r7.resolve():N(P)))}).next(()=>r7.waitFor(O))})}createCollectionParentIndex(S,T){S.createObjectStore(ie,{keyPath:ir});let R=T.store(ie),N=new dw,O=S=>{if(N.add(S)){let T=S.lastSegment(),N=S.popLast();return R.put({collectionId:T,parent:nI(N)})}};return T.store(nk).iterate({keysOnly:!0},(S,T)=>O(new rR(S).popLast())).next(()=>T.store(nq).iterate({keysOnly:!0},([S,T,R],N)=>O(nA(T).popLast())))}rewriteCanonicalIds(S){let T=S.store(nX);return T.iterate((S,R)=>{let N=cr(R),O=cn(this.serializer,N);return T.put(O)})}rewriteRemoteDocumentCache(S,T){let R=T.store(nk),N=[];return R.iterate((S,R)=>{let O=T.store(n$),P=hX(R).path.toArray(),M={prefixPath:P.slice(0,P.length-2),collectionGroup:P[P.length-2],documentId:P[P.length-1],readTime:R.readTime||[0,0],unknownDocument:R.unknownDocument,noDocument:R.noDocument,document:R.document,hasCommittedMutations:!!R.hasCommittedMutations};N.push(O.put(M))}).next(()=>r7.waitFor(N))}runOverlayMigration(S,T){let R=T.store(nM),N=hs(this.serializer),O=new hk(hO.factory,this.serializer.remoteSerializer);return R.loadAll().next(S=>{let R=new Map;return S.forEach(S=>{var T;let N=null!==(T=R.get(S.userId))&&void 0!==T?T:ox();ct(this.serializer,S).keys().forEach(S=>N=N.add(S)),R.set(S.userId,N)}),r7.forEach(R,(S,R)=>{let P=new tX(R),M=cw.forUser(this.serializer,P),L=O.getIndexManager(P);return new hm(N,dM.forUser(P,this.serializer,L,O.referenceDelegate),M,L).recalculateAndSaveOverlaysForDocumentKeys(new iz(T,nT.INVALID),S).next()})})}}function hM(S){return[0,nI(S)]}function hL(S){S.createObjectStore(nN)}function hF(S){S.createObjectStore(nx,{keyPath:nP}),S.createObjectStore(nM,{keyPath:nL,autoIncrement:!0}).createIndex(nF,nB,{unique:!0}),S.createObjectStore(nq)}function hB(S,T){return T.store(nM).loadAll().next(R=>{S.deleteObjectStore(nM),S.createObjectStore(nM,{keyPath:nL,autoIncrement:!0}).createIndex(nF,nB,{unique:!0});let N=T.store(nM),O=R.map(S=>N.put(S));return r7.waitFor(O)})}function hj(S){S.createObjectStore(nk)}function hU(S){let T=S.createObjectStore(n$,{keyPath:nG});T.createIndex(nK,nW),T.createIndex(nH,nQ)}function hV(S){S.createObjectStore(nY)}function hz(S){S.createObjectStore(n4,{keyPath:n6}).createIndex(n9,n5,{unique:!0}),S.createObjectStore(nX,{keyPath:nZ}).createIndex(n0,n3,{unique:!0}),S.createObjectStore(n7)}function hq(S){S.deleteObjectStore(n4),S.deleteObjectStore(nX),S.deleteObjectStore(n7)}function h$(S){S.objectStoreNames.contains("remoteDocumentChanges")&&S.deleteObjectStore("remoteDocumentChanges")}function hG(S){let T=S.store(n7),R={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:r$.min().toTimestamp(),targetCount:0};return T.put(n8,R)}function hK(S){S.createObjectStore(ii,{keyPath:is})}function hW(S){S.createObjectStore(ia,{keyPath:io})}function hH(S){S.createObjectStore(il,{keyPath:iu})}function hQ(S){S.createObjectStore(ic,{keyPath:ih,autoIncrement:!0}).createIndex(im,ig,{unique:!1}),S.createObjectStore(iy,{keyPath:iv}).createIndex(ib,iS,{unique:!1}),S.createObjectStore(iT,{keyPath:iE}).createIndex(iC,iw,{unique:!1})}function hY(S){let T=S.createObjectStore(i_,{keyPath:iI});T.createIndex(iR,iD,{unique:!1}),T.createIndex(iA,ik,{unique:!1})}function hJ(S){S.createObjectStore(iN,{keyPath:iO})}function hX(S){return S.document?new rk(rR.fromString(S.document.name).popFirst(5)):S.noDocument?rk.fromSegments(S.noDocument.path):S.unknownDocument?rk.fromSegments(S.unknownDocument.path):t8(36783)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hZ="IndexedDbPersistence",h0=null,h1=5e3,h2=4e3,h3=null,h4=null,h6="firestore_zombie",h9="main";class h5{constructor(S,T,R,N,O,P,M,L,U,V,$=hp){if(this.allowTabSynchronization=S,this.persistenceKey=T,this.clientId=R,this.queue=O,this.window=P,this.document=M,this.sequenceNumberSyncer=U,this.forceOwningTab=V,this.schemaVersion=$,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=S=>Promise.resolve(),!h5.isAvailable())throw new ri(rn.UNIMPLEMENTED,h4);this.referenceDelegate=new d8(this,N),this.dbName=T+h9,this.serializer=new u3(L),this.simpleDb=new ni(this.dbName,this.schemaVersion,new hP(this.serializer)),this.globalsCache=new cI,this.targetCache=new dq(this.referenceDelegate,this.serializer),this.remoteDocumentCache=hs(this.serializer),this.bundleCache=new cT,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,!1===V&&t6(hZ,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new ri(rn.FAILED_PRECONDITION,h3);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",S=>this.targetCache.getHighestSequenceNumber(S))}).then(S=>{this.listenSequence=new nT(S,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(S=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(S)))}setPrimaryStateListener(S){return this.primaryStateListener=async T=>{if(this.started)return S(T)},S(this.isPrimary)}setDatabaseDeletedListener(S){this.simpleDb.setDatabaseDeletedListener(S)}setNetworkEnabled(S){this.networkEnabled!==S&&(this.networkEnabled=S,this.queue.enqueueAndForget(async()=>{this.started&&await this.updateClientMetadataAndTryBecomePrimary()}))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",S=>h7(S).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(S).next(S=>{S||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(S)).next(T=>this.isPrimary&&!T?this.releasePrimaryLeaseIfHeld(S).next(()=>!1):!!T&&this.acquireOrExtendPrimaryLease(S).next(()=>!0))).catch(S=>{if(nc(S))return t4(hZ,"Failed to extend owner lease: ",S),this.isPrimary;if(!this.allowTabSynchronization)throw S;return t4(hZ,"Releasing owner lease after error during lease refresh",S),!1}).then(S=>{this.isPrimary!==S&&this.queue.enqueueRetryable(()=>this.primaryStateListener(S)),this.isPrimary=S})}verifyPrimaryLease(S){return h8(S).get(nO).next(S=>r7.resolve(this.isLocalClient(S)))}removeClientMetadata(S){return h7(S).delete(this.clientId)}async maybeGarbageCollectMultiClientState(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,h0)){this.lastGarbageCollectionTime=Date.now();let S=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",S=>{let T=iq(S,ii);return T.loadAll().next(S=>{let R=this.filterActiveClients(S,h0),N=S.filter(S=>-1===R.indexOf(S));return r7.forEach(N,S=>T.delete(S.clientId)).next(()=>N)})}).catch(()=>[]);if(this.webStorage)for(let T of S)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(T.clientId))}}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",h2,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(S){return!!S&&S.ownerId===this.clientId}canActAsPrimary(S){return this.forceOwningTab?r7.resolve(!0):h8(S).get(nO).next(T=>{if(null!==T&&this.isWithinAge(T.leaseTimestampMs,h1)&&!this.isClientZombied(T.ownerId)){if(this.isLocalClient(T)&&this.networkEnabled)return!0;if(!this.isLocalClient(T)){if(!T.allowTabSynchronization)throw new ri(rn.FAILED_PRECONDITION,h3);return!1}}return!!this.networkEnabled&&!!this.inForeground||h7(S).loadAll().next(S=>void 0===this.filterActiveClients(S,h1).find(S=>{if(this.clientId!==S.clientId){let T=!this.networkEnabled&&S.networkEnabled,R=!this.inForeground&&S.inForeground,N=this.networkEnabled===S.networkEnabled;if(T||R&&N)return!0}return!1}))}).next(S=>(this.isPrimary!==S&&t4(hZ,`Client ${S?"is":"is not"} eligible for a primary lease.`),S))}async shutdown(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),await this.simpleDb.runTransaction("shutdown","readwrite",[nN,ii],S=>{let T=new iz(S,nT.INVALID);return this.releasePrimaryLeaseIfHeld(T).next(()=>this.removeClientMetadata(T))}),this.simpleDb.close(),this.removeClientZombiedEntry()}filterActiveClients(S,T){return S.filter(S=>this.isWithinAge(S.updateTimeMs,T)&&!this.isClientZombied(S.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",S=>h7(S).loadAll().next(S=>this.filterActiveClients(S,h0).map(S=>S.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(S,T){return dM.forUser(S,this.serializer,T,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(S){return new dR(S,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(S){return cw.forUser(this.serializer,S)}getBundleCache(){return this.bundleCache}runTransaction(S,T,R){let N;t4(hZ,"Starting transaction:",S);let O="readonly"===T?"readonly":"readwrite",P=iV(this.schemaVersion);return this.simpleDb.runTransaction(S,O,P,O=>(N=new iz(O,this.listenSequence?this.listenSequence.next():nT.INVALID),"readwrite-primary"===T)?this.verifyPrimaryLease(N).next(S=>!!S||this.canActAsPrimary(N)).next(T=>{if(!T)throw t6(`Failed to obtain primary lease for action '${S}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new ri(rn.FAILED_PRECONDITION,r9);return R(N)}).next(S=>this.acquireOrExtendPrimaryLease(N).next(()=>S)):this.verifyAllowTabSynchronization(N).next(()=>R(N))).then(S=>(N.raiseOnCommittedEvent(),S))}verifyAllowTabSynchronization(S){return h8(S).get(nO).next(S=>{if(null!==S&&this.isWithinAge(S.leaseTimestampMs,h1)&&!this.isClientZombied(S.ownerId)&&!this.isLocalClient(S)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!S.allowTabSynchronization))throw new ri(rn.FAILED_PRECONDITION,h3)})}acquireOrExtendPrimaryLease(S){let T={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return h8(S).put(nO,T)}static isAvailable(){return ni.isAvailable()}releasePrimaryLeaseIfHeld(S){let T=h8(S);return T.get(nO).next(S=>this.isLocalClient(S)?(t4(hZ,"Releasing primary lease."),T.delete(nO)):r7.resolve())}isWithinAge(S,T){let R=Date.now(),N=R-T,O=R;return!(S<N)&&(!(S>O)||(t6(`Detected an update time that is in the future: ${S} > ${O}`),!1))}attachVisibilityHandler(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var S;"function"==typeof(null===(S=this.window)||void 0===S?void 0:S.addEventListener)&&(this.windowUnloadHandler=()=>{this.markClientZombied();let S=/(?:Version|Mobile)\/1[456]/;isSafari()&&(navigator.appVersion.match(S)||navigator.userAgent.match(S))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(S){var T;try{let R=(null===(T=this.webStorage)||void 0===T?void 0:T.getItem(this.zombiedClientLocalStorageKey(S)))!==null;return t4(hZ,`Client '${S}' ${R?"is":"is not"} zombied in LocalStorage`),R}catch(S){return t6(hZ,"Failed to get zombied client id.",S),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(S){t6("Failed to set zombie client id.",S)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(S){}}zombiedClientLocalStorageKey(S){return`${h6}_${this.persistenceKey}_${S}`}}function h8(S){return iq(S,nN)}function h7(S){return iq(S,ii)}function pe(S,T){let R=S.projectId;return S.isDefaultDatabase||(R+="."+S.database),"firestore/"+T+"/"+R+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pt(S,T,R,N,O){T=[...T],(S=[...S]).sort(R),T.sort(R);let P=S.length,M=T.length,L=0,U=0;for(;L<M&&U<P;){let P=R(S[U],T[L]);P<0?O(S[U++]):P>0?N(T[L++]):(L++,U++)}for(;L<M;)N(T[L++]);for(;U<P;)O(S[U++])}function pr(S,T){if(S.length!==T.length)return!1;for(let R=0;R<S.length;++R)if(S[R]!==T[R])return!1;return!0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pn="LocalStore",pi=3e8;class ps{constructor(S,T,R,N){this.persistence=S,this.queryEngine=T,this.serializer=N,this.targetDataByTarget=new iW(rb),this.targetIdByTarget=new oS(S=>aV(S),aq),this.collectionGroupReadTime=new Map,this.remoteDocuments=S.getRemoteDocumentCache(),this.targetCache=S.getTargetCache(),this.bundleCache=S.getBundleCache(),this.initializeUserComponents(R)}initializeUserComponents(S){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(S),this.indexManager=this.persistence.getIndexManager(S),this.mutationQueue=this.persistence.getMutationQueue(S,this.indexManager),this.localDocuments=new hm(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(S){return this.persistence.runTransaction("Collect garbage","readwrite-primary",T=>S.collect(T,this.targetDataByTarget))}}function pa(S,T,R,N){return new ps(S,T,R,N)}async function po(S,T){let R=rr(S);return await R.persistence.runTransaction("Handle user change","readonly",S=>{let N;return R.mutationQueue.getAllMutationBatches(S).next(O=>(N=O,R.initializeUserComponents(T),R.mutationQueue.getAllMutationBatches(S))).next(T=>{let O=[],P=[],M=ox();for(let S of N)for(let T of(O.push(S.batchId),S.mutations))M=M.add(T.key);for(let S of T)for(let T of(P.push(S.batchId),S.mutations))M=M.add(T.key);return R.localDocuments.getDocuments(S,M).next(S=>({affectedDocuments:S,removedBatchIds:O,addedBatchIds:P}))})})}function pl(S,T){let R,N;let O=rr(S),P=rq.now(),M=T.reduce((S,T)=>S.add(T.key),ox());return O.persistence.runTransaction("Locally write mutations","readwrite",S=>{let L=oE(),U=ox();return O.remoteDocuments.getEntries(S,M).next(S=>{(L=S).forEach((S,T)=>{T.isValidDocument()||(U=U.add(S))})}).next(()=>O.localDocuments.getOverlayedDocuments(S,L)).next(N=>{R=N;let M=[];for(let S of T){let T=o7(S,R.get(S.key).overlayedDocument);null!=T&&M.push(new ls(S.key,T,ai(T.value.mapValue),o3.exists(!0)))}return O.mutationQueue.addMutationBatch(S,P,M,T)}).next(T=>{N=T;let P=T.applyToLocalDocumentSet(R,U);return O.documentOverlayCache.saveOverlays(S,T.batchId,P)})}).then(()=>({batchId:N.batchId,changes:oI(R)}))}function pu(S,T){let R=rr(S);return R.persistence.runTransaction("Acknowledge batch","readwrite-primary",S=>{let N=T.batch.keys(),O=R.remoteDocuments.newChangeBuffer({trackRemovals:!0});return pw(R,S,T,O).next(()=>O.apply(S)).next(()=>R.mutationQueue.performConsistencyCheck(S)).next(()=>R.documentOverlayCache.removeOverlaysForBatchId(S,N,T.batch.batchId)).next(()=>R.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(S,pc(T))).next(()=>R.localDocuments.getDocuments(S,N))})}function pc(S){let T=ox();for(let R=0;R<S.mutationResults.length;++R)S.mutationResults[R].transformResults.length>0&&(T=T.add(S.batch.mutations[R].key));return T}function pd(S,T){let R=rr(S);return R.persistence.runTransaction("Reject batch","readwrite-primary",S=>{let N;return R.mutationQueue.lookupMutationBatch(S,T).next(T=>(rt(null!==T,37113),N=T.keys(),R.mutationQueue.removeMutationBatch(S,T))).next(()=>R.mutationQueue.performConsistencyCheck(S)).next(()=>R.documentOverlayCache.removeOverlaysForBatchId(S,N,T)).next(()=>R.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(S,N)).next(()=>R.localDocuments.getDocuments(S,N))})}function ph(S){let T=rr(S);return T.persistence.runTransaction("Get highest unacknowledged batch id","readonly",S=>T.mutationQueue.getHighestUnacknowledgedBatchId(S))}function pp(S){let T=rr(S);return T.persistence.runTransaction("Get last remote snapshot version","readonly",S=>T.targetCache.getLastRemoteSnapshotVersion(S))}function pf(S,T){let R=rr(S),N=T.snapshotVersion,O=R.targetDataByTarget;return R.persistence.runTransaction("Apply remote event","readwrite-primary",S=>{let P=R.remoteDocuments.newChangeBuffer({trackRemovals:!0});O=R.targetDataByTarget;let M=[];T.targetChanges.forEach((P,L)=>{let U=O.get(L);if(!U)return;M.push(R.targetCache.removeMatchingKeys(S,P.removedDocuments,L).next(()=>R.targetCache.addMatchingKeys(S,P.addedDocuments,L)));let V=U.withSequenceNumber(S.currentSequenceNumber);null!==T.targetMismatches.get(L)?V=V.withResumeToken(i4.EMPTY_BYTE_STRING,r$.min()).withLastLimboFreeSnapshotVersion(r$.min()):P.resumeToken.approximateByteSize()>0&&(V=V.withResumeToken(P.resumeToken,N)),O=O.insert(L,V),pg(U,V,P)&&M.push(R.targetCache.updateTargetData(S,V))});let L=oE(),U=ox();if(T.documentUpdates.forEach(N=>{T.resolvedLimboDocuments.has(N)&&M.push(R.persistence.referenceDelegate.updateLimboDocument(S,N))}),M.push(pm(S,P,T.documentUpdates).next(S=>{L=S.changedDocuments,U=S.existenceChangedKeys})),!N.isEqual(r$.min())){let T=R.targetCache.getLastRemoteSnapshotVersion(S).next(T=>R.targetCache.setTargetsMetadata(S,S.currentSequenceNumber,N));M.push(T)}return r7.waitFor(M).next(()=>P.apply(S)).next(()=>R.localDocuments.getLocalViewOfDocuments(S,L,U)).next(()=>L)}).then(S=>(R.targetDataByTarget=O,S))}function pm(S,T,R){let N=ox(),O=ox();return R.forEach(S=>N=N.add(S)),T.getEntries(S,N).next(S=>{let N=oE();return R.forEach((R,P)=>{let M=S.get(R);P.isFoundDocument()!==M.isFoundDocument()&&(O=O.add(R)),P.isNoDocument()&&P.version.isEqual(r$.min())?(T.removeEntry(R,P.readTime),N=N.insert(R,P)):!M.isValidDocument()||P.version.compareTo(M.version)>0||0===P.version.compareTo(M.version)&&M.hasPendingWrites?(T.addEntry(P),N=N.insert(R,P)):t4(pn,"Ignoring outdated watch update for ",R,". Current version:",M.version," Watch version:",P.version)}),{changedDocuments:N,existenceChangedKeys:O}})}function pg(S,T,R){return!!(0===S.resumeToken.approximateByteSize()||T.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=pi)||R.addedDocuments.size+R.modifiedDocuments.size+R.removedDocuments.size>0}async function py(S,T){let R=rr(S);try{await R.persistence.runTransaction("notifyLocalViewChanges","readwrite",S=>r7.forEach(T,T=>r7.forEach(T.addedKeys,N=>R.persistence.referenceDelegate.addReference(S,T.targetId,N)).next(()=>r7.forEach(T.removedKeys,N=>R.persistence.referenceDelegate.removeReference(S,T.targetId,N)))))}catch(S){if(nc(S))t4(pn,"Failed to update sequence numbers: "+S);else throw S}for(let S of T){let T=S.targetId;if(!S.fromCache){let S=R.targetDataByTarget.get(T),N=S.snapshotVersion,O=S.withLastLimboFreeSnapshotVersion(N);R.targetDataByTarget=R.targetDataByTarget.insert(T,O)}}}function pv(S,T){let R=rr(S);return R.persistence.runTransaction("Get next mutation batch","readonly",S=>(void 0===T&&(T=sp),R.mutationQueue.getNextMutationBatchAfterBatchId(S,T)))}function pb(S,T){let R=rr(S);return R.persistence.runTransaction("read document","readonly",S=>R.localDocuments.getDocument(S,T))}function pS(S,T){let R=rr(S);return R.persistence.runTransaction("Allocate target","readwrite",S=>{let N;return R.targetCache.getTargetData(S,T).next(O=>O?(N=O,r7.resolve(N)):R.targetCache.allocateTargetId(S).next(O=>(N=new u2(T,O,"TargetPurposeListen",S.currentSequenceNumber),R.targetCache.addTargetData(S,N).next(()=>N))))}).then(S=>{let N=R.targetDataByTarget.get(S.targetId);return(null===N||S.snapshotVersion.compareTo(N.snapshotVersion)>0)&&(R.targetDataByTarget=R.targetDataByTarget.insert(S.targetId,S),R.targetIdByTarget.set(T,S.targetId)),S})}function pT(S,T,R){let N=rr(S),O=N.targetIdByTarget.get(R);return void 0!==O?r7.resolve(N.targetDataByTarget.get(O)):N.targetCache.getTargetData(T,R)}async function pE(S,T,R){let N=rr(S),O=N.targetDataByTarget.get(T),P=R?"readwrite":"readwrite-primary";try{R||await N.persistence.runTransaction("Release target",P,S=>N.persistence.referenceDelegate.removeTarget(S,O))}catch(S){if(nc(S))t4(pn,`Failed to update sequence numbers for target ${T}: ${S}`);else throw S}N.targetDataByTarget=N.targetDataByTarget.remove(T),N.targetIdByTarget.delete(O.target)}function pC(S,T,R){let N=rr(S),O=r$.min(),P=ox();return N.persistence.runTransaction("Execute query","readwrite",S=>pT(N,S,a7(T)).next(T=>{if(T)return O=T.lastLimboFreeSnapshotVersion,N.targetCache.getMatchingKeysForTargetId(S,T.targetId).next(S=>{P=S})}).next(()=>N.queryEngine.getDocumentsMatchingQuery(S,T,R?O:r$.min(),R?P:ox())).next(S=>(pk(N,oy(T),S),{documents:S,remoteKeys:P})))}function pw(S,T,R,N){let O=R.batch,P=O.keys(),M=r7.resolve();return P.forEach(S=>{M=M.next(()=>N.getEntry(T,S)).next(T=>{let P=R.docVersions.get(S);rt(null!==P,48541),0>T.version.compareTo(P)&&(O.applyToRemoteDocument(T,R),T.isValidDocument()&&(T.setReadTime(R.commitVersion),N.addEntry(T)))})}),M.next(()=>S.mutationQueue.removeMutationBatch(T,O))}function p_(S,T){let R=rr(S),N=rr(R.mutationQueue);return R.persistence.runTransaction("Lookup mutation documents","readonly",S=>N.lookupMutationKeys(S,T).next(T=>T?R.localDocuments.getDocuments(S,T):r7.resolve(null)))}function pI(S,T){rr(rr(S,ps).mutationQueue).removeCachedMutationKeys(T)}function pR(S){return rr(rr(S,ps).persistence).getActiveClients()}function pD(S,T){let R=rr(S),N=rr(R.targetCache),O=R.targetDataByTarget.get(T);return O?Promise.resolve(O.target):R.persistence.runTransaction("Get target data","readonly",S=>N.getTargetDataForTarget(S,T).next(S=>S?S.target:null))}function pA(S,T){let R=rr(S),N=R.collectionGroupReadTime.get(T)||r$.min();return R.persistence.runTransaction("Get new document changes","readonly",S=>R.remoteDocuments.getAllFromCollectionGroup(S,T,r2(N,rG),Number.MAX_SAFE_INTEGER)).then(S=>(pk(R,T,S),S))}function pk(S,T,R){let N=S.collectionGroupReadTime.get(T)||r$.min();R.forEach((S,T)=>{T.readTime.compareTo(N)>0&&(N=T.readTime)}),S.collectionGroupReadTime.set(T,N)}function pN(S){return a7(a2(rR.fromString(`__bundle__/docs/${S}`)))}async function pO(S,T,R,N){let O=rr(S),P=ox(),M=oE();for(let S of R){let R=T.toDocumentKey(S.metadata.name);S.document&&(P=P.add(R));let N=T.toMutableDocument(S);N.setReadTime(T.toSnapshotVersion(S.metadata.readTime)),M=M.insert(R,N)}let L=O.remoteDocuments.newChangeBuffer({trackRemovals:!0}),U=await pS(O,pN(N));return O.persistence.runTransaction("Apply bundle documents","readwrite",S=>pm(S,L,M).next(T=>(L.apply(S),T)).next(T=>O.targetCache.removeMatchingKeysForTargetId(S,U.targetId).next(()=>O.targetCache.addMatchingKeys(S,P,U.targetId)).next(()=>O.localDocuments.getLocalViewOfDocuments(S,T.changedDocuments,T.existenceChangedKeys)).next(()=>T.changedDocuments)))}function px(S,T){let R=rr(S),N=l0(T.createTime);return R.persistence.runTransaction("hasNewerBundle","readonly",S=>R.bundleCache.getBundleMetadata(S,T.id)).then(S=>!!S&&S.createTime.compareTo(N)>=0)}function pP(S,T){let R=rr(S);return R.persistence.runTransaction("Save bundle","readwrite",S=>R.bundleCache.saveBundleMetadata(S,T))}function pM(S,T){let R=rr(S);return R.persistence.runTransaction("Get named query","readonly",S=>R.bundleCache.getNamedQuery(S,T))}async function pL(S,T,R=ox()){let N=await pS(S,a7(cu(T.bundledQuery))),O=rr(S);return O.persistence.runTransaction("Save named query","readwrite",S=>{let P=l0(T.readTime);if(N.snapshotVersion.compareTo(P)>=0)return O.bundleCache.saveNamedQuery(S,T);let M=N.withResumeToken(i4.EMPTY_BYTE_STRING,P);return O.targetDataByTarget=O.targetDataByTarget.insert(M.targetId,M),O.targetCache.updateTargetData(S,M).next(()=>O.targetCache.removeMatchingKeysForTargetId(S,N.targetId)).next(()=>O.targetCache.addMatchingKeys(S,R,N.targetId)).next(()=>O.bundleCache.saveNamedQuery(S,T))})}function pF(S,T){rr(S).queryEngine.indexAutoCreationEnabled=T}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pB{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(S){this._documentReadCount+=S}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pj=100;function pU(){return eC()?8:na(eT())>0?6:4}class pV{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=pj,this.relativeIndexReadCostPerDocument=pU()}initialize(S,T){this.localDocumentsView=S,this.indexManager=T,this.initialized=!0}getDocumentsMatchingQuery(S,T,R,N){let O={result:null};return this.performQueryUsingIndex(S,T).next(S=>{O.result=S}).next(()=>{if(!O.result)return this.performQueryUsingRemoteKeys(S,T,N,R).next(S=>{O.result=S})}).next(()=>{if(O.result)return;let R=new pB;return this.executeFullCollectionScan(S,T,R).next(N=>{if(O.result=N,this.indexAutoCreationEnabled)return this.createCacheIndexes(S,T,R,N.size)})}).next(()=>O.result)}createCacheIndexes(S,T,R,N){return R.documentReadCount<this.indexAutoCreationMinCollectionSize?(t3()<=P.DEBUG&&t4("QueryEngine","SDK will not create cache indexes for query:",oc(T),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),r7.resolve()):(t3()<=P.DEBUG&&t4("QueryEngine","Query:",oc(T),"scans",R.documentReadCount,"local documents and returns",N,"documents as results."),R.documentReadCount>this.relativeIndexReadCostPerDocument*N)?(t3()<=P.DEBUG&&t4("QueryEngine","The SDK decides to create cache indexes for query:",oc(T),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(S,a7(T))):r7.resolve()}performQueryUsingIndex(S,T){if(a4(T))return r7.resolve(null);let R=a7(T);return this.indexManager.getIndexType(S,R).next(N=>0===N?null:(null!==T.limit&&1===N&&(R=a7(T=oi(T,null,"F"))),this.indexManager.getDocumentsMatchingTarget(S,R).next(N=>{let O=ox(...N);return this.localDocumentsView.getDocuments(S,O).next(N=>this.indexManager.getMinOffset(S,R).next(R=>{let P=this.applyQuery(T,N);return this.needsRefill(T,P,O,R.readTime)?this.performQueryUsingIndex(S,oi(T,null,"F")):this.appendRemainingResults(S,P,T,R)}))})))}performQueryUsingRemoteKeys(S,T,R,N){return a4(T)||N.isEqual(r$.min())?r7.resolve(null):this.localDocumentsView.getDocuments(S,R).next(O=>{let M=this.applyQuery(T,O);return this.needsRefill(T,M,R,N)?r7.resolve(null):(t3()<=P.DEBUG&&t4("QueryEngine","Re-using previous result from %s to execute query: %s",N.toString(),oc(T)),this.appendRemainingResults(S,M,T,r2(N,rG)).next(S=>S))})}applyQuery(S,T){let R=new iJ(ov(S));return T.forEach((T,N)=>{od(S,N)&&(R=R.add(N))}),R}needsRefill(S,T,R,N){if(null===S.limit)return!1;if(R.size!==T.size)return!0;let O="F"===S.limitType?T.last():T.first();return!!O&&(O.hasPendingWrites||O.version.compareTo(N)>0)}executeFullCollectionScan(S,T,R){return t3()<=P.DEBUG&&t4("QueryEngine","Using full collection scan to execute query:",oc(T)),this.localDocumentsView.getDocumentsMatchingQuery(S,T,r4.min(),R)}appendRemainingResults(S,T,R,N){return this.localDocumentsView.getDocumentsMatchingQuery(S,R,N).next(S=>(T.forEach(T=>{S=S.insert(T.key,T)}),S))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pz="firestore_clients";function pq(S,T){return`${pz}_${S}_${T}`}let p$="firestore_mutations";function pG(S,T,R){let N=`${p$}_${S}_${R}`;return T.isAuthenticated()&&(N+=`_${T.uid}`),N}let pK="firestore_targets";function pW(S,T){return`${pK}_${S}_${T}`}let pH="firestore_online_state";function pQ(S){return`${pH}_${S}`}let pY="firestore_bundle_loaded_v2";function pJ(S){return`${pY}_${S}`}let pX="firestore_sequence_number";function pZ(S){return`${pX}_${S}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let p0="SharedClientState";class p3{constructor(S,T,R,N){this.user=S,this.batchId=T,this.state=R,this.error=N}static fromWebStorageEntry(S,T,R){let N;let O=JSON.parse(R),P="object"==typeof O&&-1!==["pending","acknowledged","rejected"].indexOf(O.state)&&(void 0===O.error||"object"==typeof O.error);return(P&&O.error&&(P="string"==typeof O.error.message&&"string"==typeof O.error.code)&&(N=new ri(O.error.code,O.error.message)),P)?new p3(S,T,O.state,N):(t6(p0,`Failed to parse mutation state for ID '${T}': ${R}`),null)}toWebStorageJSON(){let S={state:this.state,updateTimeMs:Date.now()};return this.error&&(S.error={code:this.error.code,message:this.error.message}),JSON.stringify(S)}}class p4{constructor(S,T,R){this.targetId=S,this.state=T,this.error=R}static fromWebStorageEntry(S,T){let R;let N=JSON.parse(T),O="object"==typeof N&&-1!==["not-current","current","rejected"].indexOf(N.state)&&(void 0===N.error||"object"==typeof N.error);return(O&&N.error&&(O="string"==typeof N.error.message&&"string"==typeof N.error.code)&&(R=new ri(N.error.code,N.error.message)),O)?new p4(S,N.state,R):(t6(p0,`Failed to parse target state for ID '${S}': ${T}`),null)}toWebStorageJSON(){let S={state:this.state,updateTimeMs:Date.now()};return this.error&&(S.error={code:this.error.code,message:this.error.message}),JSON.stringify(S)}}class p6{constructor(S,T){this.clientId=S,this.activeTargetIds=T}static fromWebStorageEntry(S,T){let R=JSON.parse(T),N="object"==typeof R&&R.activeTargetIds instanceof Array,O=oM();for(let S=0;N&&S<R.activeTargetIds.length;++S)N=sg(R.activeTargetIds[S]),O=O.add(R.activeTargetIds[S]);return N?new p6(S,O):(t6(p0,`Failed to parse client data for instance '${S}': ${T}`),null)}}class p9{constructor(S,T){this.clientId=S,this.onlineState=T}static fromWebStorageEntry(S){let T=JSON.parse(S);return"object"==typeof T&&-1!==["Unknown","Online","Offline"].indexOf(T.onlineState)&&"string"==typeof T.clientId?new p9(T.clientId,T.onlineState):(t6(p0,`Failed to parse online state: ${S}`),null)}}class p5{constructor(){this.activeTargetIds=oM()}addQueryTarget(S){this.activeTargetIds=this.activeTargetIds.add(S)}removeQueryTarget(S){this.activeTargetIds=this.activeTargetIds.delete(S)}toWebStorageJSON(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class p8{constructor(S,T,R,N,O){this.window=S,this.queue=T,this.persistenceKey=R,this.localClientId=N,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new iW(rb),this.started=!1,this.earlyEvents=[];let P=R.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=O,this.localClientStorageKey=pq(this.persistenceKey,this.localClientId),this.sequenceNumberKey=pZ(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new p5),this.clientStateKeyRe=RegExp(`^${pz}_${P}_([^_]*)$`),this.mutationBatchKeyRe=RegExp(`^${p$}_${P}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=RegExp(`^${pK}_${P}_(\\d+)$`),this.onlineStateKey=pQ(this.persistenceKey),this.bundleLoadedKey=pJ(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(S){return!!(S&&S.localStorage)}async start(){for(let S of(await this.syncEngine.getActiveClients())){if(S===this.localClientId)continue;let T=this.getItem(pq(this.persistenceKey,S));if(T){let R=p6.fromWebStorageEntry(S,T);R&&(this.activeClients=this.activeClients.insert(R.clientId,R))}}this.persistClientState();let S=this.storage.getItem(this.onlineStateKey);if(S){let T=this.fromWebStorageOnlineState(S);T&&this.handleOnlineStateEvent(T)}for(let S of this.earlyEvents)this.handleWebStorageEvent(S);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(S){this.setItem(this.sequenceNumberKey,JSON.stringify(S))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(S){let T=!1;return this.activeClients.forEach((R,N)=>{N.activeTargetIds.has(S)&&(T=!0)}),T}addPendingMutation(S){this.persistMutationState(S,"pending")}updateMutationState(S,T,R){this.persistMutationState(S,T,R),this.removeMutationState(S)}addLocalQueryTarget(S,T=!0){let R="not-current";if(this.isActiveQueryTarget(S)){let T=this.storage.getItem(pW(this.persistenceKey,S));if(T){let N=p4.fromWebStorageEntry(S,T);N&&(R=N.state)}}return T&&this.localClientState.addQueryTarget(S),this.persistClientState(),R}removeLocalQueryTarget(S){this.localClientState.removeQueryTarget(S),this.persistClientState()}isLocalQueryTarget(S){return this.localClientState.activeTargetIds.has(S)}clearQueryState(S){this.removeItem(pW(this.persistenceKey,S))}updateQueryState(S,T,R){this.persistQueryTargetState(S,T,R)}handleUserChange(S,T,R){T.forEach(S=>{this.removeMutationState(S)}),this.currentUser=S,R.forEach(S=>{this.addPendingMutation(S)})}setOnlineState(S){this.persistOnlineState(S)}notifyBundleLoaded(S){this.persistBundleLoadedState(S)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(S){let T=this.storage.getItem(S);return t4(p0,"READ",S,T),T}setItem(S,T){t4(p0,"SET",S,T),this.storage.setItem(S,T)}removeItem(S){t4(p0,"REMOVE",S),this.storage.removeItem(S)}handleWebStorageEvent(S){let T=S;if(T.storageArea===this.storage){if(t4(p0,"EVENT",T.key,T.newValue),T.key===this.localClientStorageKey){t6("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(async()=>{if(!this.started){this.earlyEvents.push(T);return}if(null!==T.key){if(this.clientStateKeyRe.test(T.key)){if(null!=T.newValue){let S=this.fromWebStorageClientState(T.key,T.newValue);if(S)return this.handleClientStateEvent(S.clientId,S)}else{let S=this.fromWebStorageClientStateKey(T.key);return this.handleClientStateEvent(S,null)}}else if(this.mutationBatchKeyRe.test(T.key)){if(null!==T.newValue){let S=this.fromWebStorageMutationMetadata(T.key,T.newValue);if(S)return this.handleMutationBatchEvent(S)}}else if(this.queryTargetKeyRe.test(T.key)){if(null!==T.newValue){let S=this.fromWebStorageQueryTargetMetadata(T.key,T.newValue);if(S)return this.handleQueryTargetEvent(S)}}else if(T.key===this.onlineStateKey){if(null!==T.newValue){let S=this.fromWebStorageOnlineState(T.newValue);if(S)return this.handleOnlineStateEvent(S)}}else if(T.key===this.sequenceNumberKey){let S=p7(T.newValue);S!==nT.INVALID&&this.sequenceNumberHandler(S)}else if(T.key===this.bundleLoadedKey){let S=this.fromWebStoreBundleLoadedState(T.newValue);await Promise.all(S.map(S=>this.syncEngine.synchronizeWithChangedDocuments(S)))}}})}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(S,T,R){let N=new p3(this.currentUser,S,T,R),O=pG(this.persistenceKey,this.currentUser,S);this.setItem(O,N.toWebStorageJSON())}removeMutationState(S){let T=pG(this.persistenceKey,this.currentUser,S);this.removeItem(T)}persistOnlineState(S){let T={clientId:this.localClientId,onlineState:S};this.storage.setItem(this.onlineStateKey,JSON.stringify(T))}persistQueryTargetState(S,T,R){let N=pW(this.persistenceKey,S),O=new p4(S,T,R);this.setItem(N,O.toWebStorageJSON())}persistBundleLoadedState(S){let T=JSON.stringify(Array.from(S));this.setItem(this.bundleLoadedKey,T)}fromWebStorageClientStateKey(S){let T=this.clientStateKeyRe.exec(S);return T?T[1]:null}fromWebStorageClientState(S,T){let R=this.fromWebStorageClientStateKey(S);return p6.fromWebStorageEntry(R,T)}fromWebStorageMutationMetadata(S,T){let R=this.mutationBatchKeyRe.exec(S),N=Number(R[1]),O=void 0!==R[2]?R[2]:null;return p3.fromWebStorageEntry(new tX(O),N,T)}fromWebStorageQueryTargetMetadata(S,T){let R=Number(this.queryTargetKeyRe.exec(S)[1]);return p4.fromWebStorageEntry(R,T)}fromWebStorageOnlineState(S){return p9.fromWebStorageEntry(S)}fromWebStoreBundleLoadedState(S){return JSON.parse(S)}async handleMutationBatchEvent(S){if(S.user.uid!==this.currentUser.uid){t4(p0,`Ignoring mutation for non-active user ${S.user.uid}`);return}return this.syncEngine.applyBatchState(S.batchId,S.state,S.error)}handleQueryTargetEvent(S){return this.syncEngine.applyTargetState(S.targetId,S.state,S.error)}handleClientStateEvent(S,T){let R=T?this.activeClients.insert(S,T):this.activeClients.remove(S),N=this.extractActiveQueryTargets(this.activeClients),O=this.extractActiveQueryTargets(R),P=[],M=[];return O.forEach(S=>{N.has(S)||P.push(S)}),N.forEach(S=>{O.has(S)||M.push(S)}),this.syncEngine.applyActiveTargetsChange(P,M).then(()=>{this.activeClients=R})}handleOnlineStateEvent(S){this.activeClients.get(S.clientId)&&this.onlineStateHandler(S.onlineState)}extractActiveQueryTargets(S){let T=oM();return S.forEach((S,R)=>{T=T.unionWith(R.activeTargetIds)}),T}}function p7(S){let T=nT.INVALID;if(null!=S)try{let R=JSON.parse(S);rt("number"==typeof R,30636,{seqString:S}),T=R}catch(S){t6(p0,"Failed to read sequence number from WebStorage",S)}return T}class fe{constructor(){this.localState=new p5,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(S){}updateMutationState(S,T,R){}addLocalQueryTarget(S,T=!0){return T&&this.localState.addQueryTarget(S),this.queryState[S]||"not-current"}updateQueryState(S,T,R){this.queryState[S]=T}removeLocalQueryTarget(S){this.localState.removeQueryTarget(S)}isLocalQueryTarget(S){return this.localState.activeTargetIds.has(S)}clearQueryState(S){delete this.queryState[S]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(S){return this.localState.activeTargetIds.has(S)}start(){return this.localState=new p5,Promise.resolve()}handleUserChange(S,T,R){}setOnlineState(S){}shutdown(){}writeSequenceNumber(S){}notifyBundleLoaded(S){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ft{addCallback(S){}shutdown(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fr{constructor(S){this.sendFn=S.sendFn,this.closeFn=S.closeFn}onConnected(S){this.wrappedOnConnected=S}onOpen(S){this.wrappedOnOpen=S}onClose(S){this.wrappedOnClose=S}onMessage(S){this.wrappedOnMessage=S}close(){this.closeFn()}send(S){this.sendFn(S)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(S){this.wrappedOnClose(S)}callOnMessage(S){this.wrappedOnMessage(S)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fi=null;function fa(){return 268435456+Math.round(2147483648*Math.random())}function fo(){return null===fi?fi=fa():fi++,"0x"+fi.toString(16)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fl(S){return new Promise((T,R)=>{S((S,N)=>{S?R(S):T(N)})})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fu="1.9.15",fc="GrpcConnection",fd=`gl-node/${process.versions.node} fire/${tZ} grpc/${fu}`;function fh(S,T,R,N){rt(null===T||"OAuth"===T.type,36936);let O=new tH.SF;return T&&T.headers.forEach((S,T)=>O.set(T,S)),R&&R.headers.forEach((S,T)=>O.set(T,S)),N&&O.set("X-Firebase-GMPID",N),O.set("X-Goog-Api-Client",fd),O.set("Google-Cloud-Resource-Prefix",S),O.set("x-goog-request-params",S),O}class fp{get shouldResourcePathBeIncludedInRequest(){return!0}constructor(S,T){this.databaseInfo=T,this.cachedStub=null,this.firestore=S.google.firestore.v1,this.databasePath=`projects/${T.databaseId.projectId}/databases/${T.databaseId.database}`}ensureActiveStub(){if(!this.cachedStub){t4(fc,"Creating Firestore stub.");let S=this.databaseInfo.ssl?tH.K9.createSsl():tH.K9.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,S)}return this.cachedStub}invokeRPC(S,T,R,N,O){let P=fo(),M=this.ensureActiveStub(),L=fh(this.databasePath,N,O,this.databaseInfo.appId),U=Object.assign({database:this.databasePath},R);return fl(T=>(t4(fc,`RPC '${S}' ${P} invoked with request:`,R),M[S](U,L,(R,N)=>{R?(t4(fc,`RPC '${S}' ${P} failed with error:`,R),T(new ri(lE(R.code),R.message))):(t4(fc,`RPC '${S}' ${P} completed with response:`,N),T(void 0,N))})))}invokeStreamingRPC(S,T,R,N,O,P){let M=fo(),L=[],U=new rs;t4(fc,`RPC '${S}' ${M} invoked (streaming) with request:`,R);let V=this.ensureActiveStub(),$=fh(this.databasePath,N,O,this.databaseInfo.appId),K=Object.assign(Object.assign({},R),{database:this.databasePath}),W=V[S](K,$),Q=!1;return W.on("data",T=>{t4(fc,`RPC ${S} ${M} received result:`,T),L.push(T),void 0!==P&&L.length===P&&(Q=!0,U.resolve(L))}),W.on("end",()=>{t4(fc,`RPC '${S}' ${M} completed.`),Q||(Q=!0,U.resolve(L))}),W.on("error",T=>{t4(fc,`RPC '${S}' ${M} failed with error:`,T);let R=lE(T.code);U.reject(new ri(R,T.message))}),U.promise}openStream(S,T,R){let N=fo(),O=this.ensureActiveStub(),P=fh(this.databasePath,T,R,this.databaseInfo.appId),M=O[S](P),L=!1,U=S=>{L||(L=!0,V.callOnClose(S),M.end())},V=new fr({sendFn:T=>{if(L)t4(fc,`RPC '${S}' stream ${N} not sending because gRPC stream is closed:`,T);else{t4(fc,`RPC '${S}' stream ${N} sending:`,T);try{M.write(T)}catch(S){throw t6("Failure sending:",T),t6("Error:",S),S}}},closeFn:()=>{t4(fc,`RPC '${S}' stream ${N} closed locally via close().`),U()}}),$=!1;return M.on("data",T=>{L||(t4(fc,`RPC '${S}' stream ${N} received:`,T),$||(V.callOnConnected(),$=!0),V.callOnMessage(T))}),M.on("end",()=>{t4(fc,`RPC '${S}' stream ${N} ended.`),U()}),M.on("error",T=>{L||(t9(fc,`RPC '${S}' stream ${N} error. Code:`,T.code,"Message:",T.message),U(new ri(lE(T.code),T.message)))}),t4(fc,`Opening RPC '${S}' stream ${N} to ${this.databaseInfo.host}`),setTimeout(()=>{V.callOnOpen()},0),V}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}}let ff={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}};var fm={nested:ff},fg=Object.freeze({__proto__:null,nested:ff,default:fm});/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fy={longs:String,enums:String,defaults:!0,oneofs:!1};function fv(){let S=tQ.im(fg,fy);return tH.Rz(S)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fb(S){return new fp(fv(),S)}function fS(){return new ft}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fT(){return"YES"===process.env.USE_MOCK_PERSISTENCE?window:null}function fE(){return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fC(S){return new lG(S,!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fw="ExponentialBackoff",f_=1e3,fI=1.5,fR=6e4;class fD{constructor(S,T,R=f_,N=fI,O=fR){this.queue=S,this.timerId=T,this.initialDelayMs=R,this.backoffFactor=N,this.maxDelayMs=O,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(S){this.cancel();let T=Math.floor(this.currentBaseMs+this.jitterDelayMs()),R=Math.max(0,Date.now()-this.lastAttemptTime),N=Math.max(0,T-R);N>0&&t4(fw,`Backing off for ${N} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${T} ms, last attempt: ${R} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,N,()=>(this.lastAttemptTime=Date.now(),S())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fA="PersistentStream",fk=6e4,fN=1e4;class fO{constructor(S,T,R,N,O,P,M,L){this.queue=S,this.idleTimerId=R,this.healthTimerId=N,this.connection=O,this.authCredentialsProvider=P,this.appCheckCredentialsProvider=M,this.listener=L,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new fD(S,T)}isStarted(){return 1===this.state||5===this.state||this.isOpen()}isOpen(){return 2===this.state||3===this.state}start(){if(this.responseCount=0,4===this.state){this.performBackoff();return}this.auth()}async stop(){this.isStarted()&&await this.close(0)}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,fk,()=>this.handleIdleCloseTimer()))}sendRequest(S){this.cancelIdleCheck(),this.stream.send(S)}async handleIdleCloseTimer(){if(this.isOpen())return this.close(0)}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}async close(S,T){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,4!==S?this.backoff.reset():T&&T.code===rn.RESOURCE_EXHAUSTED?(t6(T.toString()),t6("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):T&&T.code===rn.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=S,await this.listener.onClose(T)}tearDown(){}auth(){this.state=1;let S=this.getCloseGuardedDispatcher(this.closeCount),T=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([S,R])=>{this.closeCount===T&&this.startStream(S,R)},T=>{S(()=>{let S=new ri(rn.UNKNOWN,"Fetching auth token failed: "+T.message);return this.handleStreamClose(S)})})}startStream(S,T){let R=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(S,T),this.stream.onConnected(()=>{R(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{R(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,fN,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(S=>{R(()=>this.handleStreamClose(S))}),this.stream.onMessage(S=>{R(()=>1==++this.responseCount?this.onFirst(S):this.onNext(S))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(async()=>{this.state=0,this.start()})}handleStreamClose(S){return t4(fA,`close with error: ${S}`),this.stream=null,this.close(4,S)}getCloseGuardedDispatcher(S){return T=>{this.queue.enqueueAndForget(()=>this.closeCount===S?T():(t4(fA,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class fx extends fO{constructor(S,T,R,N,O,P){super(S,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",T,R,N,P),this.serializer=O}startRpc(S,T){return this.connection.openStream("Listen",S,T)}onFirst(S){return this.onNext(S)}onNext(S){this.backoff.reset();let T=ul(this.serializer,S),R=uc(S);return this.listener.onWatchChange(T,R)}watch(S){let T={};T.database=l8(this.serializer),T.addTarget=uR(this.serializer,S);let R=u_(this.serializer,S);R&&(T.labels=R),this.sendRequest(T)}unwatch(S){let T={};T.database=l8(this.serializer),T.removeTarget=S,this.sendRequest(T)}}class fP extends fO{constructor(S,T,R,N,O,P){super(S,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",T,R,N,P),this.serializer=O}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(S,T){return this.connection.openStream("Write",S,T)}onFirst(S){return rt(!!S.streamToken,31322),this.lastStreamToken=S.streamToken,rt(!S.writeResults||0===S.writeResults.length,55816),this.listener.onHandshakeComplete()}onNext(S){rt(!!S.streamToken,12678),this.lastStreamToken=S.streamToken,this.backoff.reset();let T=ug(S.writeResults,S.commitTime),R=l0(S.commitTime);return this.listener.onMutationResult(R,T)}writeHandshake(){let S={};S.database=l8(this.serializer),this.sendRequest(S)}writeMutations(S){let T={streamToken:this.lastStreamToken,writes:S.map(S=>ud(this.serializer,S))};this.sendRequest(T)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fM{}class fL extends fM{constructor(S,T,R,N){super(),this.authCredentials=S,this.appCheckCredentials=T,this.connection=R,this.serializer=N,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new ri(rn.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(S,T,R,N){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([O,P])=>this.connection.invokeRPC(S,l2(T,R),N,O,P)).catch(S=>{if("FirebaseError"===S.name)throw S.code===rn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),S;throw new ri(rn.UNKNOWN,S.toString())})}invokeStreamingRPC(S,T,R,N,O){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([P,M])=>this.connection.invokeStreamingRPC(S,l2(T,R),N,P,M,O)).catch(S=>{if("FirebaseError"===S.name)throw S.code===rn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),S;throw new ri(rn.UNKNOWN,S.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}}function fF(S,T,R,N){return new fL(S,T,R,N)}async function fB(S,T){let R=rr(S),N={writes:T.map(S=>ud(R.serializer,S))};await R.invokeRPC("Commit",R.serializer.databaseId,rR.emptyPath(),N)}async function fj(S,T){let R=rr(S),N={documents:T.map(S=>l4(R.serializer,S))},O=await R.invokeStreamingRPC("BatchGetDocuments",R.serializer.databaseId,rR.emptyPath(),N,T.length),P=new Map;O.forEach(S=>{let T=uo(R.serializer,S);P.set(T.key.toString(),T)});let M=[];return T.forEach(S=>{let T=P.get(S.toString());rt(!!T,55234,{key:S}),M.push(T)}),M}async function fU(S,T,R){var N;let O=rr(S),{request:P,aliasMap:M,parent:L}=uE(O.serializer,oe(T),R);O.connection.shouldResourcePathBeIncludedInRequest||delete P.parent;let U=(await O.invokeStreamingRPC("RunAggregationQuery",O.serializer.databaseId,L,P,1)).filter(S=>!!S.result);rt(1===U.length,64727);let V=null===(N=U[0].result)||void 0===N?void 0:N.aggregateFields;return Object.keys(V).reduce((S,T)=>(S[M[T]]=V[T],S),{})}function fV(S,T,R){let N=rr(S);return N.verifyInitialized(),new fP(T,N.connection,N.authCredentials,N.appCheckCredentials,N.serializer,R)}function fz(S,T,R){let N=rr(S);return N.verifyInitialized(),new fx(T,N.connection,N.authCredentials,N.appCheckCredentials,N.serializer,R)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fq="OnlineStateTracker",f$=1,fG=1e4;class fK{constructor(S,T){this.asyncQueue=S,this.onlineStateHandler=T,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",fG,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${fG/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(S){"Online"===this.state?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=f$&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${f$} times. Most recent error: ${S.toString()}`),this.setAndBroadcast("Offline")))}set(S){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===S&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(S)}setAndBroadcast(S){S!==this.state&&(this.state=S,this.onlineStateHandler(S))}logClientOfflineWarningIfNecessary(S){let T=`Could not reach Cloud Firestore backend. ${S}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(t6(T),this.shouldWarnClientIsOffline=!1):t4(fq,T)}clearOnlineStateTimer(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fW="RemoteStore",fH=10;class fQ{constructor(S,T,R,N,O){this.localStore=S,this.datastore=T,this.asyncQueue=R,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=O,this.connectivityMonitor.addCallback(S=>{R.enqueueAndForget(async()=>{f8(this)&&(t4(fW,"Restarting streams for network reachability change."),await mb(this))})}),this.onlineStateTracker=new fK(R,N)}}function fY(S,T,R,N,O){return new fQ(S,T,R,N,O)}async function fJ(S){if(f8(S))for(let T of S.onNetworkStatusChange)await T(!0)}async function fX(S){for(let T of S.onNetworkStatusChange)await T(!1)}async function fZ(S){let T=rr(S);t4(fW,"RemoteStore shutting down."),T.offlineCauses.add(5),await fX(T),T.connectivityMonitor.shutdown(),T.onlineStateTracker.set("Unknown")}function f0(S,T){let R=rr(S);!R.listenTargets.has(T.targetId)&&(R.listenTargets.set(T.targetId,T),f5(R)?f9(R):mE(R).isOpen()&&f4(R,T))}function f3(S,T){let R=rr(S),N=mE(R);R.listenTargets.delete(T),N.isOpen()&&f6(R,T),0===R.listenTargets.size&&(N.isOpen()?N.markIdle():f8(R)&&R.onlineStateTracker.set("Unknown"))}function f4(S,T){if(S.watchChangeAggregator.recordPendingTargetRequest(T.targetId),T.resumeToken.approximateByteSize()>0||T.snapshotVersion.compareTo(r$.min())>0){let R=S.remoteSyncer.getRemoteKeysForTarget(T.targetId).size;T=T.withExpectedCount(R)}mE(S).watch(T)}function f6(S,T){S.watchChangeAggregator.recordPendingTargetRequest(T),mE(S).unwatch(T)}function f9(S){S.watchChangeAggregator=new lB({getRemoteKeysForTarget:T=>S.remoteSyncer.getRemoteKeysForTarget(T),getTargetDataForTarget:T=>S.listenTargets.get(T)||null,getDatabaseId:()=>S.datastore.serializer.databaseId}),mE(S).start(),S.onlineStateTracker.handleWatchStreamStart()}function f5(S){return f8(S)&&!mE(S).isStarted()&&S.listenTargets.size>0}function f8(S){return 0===rr(S).offlineCauses.size}function f7(S){S.watchChangeAggregator=void 0}async function me(S){S.onlineStateTracker.set("Online")}async function mt(S){S.listenTargets.forEach((T,R)=>{f4(S,T)})}async function mr(S,T){f7(S),f5(S)?(S.onlineStateTracker.handleWatchStreamFailure(T),f9(S)):S.onlineStateTracker.set("Unknown")}async function mn(S,T,R){if(S.onlineStateTracker.set("Online"),T instanceof lM&&2===T.state&&T.cause){try{await mo(S,T)}catch(R){t4(fW,"Failed to remove targets %s: %s ",T.targetIds.join(","),R),await mi(S,R)}return}if(T instanceof lx?S.watchChangeAggregator.handleDocumentChange(T):T instanceof lP?S.watchChangeAggregator.handleExistenceFilter(T):S.watchChangeAggregator.handleTargetChange(T),!R.isEqual(r$.min()))try{let T=await pp(S.localStore);R.compareTo(T)>=0&&await ma(S,R)}catch(T){t4(fW,"Failed to raise snapshot:",T),await mi(S,T)}}async function mi(S,T,R){if(nc(T))S.offlineCauses.add(1),await fX(S),S.onlineStateTracker.set("Offline"),R||(R=()=>pp(S.localStore)),S.asyncQueue.enqueueRetryable(async()=>{t4(fW,"Retrying IndexedDB access"),await R(),S.offlineCauses.delete(1),await fJ(S)});else throw T}function ms(S,T){return T().catch(R=>mi(S,R,T))}function ma(S,T){let R=S.watchChangeAggregator.createRemoteEvent(T);return R.targetChanges.forEach((R,N)=>{if(R.resumeToken.approximateByteSize()>0){let O=S.listenTargets.get(N);O&&S.listenTargets.set(N,O.withResumeToken(R.resumeToken,T))}}),R.targetMismatches.forEach((T,R)=>{let N=S.listenTargets.get(T);N&&(S.listenTargets.set(T,N.withResumeToken(i4.EMPTY_BYTE_STRING,N.snapshotVersion)),f6(S,T),f4(S,new u2(N.target,T,R,N.sequenceNumber)))}),S.remoteSyncer.applyRemoteEvent(R)}async function mo(S,T){let R=T.cause;for(let N of T.targetIds)S.listenTargets.has(N)&&(await S.remoteSyncer.rejectListen(N,R),S.listenTargets.delete(N),S.watchChangeAggregator.removeTarget(N))}async function ml(S){let T=rr(S),R=mC(T),N=T.writePipeline.length>0?T.writePipeline[T.writePipeline.length-1].batchId:sp;for(;mu(T);)try{let S=await pv(T.localStore,N);if(null===S){0===T.writePipeline.length&&R.markIdle();break}N=S.batchId,mc(T,S)}catch(S){await mi(T,S)}mh(T)&&mp(T)}function mu(S){return f8(S)&&S.writePipeline.length<fH}function mc(S,T){S.writePipeline.push(T);let R=mC(S);R.isOpen()&&R.handshakeComplete&&R.writeMutations(T.mutations)}function mh(S){return f8(S)&&!mC(S).isStarted()&&S.writePipeline.length>0}function mp(S){mC(S).start()}async function mf(S){mC(S).writeHandshake()}async function mm(S){let T=mC(S);for(let R of S.writePipeline)T.writeMutations(R.mutations)}async function mg(S,T,R){let N=S.writePipeline.shift(),O=ly.from(N,T,R);await ms(S,()=>S.remoteSyncer.applySuccessfulWrite(O)),await ml(S)}async function my(S,T){T&&mC(S).handshakeComplete&&await mv(S,T),mh(S)&&mp(S)}async function mv(S,T){if(lT(T.code)){let R=S.writePipeline.shift();mC(S).inhibitBackoff(),await ms(S,()=>S.remoteSyncer.rejectFailedWrite(R.batchId,T)),await ml(S)}}async function mb(S){let T=rr(S);T.offlineCauses.add(4),await fX(T),T.onlineStateTracker.set("Unknown"),T.offlineCauses.delete(4),await fJ(T)}async function mS(S,T){let R=rr(S);R.asyncQueue.verifyOperationInProgress(),t4(fW,"RemoteStore received new credentials");let N=f8(R);R.offlineCauses.add(3),await fX(R),N&&R.onlineStateTracker.set("Unknown"),await R.remoteSyncer.handleCredentialChange(T),R.offlineCauses.delete(3),await fJ(R)}async function mT(S,T){let R=rr(S);T?(R.offlineCauses.delete(2),await fJ(R)):T||(R.offlineCauses.add(2),await fX(R),R.onlineStateTracker.set("Unknown"))}function mE(S){return S.watchStream||(S.watchStream=fz(S.datastore,S.asyncQueue,{onConnected:me.bind(null,S),onOpen:mt.bind(null,S),onClose:mr.bind(null,S),onWatchChange:mn.bind(null,S)}),S.onNetworkStatusChange.push(async T=>{T?(S.watchStream.inhibitBackoff(),f5(S)?f9(S):S.onlineStateTracker.set("Unknown")):(await S.watchStream.stop(),f7(S))})),S.watchStream}function mC(S){return S.writeStream||(S.writeStream=fV(S.datastore,S.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:mf.bind(null,S),onClose:my.bind(null,S),onHandshakeComplete:mm.bind(null,S),onMutationResult:mg.bind(null,S)}),S.onNetworkStatusChange.push(async T=>{T?(S.writeStream.inhibitBackoff(),await ml(S)):(await S.writeStream.stop(),S.writePipeline.length>0&&(t4(fW,`Stopping write stream with ${S.writePipeline.length} pending writes`),S.writePipeline=[]))})),S.writeStream}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mw="AsyncQueue";class m_{constructor(S,T,R,N,O){this.asyncQueue=S,this.timerId=T,this.targetTimeMs=R,this.op=N,this.removalCallback=O,this.deferred=new rs,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(S=>{})}get promise(){return this.deferred.promise}static createAndSchedule(S,T,R,N,O){let P=new m_(S,T,Date.now()+R,N,O);return P.start(R),P}start(S){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),S)}skipDelay(){return this.handleDelayElapsed()}cancel(S){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ri(rn.CANCELLED,"Operation cancelled"+(S?": "+S:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(S=>this.deferred.resolve(S))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function mI(S,T){if(t6(mw,`${T}: ${S}`),nc(S))return new ri(rn.UNAVAILABLE,`${T}: ${S}`);throw S}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mR{static emptySet(S){return new mR(S.comparator)}constructor(S){S?this.comparator=(T,R)=>S(T,R)||rk.comparator(T.key,R.key):this.comparator=(S,T)=>rk.comparator(S.key,T.key),this.keyedMap=ow(),this.sortedSet=new iW(this.comparator)}has(S){return null!=this.keyedMap.get(S)}get(S){return this.keyedMap.get(S)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(S){let T=this.keyedMap.get(S);return T?this.sortedSet.indexOf(T):-1}get size(){return this.sortedSet.size}forEach(S){this.sortedSet.inorderTraversal((T,R)=>(S(T),!1))}add(S){let T=this.delete(S.key);return T.copy(T.keyedMap.insert(S.key,S),T.sortedSet.insert(S,null))}delete(S){let T=this.get(S);return T?this.copy(this.keyedMap.remove(S),this.sortedSet.remove(T)):this}isEqual(S){if(!(S instanceof mR)||this.size!==S.size)return!1;let T=this.sortedSet.getIterator(),R=S.sortedSet.getIterator();for(;T.hasNext();){let S=T.getNext().key,N=R.getNext().key;if(!S.isEqual(N))return!1}return!0}toString(){let S=[];return(this.forEach(T=>{S.push(T.toString())}),0===S.length)?"DocumentSet ()":"DocumentSet (\n  "+S.join("  \n")+"\n)"}copy(S,T){let R=new mR;return R.comparator=this.comparator,R.keyedMap=S,R.sortedSet=T,R}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mD{constructor(){this.changeMap=new iW(rk.comparator)}track(S){let T=S.doc.key,R=this.changeMap.get(T);if(!R){this.changeMap=this.changeMap.insert(T,S);return}0!==S.type&&3===R.type?this.changeMap=this.changeMap.insert(T,S):3===S.type&&1!==R.type?this.changeMap=this.changeMap.insert(T,{type:R.type,doc:S.doc}):2===S.type&&2===R.type?this.changeMap=this.changeMap.insert(T,{type:2,doc:S.doc}):2===S.type&&0===R.type?this.changeMap=this.changeMap.insert(T,{type:0,doc:S.doc}):1===S.type&&0===R.type?this.changeMap=this.changeMap.remove(T):1===S.type&&2===R.type?this.changeMap=this.changeMap.insert(T,{type:1,doc:R.doc}):0===S.type&&1===R.type?this.changeMap=this.changeMap.insert(T,{type:2,doc:S.doc}):t8(63341,{change:S,oldChange:R})}getChanges(){let S=[];return this.changeMap.inorderTraversal((T,R)=>{S.push(R)}),S}}class mA{constructor(S,T,R,N,O,P,M,L,U){this.query=S,this.docs=T,this.oldDocs=R,this.docChanges=N,this.mutatedKeys=O,this.fromCache=P,this.syncStateChanged=M,this.excludesMetadataChanges=L,this.hasCachedResults=U}static fromInitialDocuments(S,T,R,N,O){let P=[];return T.forEach(S=>{P.push({type:0,doc:S})}),new mA(S,T,mR.emptySet(T),P,R,N,!0,!1,O)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(S){if(this.fromCache!==S.fromCache||this.hasCachedResults!==S.hasCachedResults||this.syncStateChanged!==S.syncStateChanged||!this.mutatedKeys.isEqual(S.mutatedKeys)||!ol(this.query,S.query)||!this.docs.isEqual(S.docs)||!this.oldDocs.isEqual(S.oldDocs))return!1;let T=this.docChanges,R=S.docChanges;if(T.length!==R.length)return!1;for(let S=0;S<T.length;S++)if(T[S].type!==R[S].type||!T[S].doc.isEqual(R[S].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mk{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(S=>S.listensToRemoteStore())}}function mN(){return new mO}class mO{constructor(){this.queries=mx(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){mj(this,new ri(rn.ABORTED,"Firestore shutting down"))}}function mx(){return new oS(S=>ou(S),ol)}async function mP(S,T){let R=rr(S),N=3,O=T.query,P=R.queries.get(O);P?!P.hasRemoteListeners()&&T.listensToRemoteStore()&&(N=2):(P=new mk,N=T.listensToRemoteStore()?0:1);try{switch(N){case 0:P.viewSnap=await R.onListen(O,!0);break;case 1:P.viewSnap=await R.onListen(O,!1);break;case 2:await R.onFirstRemoteStoreListen(O)}}catch(R){let S=mI(R,`Initialization of query '${oc(T.query)}' failed`);T.onError(S);return}R.queries.set(O,P),P.listeners.push(T),T.applyOnlineStateChange(R.onlineState),P.viewSnap&&T.onViewSnapshot(P.viewSnap)&&mU(R)}async function mM(S,T){let R=rr(S),N=T.query,O=3,P=R.queries.get(N);if(P){let S=P.listeners.indexOf(T);S>=0&&(P.listeners.splice(S,1),0===P.listeners.length?O=T.listensToRemoteStore()?0:1:!P.hasRemoteListeners()&&T.listensToRemoteStore()&&(O=2))}switch(O){case 0:return R.queries.delete(N),R.onUnlisten(N,!0);case 1:return R.queries.delete(N),R.onUnlisten(N,!1);case 2:return R.onLastRemoteStoreUnlisten(N);default:return}}function mL(S,T){let R=rr(S),N=!1;for(let S of T){let T=S.query,O=R.queries.get(T);if(O){for(let T of O.listeners)T.onViewSnapshot(S)&&(N=!0);O.viewSnap=S}}N&&mU(R)}function mF(S,T,R){let N=rr(S),O=N.queries.get(T);if(O)for(let S of O.listeners)S.onError(R);N.queries.delete(T)}function mB(S,T){let R=rr(S);R.onlineState=T;let N=!1;R.queries.forEach((S,R)=>{for(let S of R.listeners)S.applyOnlineStateChange(T)&&(N=!0)}),N&&mU(R)}function mj(S,T){let R=rr(S),N=R.queries;R.queries=mx(),N.forEach((S,R)=>{for(let S of R.listeners)S.onError(T)})}function mU(S){S.snapshotsInSyncListeners.forEach(S=>{S.next()})}!function(S){S.Default="default",S.Cache="cache"}(V||(V={}));class mV{constructor(S,T,R){this.query=S,this.queryObserver=T,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=R||{}}onViewSnapshot(S){if(!this.options.includeMetadataChanges){let T=[];for(let R of S.docChanges)3!==R.type&&T.push(R);S=new mA(S.query,S.docs,S.oldDocs,T,S.mutatedKeys,S.fromCache,S.syncStateChanged,!0,S.hasCachedResults)}let T=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(S)&&(this.queryObserver.next(S),T=!0):this.shouldRaiseInitialEvent(S,this.onlineState)&&(this.raiseInitialEvent(S),T=!0),this.snap=S,T}onError(S){this.queryObserver.error(S)}applyOnlineStateChange(S){this.onlineState=S;let T=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,S)&&(this.raiseInitialEvent(this.snap),T=!0),T}shouldRaiseInitialEvent(S,T){if(!S.fromCache||!this.listensToRemoteStore())return!0;let R="Offline"!==T;return(!this.options.waitForSyncWhenOnline||!R)&&(!S.docs.isEmpty()||S.hasCachedResults||"Offline"===T)}shouldRaiseEvent(S){if(S.docChanges.length>0)return!0;let T=this.snap&&this.snap.hasPendingWrites!==S.hasPendingWrites;return(!!S.syncStateChanged||!!T)&&!0===this.options.includeMetadataChanges}raiseInitialEvent(S){S=mA.fromInitialDocuments(S.query,S.docs,S.mutatedKeys,S.fromCache,S.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(S)}listensToRemoteStore(){return this.options.source!==V.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mz{constructor(S,T,R,N){this.targetId=S,this.fromCache=T,this.addedKeys=R,this.removedKeys=N}static fromSnapshot(S,T){let R=ox(),N=ox();for(let S of T.docChanges)switch(S.type){case 0:R=R.add(S.doc.key);break;case 1:N=N.add(S.doc.key)}return new mz(S,T.fromCache,R,N)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mq{constructor(S){this.serializer=S}toDocumentKey(S){return l6(this.serializer,S)}toMutableDocument(S){return S.metadata.exists?un(this.serializer,S.document,!1):as.newNoDocument(this.toDocumentKey(S.metadata.name),this.toSnapshotVersion(S.metadata.readTime))}toSnapshotVersion(S){return l0(S)}}class m${constructor(S,T){this.bundleMetadata=S,this.serializer=T,this._queries=[],this._documents=[],this.collectionGroups=new Set,this.progress=mG(S)}get queries(){return this._queries}get documents(){return this._documents}addSizedElement(S){this.progress.bytesLoaded+=S.byteLength;let T=this.progress.documentsLoaded;if(S.payload.namedQuery)this._queries.push(S.payload.namedQuery);else if(S.payload.documentMetadata){this._documents.push({metadata:S.payload.documentMetadata}),!S.payload.documentMetadata.exists&&++T;let R=rR.fromString(S.payload.documentMetadata.name);this.collectionGroups.add(R.get(R.length-2))}else S.payload.document&&(this._documents[this._documents.length-1].document=S.payload.document,++T);return T!==this.progress.documentsLoaded?(this.progress.documentsLoaded=T,Object.assign({},this.progress)):null}getQueryDocumentMapping(S){let T=new Map,R=new mq(this.serializer);for(let N of S)if(N.metadata.queries){let S=R.toDocumentKey(N.metadata.name);for(let R of N.metadata.queries){let N=(T.get(R)||ox()).add(S);T.set(R,N)}}return T}async completeAndStoreAsync(S){let T=await pO(S,new mq(this.serializer),this._documents,this.bundleMetadata.id),R=this.getQueryDocumentMapping(this.documents);for(let T of this._queries)await pL(S,T,R.get(T.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:T}}}function mG(S){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:S.totalDocuments,totalBytes:S.totalBytes}}function mK(S){return{taskState:"Success",documentsLoaded:S.totalDocuments,bytesLoaded:S.totalBytes,totalDocuments:S.totalDocuments,totalBytes:S.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mW{constructor(S){this.key=S}}class mH{constructor(S){this.key=S}}class mQ{constructor(S,T){this.query=S,this._syncedDocuments=T,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=ox(),this.mutatedKeys=ox(),this.docComparator=ov(S),this.documentSet=new mR(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(S,T){let R=T?T.changeSet:new mD,N=T?T.documentSet:this.documentSet,O=T?T.mutatedKeys:this.mutatedKeys,P=N,M=!1,L="F"===this.query.limitType&&N.size===this.query.limit?N.last():null,U="L"===this.query.limitType&&N.size===this.query.limit?N.first():null;if(S.inorderTraversal((S,T)=>{let V=N.get(S),$=od(this.query,T)?T:null,K=!!V&&this.mutatedKeys.has(V.key),W=!!$&&($.hasLocalMutations||this.mutatedKeys.has($.key)&&$.hasCommittedMutations),Q=!1;V&&$?V.data.isEqual($.data)?K!==W&&(R.track({type:3,doc:$}),Q=!0):!this.shouldWaitForSyncedDocument(V,$)&&(R.track({type:2,doc:$}),Q=!0,(L&&this.docComparator($,L)>0||U&&0>this.docComparator($,U))&&(M=!0)):!V&&$?(R.track({type:0,doc:$}),Q=!0):V&&!$&&(R.track({type:1,doc:V}),Q=!0,(L||U)&&(M=!0)),Q&&($?(P=P.add($),O=W?O.add(S):O.delete(S)):(P=P.delete(S),O=O.delete(S)))}),null!==this.query.limit)for(;P.size>this.query.limit;){let S="F"===this.query.limitType?P.last():P.first();P=P.delete(S.key),O=O.delete(S.key),R.track({type:1,doc:S})}return{documentSet:P,changeSet:R,needsRefill:M,mutatedKeys:O}}shouldWaitForSyncedDocument(S,T){return S.hasLocalMutations&&T.hasCommittedMutations&&!T.hasLocalMutations}applyChanges(S,T,R,N){let O=this.documentSet;this.documentSet=S.documentSet,this.mutatedKeys=S.mutatedKeys;let P=S.changeSet.getChanges();P.sort((S,T)=>mY(S.type,T.type)||this.docComparator(S.doc,T.doc)),this.applyTargetChange(R),N=null!=N&&N;let M=T&&!N?this.updateLimboDocuments():[],L=0===this.limboDocuments.size&&this.current&&!N?1:0,U=L!==this.syncState;return(this.syncState=L,0!==P.length||U)?{snapshot:new mA(this.query,S.documentSet,O,P,S.mutatedKeys,0===L,U,!1,!!R&&R.resumeToken.approximateByteSize()>0),limboChanges:M}:{limboChanges:M}}applyOnlineStateChange(S){return this.current&&"Offline"===S?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new mD,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(S){return!this._syncedDocuments.has(S)&&!!this.documentSet.has(S)&&!this.documentSet.get(S).hasLocalMutations}applyTargetChange(S){S&&(S.addedDocuments.forEach(S=>this._syncedDocuments=this._syncedDocuments.add(S)),S.modifiedDocuments.forEach(S=>{}),S.removedDocuments.forEach(S=>this._syncedDocuments=this._syncedDocuments.delete(S)),this.current=S.current)}updateLimboDocuments(){if(!this.current)return[];let S=this.limboDocuments;this.limboDocuments=ox(),this.documentSet.forEach(S=>{this.shouldBeInLimbo(S.key)&&(this.limboDocuments=this.limboDocuments.add(S.key))});let T=[];return S.forEach(S=>{this.limboDocuments.has(S)||T.push(new mH(S))}),this.limboDocuments.forEach(R=>{S.has(R)||T.push(new mW(R))}),T}synchronizeWithPersistedState(S){this._syncedDocuments=S.remoteKeys,this.limboDocuments=ox();let T=this.computeDocChanges(S.documents);return this.applyChanges(T,!0)}computeInitialSnapshot(){return mA.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState,this.hasCachedResults)}}function mY(S,T){let R=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return t8(20277,{change:S})}};return R(S)-R(T)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mJ="SyncEngine";class mX{constructor(S,T,R){this.query=S,this.targetId=T,this.view=R}}class mZ{constructor(S){this.key=S,this.receivedDocument=!1}}class m0{constructor(S,T,R,N,O,P){this.localStore=S,this.remoteStore=T,this.eventManager=R,this.sharedClientState=N,this.currentUser=O,this.maxConcurrentLimboResolutions=P,this.syncEngineListener={},this.queryViewsByQuery=new oS(S=>ou(S),ol),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new iW(rk.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new hS,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=dz.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return!0===this._isPrimaryClient}}function m1(S,T,R,N,O,P,M){let L=new m0(S,T,R,N,O,P);return M&&(L._isPrimaryClient=!0),L}async function m2(S,T,R=!0){let N;let O=gR(S),P=O.queryViewsByQuery.get(T);return P?(O.sharedClientState.addLocalQueryTarget(P.targetId),N=P.view.computeInitialSnapshot()):N=await m4(O,T,R,!0),N}async function m3(S,T){let R=gR(S);await m4(R,T,!0,!1)}async function m4(S,T,R,N){let O;let P=await pS(S.localStore,a7(T)),M=P.targetId,L=S.sharedClientState.addLocalQueryTarget(M,R);return N&&(O=await m6(S,T,M,"current"===L,P.resumeToken)),S.isPrimaryClient&&R&&f0(S.remoteStore,P),O}async function m6(S,T,R,N,O){S.applyDocChanges=(T,R,N)=>gf(S,T,R,N);let P=await pC(S.localStore,T,!0),M=new mQ(T,P.remoteKeys),L=M.computeDocChanges(P.documents),U=lO.createSynthesizedTargetChangeForCurrentChange(R,N&&"Offline"!==S.onlineState,O),V=M.applyChanges(L,S.isPrimaryClient,U);gc(S,R,V.limboChanges);let $=new mX(T,R,M);return S.queryViewsByQuery.set(T,$),S.queriesByTarget.has(R)?S.queriesByTarget.get(R).push(T):S.queriesByTarget.set(R,[T]),V.snapshot}async function m9(S,T,R){let N=rr(S),O=N.queryViewsByQuery.get(T),P=N.queriesByTarget.get(O.targetId);if(P.length>1){N.queriesByTarget.set(O.targetId,P.filter(S=>!ol(S,T))),N.queryViewsByQuery.delete(T);return}N.isPrimaryClient?(N.sharedClientState.removeLocalQueryTarget(O.targetId),N.sharedClientState.isActiveQueryTarget(O.targetId)||await pE(N.localStore,O.targetId,!1).then(()=>{N.sharedClientState.clearQueryState(O.targetId),R&&f3(N.remoteStore,O.targetId),gl(N,O.targetId)}).catch(r8)):(gl(N,O.targetId),await pE(N.localStore,O.targetId,!0))}async function m5(S,T){let R=rr(S),N=R.queryViewsByQuery.get(T),O=R.queriesByTarget.get(N.targetId);R.isPrimaryClient&&1===O.length&&(R.sharedClientState.removeLocalQueryTarget(N.targetId),f3(R.remoteStore,N.targetId))}async function m8(S,T,R){let N=gD(S);try{let S=await pl(N.localStore,T);N.sharedClientState.addPendingMutation(S.batchId),ga(N,S.batchId,R),await gp(N,S.changes),await ml(N.remoteStore)}catch(T){let S=mI(T,"Failed to persist write");R.reject(S)}}async function m7(S,T){let R=rr(S);try{let S=await pf(R.localStore,T);T.targetChanges.forEach((S,T)=>{let N=R.activeLimboResolutionsByTarget.get(T);N&&(rt(S.addedDocuments.size+S.modifiedDocuments.size+S.removedDocuments.size<=1,22616),S.addedDocuments.size>0?N.receivedDocument=!0:S.modifiedDocuments.size>0?rt(N.receivedDocument,14607):S.removedDocuments.size>0&&(rt(N.receivedDocument,42227),N.receivedDocument=!1))}),await gp(R,S,T)}catch(S){await r8(S)}}function ge(S,T,R){let N=rr(S);if(N.isPrimaryClient&&0===R||!N.isPrimaryClient&&1===R){let S=[];N.queryViewsByQuery.forEach((R,N)=>{let O=N.view.applyOnlineStateChange(T);O.snapshot&&S.push(O.snapshot)}),mB(N.eventManager,T),S.length&&N.syncEngineListener.onWatchChange(S),N.onlineState=T,N.isPrimaryClient&&N.sharedClientState.setOnlineState(T)}}async function gt(S,T,R){let N=rr(S);N.sharedClientState.updateQueryState(T,"rejected",R);let O=N.activeLimboResolutionsByTarget.get(T),P=O&&O.key;if(P){let S=new iW(rk.comparator);S=S.insert(P,as.newNoDocument(P,r$.min()));let R=ox().add(P),O=new lN(r$.min(),new Map,new iW(rb),S,R);await m7(N,O),N.activeLimboTargetsByKey=N.activeLimboTargetsByKey.remove(P),N.activeLimboResolutionsByTarget.delete(T),gh(N)}else await pE(N.localStore,T,!1).then(()=>gl(N,T,R)).catch(r8)}async function gr(S,T){let R=rr(S),N=T.batch.batchId;try{let S=await pu(R.localStore,T);go(R,N,null),gi(R,N),R.sharedClientState.updateMutationState(N,"acknowledged"),await gp(R,S)}catch(S){await r8(S)}}async function gn(S,T,R){let N=rr(S);try{let S=await pd(N.localStore,T);go(N,T,R),gi(N,T),N.sharedClientState.updateMutationState(T,"rejected",R),await gp(N,S)}catch(S){await r8(S)}}function gi(S,T){(S.pendingWritesCallbacks.get(T)||[]).forEach(S=>{S.resolve()}),S.pendingWritesCallbacks.delete(T)}function gs(S,T){S.pendingWritesCallbacks.forEach(S=>{S.forEach(S=>{S.reject(new ri(rn.CANCELLED,T))})}),S.pendingWritesCallbacks.clear()}function ga(S,T,R){let N=S.mutationUserCallbacks[S.currentUser.toKey()];N||(N=new iW(rb)),N=N.insert(T,R),S.mutationUserCallbacks[S.currentUser.toKey()]=N}function go(S,T,R){let N=rr(S),O=N.mutationUserCallbacks[N.currentUser.toKey()];if(O){let S=O.get(T);S&&(R?S.reject(R):S.resolve(),O=O.remove(T)),N.mutationUserCallbacks[N.currentUser.toKey()]=O}}function gl(S,T,R=null){for(let N of(S.sharedClientState.removeLocalQueryTarget(T),S.queriesByTarget.get(T)))S.queryViewsByQuery.delete(N),R&&S.syncEngineListener.onWatchError(N,R);S.queriesByTarget.delete(T),S.isPrimaryClient&&S.limboDocumentRefs.removeReferencesForId(T).forEach(T=>{S.limboDocumentRefs.containsKey(T)||gu(S,T)})}function gu(S,T){S.enqueuedLimboResolutions.delete(T.path.canonicalString());let R=S.activeLimboTargetsByKey.get(T);null!==R&&(f3(S.remoteStore,R),S.activeLimboTargetsByKey=S.activeLimboTargetsByKey.remove(T),S.activeLimboResolutionsByTarget.delete(R),gh(S))}function gc(S,T,R){for(let N of R)N instanceof mW?(S.limboDocumentRefs.addReference(N.key,T),gd(S,N)):N instanceof mH?(t4(mJ,"Document no longer in limbo: "+N.key),S.limboDocumentRefs.removeReference(N.key,T),S.limboDocumentRefs.containsKey(N.key)||gu(S,N.key)):t8(19791,{limboChange:N})}function gd(S,T){let R=T.key,N=R.path.canonicalString();S.activeLimboTargetsByKey.get(R)||S.enqueuedLimboResolutions.has(N)||(t4(mJ,"New document in limbo: "+R),S.enqueuedLimboResolutions.add(N),gh(S))}function gh(S){for(;S.enqueuedLimboResolutions.size>0&&S.activeLimboTargetsByKey.size<S.maxConcurrentLimboResolutions;){let T=S.enqueuedLimboResolutions.values().next().value;S.enqueuedLimboResolutions.delete(T);let R=new rk(rR.fromString(T)),N=S.limboTargetIdGenerator.next();S.activeLimboResolutionsByTarget.set(N,new mZ(R)),S.activeLimboTargetsByKey=S.activeLimboTargetsByKey.insert(R,N),f0(S.remoteStore,new u2(a7(a2(R.path)),N,"TargetPurposeLimboResolution",nT.INVALID))}}async function gp(S,T,R){let N=rr(S),O=[],P=[],M=[];N.queryViewsByQuery.isEmpty()||(N.queryViewsByQuery.forEach((S,L)=>{M.push(N.applyDocChanges(L,T,R).then(S=>{var T;if((S||R)&&N.isPrimaryClient){let O=S?!S.fromCache:null===(T=null==R?void 0:R.targetChanges.get(L.targetId))||void 0===T?void 0:T.current;N.sharedClientState.updateQueryState(L.targetId,O?"current":"not-current")}if(S){O.push(S);let T=mz.fromSnapshot(L.targetId,S);P.push(T)}}))}),await Promise.all(M),N.syncEngineListener.onWatchChange(O),await py(N.localStore,P))}async function gf(S,T,R,N){let O=T.view.computeDocChanges(R);O.needsRefill&&(O=await pC(S.localStore,T.query,!1).then(({documents:S})=>T.view.computeDocChanges(S,O)));let P=N&&N.targetChanges.get(T.targetId),M=N&&null!=N.targetMismatches.get(T.targetId),L=T.view.applyChanges(O,S.isPrimaryClient,P,M);return gc(S,T.targetId,L.limboChanges),L.snapshot}async function gm(S,T){let R=rr(S);if(!R.currentUser.isEqual(T)){t4(mJ,"User change. New user:",T.toKey());let S=await po(R.localStore,T);R.currentUser=T,gs(R,"'waitForPendingWrites' promise is rejected due to a user change."),R.sharedClientState.handleUserChange(T,S.removedBatchIds,S.addedBatchIds),await gp(R,S.affectedDocuments)}}function gg(S,T){let R=rr(S),N=R.activeLimboResolutionsByTarget.get(T);if(N&&N.receivedDocument)return ox().add(N.key);{let S=ox(),N=R.queriesByTarget.get(T);if(!N)return S;for(let T of N){let N=R.queryViewsByQuery.get(T);S=S.unionWith(N.view.syncedDocuments)}return S}}async function gy(S,T){let R=rr(S),N=await pC(R.localStore,T.query,!0),O=T.view.synchronizeWithPersistedState(N);return R.isPrimaryClient&&gc(R,T.targetId,O.limboChanges),O}async function gv(S,T){let R=rr(S);return pA(R.localStore,T).then(S=>gp(R,S))}async function gb(S,T,R,N){let O=rr(S),P=await p_(O.localStore,T);if(null===P){t4(mJ,"Cannot apply mutation batch with id: "+T);return}"pending"===R?await ml(O.remoteStore):"acknowledged"===R||"rejected"===R?(go(O,T,N||null),gi(O,T),pI(O.localStore,T)):t8(6720,"Unknown batchState",{batchState:R}),await gp(O,P)}async function gS(S,T){let R=rr(S);if(gR(R),gD(R),!0===T&&!0!==R._isPrimaryClient){let S=R.sharedClientState.getAllActiveQueryTargets(),T=await gE(R,S.toArray());for(let S of(R._isPrimaryClient=!0,await mT(R.remoteStore,!0),T))f0(R.remoteStore,S)}else if(!1===T&&!1!==R._isPrimaryClient){let S=[],T=Promise.resolve();R.queriesByTarget.forEach((N,O)=>{R.sharedClientState.isLocalQueryTarget(O)?S.push(O):T=T.then(()=>(gl(R,O),pE(R.localStore,O,!0))),f3(R.remoteStore,O)}),await T,await gE(R,S),gT(R),R._isPrimaryClient=!1,await mT(R.remoteStore,!1)}}function gT(S){let T=rr(S);T.activeLimboResolutionsByTarget.forEach((S,R)=>{f3(T.remoteStore,R)}),T.limboDocumentRefs.removeAllReferences(),T.activeLimboResolutionsByTarget=new Map,T.activeLimboTargetsByKey=new iW(rk.comparator)}async function gE(S,T,R){let N=rr(S),O=[],P=[];for(let S of T){let T;let R=N.queriesByTarget.get(S);if(R&&0!==R.length)for(let S of(T=await pS(N.localStore,a7(R[0])),R)){let T=N.queryViewsByQuery.get(S),R=await gy(N,T);R.snapshot&&P.push(R.snapshot)}else{let R=await pD(N.localStore,S);T=await pS(N.localStore,R),await m6(N,gC(R),S,!1,T.resumeToken)}O.push(T)}return N.syncEngineListener.onWatchChange(P),O}function gC(S){return a1(S.path,S.collectionGroup,S.orderBy,S.filters,S.limit,"F",S.startAt,S.endAt)}function gw(S){return pR(rr(S).localStore)}async function g_(S,T,R,N){let O=rr(S);if(O._isPrimaryClient){t4(mJ,"Ignoring unexpected query state notification.");return}let P=O.queriesByTarget.get(T);if(P&&P.length>0)switch(R){case"current":case"not-current":{let S=await pA(O.localStore,oy(P[0])),N=lN.createSynthesizedRemoteEventForCurrentChange(T,"current"===R,i4.EMPTY_BYTE_STRING);await gp(O,S,N);break}case"rejected":await pE(O.localStore,T,!0),gl(O,T,N);break;default:t8(64155,R)}}async function gI(S,T,R){let N=gR(S);if(N._isPrimaryClient){for(let S of T){if(N.queriesByTarget.has(S)&&N.sharedClientState.isActiveQueryTarget(S)){t4(mJ,"Adding an already active target "+S);continue}let T=await pD(N.localStore,S),R=await pS(N.localStore,T);await m6(N,gC(T),R.targetId,!1,R.resumeToken),f0(N.remoteStore,R)}for(let S of R)N.queriesByTarget.has(S)&&await pE(N.localStore,S,!1).then(()=>{f3(N.remoteStore,S),gl(N,S)}).catch(r8)}}function gR(S){let T=rr(S);return T.remoteStore.remoteSyncer.applyRemoteEvent=m7.bind(null,T),T.remoteStore.remoteSyncer.getRemoteKeysForTarget=gg.bind(null,T),T.remoteStore.remoteSyncer.rejectListen=gt.bind(null,T),T.syncEngineListener.onWatchChange=mL.bind(null,T.eventManager),T.syncEngineListener.onWatchError=mF.bind(null,T.eventManager),T}function gD(S){let T=rr(S);return T.remoteStore.remoteSyncer.applySuccessfulWrite=gr.bind(null,T),T.remoteStore.remoteSyncer.rejectFailedWrite=gn.bind(null,T),T}function gA(S,T,R){let N=rr(S);gk(N,T,R).then(S=>{N.sharedClientState.notifyBundleLoaded(S)})}async function gk(S,T,R){try{let N=await T.getMetadata();if(await px(S.localStore,N))return await T.close(),R._completeWith(mK(N)),Promise.resolve(new Set);R._updateProgress(mG(N));let O=new m$(N,T.serializer),P=await T.nextElement();for(;P;){let S=await O.addSizedElement(P);S&&R._updateProgress(S),P=await T.nextElement()}let M=await O.completeAndStoreAsync(S.localStore);return await gp(S,M.changedDocs,void 0),await pP(S.localStore,N),R._completeWith(M.progress),Promise.resolve(M.changedCollectionGroups)}catch(S){return t9(mJ,`Loading bundle failed with ${S}`),R._failWith(S),Promise.resolve(new Set)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gN{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(S){this.serializer=fC(S.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(S),this.persistence=this.createPersistence(S),await this.persistence.start(),this.localStore=this.createLocalStore(S),this.gcScheduler=this.createGarbageCollectionScheduler(S,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(S,this.localStore)}createGarbageCollectionScheduler(S,T){return null}createIndexBackfillerScheduler(S,T){return null}createLocalStore(S){return pa(this.persistence,new pV,S.initialUser,this.serializer)}createPersistence(S){return new hk(hO.factory,this.serializer)}createSharedClientState(S){return new fe}async terminate(){var S,T;null===(S=this.gcScheduler)||void 0===S||S.stop(),null===(T=this.indexBackfillerScheduler)||void 0===T||T.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}gN.provider={build:()=>new gN};class gO extends gN{constructor(S){super(),this.cacheSizeBytes=S}createGarbageCollectionScheduler(S,T){return rt(this.persistence.referenceDelegate instanceof hx,46915),new d6(this.persistence.referenceDelegate.garbageCollector,S.asyncQueue,T)}createPersistence(S){let T=void 0!==this.cacheSizeBytes?dY.withCacheSize(this.cacheSizeBytes):dY.DEFAULT;return new hk(S=>hx.factory(S,T),this.serializer)}}class gx extends null{constructor(S,T,R){super(),this.onlineComponentProvider=S,this.cacheSizeBytes=T,this.forceOwnership=R,this.kind="persistent",this.synchronizeTabs=!1}async initialize(S){await super.initialize(S),await this.onlineComponentProvider.initialize(this,S),await gD(this.onlineComponentProvider.syncEngine),await ml(this.onlineComponentProvider.remoteStore),await this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(S){return pa(this.persistence,new pV,S.initialUser,this.serializer)}createGarbageCollectionScheduler(S,T){return new d6(this.persistence.referenceDelegate.garbageCollector,S.asyncQueue,T)}createIndexBackfillerScheduler(S,T){let R=new nS(T,this.persistence);return new nb(S.asyncQueue,R)}createPersistence(S){let T=pe(S.databaseInfo.databaseId,S.databaseInfo.persistenceKey),R=void 0!==this.cacheSizeBytes?dY.withCacheSize(this.cacheSizeBytes):dY.DEFAULT;return new h5(this.synchronizeTabs,T,S.clientId,R,S.asyncQueue,fT(),fE(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(S){return new fe}}class gP{async initialize(S,T){this.localStore||(this.localStore=S.localStore,this.sharedClientState=S.sharedClientState,this.datastore=this.createDatastore(T),this.remoteStore=this.createRemoteStore(T),this.eventManager=this.createEventManager(T),this.syncEngine=this.createSyncEngine(T,!S.synchronizeTabs),this.sharedClientState.onlineStateHandler=S=>ge(this.syncEngine,S,1),this.remoteStore.remoteSyncer.handleCredentialChange=gm.bind(null,this.syncEngine),await mT(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(S){return mN()}createDatastore(S){let T=fC(S.databaseInfo.databaseId),R=fb(S.databaseInfo);return fF(S.authCredentials,S.appCheckCredentials,R,T)}createRemoteStore(S){return fY(this.localStore,this.datastore,S.asyncQueue,S=>ge(this.syncEngine,S,0),fS())}createSyncEngine(S,T){return m1(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,S.initialUser,S.maxConcurrentLimboResolutions,T)}async terminate(){var S,T;await fZ(this.remoteStore),null===(S=this.datastore)||void 0===S||S.terminate(),null===(T=this.eventManager)||void 0===T||T.terminate()}}gP.provider={build:()=>new gP};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gM=10240;function gL(S,T=gM){let R=0;return{async read(){if(R<S.byteLength){let N={value:S.slice(R,R+T),done:!1};return R+=T,N}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gF(S,T){if(!(S instanceof Uint8Array))throw new ri(rn.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${rL(S)}`);return gL(S,T)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gB{constructor(S){this.observer=S,this.muted=!1}next(S){!this.muted&&this.observer.next&&this.scheduleEvent(this.observer.next,S)}error(S){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,S):t6("Uncaught Error in snapshot listener:",S.toString()))}mute(){this.muted=!0}scheduleEvent(S,T){setTimeout(()=>{this.muted||S(T)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gj{constructor(S,T){this.payload=S,this.byteLength=T}isBundleMetadata(){return"metadata"in this.payload}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gU{constructor(S,T){this.reader=S,this.serializer=T,this.metadata=new rs,this.buffer=new Uint8Array,this.textDecoder=ry(),this.nextElementImpl().then(S=>{S&&S.isBundleMetadata()?this.metadata.resolve(S.payload.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(null==S?void 0:S.payload)}`))},S=>this.metadata.reject(S))}close(){return this.reader.cancel()}async getMetadata(){return this.metadata.promise}async nextElement(){return await this.getMetadata(),this.nextElementImpl()}async nextElementImpl(){let S=await this.readLength();if(null===S)return null;let T=this.textDecoder.decode(S),R=Number(T);return isNaN(R)&&this.raiseError(`length string (${T}) is not valid number`),new gj(JSON.parse(await this.readJsonString(R)),S.length+R)}indexOfOpenBracket(){return this.buffer.findIndex(S=>123===S)}async readLength(){for(;0>this.indexOfOpenBracket()&&!await this.pullMoreDataToBuffer(););if(0===this.buffer.length)return null;let S=this.indexOfOpenBracket();S<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let T=this.buffer.slice(0,S);return this.buffer=this.buffer.slice(S),T}async readJsonString(S){for(;this.buffer.length<S;)await this.pullMoreDataToBuffer()&&this.raiseError("Reached the end of bundle when more is expected.");let T=this.textDecoder.decode(this.buffer.slice(0,S));return this.buffer=this.buffer.slice(S),T}raiseError(S){throw this.reader.cancel(),Error(`Invalid bundle format: ${S}`)}async pullMoreDataToBuffer(){let S=await this.reader.read();if(!S.done){let T=new Uint8Array(this.buffer.length+S.value.length);T.set(this.buffer),T.set(S.value,this.buffer.length),this.buffer=T}return S.done}}function gV(S,T){return new gU(S,T)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gz{constructor(S,T){this.bundleData=S,this.serializer=T,this.cursor=0,this.elements=[];let R=this.nextElement();if(R&&R.isBundleMetadata())this.metadata=R;else throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(null==R?void 0:R.payload)}`);do null!==(R=this.nextElement())&&this.elements.push(R);while(null!==R)}getMetadata(){return this.metadata}getElements(){return this.elements}nextElement(){if(this.cursor===this.bundleData.length)return null;let S=this.readLength();return new gj(JSON.parse(this.readJsonString(S)),S)}readJsonString(S){if(this.cursor+S>this.bundleData.length)throw new ri(rn.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=S)}readLength(){let S=this.cursor,T=this.cursor;for(;T<this.bundleData.length;){if("{"===this.bundleData[T]){if(T===S)throw Error("First character is a bracket and not a number");return this.cursor=T,Number(this.bundleData.slice(S,T))}T++}throw Error("Reached the end of bundle when more is expected.")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gq{constructor(S){this.datastore=S,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(S){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new ri(rn.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let T=await fj(this.datastore,S);return T.forEach(S=>this.recordVersion(S)),T}set(S,T){this.write(T.toMutation(S,this.precondition(S))),this.writtenDocs.add(S.toString())}update(S,T){try{this.write(T.toMutation(S,this.preconditionForUpdate(S)))}catch(S){this.lastTransactionError=S}this.writtenDocs.add(S.toString())}delete(S){this.write(new lh(S,this.precondition(S))),this.writtenDocs.add(S.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let S=this.readVersions;this.mutations.forEach(T=>{S.delete(T.key.toString())}),S.forEach((S,T)=>{let R=rk.fromPath(T);this.mutations.push(new lm(R,this.precondition(R)))}),await fB(this.datastore,this.mutations),this.committed=!0}recordVersion(S){let T;if(S.isFoundDocument())T=S.version;else if(S.isNoDocument())T=r$.min();else throw t8(50498,{documentName:S.constructor.name});let R=this.readVersions.get(S.key.toString());if(R){if(!T.isEqual(R))throw new ri(rn.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(S.key.toString(),T)}precondition(S){let T=this.readVersions.get(S.toString());return this.writtenDocs.has(S.toString())||!T?o3.none():T.isEqual(r$.min())?o3.exists(!1):o3.updateTime(T)}preconditionForUpdate(S){let T=this.readVersions.get(S.toString());if(this.writtenDocs.has(S.toString())||!T)return o3.exists(!0);if(T.isEqual(r$.min()))throw new ri(rn.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return o3.updateTime(T)}write(S){this.ensureCommitNotCalled(),this.mutations.push(S)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let g$="FirestoreClient",gG=100,gK=11,gW=20,gH=22;class gQ{constructor(S,T,R,N,O){this.authCredentials=S,this.appCheckCredentials=T,this.asyncQueue=R,this.databaseInfo=N,this.user=tX.UNAUTHENTICATED,this.clientId=rv.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=O,this.authCredentials.start(R,async S=>{t4(g$,"Received user=",S.uid),await this.authCredentialListener(S),this.user=S}),this.appCheckCredentials.start(R,S=>(t4(g$,"Received new app check token=",S),this.appCheckCredentialListener(S,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:gG}}setCredentialChangeListener(S){this.authCredentialListener=S}setAppCheckTokenChangeListener(S){this.appCheckCredentialListener=S}terminate(){this.asyncQueue.enterRestrictedMode();let S=new rs;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),S.resolve()}catch(R){let T=mI(R,"Failed to shutdown persistence");S.reject(T)}}),S.promise}}async function gY(S,T){S.asyncQueue.verifyOperationInProgress(),t4(g$,"Initializing OfflineComponentProvider");let R=S.configuration;await T.initialize(R);let N=R.initialUser;S.setCredentialChangeListener(async S=>{N.isEqual(S)||(await po(T.localStore,S),N=S)}),T.persistence.setDatabaseDeletedListener(()=>{t9("Terminating Firestore due to IndexedDb database deletion"),S.terminate().then(()=>{t4("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(S=>{t9("Terminating Firestore due to IndexedDb database deletion failed",S)})}),S._offlineComponents=T}async function gJ(S,T){S.asyncQueue.verifyOperationInProgress();let R=await gZ(S);t4(g$,"Initializing OnlineComponentProvider"),await T.initialize(R,S.configuration),S.setCredentialChangeListener(S=>mS(T.remoteStore,S)),S.setAppCheckTokenChangeListener((S,R)=>mS(T.remoteStore,R)),S._onlineComponents=T}function gX(S){return"FirebaseError"===S.name?S.code===rn.FAILED_PRECONDITION||S.code===rn.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&S instanceof DOMException)||S.code===gH||S.code===gW||S.code===gK}async function gZ(S){if(!S._offlineComponents){if(S._uninitializedComponentsProvider){t4(g$,"Using user provided OfflineComponentProvider");try{await gY(S,S._uninitializedComponentsProvider._offline)}catch(R){let T=R;if(!gX(T))throw T;t9("Error using user provided cache. Falling back to memory cache: "+T),await gY(S,new gN)}}else t4(g$,"Using default OfflineComponentProvider"),await gY(S,new gO(void 0))}return S._offlineComponents}async function g0(S){return S._onlineComponents||(S._uninitializedComponentsProvider?(t4(g$,"Using user provided OnlineComponentProvider"),await gJ(S,S._uninitializedComponentsProvider._online)):(t4(g$,"Using default OnlineComponentProvider"),await gJ(S,new gP))),S._onlineComponents}function g1(S){return gZ(S).then(S=>S.localStore)}function g2(S){return g0(S).then(S=>S.syncEngine)}function g3(S){return g0(S).then(S=>S.datastore)}async function g4(S){let T=await g0(S),R=T.eventManager;return R.onListen=m2.bind(null,T.syncEngine),R.onUnlisten=m9.bind(null,T.syncEngine),R.onFirstRemoteStoreListen=m3.bind(null,T.syncEngine),R.onLastRemoteStoreUnlisten=m5.bind(null,T.syncEngine),R}function g6(S,T,R,N){let O=new gB(N),P=new mV(T,O,R);return S.asyncQueue.enqueueAndForget(async()=>mP(await g4(S),P)),()=>{O.mute(),S.asyncQueue.enqueueAndForget(async()=>mM(await g4(S),P))}}function g9(S,T,R={}){let N=new rs;return S.asyncQueue.enqueueAndForget(async()=>g8(await g4(S),S.asyncQueue,T,R,N)),N.promise}function g5(S,T){let R=new rs;return S.asyncQueue.enqueueAndForget(async()=>m8(await g2(S),T,R)),R.promise}function g8(S,T,R,N,O){let P=new gB({next:R=>{P.mute(),T.enqueueAndForget(()=>mM(S,M)),R.fromCache&&"server"===N.source?O.reject(new ri(rn.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):O.resolve(R)},error:S=>O.reject(S)}),M=new mV(R,P,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return mP(S,M)}function g7(S,T,R,N){let O=yt(R,fC(T));S.asyncQueue.enqueueAndForget(async()=>{gA(await g2(S),O,N)})}function ye(S,T){return S.asyncQueue.enqueue(async()=>pM(await g1(S),T))}function yt(S,T){let R;return gV(gF(R="string"==typeof S?rg().encode(S):S),T)}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yr(S,T){return S.timeoutSeconds===T.timeoutSeconds}function yn(S){let T={};return void 0!==S.timeoutSeconds&&(T.timeoutSeconds=S.timeoutSeconds),T}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yi="ComponentProvider",ys=new Map;function ya(S){let T=ys.get(S);T&&(t4(yi,"Removing Datastore"),ys.delete(S),T.terminate())}function yo(S,T,R,N){return new su(S,T,R,N.host,N.ssl,N.experimentalForceLongPolling,N.experimentalAutoDetectLongPolling,yn(N.experimentalLongPollingOptions),N.useFetchStreams,N.isUsingEmulator)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yl="firestore.googleapis.com",yu=!0,yc=5,yd=30,yh=!0;class yp{constructor(S){var T,R;if(void 0===S.host){if(void 0!==S.ssl)throw new ri(rn.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=yl,this.ssl=yu}else this.host=S.host,this.ssl=null!==(T=S.ssl)&&void 0!==T?T:yu;if(this.isUsingEmulator=void 0!==S.emulatorOptions,this.credentials=S.credentials,this.ignoreUndefinedProperties=!!S.ignoreUndefinedProperties,this.localCache=S.localCache,void 0===S.cacheSizeBytes)this.cacheSizeBytes=dQ;else{if(S.cacheSizeBytes!==dH&&S.cacheSizeBytes<dX)throw new ri(rn.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${dX}`);this.cacheSizeBytes=S.cacheSizeBytes}rO("experimentalForceLongPolling",S.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",S.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!S.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===S.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=yh:this.experimentalAutoDetectLongPolling=!!S.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=yn(null!==(R=S.experimentalLongPollingOptions)&&void 0!==R?R:{}),yf(this.experimentalLongPollingOptions),this.useFetchStreams=!!S.useFetchStreams}isEqual(S){return this.host===S.host&&this.ssl===S.ssl&&this.credentials===S.credentials&&this.cacheSizeBytes===S.cacheSizeBytes&&this.experimentalForceLongPolling===S.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===S.experimentalAutoDetectLongPolling&&yr(this.experimentalLongPollingOptions,S.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===S.ignoreUndefinedProperties&&this.useFetchStreams===S.useFetchStreams}}function yf(S){if(void 0!==S.timeoutSeconds){if(isNaN(S.timeoutSeconds))throw new ri(rn.INVALID_ARGUMENT,`invalid long polling timeout: ${S.timeoutSeconds} (must not be NaN)`);if(S.timeoutSeconds<yc)throw new ri(rn.INVALID_ARGUMENT,`invalid long polling timeout: ${S.timeoutSeconds} (minimum allowed value is ${yc})`);if(S.timeoutSeconds>yd)throw new ri(rn.INVALID_ARGUMENT,`invalid long polling timeout: ${S.timeoutSeconds} (maximum allowed value is ${yd})`)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ym{constructor(S,T,R,N){this._authCredentials=S,this._appCheckCredentials=T,this._databaseId=R,this._app=N,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new yp({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ri(rn.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(S){if(this._settingsFrozen)throw new ri(rn.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new yp(S),this._emulatorOptions=S.emulatorOptions||{},void 0!==S.credentials&&(this._authCredentials=rf(S.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return ya(this),Promise.resolve()}}function yg(S,T,R,N={}){var O;S=rB(S,ym);let P=ey(T),M=S._getSettings(),L=Object.assign(Object.assign({},M),{emulatorOptions:S._getEmulatorOptions()}),U=`${T}:${R}`;P&&(ev(`https://${U}`),eS("Firestore",!0)),M.host!==yl&&M.host!==U&&t9("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let V=Object.assign(Object.assign({},M),{host:U,ssl:P,emulatorOptions:N});if(!eN(V,L)&&(S._setSettings(V),N.mockUserToken)){let T,R;if("string"==typeof N.mockUserToken)T=N.mockUserToken,R=tX.MOCK_USER;else{T=eb(N.mockUserToken,null===(O=S._app)||void 0===O?void 0:O.options.projectId);let P=N.mockUserToken.sub||N.mockUserToken.user_id;if(!P)throw new ri(rn.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");R=new tX(P)}S._authCredentials=new rl(new ra(T,R))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yy{constructor(S,T,R){this.converter=T,this._query=R,this.type="query",this.firestore=S}withConverter(S){return new yy(this.firestore,S,this._query)}}class yv{constructor(S,T,R){this.converter=T,this._key=R,this.type="document",this.firestore=S}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new yb(this.firestore,this.converter,this._key.path.popLast())}withConverter(S){return new yv(this.firestore,S,this._key)}toJSON(){return{type:yv._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(S,T,R){if(rU(T,yv._jsonSchema))return new yv(S,R||null,new rk(rR.fromString(T.referencePath)))}}yv._jsonSchemaVersion="firestore/documentReference/1.0",yv._jsonSchema={type:rj("string",yv._jsonSchemaVersion),referencePath:rj("string")};class yb extends yy{constructor(S,T,R){super(S,T,a2(R)),this._path=R,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let S=this._path.popLast();return S.isEmpty()?null:new yv(this.firestore,null,new rk(S))}withConverter(S){return new yb(this.firestore,S,this._path)}}function yS(S,T,...R){if(S=ex(S),rN("collection","path",T),S instanceof ym){let N=rR.fromString(T,...R);return rP(N),new yb(S,null,N)}{if(!(S instanceof yv)&&!(S instanceof yb))throw new ri(rn.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let N=S._path.child(rR.fromString(T,...R));return rP(N),new yb(S.firestore,null,N)}}function yT(S,T,...R){if(S=ex(S),1==arguments.length&&(T=rv.newId()),rN("doc","path",T),S instanceof ym){let N=rR.fromString(T,...R);return rx(N),new yv(S,null,new rk(N))}{if(!(S instanceof yv)&&!(S instanceof yb))throw new ri(rn.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let N=S._path.child(rR.fromString(T,...R));return rx(N),new yv(S.firestore,S instanceof yb?S.converter:null,new rk(N))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yE="AsyncQueue";class yC{constructor(S=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new fD(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=S}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(S){this.enqueue(S)}enqueueAndForgetEvenWhileRestricted(S){this.verifyNotFailed(),this.enqueueInternal(S)}enterRestrictedMode(S){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=S||!1)}enqueue(S){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let T=new rs;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(S().then(T.resolve,T.reject),T.promise)).then(()=>T.promise)}enqueueRetryable(S){this.enqueueAndForget(()=>(this.retryableOps.push(S),this.retryNextOp()))}async retryNextOp(){if(0!==this.retryableOps.length){try{await this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(S){if(nc(S))t4(yE,"Operation failed with retryable error: "+S);else throw S}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}}enqueueInternal(S){let T=this.tail.then(()=>(this.operationInProgress=!0,S().catch(S=>{throw this.failure=S,this.operationInProgress=!1,t6("INTERNAL UNHANDLED ERROR: ",yw(S)),S}).then(S=>(this.operationInProgress=!1,S))));return this.tail=T,T}enqueueAfterDelay(S,T,R){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(S)>-1&&(T=0);let N=m_.createAndSchedule(this,S,T,R,S=>this.removeDelayedOperation(S));return this.delayedOperations.push(N),N}verifyNotFailed(){this.failure&&t8(47125,{messageOrStack:yw(this.failure)})}verifyOperationInProgress(){}async drain(){let S;do S=this.tail,await S;while(S!==this.tail)}containsDelayedOperation(S){for(let T of this.delayedOperations)if(T.timerId===S)return!0;return!1}runAllDelayedOperationsUntil(S){return this.drain().then(()=>{for(let T of(this.delayedOperations.sort((S,T)=>S.targetTimeMs-T.targetTimeMs),this.delayedOperations))if(T.skipDelay(),"all"!==S&&T.timerId===S)break;return this.drain()})}skipDelaysForTimerId(S){this.timerIdsToSkip.push(S)}removeDelayedOperation(S){let T=this.delayedOperations.indexOf(S);this.delayedOperations.splice(T,1)}}function yw(S){let T=S.message||"";return S.stack&&(T=S.stack.includes(S.message)?S.stack:S.message+"\n"+S.stack),T}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y_{constructor(){this._progressObserver={},this._taskCompletionResolver=new rs,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(S,T,R){this._progressObserver={next:S,error:T,complete:R}}catch(S){return this._taskCompletionResolver.promise.catch(S)}then(S,T){return this._taskCompletionResolver.promise.then(S,T)}_completeWith(S){this._updateProgress(S),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(S)}_failWith(S){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(S),this._taskCompletionResolver.reject(S)}_updateProgress(S){this._lastProgress=S,this._progressObserver.next&&this._progressObserver.next(S)}}class yI extends ym{constructor(S,T,R,N){super(S,T,R,N),this.type="firestore",this._queue=new yC,this._persistenceKey=(null==N?void 0:N.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let S=this._firestoreClient.terminate();this._queue=new yC(S),this._firestoreClient=void 0,await S}}}function yR(S,T){let R="object"==typeof S?S:tw(),N="string"==typeof S?S:T||sc,O=tv(R,"firestore").getImmediate({identifier:N});if(!O._initialized){let S=ef("firestore");S&&yg(O,...S)}return O}function yD(S){if(S._terminated)throw new ri(rn.FAILED_PRECONDITION,"The client has already been terminated.");return S._firestoreClient||yA(S),S._firestoreClient}function yA(S){var T,R,N;let O=S._freezeSettings(),P=yo(S._databaseId,(null===(T=S._app)||void 0===T?void 0:T.options.appId)||"",S._persistenceKey,O);!S._componentsProvider&&(null===(R=O.localCache)||void 0===R?void 0:R._offlineComponentProvider)&&(null===(N=O.localCache)||void 0===N?void 0:N._onlineComponentProvider)&&(S._componentsProvider={_offline:O.localCache._offlineComponentProvider,_online:O.localCache._onlineComponentProvider}),S._firestoreClient=new gQ(S._authCredentials,S._appCheckCredentials,S._queue,P,S._componentsProvider&&yk(S._componentsProvider))}function yk(S){let T=null==S?void 0:S._online.build();return{_offline:null==S?void 0:S._offline.build(T),_online:T}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yN(S,T=!0){t0(tE),ty(new eP("firestore",(S,{instanceIdentifier:R,options:N})=>{let O=S.getProvider("app").getImmediate(),P=new yI(new ru(S.getProvider("auth-internal")),new rp(O,S.getProvider("app-check-internal")),sh(O,R),O);return N=Object.assign({useFetchStreams:T},N),P._setSettings(N),P},"PUBLIC").setMultipleInstances(!0)),tI(tY,tJ,S),tI(tY,tJ,"esm2017")}class yO{constructor(S,T,R){this._userDataWriter=T,this._data=R,this.type="AggregateQuerySnapshot",this.query=S}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yx{constructor(S){this._byteString=S}static fromBase64String(S){try{return new yx(i4.fromBase64String(S))}catch(S){throw new ri(rn.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+S)}}static fromUint8Array(S){return new yx(i4.fromUint8Array(S))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(S){return this._byteString.isEqual(S._byteString)}toJSON(){return{type:yx._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(S){if(rU(S,yx._jsonSchema))return yx.fromBase64String(S.bytes)}}yx._jsonSchemaVersion="firestore/bytes/1.0",yx._jsonSchema={type:rj("string",yx._jsonSchemaVersion),bytes:rj("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yP{constructor(...S){for(let T=0;T<S.length;++T)if(0===S[T].length)throw new ri(rn.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new rA(S)}isEqual(S){return this._internalPath.isEqual(S._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yM{constructor(S){this._methodName=S}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yL{constructor(S,T){if(!isFinite(S)||S<-90||S>90)throw new ri(rn.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+S);if(!isFinite(T)||T<-180||T>180)throw new ri(rn.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+T);this._lat=S,this._long=T}get latitude(){return this._lat}get longitude(){return this._long}isEqual(S){return this._lat===S._lat&&this._long===S._long}_compareTo(S){return rb(this._lat,S._lat)||rb(this._long,S._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:yL._jsonSchemaVersion}}static fromJSON(S){if(rU(S,yL._jsonSchema))return new yL(S.latitude,S.longitude)}}yL._jsonSchemaVersion="firestore/geoPoint/1.0",yL._jsonSchema={type:rj("string",yL._jsonSchemaVersion),latitude:rj("number"),longitude:rj("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yF{constructor(S){this._values=(S||[]).map(S=>S)}toArray(){return this._values.map(S=>S)}isEqual(S){return pr(this._values,S._values)}toJSON(){return{type:yF._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(S){if(rU(S,yF._jsonSchema)){if(Array.isArray(S.vectorValues)&&S.vectorValues.every(S=>"number"==typeof S))return new yF(S.vectorValues);throw new ri(rn.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}yF._jsonSchemaVersion="firestore/vectorValue/1.0",yF._jsonSchema={type:rj("string",yF._jsonSchemaVersion),vectorValues:rj("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yB=/^__.*__$/;class yj{constructor(S,T,R){this.data=S,this.fieldMask=T,this.fieldTransforms=R}toMutation(S,T){return null!==this.fieldMask?new ls(S,this.data,this.fieldMask,T,this.fieldTransforms):new lr(S,this.data,T,this.fieldTransforms)}}class yU{constructor(S,T,R){this.data=S,this.fieldMask=T,this.fieldTransforms=R}toMutation(S,T){return new ls(S,this.data,this.fieldMask,T,this.fieldTransforms)}}function yV(S){switch(S){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw t8(40011,{dataSource:S})}}class yz{constructor(S,T,R,N,O,P){this.settings=S,this.databaseId=T,this.serializer=R,this.ignoreUndefinedProperties=N,void 0===O&&this.validatePath(),this.fieldTransforms=O||[],this.fieldMask=P||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(S){return new yz(Object.assign(Object.assign({},this.settings),S),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(S){var T;let R=null===(T=this.path)||void 0===T?void 0:T.child(S),N=this.contextWith({path:R,arrayElement:!1});return N.validatePathSegment(S),N}childContextForFieldPath(S){var T;let R=null===(T=this.path)||void 0===T?void 0:T.child(S),N=this.contextWith({path:R,arrayElement:!1});return N.validatePath(),N}childContextForArray(S){return this.contextWith({path:void 0,arrayElement:!0})}createError(S){return vr(S,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(S){return void 0!==this.fieldMask.find(T=>S.isPrefixOf(T))||void 0!==this.fieldTransforms.find(T=>S.isPrefixOf(T.field))}validatePath(){if(this.path)for(let S=0;S<this.path.length;S++)this.validatePathSegment(this.path.get(S))}validatePathSegment(S){if(0===S.length)throw this.createError("Document fields must not be empty");if(yV(this.dataSource)&&yB.test(S))throw this.createError('Document fields cannot begin and end with "__"')}}class yq{constructor(S,T,R){this.databaseId=S,this.ignoreUndefinedProperties=T,this.serializer=R||fC(S)}createContext(S,T,R,N=!1){return new yz({dataSource:S,methodName:T,targetDoc:R,path:rA.emptyPath(),arrayElement:!1,hasConverter:N},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function y$(S){let T=S._freezeSettings(),R=fC(S._databaseId);return new yq(S._databaseId,!!T.ignoreUndefinedProperties,R)}function yG(S,T,R,N,O,P={}){let M,L;let U=S.createContext(P.merge||P.mergeFields?2:0,T,R,O);y8("Data must be an object, but it was:",U,N);let V=y2(N,U);if(P.merge)M=new i1(U.fieldMask),L=U.fieldTransforms;else if(P.mergeFields){let S=[];for(let N of P.mergeFields){let O=y7(T,N,R);if(!U.contains(O))throw new ri(rn.INVALID_ARGUMENT,`Field '${O}' is specified in your field mask but missing from your input data.`);vn(S,O)||S.push(O)}M=new i1(S),L=U.fieldTransforms.filter(S=>M.covers(S.field))}else M=null,L=U.fieldTransforms;return new yj(new an(V),M,L)}class yK extends yM{_toFieldTransform(S){if(2===S.dataSource)S.fieldMask.push(S.path);else if(1===S.dataSource)throw S.createError(`${this._methodName}() can only appear at the top level of your update data`);else throw S.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(S){return S instanceof yK}}function yW(S,T,R){return new yz({dataSource:3,targetDoc:T.settings.targetDoc,methodName:S._methodName,arrayElement:R},T.databaseId,T.serializer,T.ignoreUndefinedProperties)}class yH extends yM{_toFieldTransform(S){return new oZ(S.path,new o$)}isEqual(S){return S instanceof yH}}class yQ extends null{constructor(S,T){super(S),this._elements=T}_toFieldTransform(S){let T=yW(this,S,!0),R=new oG(this._elements.map(S=>y1(S,T)));return new oZ(S.path,R)}isEqual(S){return S instanceof yQ&&deepEqual(this._elements,S._elements)}}class yY extends null{constructor(S,T){super(S),this._elements=T}_toFieldTransform(S){let T=yW(this,S,!0),R=new oW(this._elements.map(S=>y1(S,T)));return new oZ(S.path,R)}isEqual(S){return S instanceof yY&&deepEqual(this._elements,S._elements)}}class yJ extends null{constructor(S,T){super(S),this._operand=T}_toFieldTransform(S){let T=new oQ(S.serializer,oB(S.serializer,this._operand));return new oZ(S.path,T)}isEqual(S){return S instanceof yJ&&this._operand===S._operand}}function yX(S,T,R,N){let O=S.createContext(1,T,R);y8("Data must be an object, but it was:",O,N);let P=[],M=an.empty();return iG(N,(S,N)=>{let L=vt(T,S,R);N=ex(N);let U=O.childContextForFieldPath(L);if(N instanceof yK)P.push(L);else{let S=y1(N,U);null!=S&&(P.push(L),M.set(L,S))}}),new yU(M,new i1(P),O.fieldTransforms)}function yZ(S,T,R,N,O,P){let M=S.createContext(1,T,R),L=[y7(T,N,R)],U=[O];if(P.length%2!=0)throw new ri(rn.INVALID_ARGUMENT,`Function ${T}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let S=0;S<P.length;S+=2)L.push(y7(T,P[S])),U.push(P[S+1]);let V=[],$=an.empty();for(let S=L.length-1;S>=0;--S)if(!vn(V,L[S])){let T=L[S],R=U[S];R=ex(R);let N=M.childContextForFieldPath(T);if(R instanceof yK)V.push(T);else{let S=y1(R,N);null!=S&&(V.push(T),$.set(T,S))}}return new yU($,new i1(V),M.fieldTransforms)}function y0(S,T,R,N=!1){return y1(R,S.createContext(N?4:3,T))}function y1(S,T){if(y5(S=ex(S)))return y8("Unsupported field value:",T,S),y2(S,T);if(S instanceof yM)return y4(S,T),null;if(void 0===S&&T.ignoreUndefinedProperties)return null;if(T.path&&T.fieldMask.push(T.path),!(S instanceof Array))return y6(S,T);if(T.settings.arrayElement&&4!==T.dataSource)throw T.createError("Nested arrays are not supported");return y3(S,T)}function y2(S,T){let R={};return iK(S)?T.path&&T.path.length>0&&T.fieldMask.push(T.path):iG(S,(S,N)=>{let O=y1(N,T.childContextForField(S));null!=O&&(R[S]=O)}),{mapValue:{fields:R}}}function y3(S,T){let R=[],N=0;for(let O of S){let S=y1(O,T.childContextForArray(N));null==S&&(S={nullValue:"NULL_VALUE"}),R.push(S),N++}return{arrayValue:{values:R}}}function y4(S,T){if(!yV(T.dataSource))throw T.createError(`${S._methodName}() can only be used with update() and set()`);if(!T.path)throw T.createError(`${S._methodName}() is not currently supported inside arrays`);let R=S._toFieldTransform(T);R&&T.fieldTransforms.push(R)}function y6(S,T){if(null===(S=ex(S)))return{nullValue:"NULL_VALUE"};if("number"==typeof S)return oB(T.serializer,S);if("boolean"==typeof S)return{booleanValue:S};if("string"==typeof S)return{stringValue:S};if(S instanceof Date){let R=rq.fromDate(S);return{timestampValue:lQ(T.serializer,R)}}if(S instanceof rq){let R=new rq(S.seconds,1e3*Math.floor(S.nanoseconds/1e3));return{timestampValue:lQ(T.serializer,R)}}if(S instanceof yL)return{geoPointValue:{latitude:S.latitude,longitude:S.longitude}};else if(S instanceof yx)return{bytesValue:lJ(T.serializer,S._byteString)};else if(S instanceof yv){let R=T.databaseId,N=S.firestore._databaseId;if(!N.isEqual(R))throw T.createError(`Document reference is for database ${N.projectId}/${N.database} but should be for database ${R.projectId}/${R.database}`);return{referenceValue:l1(S.firestore._databaseId||T.databaseId,S._key.path)}}else if(S instanceof yF)return y9(S,T);else throw T.createError(`Unsupported field value: ${rL(S)}`)}function y9(S,T){return{mapValue:{fields:{[sy]:{stringValue:sS},[sT]:{arrayValue:{values:S.toArray().map(S=>{if("number"!=typeof S)throw T.createError("VectorValues must only contain numeric values.");return oL(T.serializer,S)})}}}}}}function y5(S){return"object"==typeof S&&null!==S&&!(S instanceof Array)&&!(S instanceof Date)&&!(S instanceof rq)&&!(S instanceof yL)&&!(S instanceof yx)&&!(S instanceof yv)&&!(S instanceof yM)&&!(S instanceof yF)}function y8(S,T,R){if(!y5(R)||!rM(R)){let N=rL(R);if("an object"===N)throw T.createError(S+" a custom object");throw T.createError(S+" "+N)}}function y7(S,T,R){if((T=ex(T))instanceof yP)return T._internalPath;if("string"==typeof T)return vt(S,T);throw vr("Field path arguments must be of type string or ",S,!1,void 0,R)}let ve=RegExp("[~\\*/\\[\\]]");function vt(S,T,R){if(T.search(ve)>=0)throw vr(`Invalid field path (${T}). Paths must not contain '~', '*', '/', '[', or ']'`,S,!1,void 0,R);try{return new yP(...T.split("."))._internalPath}catch(N){throw vr(`Invalid field path (${T}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,S,!1,void 0,R)}}function vr(S,T,R,N,O){let P=N&&!N.isEmpty(),M=void 0!==O,L=`Function ${T}() called with invalid data`;R&&(L+=" (via `toFirestore()`)"),L+=". ";let U="";return(P||M)&&(U+=" (found",P&&(U+=` in field ${N}`),M&&(U+=` in document ${O}`),U+=")"),new ri(rn.INVALID_ARGUMENT,L+S+U)}function vn(S,T){return S.some(S=>S.isEqual(T))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vi{constructor(S,T,R,N,O){this._firestore=S,this._userDataWriter=T,this._key=R,this._document=N,this._converter=O}get id(){return this._key.path.lastSegment()}get ref(){return new yv(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value);{let S=new vs(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(S)}}}get(S){if(this._document){let T=this._document.data.field(va("DocumentSnapshot.get",S));if(null!==T)return this._userDataWriter.convertValue(T)}}}class vs extends vi{data(){return super.data()}}function va(S,T){return"string"==typeof T?vt(S,T):T instanceof yP?T._internalPath:T._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vo(S){if("L"===S.limitType&&0===S.explicitOrderBy.length)throw new ri(rn.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class vl{}class vu extends vl{}function vc(S,T,...R){let N=[];for(let O of(T instanceof vl&&N.push(T),vA(N=N.concat(R)),N))S=O._apply(S);return S}class vd extends vu{constructor(S,T,R){super(),this._field=S,this._op=T,this._value=R,this.type="where"}static _create(S,T,R){return new vd(S,T,R)}_apply(S){let T=this._parse(S);return vI(S._query,T),new yy(S.firestore,S.converter,or(S._query,T))}_parse(S){let T=y$(S.firestore);return vb(S._query,"where",T,S.firestore._databaseId,this._field,this._op,this._value)}}function vh(S,T,R){let N=T,O=va("where",S);return vd._create(O,N,R)}class vp extends vl{constructor(S,T){super(),this.type=S,this._queryConstraints=T}static _create(S,T){return new vp(S,T)}_parse(S){let T=this._queryConstraints.map(T=>T._parse(S)).filter(S=>S.getFilters().length>0);return 1===T.length?T[0]:av.create(T,this._getOperator())}_apply(S){let T=this._parse(S);return 0===T.getFilters().length?S:(vR(S._query,T),new yy(S.firestore,S.converter,or(S._query,T)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class vf extends null{constructor(S,T){super(),this._field=S,this._direction=T,this.type="orderBy"}static _create(S,T){return new vf(S,T)}_apply(S){let T=vS(S._query,this._field,this._direction);return new yy(S.firestore,S.converter,on(S._query,T))}}class vm extends null{constructor(S,T,R){super(),this.type=S,this._limit=T,this._limitType=R}static _create(S,T,R){return new vm(S,T,R)}_apply(S){return new yy(S.firestore,S.converter,oi(S._query,this._limit,this._limitType))}}class vg extends null{constructor(S,T,R){super(),this.type=S,this._docOrFields=T,this._inclusive=R}static _create(S,T,R){return new vg(S,T,R)}_apply(S){let T=vv(S,this.type,this._docOrFields,this._inclusive);return new yy(S.firestore,S.converter,oa(S._query,T))}}class vy extends null{constructor(S,T,R){super(),this.type=S,this._docOrFields=T,this._inclusive=R}static _create(S,T,R){return new vy(S,T,R)}_apply(S){let T=vv(S,this.type,this._docOrFields,this._inclusive);return new yy(S.firestore,S.converter,oo(S._query,T))}}function vv(S,T,R,N){if(R[0]=getModularInstance(R[0]),R[0]instanceof vi)return vT(S._query,S.firestore._databaseId,T,R[0]._document,N);{let O=y$(S.firestore);return vE(S._query,S.firestore._databaseId,O,T,R,N)}}function vb(S,T,R,N,O,P,M){let L;if(O.isKeyField()){if("array-contains"===P||"array-contains-any"===P)throw new ri(rn.INVALID_ARGUMENT,`Invalid Query. You can't perform '${P}' queries on documentId().`);if("in"===P||"not-in"===P){vw(M,P);let T=[];for(let R of M)T.push(vC(N,S,R));L={arrayValue:{values:T}}}else L=vC(N,S,M)}else("in"===P||"not-in"===P||"array-contains-any"===P)&&vw(M,P),L=y0(R,T,M,"in"===P||"not-in"===P);return ay.create(O,P,L)}function vS(S,T,R){if(null!==S.startAt)throw new ri(rn.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==S.endAt)throw new ri(rn.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ah(T,R)}function vT(S,T,R,N,O){if(!N)throw new ri(rn.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${R}().`);let P=[];for(let R of a8(S))if(R.field.isKeyField())P.push(sJ(T,N.key));else{let S=N.data.field(R.field);if(ss(S))throw new ri(rn.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+R.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null!==S)P.push(S);else{let S=R.field.canonicalString();throw new ri(rn.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${S}' (used as the orderBy) does not exist.`)}}return new ao(P,O)}function vE(S,T,R,N,O,P){let M=S.explicitOrderBy;if(O.length>M.length)throw new ri(rn.INVALID_ARGUMENT,`Too many arguments provided to ${N}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let L=[];for(let P=0;P<O.length;P++){let U=O[P];if(M[P].field.isKeyField()){if("string"!=typeof U)throw new ri(rn.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${N}(), but got a ${typeof U}`);if(!a5(S)&&-1!==U.indexOf("/"))throw new ri(rn.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${N}() must be a plain document ID, but '${U}' contains a slash.`);let R=S.path.child(rR.fromString(U));if(!rk.isDocumentKey(R))throw new ri(rn.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${N}() must result in a valid document path, but '${R}' is not because it contains an odd number of segments.`);let O=new rk(R);L.push(sJ(T,O))}else{let S=y0(R,N,U);L.push(S)}}return new ao(L,P)}function vC(S,T,R){if("string"==typeof(R=ex(R))){if(""===R)throw new ri(rn.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!a5(T)&&-1!==R.indexOf("/"))throw new ri(rn.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${R}' contains a '/' character.`);let N=T.path.child(rR.fromString(R));if(!rk.isDocumentKey(N))throw new ri(rn.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${N}' is not because it has an odd number of segments (${N.length}).`);return sJ(S,new rk(N))}if(R instanceof yv)return sJ(S,R._key);throw new ri(rn.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${rL(R)}.`)}function vw(S,T){if(!Array.isArray(S)||0===S.length)throw new ri(rn.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${T.toString()}' filters.`)}function v_(S){switch(S){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function vI(S,T){let R=vD(S.filters,v_(T.op));if(null!==R){if(R===T.op)throw new ri(rn.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${T.op.toString()}' filter.`);throw new ri(rn.INVALID_ARGUMENT,`Invalid query. You cannot use '${T.op.toString()}' filters with '${R.toString()}' filters.`)}}function vR(S,T){let R=S;for(let S of T.getFlattenedFilters())vI(R,S),R=or(R,S)}function vD(S,T){for(let R of S)for(let S of R.getFlattenedFilters())if(T.indexOf(S.op)>=0)return S.op;return null}function vA(S){let T=S.filter(S=>S instanceof vp).length,R=S.filter(S=>S instanceof vd).length;if(T>1||T>0&&R>0)throw new ri(rn.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vk{convertValue(S,T="none"){switch(sC(S)){case 0:return null;case 1:return S.booleanValue;case 2:return i7(S.integerValue||S.doubleValue);case 3:return this.convertTimestamp(S.timestampValue);case 4:return this.convertServerTimestamp(S,T);case 5:return S.stringValue;case 6:return this.convertBytes(se(S.bytesValue));case 7:return this.convertReference(S.referenceValue);case 8:return this.convertGeoPoint(S.geoPointValue);case 9:return this.convertArray(S.arrayValue,T);case 11:return this.convertObject(S.mapValue,T);case 10:return this.convertVectorValue(S.mapValue);default:throw t8(62114,{value:S})}}convertObject(S,T){return this.convertObjectMap(S.fields,T)}convertObjectMap(S,T="none"){let R={};return iG(S,(S,N)=>{R[S]=this.convertValue(N,T)}),R}convertVectorValue(S){var T,R,N;return new yF(null===(N=null===(R=null===(T=S.fields)||void 0===T?void 0:T[sT].arrayValue)||void 0===R?void 0:R.values)||void 0===N?void 0:N.map(S=>i7(S.doubleValue)))}convertGeoPoint(S){return new yL(i7(S.latitude),i7(S.longitude))}convertArray(S,T){return(S.values||[]).map(S=>this.convertValue(S,T))}convertServerTimestamp(S,T){switch(T){case"previous":let R=so(S);if(null==R)return null;return this.convertValue(R,T);case"estimate":return this.convertTimestamp(sl(S));default:return null}}convertTimestamp(S){let T=i8(S);return new rq(T.seconds,T.nanos)}convertDocumentKey(S,T){let R=rR.fromString(S);rt(u1(R),9688,{name:S});let N=new sd(R.get(1),R.get(3)),O=new rk(R.popFirst(5));return N.isEqual(T)||t6(`Document ${O} contains a document reference within a different database (${N.projectId}/${N.database}) which is not supported. It will be treated as a reference in the current database (${T.projectId}/${T.database}) instead.`),O}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vN(S,T,R){return S?R&&(R.merge||R.mergeFields)?S.toFirestore(T,R):S.toFirestore(T):T}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vO(S){return vx(S,["next","error","complete"])}function vx(S,T){if("object"!=typeof S||null===S)return!1;let R=S;for(let S of T)if(S in R&&"function"==typeof R[S])return!0;return!1}let vP=rg();function vM(S){let T=JSON.stringify(S),R=vP.encode(T).byteLength;return`${R}${T}`}vM({metadata:{id:"test-bundle",createTime:{seconds:1577836805,nanos:6},version:1,totalDocuments:1,totalBytes:416}}),vM({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",readTime:{seconds:5,nanos:6},exists:!0}}),vM({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value"},bar:{integerValue:-42}}}}),vM({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",readTime:{seconds:5,nanos:6},exists:!0}}),vM({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value1"},bar:{integerValue:42},emptyArray:{arrayValue:{}},emptyMap:{mapValue:{}}}}}),vM({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/nodoc",readTime:{seconds:5,nanos:6},exists:!1}}),vM({namedQuery:{name:"limitQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"DESCENDING"}],limit:{value:1}},limitType:"FIRST"},readTime:{seconds:1590011379,nanos:191164e3}}}),vM({namedQuery:{name:"limitToLastQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"ASCENDING"}],limit:{value:1}},limitType:"LAST"},readTime:{seconds:1590011379,nanos:543063e3}}});/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vL=1;class vF{constructor(S,T){this.firestore=S,this.bundleId=T,this.documents=new Map,this.namedQueries=new Map,this.latestReadTime=new rq(0,0),this.databaseId=S._databaseId,this.serializer=new lG(this.databaseId,!0),this.userDataReader=new yq(this.databaseId,!0,this.serializer)}addBundleDocument(S,T){let R=this.documents.get(S.documentPath),N=null==R?void 0:R.metadata.queries,O=S.readTime,P=(null==R?void 0:R.metadata.readTime)?lY(R.metadata.readTime):null,M=!O&&null==P,L=void 0!==O&&(null==P||P<O);if((M||L)&&this.documents.set(S.documentPath,{document:this.toBundleDocument(S),metadata:{name:l4(this.serializer,S.documentKey),readTime:O?lQ(this.serializer,O):void 0,exists:S.documentExists}}),O&&O>this.latestReadTime&&(this.latestReadTime=O),T){let R=this.documents.get(S.documentPath);R.metadata.queries=N||[],R.metadata.queries.push(T)}}addBundleQuery(S){if(this.namedQueries.has(S.name))throw Error(`Query name conflict: ${name} has already been added.`);let T=new rq(0,0);for(let R of S.docBundleDataArray)this.addBundleDocument(R,S.name),R.readTime&&R.readTime>T&&(T=R.readTime);let R=uT(this.serializer,a7(S.query)),N={parent:S.parent,structuredQuery:R.queryTarget.structuredQuery};this.namedQueries.set(S.name,{name:S.name,bundledQuery:N,readTime:lQ(this.serializer,T)})}toBundleDocument(S){let T=this.userDataReader.createContext(4,"internal toBundledDocument"),R=y2(S.documentData,T);return{name:l4(this.serializer,S.documentKey),fields:R.mapValue.fields,updateTime:lQ(this.serializer,S.versionTime),createTime:lQ(this.serializer,S.createdTime)}}lengthPrefixedString(S){let T=JSON.stringify(S),R=vP.encode(T).byteLength;return`${R}${T}`}build(){let S="";for(let T of this.namedQueries.values())S+=this.lengthPrefixedString({namedQuery:T});for(let T of this.documents.values()){let R=T.metadata;S+=this.lengthPrefixedString({documentMetadata:R});let N=T.document;N&&(S+=this.lengthPrefixedString({document:N}))}let T={id:this.bundleId,createTime:lQ(this.serializer,this.latestReadTime),version:vL,totalDocuments:this.documents.size,totalBytes:vP.encode(S).length};return this.lengthPrefixedString({metadata:T})+S}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vB(S,T,R,N){let O=new vF(S,rv.newId());return O.addBundleDocument(vU(N,R,T)),O.build()}function vj(S,T,R,N,O,P,M){let L=[];for(let S=0;S<P.length;S++)L.push(vU(O[S],M[S],P[S]));let U={name:R,query:T,parent:N,docBundleDataArray:L},V=new vF(S,R);return V.addBundleQuery(U),V.build()}function vU(S,T,R){return{documentData:T,documentKey:R.mutableCopy().key,documentPath:S,documentExists:!0,createdTime:R.createTime.toTimestamp(),readTime:R.readTime.toTimestamp(),versionTime:R.version.toTimestamp()}}class vV{constructor(S,T){this.hasPendingWrites=S,this.fromCache=T}isEqual(S){return this.hasPendingWrites===S.hasPendingWrites&&this.fromCache===S.fromCache}}class vz extends vi{constructor(S,T,R,N,O,P){super(S,T,R,N,P),this._firestore=S,this._firestoreImpl=S,this.metadata=O}exists(){return super.exists()}data(S={}){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value,S.serverTimestamps);{let T=new vq(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(T,S)}}}get(S,T={}){if(this._document){let R=this._document.data.field(va("DocumentSnapshot.get",S));if(null!==R)return this._userDataWriter.convertValue(R,T.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new ri(rn.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let S=this._document,T={};if(T.type=vz._jsonSchemaVersion,T.bundle="",T.bundleSource="DocumentSnapshot",T.bundleName=this._key.toString(),!S||!S.isValidDocument()||!S.isFoundDocument())return T;let R=this._userDataWriter.convertObjectMap(S.data.value.mapValue.fields,"previous");return T.bundle=vB(this._firestore,S,R,this.ref.path),T}}vz._jsonSchemaVersion="firestore/documentSnapshot/1.0",vz._jsonSchema={type:rj("string",vz._jsonSchemaVersion),bundleSource:rj("string","DocumentSnapshot"),bundleName:rj("string"),bundle:rj("string")};class vq extends vz{data(S={}){return super.data(S)}}class v${constructor(S,T,R,N){this._firestore=S,this._userDataWriter=T,this._snapshot=N,this.metadata=new vV(N.hasPendingWrites,N.fromCache),this.query=R}get docs(){let S=[];return this.forEach(T=>S.push(T)),S}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(S,T){this._snapshot.docs.forEach(R=>{S.call(T,new vq(this._firestore,this._userDataWriter,R.key,R,new vV(this._snapshot.mutatedKeys.has(R.key),this._snapshot.fromCache),this.query.converter))})}docChanges(S={}){let T=!!S.includeMetadataChanges;if(T&&this._snapshot.excludesMetadataChanges)throw new ri(rn.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===T||(this._cachedChanges=vG(this,T),this._cachedChangesIncludeMetadataChanges=T),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new ri(rn.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let S={};S.type=v$._jsonSchemaVersion,S.bundleSource="QuerySnapshot",S.bundleName=rv.newId();let T=this._firestore._databaseId.database,R=this._firestore._databaseId.projectId,N=`projects/${R}/databases/${T}/documents`,O=[],P=[],M=[];return this.docs.forEach(S=>{null!==S._document&&(O.push(S._document),P.push(this._userDataWriter.convertObjectMap(S._document.data.value.mapValue.fields,"previous")),M.push(S.ref.path))}),S.bundle=vj(this._firestore,this.query._query,S.bundleName,N,M,O,P),S}}function vG(S,T){if(S._snapshot.oldDocs.isEmpty()){let T=0;return S._snapshot.docChanges.map(R=>{let N=new vq(S._firestore,S._userDataWriter,R.doc.key,R.doc,new vV(S._snapshot.mutatedKeys.has(R.doc.key),S._snapshot.fromCache),S.query.converter);return R.doc,{type:"added",doc:N,oldIndex:-1,newIndex:T++}})}{let R=S._snapshot.oldDocs;return S._snapshot.docChanges.filter(S=>T||3!==S.type).map(T=>{let N=new vq(S._firestore,S._userDataWriter,T.doc.key,T.doc,new vV(S._snapshot.mutatedKeys.has(T.doc.key),S._snapshot.fromCache),S.query.converter),O=-1,P=-1;return 0!==T.type&&(O=R.indexOf(T.doc.key),R=R.delete(T.doc.key)),1!==T.type&&(P=(R=R.add(T.doc)).indexOf(T.doc.key)),{type:vK(T.type),doc:N,oldIndex:O,newIndex:P}})}}function vK(S){switch(S){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return t8(61501,{type:S})}}v$._jsonSchemaVersion="firestore/querySnapshot/1.0",v$._jsonSchema={type:rj("string",v$._jsonSchemaVersion),bundleSource:rj("string","QuerySnapshot"),bundleName:rj("string"),bundle:rj("string")};class vW extends vk{constructor(S){super(),this.firestore=S}convertBytes(S){return new yx(S)}convertReference(S){let T=this.convertDocumentKey(S,this.firestore._databaseId);return new yv(this.firestore,null,T)}}function vH(S){S=rB(S,yy);let T=rB(S.firestore,yI),R=yD(T),N=new vW(T);return vo(S._query),g9(R,S._query).then(R=>new v$(T,N,S,R))}function vQ(S,T,R,...N){let O;S=rB(S,yv);let P=rB(S.firestore,yI),M=y$(P);return vJ(P,[(O="string"==typeof(T=ex(T))||T instanceof yP?yZ(M,"updateDoc",S._key,T,R,N):yX(M,"updateDoc",S._key,T)).toMutation(S._key,o3.exists(!0))])}function vY(S,T){let R=rB(S.firestore,yI),N=yT(S),O=vN(S.converter,T);return vJ(R,[yG(y$(S.firestore),"addDoc",N._key,O,null!==S.converter,{}).toMutation(N._key,o3.exists(!1))]).then(()=>N)}function vJ(S,T){return g5(yD(S),T)}function vX(S,T,R){let N=R.docs.get(T._key),O=new vW(S);return new vz(S,O,T._key,N,new vV(R.hasPendingWrites,R.fromCache),T.converter)}class vZ{constructor(S){this.forceOwnership=S,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(S){this._onlineComponentProvider=gP.provider,this._offlineComponentProvider={build:T=>new gx(T,null==S?void 0:S.cacheSizeBytes,this.forceOwnership)}}}function v0(){return new yH("serverTimestamp")}new WeakMap;class v3{constructor(){this.existenceFilterMismatchCallbacksById=new Map}static get instance(){return v4||l_(v4=new v3),v4}notifyOnExistenceFilterMismatch(S){this.existenceFilterMismatchCallbacksById.forEach(T=>T(S))}onExistenceFilterMismatch(S){let T=Symbol(),R=this.existenceFilterMismatchCallbacksById;return R.set(T,S),()=>R.delete(T)}}let v4=null;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */yN("node");let v6={apiKey:"AIzaSyCTMqWzORaG1eK0Tp-T8e0h39rDJpLMPPQ",authDomain:"did-i-dodge-a-bullet.firebaseapp.com",projectId:"did-i-dodge-a-bullet",storageBucket:"did-i-dodge-a-bullet.firebasestorage.app",messagingSenderId:"190454478964",appId:"1:190454478964:web:8b54426780fe1792627921"},v9=null,v5=null,v8=()=>{if(!v9){let S=t_();v9=S.length>0?S[0]:tC(v6)}return v5||(v5=yR(v9)),{app:v9,db:v5}},v7=()=>{if(!v9){let{app:S}=v8();return S}return v9},be=()=>{if(!v5){let{db:S}=v8();return S}return v5};be(),v7();let bt=async S=>{if(!v5)throw Error("Firebase not initialized. Please set up your Firebase configuration.");try{let T={...S,timestamp:v0()},R=await vY(yS(v5,"submissions"),T);return S.companyName&&await br(S.companyName,T),R.id}catch(S){throw console.error("Error submitting interview checkup:",S),S}},br=async(S,T)=>{if(!v5){console.warn("Firebase not initialized. Skipping company insights update.");return}try{let R=bn(S),N=vc(yS(v5,"company_insights"),vh("companyName","==",R)),O=await vH(N);if(O.empty)await vY(yS(v5,"company_insights"),{companyName:R,totalSubmissions:1,commonFlags:T.markedFlags,averageFlagCount:T.markedFlags.length,severityTrends:T.severityBreakdown,lastUpdated:v0()});else{let S=yT(v5,"company_insights",O.docs[0].id),R=O.docs[0].data(),N={totalSubmissions:R.totalSubmissions+1,commonFlags:Array.from(new Set([...R.commonFlags,...T.markedFlags])),averageFlagCount:(R.averageFlagCount*R.totalSubmissions+T.markedFlags.length)/(R.totalSubmissions+1),severityTrends:{light:R.severityTrends.light+T.severityBreakdown.light,medium:R.severityTrends.medium+T.severityBreakdown.medium},lastUpdated:v0()};await vQ(S,N)}}catch(S){console.error("Error updating company insights:",S)}},bn=S=>S.trim().toLowerCase().replace(/\s+/g," ").replace(/[^\w\s-]/g,"").replace(/\b(inc|corp|llc|ltd|co|company)\b/g,"").trim(),bi=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),bs=async S=>{let T=new TextEncoder().encode(S),R=await crypto.subtle.digest("SHA-256",T);return Array.from(new Uint8Array(R)).map(S=>S.toString(16).padStart(2,"0")).join("")},ba=3e5,bo={companies:[],lastUpdated:0,isLoaded:!1},bl=S=>S?S.trim().toLowerCase().replace(/\s+/g," ").replace(/[^\w\s-]/g,"").replace(/\b(inc|corp|corporation|llc|ltd|limited|co|company|group|holdings|enterprises|ventures|partners|associates)\b/g,"").replace(/\b(the|a|an)\b/g,"").replace(/\s+/g," ").trim():"",bu=(S,T)=>{let R=[];if(!S)return R;R.push(S.trim()),R.push(S.toLowerCase().trim());let N=S.toLowerCase().replace(/\b(inc|corp|corporation|llc|ltd|limited|co|company|group|holdings|enterprises|ventures|partners|associates)\b/g,"").replace(/\s+/g," ").trim();if(N&&N!==S.toLowerCase().trim()&&R.push(N),T)try{let N=new URL(T).hostname;N&&N!==S.toLowerCase()&&(R.push(N),N.startsWith("www.")&&R.push(N.substring(4)))}catch{}return Array.from(new Set(R.filter(S=>S.trim())))},bc=(S,T)=>{if(!S||!T)return 0;let R=[],N=S.length,O=T.length;for(let S=0;S<=O;S++)R[S]=[S];for(let S=0;S<=N;S++)R[0][S]=S;for(let P=1;P<=O;P++)for(let O=1;O<=N;O++)T.charAt(P-1)===S.charAt(O-1)?R[P][O]=R[P-1][O-1]:R[P][O]=Math.min(R[P-1][O-1]+1,R[P][O-1]+1,R[P-1][O]+1);let P=Math.max(N,O);return 0===P?1:(P-R[O][N])/P};class bd{constructor(){this.db=be()}static getInstance(){return bd.instance||(bd.instance=new bd),bd.instance}async loadAllCompanies(){let S=Date.now();if(bo.isLoaded&&S-bo.lastUpdated<ba)return bo.companies;try{if(!this.db)return console.warn("Firebase not initialized"),[];let T=yS(this.db,"companies"),R=(await vH(T)).docs.map(S=>{let T=S.data();return{id:S.id,name:T.name||"",normalizedName:T.normalizedName||"",aliases:T.aliases||[],website:T.website,location:T.location,industry:T.industry,company_size:T.company_size,company_type:T.company_type,founded_year:T.founded_year,specialities:T.specialities,locations:T.locations,submissionCount:T.submissionCount||0,lastSubmission:T.lastSubmission?.toDate(),commonFlags:T.commonFlags||[],averageFlagCount:T.averageFlagCount||0,severityTrends:T.severityTrends||{light:0,medium:0},createdAt:T.createdAt?.toDate(),updatedAt:T.updatedAt?.toDate()}});return bo={companies:R,lastUpdated:S,isLoaded:!0},console.log(`Loaded ${R.length} companies`),R}catch(S){return console.error("Error loading companies:",S),[]}}async searchCompanies(S,T=10){if(!S.trim())return[];let R=await this.loadAllCompanies(),N=bl(S),O=[];for(let T of R){let R=0,P="fuzzy";if(T.normalizedName===N)R=1,P="exact";else if(T.name.toLowerCase().includes(S.toLowerCase()))R=.9,P="partial";else{for(let S of T.aliases)if(bl(S)===N){R=.8,P="alias";break}if(0===R){let S=bc(N,T.normalizedName);S>.7&&(R=S,P="fuzzy")}}R>0&&O.push({company:T,relevanceScore:R,matchType:P})}return O.sort((S,T)=>T.relevanceScore-S.relevanceScore).slice(0,T).map(S=>S.company)}async findOrCreateCompany(S){if(!S.trim())throw Error("Company name cannot be empty");let T=await this.searchCompanies(S,1);if(T.length>0){let R=T[0];if(bc(bl(S),R.normalizedName)>.8)return R}return this.createCompany(S)}async createCompany(S){if(!this.db)throw Error("Firebase not initialized");let T=bl(S),R=bu(S),N={name:S.trim(),normalizedName:T,aliases:R,submissionCount:0,commonFlags:[],averageFlagCount:0,severityTrends:{light:0,medium:0},createdAt:v0(),updatedAt:v0()};try{let S={id:(await vY(yS(this.db,"companies"),N)).id,...N,createdAt:new Date,updatedAt:new Date};return bo.companies.push(S),S}catch(S){throw console.error("Error creating company:",S),S}}async updateCompanyWithSubmission(S,T){if(!this.db){console.warn("Firebase not initialized. Skipping company update.");return}try{let R=yT(this.db,"companies",S),N=bo.companies.find(T=>T.id===S);if(!N){console.warn("Company not found in cache for update");return}let O={submissionCount:N.submissionCount+1,commonFlags:Array.from(new Set([...N.commonFlags,...T.markedFlags])),averageFlagCount:(N.averageFlagCount*N.submissionCount+T.markedFlags.length)/(N.submissionCount+1),severityTrends:{light:N.severityTrends.light+T.severityBreakdown.light,medium:N.severityTrends.medium+T.severityBreakdown.medium},lastSubmission:v0(),updatedAt:v0()};await vQ(R,O);let P=bo.companies.findIndex(T=>T.id===S);-1!==P&&(bo.companies[P]={...N,...O,lastSubmission:new Date,updatedAt:new Date})}catch(S){console.error("Error updating company with submission:",S)}}async refreshCompanies(){bo={companies:[],lastUpdated:0,isLoaded:!1},await this.loadAllCompanies()}async getAllCompanies(){return this.loadAllCompanies()}}let bh=bd.getInstance();async function bp(S){try{let{companyName:T,companyId:R,markedFlags:N,totalFlags:O,severityBreakdown:P}=await S.json(),M=S.headers.get("x-forwarded-for"),L=M?M.split(",")[0]:S.ip||"unknown",U=await bs(L),V=bi(),$=S.headers.get("user-agent")||"unknown",K=await bt({companyName:T,markedFlags:N,totalFlags:O,severityBreakdown:P,userAgent:$,ipHash:U,sessionId:V});if(R)try{await bh.refreshCompanies(),await bh.updateCompanyWithSubmission(R,{markedFlags:N,severityBreakdown:P})}catch(S){console.error("Error updating company:",S)}return Y.Z.json({success:!0,submissionId:K,sessionId:V})}catch(S){return console.error("Error submitting interview checkup:",S),Y.Z.json({success:!1,error:"Failed to submit interview checkup"},{status:500})}}let bf="",bm=new K.AppRouteRouteModule({definition:{kind:W.x.APP_ROUTE,page:"/api/submit/route",pathname:"/api/submit",filename:"route",bundlePath:"app/api/submit/route"},resolvedPagePath:"C:\\Users\\bread\\Documents\\git-projects\\Did-I-Dodge-a-Bullet\\app\\api\\submit\\route.ts",nextConfigOutput:bf,userland:$}),{requestAsyncStorage:bg,staticGenerationAsyncStorage:by,serverHooks:bv,headerHooks:bb,staticGenerationBailout:bS}=bm,bT="/api/submit/route";function bE(){return(0,Q.patchFetch)({serverHooks:bv,staticGenerationAsyncStorage:by})}},6959:(S,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.addAdminServicesToServer=T.registerAdminService=void 0;let R=[];function N(S,T){R.push({getServiceDefinition:S,getHandlers:T})}function O(S){for(let{getServiceDefinition:T,getHandlers:N}of R)S.addService(T(),N())}T.registerAdminService=N,T.addAdminServicesToServer=O},3339:(S,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.BackoffTimeout=void 0;let R=1e3,N=1.6,O=12e4,P=.2;function M(S,T){return Math.random()*(T-S)+S}class L{constructor(S,T){this.callback=S,this.initialDelay=R,this.multiplier=N,this.maxDelay=O,this.jitter=P,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,T&&(T.initialDelay&&(this.initialDelay=T.initialDelay),T.multiplier&&(this.multiplier=T.multiplier),T.jitter&&(this.jitter=T.jitter),T.maxDelay&&(this.maxDelay=T.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(S){var T,R;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},S),this.hasRef||null===(R=(T=this.timerId).unref)||void 0===R||R.call(T)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let S=Math.min(this.nextDelay*this.multiplier,this.maxDelay),T=S*this.jitter;this.nextDelay=S+M(-T,T)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let S=new Date,T=this.startTime;T.setMilliseconds(T.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),S<T?this.runTimer(T.getTime()-S.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var S,T;this.hasRef=!0,null===(T=(S=this.timerId).ref)||void 0===T||T.call(S)}unref(){var S,T;this.hasRef=!1,null===(T=(S=this.timerId).unref)||void 0===T||T.call(S)}getEndTime(){return this.endTime}}T.BackoffTimeout=L},1860:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.CallCredentials=void 0;let N=R(6598);function O(S){return"getRequestHeaders"in S&&"function"==typeof S.getRequestHeaders}class P{static createFromMetadataGenerator(S){return new L(S)}static createFromGoogleCredential(S){return P.createFromMetadataGenerator((T,R)=>{let P;(P=O(S)?S.getRequestHeaders(T.service_url):new Promise((R,N)=>{S.getRequestMetadata(T.service_url,(S,T)=>{if(S){N(S);return}if(!T){N(Error("Headers not set by metadata plugin"));return}R(T)})})).then(S=>{let T=new N.Metadata;for(let R of Object.keys(S))T.add(R,S[R]);R(null,T)},S=>{R(S)})})}static createEmpty(){return new U}}T.CallCredentials=P;class M extends P{constructor(S){super(),this.creds=S}async generateMetadata(S){let T=new N.Metadata;for(let R of(await Promise.all(this.creds.map(T=>T.generateMetadata(S)))))T.merge(R);return T}compose(S){return new M(this.creds.concat([S]))}_equals(S){return this===S||S instanceof M&&this.creds.every((T,R)=>T._equals(S.creds[R]))}}class L extends P{constructor(S){super(),this.metadataGenerator=S}generateMetadata(S){return new Promise((T,R)=>{this.metadataGenerator(S,(S,N)=>{void 0!==N?T(N):R(S)})})}compose(S){return new M([this,S])}_equals(S){return this===S||S instanceof L&&this.metadataGenerator===S.metadataGenerator}}class U extends P{generateMetadata(S){return Promise.resolve(new N.Metadata)}compose(S){return S}_equals(S){return S instanceof U}}},2247:(S,T)=>{"use strict";function R(S){return void 0!==S.onReceiveMetadata&&1===S.onReceiveMetadata.length}Object.defineProperty(T,"__esModule",{value:!0}),T.InterceptingListenerImpl=T.isInterceptingListener=void 0,T.isInterceptingListener=R;class N{constructor(S,T){this.listener=S,this.nextListener=T,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(S){this.processingMetadata=!0,this.listener.onReceiveMetadata(S,S=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(S),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(S){this.processingMessage=!0,this.listener.onReceiveMessage(S,S=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=S,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(S),this.processPendingStatus())})}onReceiveStatus(S){this.listener.onReceiveStatus(S,S=>{this.processingMetadata||this.processingMessage?this.pendingStatus=S:this.nextListener.onReceiveStatus(S)})}}T.InterceptingListenerImpl=N},4391:(S,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.getNextCallNumber=void 0;let R=0;function N(){return R++}T.getNextCallNumber=N},9238:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ClientDuplexStreamImpl=T.ClientWritableStreamImpl=T.ClientReadableStreamImpl=T.ClientUnaryCallImpl=T.callErrorFromStatus=void 0;let N=R(2361),O=R(2781),P=R(8905);function M(S,T){let R=`${S.code} ${P.Status[S.code]}: ${S.details}`,N=Error(R),O=`${N.stack}
for call at
${T}`;return Object.assign(Error(R),S,{stack:O})}T.callErrorFromStatus=M;class L extends N.EventEmitter{constructor(){super()}cancel(){var S;null===(S=this.call)||void 0===S||S.cancelWithStatus(P.Status.CANCELLED,"Cancelled on client")}getPeer(){var S,T;return null!==(T=null===(S=this.call)||void 0===S?void 0:S.getPeer())&&void 0!==T?T:"unknown"}}T.ClientUnaryCallImpl=L;class U extends O.Readable{constructor(S){super({objectMode:!0}),this.deserialize=S}cancel(){var S;null===(S=this.call)||void 0===S||S.cancelWithStatus(P.Status.CANCELLED,"Cancelled on client")}getPeer(){var S,T;return null!==(T=null===(S=this.call)||void 0===S?void 0:S.getPeer())&&void 0!==T?T:"unknown"}_read(S){var T;null===(T=this.call)||void 0===T||T.startRead()}}T.ClientReadableStreamImpl=U;class V extends O.Writable{constructor(S){super({objectMode:!0}),this.serialize=S}cancel(){var S;null===(S=this.call)||void 0===S||S.cancelWithStatus(P.Status.CANCELLED,"Cancelled on client")}getPeer(){var S,T;return null!==(T=null===(S=this.call)||void 0===S?void 0:S.getPeer())&&void 0!==T?T:"unknown"}_write(S,T,R){var N;let O={callback:R},P=Number(T);Number.isNaN(P)||(O.flags=P),null===(N=this.call)||void 0===N||N.sendMessageWithContext(O,S)}_final(S){var T;null===(T=this.call)||void 0===T||T.halfClose(),S()}}T.ClientWritableStreamImpl=V;class $ extends O.Duplex{constructor(S,T){super({objectMode:!0}),this.serialize=S,this.deserialize=T}cancel(){var S;null===(S=this.call)||void 0===S||S.cancelWithStatus(P.Status.CANCELLED,"Cancelled on client")}getPeer(){var S,T;return null!==(T=null===(S=this.call)||void 0===S?void 0:S.getPeer())&&void 0!==T?T:"unknown"}_read(S){var T;null===(T=this.call)||void 0===T||T.startRead()}_write(S,T,R){var N;let O={callback:R},P=Number(T);Number.isNaN(P)||(O.flags=P),null===(N=this.call)||void 0===N||N.sendMessageWithContext(O,S)}_final(S){var T;null===(T=this.call)||void 0===T||T.halfClose(),S()}}T.ClientDuplexStreamImpl=$},9473:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ChannelCredentials=void 0;let N=R(4404),O=R(1860),P=R(6337);function M(S,T){if(S&&!(S instanceof Buffer))throw TypeError(`${T}, if provided, must be a Buffer.`)}class L{constructor(S){this.callCredentials=S||O.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(S,T,R,O){var L;if(M(S,"Root certificate"),M(T,"Private key"),M(R,"Certificate chain"),T&&!R)throw Error("Private key must be given with accompanying certificate chain");if(!T&&R)throw Error("Certificate chain must be given with accompanying private key");return new V((0,N.createSecureContext)({ca:null!==(L=null!=S?S:(0,P.getDefaultRootsData)())&&void 0!==L?L:void 0,key:null!=T?T:void 0,cert:null!=R?R:void 0,ciphers:P.CIPHER_SUITES}),null!=O?O:{})}static createFromSecureContext(S,T){return new V(S,null!=T?T:{})}static createInsecure(){return new U}}T.ChannelCredentials=L;class U extends L{constructor(S){super(S)}compose(S){throw Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(S){return S instanceof U}}class V extends L{constructor(S,T){super(),this.secureContext=S,this.verifyOptions=T,this.connectionOptions={secureContext:S},(null==T?void 0:T.checkServerIdentity)&&(this.connectionOptions.checkServerIdentity=T.checkServerIdentity)}compose(S){return new $(this,this.callCredentials.compose(S))}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(S){return this===S||S instanceof V&&this.secureContext===S.secureContext&&this.verifyOptions.checkServerIdentity===S.verifyOptions.checkServerIdentity}}class $ extends L{constructor(S,T){super(T),this.channelCredentials=S}compose(S){let T=this.callCredentials.compose(S);return new $(this.channelCredentials,T)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(S){return this===S||S instanceof $&&this.channelCredentials._equals(S.channelCredentials)&&this.callCredentials._equals(S.callCredentials)}}},8007:(S,T)=>{"use strict";function R(S,T){let R=Object.keys(S).sort(),N=Object.keys(T).sort();if(R.length!==N.length)return!1;for(let O=0;O<R.length;O+=1)if(R[O]!==N[O]||S[R[O]]!==T[N[O]])return!1;return!0}Object.defineProperty(T,"__esModule",{value:!0}),T.channelOptionsEqual=T.recognizedOptions=void 0,T.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0},T.channelOptionsEqual=R},5835:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ChannelImplementation=void 0;let N=R(9473),O=R(5263);class P{constructor(S,T,R){if("string"!=typeof S)throw TypeError("Channel target must be a string");if(!(T instanceof N.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(R&&"object"!=typeof R)throw TypeError("Channel options must be an object");this.internalChannel=new O.InternalChannel(S,T,R)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(S){return this.internalChannel.getConnectivityState(S)}watchConnectivityState(S,T,R){this.internalChannel.watchConnectivityState(S,T,R)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(S,T,R,N,O){if("string"!=typeof S)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof T||T instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(S,T,R,N,O)}}T.ChannelImplementation=P},4174:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.setup=T.getChannelzServiceDefinition=T.getChannelzHandlers=T.unregisterChannelzRef=T.registerChannelzSocket=T.registerChannelzServer=T.registerChannelzSubchannel=T.registerChannelzChannel=T.ChannelzCallTracker=T.ChannelzChildrenTracker=T.ChannelzTrace=void 0;let N=R(1808),O=R(5199),P=R(8905),M=R(476),L=R(6959),U=R(2900);function V(S){return{channel_id:S.id,name:S.name}}function $(S){return{subchannel_id:S.id,name:S.name}}function K(S){return{server_id:S.id}}function W(S){return{socket_id:S.id,name:S.name}}let Q=32;class Y{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(S,T,R){let N=new Date;this.events.push({description:T,severity:S,timestamp:N,childChannel:(null==R?void 0:R.kind)==="channel"?R:void 0,childSubchannel:(null==R?void 0:R.kind)==="subchannel"?R:void 0}),this.events.length>=2*Q&&(this.events=this.events.slice(Q)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:eg(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(S=>({description:S.description,severity:S.severity,timestamp:eg(S.timestamp),channel_ref:S.childChannel?V(S.childChannel):null,subchannel_ref:S.childSubchannel?$(S.childSubchannel):null}))}}}T.ChannelzTrace=Y;class X{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(S){var T,R,N;switch(S.kind){case"channel":{let R=null!==(T=this.channelChildren.get(S.id))&&void 0!==T?T:{ref:S,count:0};R.count+=1,this.channelChildren.set(S.id,R);break}case"subchannel":{let T=null!==(R=this.subchannelChildren.get(S.id))&&void 0!==R?R:{ref:S,count:0};T.count+=1,this.subchannelChildren.set(S.id,T);break}case"socket":{let T=null!==(N=this.socketChildren.get(S.id))&&void 0!==N?N:{ref:S,count:0};T.count+=1,this.socketChildren.set(S.id,T)}}}unrefChild(S){switch(S.kind){case"channel":{let T=this.channelChildren.get(S.id);void 0!==T&&(T.count-=1,0===T.count?this.channelChildren.delete(S.id):this.channelChildren.set(S.id,T));break}case"subchannel":{let T=this.subchannelChildren.get(S.id);void 0!==T&&(T.count-=1,0===T.count?this.subchannelChildren.delete(S.id):this.subchannelChildren.set(S.id,T));break}case"socket":{let T=this.socketChildren.get(S.id);void 0!==T&&(T.count-=1,0===T.count?this.socketChildren.delete(S.id):this.socketChildren.set(S.id,T))}}}getChildLists(){let S=[];for(let{ref:T}of this.channelChildren.values())S.push(T);let T=[];for(let{ref:S}of this.subchannelChildren.values())T.push(S);let R=[];for(let{ref:S}of this.socketChildren.values())R.push(S);return{channels:S,subchannels:T,sockets:R}}}T.ChannelzChildrenTracker=X;class Z{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}}T.ChannelzCallTracker=Z;let ee=1;function et(){return ee++}let er=[],en=[],ei=[],es=[];function ea(S,T,R){let N=et(),O={id:N,name:S,kind:"channel"};return R&&(er[N]={ref:O,getInfo:T}),O}function eo(S,T,R){let N=et(),O={id:N,name:S,kind:"subchannel"};return R&&(en[N]={ref:O,getInfo:T}),O}function eu(S,T){let R=et(),N={id:R,kind:"server"};return T&&(ei[R]={ref:N,getInfo:S}),N}function ec(S,T,R){let N=et(),O={id:N,name:S,kind:"socket"};return R&&(es[N]={ref:O,getInfo:T}),O}function ed(S){switch(S.kind){case"channel":delete er[S.id];return;case"subchannel":delete en[S.id];return;case"server":delete ei[S.id];return;case"socket":delete es[S.id];return}}function eh(S){let T=Number.parseInt(S,16);return[T/256|0,T%256]}function ep(S){return""===S?[]:[].concat(...S.split(":").map(S=>eh(S)))}function ef(S){if((0,N.isIPv4)(S))return Buffer.from(Uint8Array.from(S.split(".").map(S=>Number.parseInt(S))));if(!(0,N.isIPv6)(S))return null;{let T,R;let N=S.indexOf("::");-1===N?(T=S,R=""):(T=S.substring(0,N),R=S.substring(N+2));let O=Buffer.from(ep(T)),P=Buffer.from(ep(R)),M=Buffer.alloc(16-O.length-P.length,0);return Buffer.concat([O,M,P])}}function em(S){switch(S){case O.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case O.ConnectivityState.IDLE:return{state:"IDLE"};case O.ConnectivityState.READY:return{state:"READY"};case O.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case O.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function eg(S){if(!S)return null;let T=S.getTime();return{seconds:T/1e3|0,nanos:T%1e3*1e6}}function ey(S){let T=S.getInfo();return{ref:V(S.ref),data:{target:T.target,state:em(T.state),calls_started:T.callTracker.callsStarted,calls_succeeded:T.callTracker.callsSucceeded,calls_failed:T.callTracker.callsFailed,last_call_started_timestamp:eg(T.callTracker.lastCallStartedTimestamp),trace:T.trace.getTraceMessage()},channel_ref:T.children.channels.map(S=>V(S)),subchannel_ref:T.children.subchannels.map(S=>$(S))}}function ev(S,T){let R=Number.parseInt(S.request.channel_id),N=er[R];if(void 0===N){T({code:P.Status.NOT_FOUND,details:"No channel data found for id "+R});return}T(null,{channel:ey(N)})}function eb(S,T){let R=Number.parseInt(S.request.max_results),N=[],O=Number.parseInt(S.request.start_channel_id);for(;O<er.length;O++){let S=er[O];if(void 0!==S&&(N.push(ey(S)),N.length>=R))break}T(null,{channel:N,end:O>=ei.length})}function eS(S){let T=S.getInfo();return{ref:K(S.ref),data:{calls_started:T.callTracker.callsStarted,calls_succeeded:T.callTracker.callsSucceeded,calls_failed:T.callTracker.callsFailed,last_call_started_timestamp:eg(T.callTracker.lastCallStartedTimestamp),trace:T.trace.getTraceMessage()},listen_socket:T.listenerChildren.sockets.map(S=>W(S))}}function eT(S,T){let R=Number.parseInt(S.request.server_id),N=ei[R];if(void 0===N){T({code:P.Status.NOT_FOUND,details:"No server data found for id "+R});return}T(null,{server:eS(N)})}function eE(S,T){let R=Number.parseInt(S.request.max_results),N=[],O=Number.parseInt(S.request.start_server_id);for(;O<ei.length;O++){let S=ei[O];if(void 0!==S&&(N.push(eS(S)),N.length>=R))break}T(null,{server:N,end:O>=ei.length})}function eC(S,T){let R=Number.parseInt(S.request.subchannel_id),N=en[R];if(void 0===N){T({code:P.Status.NOT_FOUND,details:"No subchannel data found for id "+R});return}let O=N.getInfo();T(null,{subchannel:{ref:$(N.ref),data:{target:O.target,state:em(O.state),calls_started:O.callTracker.callsStarted,calls_succeeded:O.callTracker.callsSucceeded,calls_failed:O.callTracker.callsFailed,last_call_started_timestamp:eg(O.callTracker.lastCallStartedTimestamp),trace:O.trace.getTraceMessage()},socket_ref:O.children.sockets.map(S=>W(S))}})}function ew(S){var T;return(0,M.isTcpSubchannelAddress)(S)?{address:"tcpip_address",tcpip_address:{ip_address:null!==(T=ef(S.host))&&void 0!==T?T:void 0,port:S.port}}:{address:"uds_address",uds_address:{filename:S.path}}}function e_(S,T){var R,N,O,M,L;let U=Number.parseInt(S.request.socket_id),V=es[U];if(void 0===V){T({code:P.Status.NOT_FOUND,details:"No socket data found for id "+U});return}let $=V.getInfo(),K=$.security?{model:"tls",tls:{cipher_suite:$.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:null!==(R=$.security.cipherSuiteStandardName)&&void 0!==R?R:void 0,other_name:null!==(N=$.security.cipherSuiteOtherName)&&void 0!==N?N:void 0,local_certificate:null!==(O=$.security.localCertificate)&&void 0!==O?O:void 0,remote_certificate:null!==(M=$.security.remoteCertificate)&&void 0!==M?M:void 0}}:null;T(null,{socket:{ref:W(V.ref),local:$.localAddress?ew($.localAddress):null,remote:$.remoteAddress?ew($.remoteAddress):null,remote_name:null!==(L=$.remoteName)&&void 0!==L?L:void 0,security:K,data:{keep_alives_sent:$.keepAlivesSent,streams_started:$.streamsStarted,streams_succeeded:$.streamsSucceeded,streams_failed:$.streamsFailed,last_local_stream_created_timestamp:eg($.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:eg($.lastRemoteStreamCreatedTimestamp),messages_received:$.messagesReceived,messages_sent:$.messagesSent,last_message_received_timestamp:eg($.lastMessageReceivedTimestamp),last_message_sent_timestamp:eg($.lastMessageSentTimestamp),local_flow_control_window:$.localFlowControlWindow?{value:$.localFlowControlWindow}:null,remote_flow_control_window:$.remoteFlowControlWindow?{value:$.remoteFlowControlWindow}:null}}})}function eI(S,T){let R=Number.parseInt(S.request.server_id),N=ei[R];if(void 0===N){T({code:P.Status.NOT_FOUND,details:"No server data found for id "+R});return}let O=Number.parseInt(S.request.start_socket_id),M=Number.parseInt(S.request.max_results),L=N.getInfo().sessionChildren.sockets.sort((S,T)=>S.id-T.id),U=[],V=0;for(;V<L.length&&(!(L[V].id>=O)||(U.push(W(L[V])),!(U.length>=M)));V++);T(null,{socket_ref:U,end:V>=L.length})}function eR(){return{GetChannel:ev,GetTopChannels:eb,GetServer:eT,GetServers:eE,GetSubchannel:eC,GetSocket:e_,GetServerSockets:eI}}T.registerChannelzChannel=ea,T.registerChannelzSubchannel=eo,T.registerChannelzServer=eu,T.registerChannelzSocket=ec,T.unregisterChannelzRef=ed,T.getChannelzHandlers=eR;let eD=null;function eA(){if(eD)return eD;let S=(0,R(4663).J_)("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return eD=(0,U.loadPackageDefinition)(S).grpc.channelz.v1.Channelz.service}function ek(){(0,L.registerAdminService)(eA,eR)}T.getChannelzServiceDefinition=eA,T.setup=ek},3811:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.getInterceptingCall=T.InterceptingCall=T.RequesterBuilder=T.ListenerBuilder=T.InterceptorConfigurationError=void 0;let N=R(6598),O=R(2247),P=R(8905),M=R(7025);class L extends Error{constructor(S){super(S),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,L)}}T.InterceptorConfigurationError=L;class U{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(S){return this.metadata=S,this}withOnReceiveMessage(S){return this.message=S,this}withOnReceiveStatus(S){return this.status=S,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}}T.ListenerBuilder=U;class V{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(S){return this.start=S,this}withSendMessage(S){return this.message=S,this}withHalfClose(S){return this.halfClose=S,this}withCancel(S){return this.cancel=S,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}}T.RequesterBuilder=V;let $={onReceiveMetadata:(S,T)=>{T(S)},onReceiveMessage:(S,T)=>{T(S)},onReceiveStatus:(S,T)=>{T(S)}},K={start:(S,T,R)=>{R(S,T)},sendMessage:(S,T)=>{T(S)},halfClose:S=>{S()},cancel:S=>{S()}};class W{constructor(S,T){var R,N,O,P;this.nextCall=S,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,T?this.requester={start:null!==(R=T.start)&&void 0!==R?R:K.start,sendMessage:null!==(N=T.sendMessage)&&void 0!==N?N:K.sendMessage,halfClose:null!==(O=T.halfClose)&&void 0!==O?O:K.halfClose,cancel:null!==(P=T.cancel)&&void 0!==P?P:K.cancel}:this.requester=K}cancelWithStatus(S,T){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(S,T)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(S,T){var R,N,P,M,L,U;let V={onReceiveMetadata:null!==(N=null===(R=null==T?void 0:T.onReceiveMetadata)||void 0===R?void 0:R.bind(T))&&void 0!==N?N:S=>{},onReceiveMessage:null!==(M=null===(P=null==T?void 0:T.onReceiveMessage)||void 0===P?void 0:P.bind(T))&&void 0!==M?M:S=>{},onReceiveStatus:null!==(U=null===(L=null==T?void 0:T.onReceiveStatus)||void 0===L?void 0:L.bind(T))&&void 0!==U?U:S=>{}};this.processingMetadata=!0,this.requester.start(S,V,(S,T)=>{var R,N,P;let M;if(this.processingMetadata=!1,(0,O.isInterceptingListener)(T))M=T;else{let S={onReceiveMetadata:null!==(R=T.onReceiveMetadata)&&void 0!==R?R:$.onReceiveMetadata,onReceiveMessage:null!==(N=T.onReceiveMessage)&&void 0!==N?N:$.onReceiveMessage,onReceiveStatus:null!==(P=T.onReceiveStatus)&&void 0!==P?P:$.onReceiveStatus};M=new O.InterceptingListenerImpl(S,V)}this.nextCall.start(S,M),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(S,T){this.processingMessage=!0,this.requester.sendMessage(T,R=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=S,this.pendingMessage=T):(this.nextCall.sendMessageWithContext(S,R),this.processPendingHalfClose())})}sendMessage(S){this.sendMessageWithContext({},S)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}}function Q(S,T,R){var N,O;let P=null!==(N=R.deadline)&&void 0!==N?N:1/0,M=R.host,L=null!==(O=R.parent)&&void 0!==O?O:null,U=R.propagate_flags,V=R.credentials,$=S.createCall(T,P,M,L,U);return V&&$.setCredentials(V),$}T.InterceptingCall=W;class Y{constructor(S,T){this.call=S,this.methodDefinition=T}cancelWithStatus(S,T){this.call.cancelWithStatus(S,T)}getPeer(){return this.call.getPeer()}sendMessageWithContext(S,T){let R;try{R=this.methodDefinition.requestSerialize(T)}catch(S){this.call.cancelWithStatus(P.Status.INTERNAL,`Request message serialization failure: ${(0,M.getErrorMessage)(S)}`);return}this.call.sendMessageWithContext(S,R)}sendMessage(S){this.sendMessageWithContext({},S)}start(S,T){let R=null;this.call.start(S,{onReceiveMetadata:S=>{var R;null===(R=null==T?void 0:T.onReceiveMetadata)||void 0===R||R.call(T,S)},onReceiveMessage:S=>{var O;let L;try{L=this.methodDefinition.responseDeserialize(S)}catch(S){R={code:P.Status.INTERNAL,details:`Response message parsing error: ${(0,M.getErrorMessage)(S)}`,metadata:new N.Metadata},this.call.cancelWithStatus(R.code,R.details);return}null===(O=null==T?void 0:T.onReceiveMessage)||void 0===O||O.call(T,L)},onReceiveStatus:S=>{var N,O;R?null===(N=null==T?void 0:T.onReceiveStatus)||void 0===N||N.call(T,R):null===(O=null==T?void 0:T.onReceiveStatus)||void 0===O||O.call(T,S)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}}class X extends Y{constructor(S,T){super(S,T)}start(S,T){var R,N;let O=!1,P={onReceiveMetadata:null!==(N=null===(R=null==T?void 0:T.onReceiveMetadata)||void 0===R?void 0:R.bind(T))&&void 0!==N?N:S=>{},onReceiveMessage:S=>{var R;O=!0,null===(R=null==T?void 0:T.onReceiveMessage)||void 0===R||R.call(T,S)},onReceiveStatus:S=>{var R,N;O||null===(R=null==T?void 0:T.onReceiveMessage)||void 0===R||R.call(T,null),null===(N=null==T?void 0:T.onReceiveStatus)||void 0===N||N.call(T,S)}};super.start(S,P),this.call.startRead()}}class Z extends Y{}function ee(S,T,R){let N=Q(S,R.path,T);return R.responseStream?new Z(N,R):new X(N,R)}function et(S,T,R,N){if(S.clientInterceptors.length>0&&S.clientInterceptorProviders.length>0)throw new L("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(S.callInterceptors.length>0&&S.callInterceptorProviders.length>0)throw new L("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let O=[];O=S.callInterceptors.length>0||S.callInterceptorProviders.length>0?[].concat(S.callInterceptors,S.callInterceptorProviders.map(S=>S(T))).filter(S=>S):[].concat(S.clientInterceptors,S.clientInterceptorProviders.map(S=>S(T))).filter(S=>S);let P=Object.assign({},R,{method_definition:T});return O.reduceRight((S,T)=>R=>T(R,S),S=>ee(N,S,T))(P)}T.getInterceptingCall=et},526:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.Client=void 0;let N=R(9238),O=R(5835),P=R(5199),M=R(8905),L=R(6598),U=R(3811),V=Symbol(),$=Symbol(),K=Symbol(),W=Symbol();function Q(S){return"function"==typeof S}function Y(S){return S.stack.split("\n").slice(1).join("\n")}class X{constructor(S,T,R={}){var N,P;if(R=Object.assign({},R),this[$]=null!==(N=R.interceptors)&&void 0!==N?N:[],delete R.interceptors,this[K]=null!==(P=R.interceptor_providers)&&void 0!==P?P:[],delete R.interceptor_providers,this[$].length>0&&this[K].length>0)throw Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[W]=R.callInvocationTransformer,delete R.callInvocationTransformer,R.channelOverride)this[V]=R.channelOverride;else if(R.channelFactoryOverride){let N=R.channelFactoryOverride;delete R.channelFactoryOverride,this[V]=N(S,T,R)}else this[V]=new O.ChannelImplementation(S,T,R)}close(){this[V].close()}getChannel(){return this[V]}waitForReady(S,T){let R=N=>{let O;if(N){T(Error("Failed to connect before the deadline"));return}try{O=this[V].getConnectivityState(!0)}catch(S){T(Error("The channel has been closed"));return}if(O===P.ConnectivityState.READY)T();else try{this[V].watchConnectivityState(O,S,R)}catch(S){T(Error("The channel has been closed"))}};setImmediate(R)}checkOptionalUnaryResponseArguments(S,T,R){if(Q(S))return{metadata:new L.Metadata,options:{},callback:S};if(Q(T))return S instanceof L.Metadata?{metadata:S,options:{},callback:T}:{metadata:new L.Metadata,options:S,callback:T};if(!(S instanceof L.Metadata&&T instanceof Object&&Q(R)))throw Error("Incorrect arguments passed");return{metadata:S,options:T,callback:R}}makeUnaryRequest(S,T,R,O,P,L,Q){var X,Z;let ee=this.checkOptionalUnaryResponseArguments(P,L,Q),et={path:S,requestStream:!1,responseStream:!1,requestSerialize:T,responseDeserialize:R},er={argument:O,metadata:ee.metadata,call:new N.ClientUnaryCallImpl,channel:this[V],methodDefinition:et,callOptions:ee.options,callback:ee.callback};this[W]&&(er=this[W](er));let en=er.call,ei={clientInterceptors:this[$],clientInterceptorProviders:this[K],callInterceptors:null!==(X=er.callOptions.interceptors)&&void 0!==X?X:[],callInterceptorProviders:null!==(Z=er.callOptions.interceptor_providers)&&void 0!==Z?Z:[]},es=(0,U.getInterceptingCall)(ei,er.methodDefinition,er.callOptions,er.channel);en.call=es;let ea=null,eo=!1,eu=Error();return es.start(er.metadata,{onReceiveMetadata:S=>{en.emit("metadata",S)},onReceiveMessage(S){null!==ea&&es.cancelWithStatus(M.Status.INTERNAL,"Too many responses received"),ea=S},onReceiveStatus(S){if(!eo){if(eo=!0,S.code===M.Status.OK){if(null===ea){let T=Y(eu);er.callback((0,N.callErrorFromStatus)({code:M.Status.INTERNAL,details:"No message received",metadata:S.metadata},T))}else er.callback(null,ea)}else{let T=Y(eu);er.callback((0,N.callErrorFromStatus)(S,T))}eu=null,en.emit("status",S)}}}),es.sendMessage(O),es.halfClose(),en}makeClientStreamRequest(S,T,R,O,P,L){var Q,X;let Z=this.checkOptionalUnaryResponseArguments(O,P,L),ee={path:S,requestStream:!0,responseStream:!1,requestSerialize:T,responseDeserialize:R},et={metadata:Z.metadata,call:new N.ClientWritableStreamImpl(T),channel:this[V],methodDefinition:ee,callOptions:Z.options,callback:Z.callback};this[W]&&(et=this[W](et));let er=et.call,en={clientInterceptors:this[$],clientInterceptorProviders:this[K],callInterceptors:null!==(Q=et.callOptions.interceptors)&&void 0!==Q?Q:[],callInterceptorProviders:null!==(X=et.callOptions.interceptor_providers)&&void 0!==X?X:[]},ei=(0,U.getInterceptingCall)(en,et.methodDefinition,et.callOptions,et.channel);er.call=ei;let es=null,ea=!1,eo=Error();return ei.start(et.metadata,{onReceiveMetadata:S=>{er.emit("metadata",S)},onReceiveMessage(S){null!==es&&ei.cancelWithStatus(M.Status.INTERNAL,"Too many responses received"),es=S},onReceiveStatus(S){if(!ea){if(ea=!0,S.code===M.Status.OK){if(null===es){let T=Y(eo);et.callback((0,N.callErrorFromStatus)({code:M.Status.INTERNAL,details:"No message received",metadata:S.metadata},T))}else et.callback(null,es)}else{let T=Y(eo);et.callback((0,N.callErrorFromStatus)(S,T))}eo=null,er.emit("status",S)}}}),er}checkMetadataAndOptions(S,T){let R,N;return S instanceof L.Metadata?(R=S,N=T||{}):(N=S||{},R=new L.Metadata),{metadata:R,options:N}}makeServerStreamRequest(S,T,R,O,P,L){var Q,X;let Z=this.checkMetadataAndOptions(P,L),ee={path:S,requestStream:!1,responseStream:!0,requestSerialize:T,responseDeserialize:R},et={argument:O,metadata:Z.metadata,call:new N.ClientReadableStreamImpl(R),channel:this[V],methodDefinition:ee,callOptions:Z.options};this[W]&&(et=this[W](et));let er=et.call,en={clientInterceptors:this[$],clientInterceptorProviders:this[K],callInterceptors:null!==(Q=et.callOptions.interceptors)&&void 0!==Q?Q:[],callInterceptorProviders:null!==(X=et.callOptions.interceptor_providers)&&void 0!==X?X:[]},ei=(0,U.getInterceptingCall)(en,et.methodDefinition,et.callOptions,et.channel);er.call=ei;let es=!1,ea=Error();return ei.start(et.metadata,{onReceiveMetadata(S){er.emit("metadata",S)},onReceiveMessage(S){er.push(S)},onReceiveStatus(S){if(!es){if(es=!0,er.push(null),S.code!==M.Status.OK){let T=Y(ea);er.emit("error",(0,N.callErrorFromStatus)(S,T))}ea=null,er.emit("status",S)}}}),ei.sendMessage(O),ei.halfClose(),er}makeBidiStreamRequest(S,T,R,O,P){var L,Q;let X=this.checkMetadataAndOptions(O,P),Z={path:S,requestStream:!0,responseStream:!0,requestSerialize:T,responseDeserialize:R},ee={metadata:X.metadata,call:new N.ClientDuplexStreamImpl(T,R),channel:this[V],methodDefinition:Z,callOptions:X.options};this[W]&&(ee=this[W](ee));let et=ee.call,er={clientInterceptors:this[$],clientInterceptorProviders:this[K],callInterceptors:null!==(L=ee.callOptions.interceptors)&&void 0!==L?L:[],callInterceptorProviders:null!==(Q=ee.callOptions.interceptor_providers)&&void 0!==Q?Q:[]},en=(0,U.getInterceptingCall)(er,ee.methodDefinition,ee.callOptions,ee.channel);et.call=en;let ei=!1,es=Error();return en.start(ee.metadata,{onReceiveMetadata(S){et.emit("metadata",S)},onReceiveMessage(S){et.push(S)},onReceiveStatus(S){if(!ei){if(ei=!0,et.push(null),S.code!==M.Status.OK){let T=Y(es);et.emit("error",(0,N.callErrorFromStatus)(S,T))}es=null,et.emit("status",S)}}}),et}}T.Client=X},5202:(S,T)=>{"use strict";var R;Object.defineProperty(T,"__esModule",{value:!0}),T.CompressionAlgorithms=void 0,function(S){S[S.identity=0]="identity",S[S.deflate=1]="deflate",S[S.gzip=2]="gzip"}(R||(T.CompressionAlgorithms=R={}))},4535:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.CompressionFilterFactory=T.CompressionFilter=void 0;let N=R(9796),O=R(5202),P=R(8905),M=R(7215),L=R(4386),U=S=>"number"==typeof S&&"string"==typeof O.CompressionAlgorithms[S];class V{async writeMessage(S,T){let R=S;T&&(R=await this.compressMessage(R));let N=Buffer.allocUnsafe(R.length+5);return N.writeUInt8(T?1:0,0),N.writeUInt32BE(R.length,1),R.copy(N,5),N}async readMessage(S){let T=1===S.readUInt8(0),R=S.slice(5);return T&&(R=await this.decompressMessage(R)),R}}class $ extends V{async compressMessage(S){return S}async writeMessage(S,T){let R=Buffer.allocUnsafe(S.length+5);return R.writeUInt8(0,0),R.writeUInt32BE(S.length,1),S.copy(R,5),R}decompressMessage(S){return Promise.reject(Error('Received compressed message but "grpc-encoding" header was identity'))}}class K extends V{constructor(S){super(),this.maxRecvMessageLength=S}compressMessage(S){return new Promise((T,R)=>{N.deflate(S,(S,N)=>{S?R(S):T(N)})})}decompressMessage(S){return new Promise((T,R)=>{let O=0,M=[],L=N.createInflate();L.on("data",S=>{M.push(S),O+=S.byteLength,-1!==this.maxRecvMessageLength&&O>this.maxRecvMessageLength&&(L.destroy(),R({code:P.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),L.on("end",()=>{T(Buffer.concat(M))}),L.write(S),L.end()})}}class W extends V{constructor(S){super(),this.maxRecvMessageLength=S}compressMessage(S){return new Promise((T,R)=>{N.gzip(S,(S,N)=>{S?R(S):T(N)})})}decompressMessage(S){return new Promise((T,R)=>{let O=0,M=[],L=N.createGunzip();L.on("data",S=>{M.push(S),O+=S.byteLength,-1!==this.maxRecvMessageLength&&O>this.maxRecvMessageLength&&(L.destroy(),R({code:P.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),L.on("end",()=>{T(Buffer.concat(M))}),L.write(S),L.end()})}}class Q extends V{constructor(S){super(),this.compressionName=S}compressMessage(S){return Promise.reject(Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(S){return Promise.reject(Error(`Compression method not supported: ${this.compressionName}`))}}function Y(S,T){switch(S){case"identity":return new $;case"deflate":return new K(T);case"gzip":return new W(T);default:return new Q(S)}}class X extends M.BaseFilter{constructor(S,T){var R,N;super(),this.sharedFilterConfig=T,this.sendCompression=new $,this.receiveCompression=new $,this.currentCompressionAlgorithm="identity";let M=S["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=null!==(R=S["grpc.max_receive_message_length"])&&void 0!==R?R:P.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,void 0!==M){if(U(M)){let S=O.CompressionAlgorithms[M],R=null===(N=T.serverSupportedEncodingHeader)||void 0===N?void 0:N.split(",");(!R||R.includes(S))&&(this.currentCompressionAlgorithm=S,this.sendCompression=Y(this.currentCompressionAlgorithm,-1))}else L.log(P.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${M}`)}}async sendMetadata(S){let T=await S;return T.set("grpc-accept-encoding","identity,deflate,gzip"),T.set("accept-encoding","identity"),"identity"===this.currentCompressionAlgorithm?T.remove("grpc-encoding"):T.set("grpc-encoding",this.currentCompressionAlgorithm),T}receiveMetadata(S){let T=S.get("grpc-encoding");if(T.length>0){let S=T[0];"string"==typeof S&&(this.receiveCompression=Y(S,this.maxReceiveMessageLength))}S.remove("grpc-encoding");let R=S.get("grpc-accept-encoding")[0];return R&&(this.sharedFilterConfig.serverSupportedEncodingHeader=R,R.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new $,this.currentCompressionAlgorithm="identity")),S.remove("grpc-accept-encoding"),S}async sendMessage(S){var T;let R;let N=await S;return R=!(this.sendCompression instanceof $)&&((null!==(T=N.flags)&&void 0!==T?T:0)&2)==0,{message:await this.sendCompression.writeMessage(N.message,R),flags:N.flags}}async receiveMessage(S){return this.receiveCompression.readMessage(await S)}}T.CompressionFilter=X;class Z{constructor(S,T){this.options=T,this.sharedFilterConfig={}}createFilter(){return new X(this.options,this.sharedFilterConfig)}}T.CompressionFilterFactory=Z},5199:(S,T)=>{"use strict";var R;Object.defineProperty(T,"__esModule",{value:!0}),T.ConnectivityState=void 0,function(S){S[S.IDLE=0]="IDLE",S[S.CONNECTING=1]="CONNECTING",S[S.READY=2]="READY",S[S.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",S[S.SHUTDOWN=4]="SHUTDOWN"}(R||(T.ConnectivityState=R={}))},8905:(S,T)=>{"use strict";var R,N,O;Object.defineProperty(T,"__esModule",{value:!0}),T.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=T.DEFAULT_MAX_SEND_MESSAGE_LENGTH=T.Propagate=T.LogVerbosity=T.Status=void 0,function(S){S[S.OK=0]="OK",S[S.CANCELLED=1]="CANCELLED",S[S.UNKNOWN=2]="UNKNOWN",S[S.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",S[S.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",S[S.NOT_FOUND=5]="NOT_FOUND",S[S.ALREADY_EXISTS=6]="ALREADY_EXISTS",S[S.PERMISSION_DENIED=7]="PERMISSION_DENIED",S[S.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",S[S.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",S[S.ABORTED=10]="ABORTED",S[S.OUT_OF_RANGE=11]="OUT_OF_RANGE",S[S.UNIMPLEMENTED=12]="UNIMPLEMENTED",S[S.INTERNAL=13]="INTERNAL",S[S.UNAVAILABLE=14]="UNAVAILABLE",S[S.DATA_LOSS=15]="DATA_LOSS",S[S.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(R||(T.Status=R={})),function(S){S[S.DEBUG=0]="DEBUG",S[S.INFO=1]="INFO",S[S.ERROR=2]="ERROR",S[S.NONE=3]="NONE"}(N||(T.LogVerbosity=N={})),function(S){S[S.DEADLINE=1]="DEADLINE",S[S.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",S[S.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",S[S.CANCELLATION=8]="CANCELLATION",S[S.DEFAULTS=65535]="DEFAULTS"}(O||(T.Propagate=O={})),T.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1,T.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4194304},6648:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.restrictControlPlaneStatusCode=void 0;let N=R(8905),O=[N.Status.OK,N.Status.INVALID_ARGUMENT,N.Status.NOT_FOUND,N.Status.ALREADY_EXISTS,N.Status.FAILED_PRECONDITION,N.Status.ABORTED,N.Status.OUT_OF_RANGE,N.Status.DATA_LOSS];function P(S,T){return O.includes(S)?{code:N.Status.INTERNAL,details:`Invalid status from control plane: ${S} ${N.Status[S]} ${T}`}:{code:S,details:T}}T.restrictControlPlaneStatusCode=P},3117:(S,T)=>{"use strict";function R(...S){let T=1/0;for(let R of S){let S=R instanceof Date?R.getTime():R;S<T&&(T=S)}return T}Object.defineProperty(T,"__esModule",{value:!0}),T.deadlineToString=T.getRelativeTimeout=T.getDeadlineTimeoutString=T.minDeadline=void 0,T.minDeadline=R;let N=[["m",1],["S",1e3],["M",6e4],["H",36e5]];function O(S){let T=new Date().getTime();S instanceof Date&&(S=S.getTime());let R=Math.max(S-T,0);for(let[S,T]of N){let N=R/T;if(N<1e8)return String(Math.ceil(N))+S}throw Error("Deadline is too far in the future")}T.getDeadlineTimeoutString=O;let P=2147483647;function M(S){let T=(S instanceof Date?S.getTime():S)-new Date().getTime();return T<0?0:T>P?1/0:T}function L(S){if(S instanceof Date)return S.toISOString();{let T=new Date(S);return Number.isNaN(T.getTime())?""+S:T.toISOString()}}T.getRelativeTimeout=M,T.deadlineToString=L},5292:(S,T)=>{"use strict";function R(S){return{seconds:S/1e3|0,nanos:S%1e3*1e6|0}}function N(S){return 1e3*S.seconds+S.nanos/1e6|0}function O(S){return"number"==typeof S.seconds&&"number"==typeof S.nanos}Object.defineProperty(T,"__esModule",{value:!0}),T.isDuration=T.durationToMs=T.msToDuration=void 0,T.msToDuration=R,T.durationToMs=N,T.isDuration=O},7025:(S,T)=>{"use strict";function R(S){return S instanceof Error?S.message:String(S)}function N(S){return"object"==typeof S&&null!==S&&"code"in S&&"number"==typeof S.code?S.code:null}Object.defineProperty(T,"__esModule",{value:!0}),T.getErrorCode=T.getErrorMessage=void 0,T.getErrorMessage=R,T.getErrorCode=N},6614:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.OutlierDetectionLoadBalancingConfig=T.BaseSubchannelWrapper=T.registerAdminService=T.FilterStackFactory=T.BaseFilter=T.PickResultType=T.QueuePicker=T.UnavailablePicker=T.ChildLoadBalancerHandler=T.subchannelAddressToString=T.validateLoadBalancingConfig=T.getFirstUsableConfig=T.registerLoadBalancerType=T.createChildChannelControlHelper=T.BackoffTimeout=T.durationToMs=T.uriToString=T.createResolver=T.registerResolver=T.log=T.trace=void 0;var N=R(4386);Object.defineProperty(T,"trace",{enumerable:!0,get:function(){return N.trace}}),Object.defineProperty(T,"log",{enumerable:!0,get:function(){return N.log}});var O=R(5361);Object.defineProperty(T,"registerResolver",{enumerable:!0,get:function(){return O.registerResolver}}),Object.defineProperty(T,"createResolver",{enumerable:!0,get:function(){return O.createResolver}});var P=R(6228);Object.defineProperty(T,"uriToString",{enumerable:!0,get:function(){return P.uriToString}});var M=R(5292);Object.defineProperty(T,"durationToMs",{enumerable:!0,get:function(){return M.durationToMs}});var L=R(3339);Object.defineProperty(T,"BackoffTimeout",{enumerable:!0,get:function(){return L.BackoffTimeout}});var U=R(2728);Object.defineProperty(T,"createChildChannelControlHelper",{enumerable:!0,get:function(){return U.createChildChannelControlHelper}}),Object.defineProperty(T,"registerLoadBalancerType",{enumerable:!0,get:function(){return U.registerLoadBalancerType}}),Object.defineProperty(T,"getFirstUsableConfig",{enumerable:!0,get:function(){return U.getFirstUsableConfig}}),Object.defineProperty(T,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return U.validateLoadBalancingConfig}});var V=R(476);Object.defineProperty(T,"subchannelAddressToString",{enumerable:!0,get:function(){return V.subchannelAddressToString}});var $=R(868);Object.defineProperty(T,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return $.ChildLoadBalancerHandler}});var K=R(3184);Object.defineProperty(T,"UnavailablePicker",{enumerable:!0,get:function(){return K.UnavailablePicker}}),Object.defineProperty(T,"QueuePicker",{enumerable:!0,get:function(){return K.QueuePicker}}),Object.defineProperty(T,"PickResultType",{enumerable:!0,get:function(){return K.PickResultType}});var W=R(7215);Object.defineProperty(T,"BaseFilter",{enumerable:!0,get:function(){return W.BaseFilter}});var Q=R(6846);Object.defineProperty(T,"FilterStackFactory",{enumerable:!0,get:function(){return Q.FilterStackFactory}});var Y=R(6959);Object.defineProperty(T,"registerAdminService",{enumerable:!0,get:function(){return Y.registerAdminService}});var X=R(5074);Object.defineProperty(T,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return X.BaseSubchannelWrapper}});var Z=R(8583);Object.defineProperty(T,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return Z.OutlierDetectionLoadBalancingConfig}})},6846:(S,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.FilterStackFactory=T.FilterStack=void 0;class R{constructor(S){this.filters=S}sendMetadata(S){let T=S;for(let S=0;S<this.filters.length;S++)T=this.filters[S].sendMetadata(T);return T}receiveMetadata(S){let T=S;for(let S=this.filters.length-1;S>=0;S--)T=this.filters[S].receiveMetadata(T);return T}sendMessage(S){let T=S;for(let S=0;S<this.filters.length;S++)T=this.filters[S].sendMessage(T);return T}receiveMessage(S){let T=S;for(let S=this.filters.length-1;S>=0;S--)T=this.filters[S].receiveMessage(T);return T}receiveTrailers(S){let T=S;for(let S=this.filters.length-1;S>=0;S--)T=this.filters[S].receiveTrailers(T);return T}push(S){this.filters.unshift(...S)}getFilters(){return this.filters}}T.FilterStack=R;class N{constructor(S){this.factories=S}push(S){this.factories.unshift(...S)}clone(){return new N([...this.factories])}createFilter(){return new R(this.factories.map(S=>S.createFilter()))}}T.FilterStackFactory=N},7215:(S,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.BaseFilter=void 0;class R{async sendMetadata(S){return S}receiveMetadata(S){return S}async sendMessage(S){return S}async receiveMessage(S){return S}receiveTrailers(S){return S}}T.BaseFilter=R},9347:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.getProxiedConnection=T.mapProxyName=void 0;let N=R(4386),O=R(8905),P=R(5361),M=R(3685),L=R(4404),U=R(4386),V=R(476),$=R(6228),K=R(7310),W=R(9041),Q="proxy";function Y(S){U.trace(O.LogVerbosity.DEBUG,Q,S)}function X(){let S,T="",R="";if(process.env.grpc_proxy)R="grpc_proxy",T=process.env.grpc_proxy;else if(process.env.https_proxy)R="https_proxy",T=process.env.https_proxy;else{if(!process.env.http_proxy)return{};R="http_proxy",T=process.env.http_proxy}try{S=new K.URL(T)}catch(S){return(0,N.log)(O.LogVerbosity.ERROR,`cannot parse value of "${R}" env var`),{}}if("http:"!==S.protocol)return(0,N.log)(O.LogVerbosity.ERROR,`"${S.protocol}" scheme not supported in proxy URI`),{};let P=null;S.username&&(S.password?((0,N.log)(O.LogVerbosity.INFO,"userinfo found in proxy URI"),P=`${S.username}:${S.password}`):P=S.username);let M=S.hostname,L=S.port;""===L&&(L="80");let U={address:`${M}:${L}`};return P&&(U.creds=P),Y("Proxy server "+U.address+" set by environment variable "+R),U}function Z(){let S=process.env.no_grpc_proxy,T="no_grpc_proxy";return(S||(S=process.env.no_proxy,T="no_proxy"),S)?(Y("No proxy server list set by environment variable "+T),S.split(",")):[]}function ee(S,T){var R;let N={target:S,extraOptions:{}};if((null!==(R=T["grpc.enable_http_proxy"])&&void 0!==R?R:1)===0||"unix"===S.scheme)return N;let O=X();if(!O.address)return N;let P=(0,$.splitHostPort)(S.path);if(!P)return N;let M=P.host;for(let T of Z())if(T===M)return Y("Not using proxy for target in no_proxy list: "+(0,$.uriToString)(S)),N;let L={"grpc.http_connect_target":(0,$.uriToString)(S)};return O.creds&&(L["grpc.http_connect_creds"]=O.creds),{target:{scheme:"dns",path:O.address},extraOptions:L}}function et(S,T,R){var U;if(!("grpc.http_connect_target"in T))return Promise.resolve({});let K=T["grpc.http_connect_target"],Q=(0,$.parseUri)(K);if(null===Q)return Promise.resolve({});let X=(0,$.splitHostPort)(Q.path);if(null===X)return Promise.resolve({});let Z=`${X.host}:${null!==(U=X.port)&&void 0!==U?U:W.DEFAULT_PORT}`,ee={method:"CONNECT",path:Z},et={Host:Z};(0,V.isTcpSubchannelAddress)(S)?(ee.host=S.host,ee.port=S.port):ee.socketPath=S.path,"grpc.http_connect_creds"in T&&(et["Proxy-Authorization"]="Basic "+Buffer.from(T["grpc.http_connect_creds"]).toString("base64")),ee.headers=et;let er=(0,V.subchannelAddressToString)(S);return Y("Using proxy "+er+" to connect to "+ee.path),new Promise((S,T)=>{let U=M.request(ee);U.once("connect",(M,V,K)=>{var W;if(U.removeAllListeners(),V.removeAllListeners(),200===M.statusCode){if(Y("Successfully connected to "+ee.path+" through proxy "+er),"secureContext"in R){let N=(0,P.getDefaultAuthority)(Q),O=(0,$.splitHostPort)(N),M=null!==(W=null==O?void 0:O.host)&&void 0!==W?W:N,U=L.connect(Object.assign({host:M,servername:M,socket:V},R),()=>{Y("Successfully established a TLS connection to "+ee.path+" through proxy "+er),S({socket:U,realTarget:Q})});U.on("error",S=>{Y("Failed to establish a TLS connection to "+ee.path+" through proxy "+er+" with error "+S.message),T()})}else Y("Successfully established a plaintext connection to "+ee.path+" through proxy "+er),S({socket:V,realTarget:Q})}else(0,N.log)(O.LogVerbosity.ERROR,"Failed to connect to "+ee.path+" through proxy "+er+" with status "+M.statusCode),T()}),U.once("error",S=>{U.removeAllListeners(),(0,N.log)(O.LogVerbosity.ERROR,"Failed to connect to proxy "+er+" with error "+S.message),T()}),U.end()})}T.mapProxyName=ee,T.getProxiedConnection=et},8388:(S,T,R)=>{"use strict";Z={value:!0},Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=T.Rz=Z=Z=Z=Z=Z=Z=T.SF=T.K9=void 0;let N=R(1860);Z={enumerable:!0,get:function(){return N.CallCredentials}};let O=R(5835);Z={enumerable:!0,get:function(){return O.ChannelImplementation}};let P=R(5202);Z={enumerable:!0,get:function(){return P.CompressionAlgorithms}};let M=R(5199);Z={enumerable:!0,get:function(){return M.ConnectivityState}};let L=R(9473);Z={enumerable:!0,get:function(){return L.ChannelCredentials}};let U=R(526);Z={enumerable:!0,get:function(){return U.Client}};let V=R(8905);Z={enumerable:!0,get:function(){return V.LogVerbosity}},Z={enumerable:!0,get:function(){return V.Status}},Z={enumerable:!0,get:function(){return V.Propagate}};let $=R(4386),K=R(2900);Object.defineProperty(T,"Rz",{enumerable:!0,get:function(){return K.loadPackageDefinition}}),Z={enumerable:!0,get:function(){return K.makeClientConstructor}},Z={enumerable:!0,get:function(){return K.makeClientConstructor}};let W=R(6598);Object.defineProperty(T,"SF",{enumerable:!0,get:function(){return W.Metadata}});let Q=R(1798);Z={enumerable:!0,get:function(){return Q.Server}};let Y=R(4288);Z={enumerable:!0,get:function(){return Y.ServerCredentials}};let X=R(1192);Z={enumerable:!0,get:function(){return X.StatusBuilder}},T.K9={combineChannelCredentials:(S,...T)=>T.reduce((S,T)=>S.compose(T),S),combineCallCredentials:(S,...T)=>T.reduce((S,T)=>S.compose(T),S),createInsecure:L.ChannelCredentials.createInsecure,createSsl:L.ChannelCredentials.createSsl,createFromSecureContext:L.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:N.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:N.CallCredentials.createFromGoogleCredential,createEmpty:N.CallCredentials.createEmpty},Z=S=>S.close(),Z=(S,T,R)=>S.waitForReady(T,R),Z=(S,T)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},Z=(S,T,R)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},Z=S=>{$.setLogger(S)},Z=S=>{$.setLoggerVerbosity(S)},Z=S=>U.Client.prototype.getChannel.call(S);var Z,ee=R(3811);Z={enumerable:!0,get:function(){return ee.ListenerBuilder}},Z={enumerable:!0,get:function(){return ee.RequesterBuilder}},Z={enumerable:!0,get:function(){return ee.InterceptingCall}},Z={enumerable:!0,get:function(){return ee.InterceptorConfigurationError}};var et=R(4174);Z={enumerable:!0,get:function(){return et.getChannelzServiceDefinition}},Z={enumerable:!0,get:function(){return et.getChannelzHandlers}};var er=R(6959);Z={enumerable:!0,get:function(){return er.addAdminServicesToServer}},Z=R(6614);let en=R(9041),ei=R(4871),es=R(8250),ea=R(8766),eo=R(3887),eu=R(8583),ec=R(4174);(()=>{en.setup(),ei.setup(),es.setup(),ea.setup(),eo.setup(),eu.setup(),ec.setup()})()},5263:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.InternalChannel=void 0;let N=R(9473),O=R(7039),P=R(760),M=R(3184),L=R(8905),U=R(6846),V=R(4535),$=R(5361),K=R(4386),W=R(9347),Q=R(6228),Y=R(5199),X=R(4174),Z=R(3911),ee=R(3117),et=R(1316),er=R(4391),en=R(6648),ei=R(6230),es=R(5074),ea=2147483647,eo=1e3,eu=18e5,ec=new Map,ed=16777216,eh=1048576;class ep extends es.BaseSubchannelWrapper{constructor(S,T){super(S),this.channel=T,this.refCount=0,this.subchannelStateListener=(S,R,N,O)=>{T.throttleKeepalive(O)},S.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}}class ef{constructor(S,T,R){var Z,ee,et,er,es,ef,em,eg;if(this.credentials=T,this.options=R,this.connectivityState=Y.ConnectivityState.IDLE,this.currentPicker=new M.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new X.ChannelzCallTracker,this.childrenTracker=new X.ChannelzChildrenTracker,"string"!=typeof S)throw TypeError("Channel target must be a string");if(!(T instanceof N.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(R&&"object"!=typeof R)throw TypeError("Channel options must be an object");this.originalTarget=S;let ey=(0,Q.parseUri)(S);if(null===ey)throw Error(`Could not parse target name "${S}"`);let ev=(0,$.mapUriDefaultScheme)(ey);if(null===ev)throw Error(`Could not find a default scheme for target name "${S}"`);this.callRefTimer=setInterval(()=>{},ea),null===(ee=(Z=this.callRefTimer).unref)||void 0===ee||ee.call(Z),0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new X.ChannelzTrace,this.channelzRef=(0,X.registerChannelzChannel)(S,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,$.getDefaultAuthority)(ev);let eb=(0,W.mapProxyName)(ev,R);this.target=eb.target,this.options=Object.assign({},this.options,eb.extraOptions),this.subchannelPool=(0,P.getSubchannelPool)((null!==(et=R["grpc.use_local_subchannel_pool"])&&void 0!==et?et:0)===0),this.retryBufferTracker=new ei.MessageBufferTracker(null!==(er=R["grpc.retry_buffer_size"])&&void 0!==er?er:ed,null!==(es=R["grpc.per_rpc_retry_buffer_size"])&&void 0!==es?es:eh),this.keepaliveTime=null!==(ef=R["grpc.keepalive_time_ms"])&&void 0!==ef?ef:-1,this.idleTimeoutMs=Math.max(null!==(em=R["grpc.client_idle_timeout_ms"])&&void 0!==em?em:eu,eo);let eS={createSubchannel:(S,T)=>{let R=this.subchannelPool.getOrCreateSubchannel(this.target,S,Object.assign({},this.options,T),this.credentials);R.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",R.getChannelzRef());let N=new ep(R,this);return this.wrappedSubchannels.add(N),N},updateState:(S,T)=>{this.currentPicker=T;let R=this.pickQueue.slice();for(let S of(this.pickQueue=[],R.length>0&&this.callRefTimerUnref(),R))S.doPick();this.updateState(S)},requestReresolution:()=>{throw Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:S=>{this.channelzEnabled&&this.childrenTracker.refChild(S)},removeChannelzChild:S=>{this.channelzEnabled&&this.childrenTracker.unrefChild(S)}};this.resolvingLoadBalancer=new O.ResolvingLoadBalancer(this.target,eS,R,(S,T)=>{S.retryThrottling?ec.set(this.getTarget(),new ei.RetryThrottler(S.retryThrottling.maxTokens,S.retryThrottling.tokenRatio,ec.get(this.getTarget()))):ec.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=T,this.currentResolutionError=null,process.nextTick(()=>{let S=this.configSelectionQueue;for(let T of(this.configSelectionQueue=[],S.length>0&&this.callRefTimerUnref(),S))T.getConfig()})},S=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+S.code+' and details "'+S.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),null===this.configSelector&&(this.currentResolutionError=Object.assign(Object.assign({},(0,en.restrictControlPlaneStatusCode)(S.code,S.details)),{metadata:S.metadata}));let T=this.configSelectionQueue;for(let R of(this.configSelectionQueue=[],T.length>0&&this.callRefTimerUnref(),T))R.reportResolverError(S)}),this.filterStackFactory=new U.FilterStackFactory([new V.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(R,void 0,2));let eT=Error();(0,K.trace)(L.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+") Channel constructed \n"+(null===(eg=eT.stack)||void 0===eg?void 0:eg.substring(eT.stack.indexOf("\n")+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(S,T){(0,K.trace)(null!=T?T:L.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,Q.uriToString)(this.target)+" "+S)}callRefTimerRef(){var S,T,R,N;(null===(T=(S=this.callRefTimer).hasRef)||void 0===T?void 0:T.call(S))||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null===(N=(R=this.callRefTimer).ref)||void 0===N||N.call(R))}callRefTimerUnref(){var S,T;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null===(T=(S=this.callRefTimer).unref)||void 0===T||T.call(S))}removeConnectivityStateWatcher(S){let T=this.connectivityStateWatchers.findIndex(T=>T===S);T>=0&&this.connectivityStateWatchers.splice(T,1)}updateState(S){for(let T of((0,K.trace)(L.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,Q.uriToString)(this.target)+" "+Y.ConnectivityState[this.connectivityState]+" -> "+Y.ConnectivityState[S]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Y.ConnectivityState[S]),this.connectivityState=S,this.connectivityStateWatchers.slice()))S!==T.currentState&&(T.timer&&clearTimeout(T.timer),this.removeConnectivityStateWatcher(T),T.callback());S!==Y.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(S){if(S>this.keepaliveTime)for(let T of(this.keepaliveTime=S,this.wrappedSubchannels))T.throttleKeepalive(S)}removeWrappedSubchannel(S){this.wrappedSubchannels.delete(S)}doPick(S,T){return this.currentPicker.pick({metadata:S,extraPickInfo:T})}queueCallForPick(S){this.pickQueue.push(S),this.callRefTimerRef()}getConfig(S,T){return(this.resolvingLoadBalancer.exitIdle(),this.configSelector)?{type:"SUCCESS",config:this.configSelector(S,T)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(S){this.configSelectionQueue.push(S),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(Y.ConnectivityState.IDLE),this.currentPicker=new M.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(S){var T,R;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let S=new Date().valueOf()-this.lastActivityTimestamp.valueOf();S>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-S)},S),null===(R=(T=this.idleTimer).unref)||void 0===R||R.call(T)}maybeStartIdleTimer(){this.connectivityState===Y.ConnectivityState.SHUTDOWN||this.idleTimer||this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(S){this.channelzEnabled&&(S.code===L.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(S,T,R,N,O){let P=(0,er.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+P+'] method="'+T+'"'),new Z.LoadBalancingCall(this,S,T,R,N,O,P)}createRetryingCall(S,T,R,N,O){let P=(0,er.getNextCallNumber)();return this.trace("createRetryingCall ["+P+'] method="'+T+'"'),new ei.RetryingCall(this,S,T,R,N,O,P,this.retryBufferTracker,ec.get(this.getTarget()))}createInnerCall(S,T,R,N,O){return 0===this.options["grpc.enable_retries"]?this.createLoadBalancingCall(S,T,R,N,O):this.createRetryingCall(S,T,R,N,O)}createResolvingCall(S,T,R,N,O){let P=(0,er.getNextCallNumber)();this.trace("createResolvingCall ["+P+'] method="'+S+'", deadline='+(0,ee.deadlineToString)(T));let M={deadline:T,flags:null!=O?O:L.Propagate.DEFAULTS,host:null!=R?R:this.defaultAuthority,parentCall:N},U=new et.ResolvingCall(this,S,M,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),P);return this.onCallStart(),U.addStatusWatcher(S=>{this.onCallEnd(S)}),U}close(){this.resolvingLoadBalancer.destroy(),this.updateState(Y.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,X.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,Q.uriToString)(this.target)}getConnectivityState(S){let T=this.connectivityState;return S&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),T}watchConnectivityState(S,T,R){if(this.connectivityState===Y.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");let N=null;if(T!==1/0){let S=T instanceof Date?T:new Date(T),P=new Date;if(T===-1/0||S<=P){process.nextTick(R,Error("Deadline passed without connectivity state change"));return}N=setTimeout(()=>{this.removeConnectivityStateWatcher(O),R(Error("Deadline passed without connectivity state change"))},S.getTime()-P.getTime())}let O={currentState:S,callback:R,timer:N};this.connectivityStateWatchers.push(O)}getChannelzRef(){return this.channelzRef}createCall(S,T,R,N,O){if("string"!=typeof S)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof T||T instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===Y.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");return this.createResolvingCall(S,T,R,N,O)}}T.InternalChannel=ef},868:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ChildLoadBalancerHandler=void 0;let N=R(2728),O=R(5199),P="child_load_balancer_helper";class M{constructor(S){this.channelControlHelper=S,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(S){this.parent=S,this.child=null}createSubchannel(S,T){return this.parent.channelControlHelper.createSubchannel(S,T)}updateState(S,T){var R;if(this.calledByPendingChild()){if(S===O.ConnectivityState.CONNECTING)return;null===(R=this.parent.currentChild)||void 0===R||R.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(S,T)}requestReresolution(){var S;let T=null!==(S=this.parent.pendingChild)&&void 0!==S?S:this.parent.currentChild;this.child===T&&this.parent.channelControlHelper.requestReresolution()}setChild(S){this.child=S}addChannelzChild(S){this.parent.channelControlHelper.addChannelzChild(S)}removeChannelzChild(S){this.parent.channelControlHelper.removeChannelzChild(S)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(S,T){return S.getLoadBalancerName()!==T.getLoadBalancerName()}updateAddressList(S,T,R){let O;if(null===this.currentChild||null===this.latestConfig||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,T)){let S=new this.ChildPolicyHelper(this),R=(0,N.createLoadBalancer)(T,S);S.setChild(R),null===this.currentChild?(this.currentChild=R,O=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=R,O=this.pendingChild)}else O=null===this.pendingChild?this.currentChild:this.pendingChild;this.latestConfig=T,O.updateAddressList(S,T,R)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return P}}T.ChildLoadBalancerHandler=M},8583:(S,T,R)=>{"use strict";var N;Object.defineProperty(T,"__esModule",{value:!0}),T.setup=T.OutlierDetectionLoadBalancer=T.OutlierDetectionLoadBalancingConfig=void 0;let O=R(5199),P=R(8905),M=R(5292),L=R(6614),U=R(2728),V=R(868),$=R(3184),K=R(476),W=R(5074),Q=R(4386),Y="outlier_detection";function X(S){Q.trace(P.LogVerbosity.DEBUG,Y,S)}let Z="outlier_detection",ee=(null!==(N=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)&&void 0!==N?N:"true")==="true",et={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},er={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function en(S,T,R,N){if(T in S&&typeof S[T]!==R){let O=N?`${N}.${T}`:T;throw Error(`outlier detection config ${O} parse error: expected ${R}, got ${typeof S[T]}`)}}function ei(S,T,R){let N=R?`${R}.${T}`:T;if(T in S){if(!(0,M.isDuration)(S[T]))throw Error(`outlier detection config ${N} parse error: expected Duration, got ${typeof S[T]}`);if(!(S[T].seconds>=0&&S[T].seconds<=315576e6&&S[T].nanos>=0&&S[T].nanos<=999999999))throw Error(`outlier detection config ${N} parse error: values out of range for non-negative Duaration`)}}function es(S,T,R){let N=R?`${R}.${T}`:T;if(en(S,T,"number",R),T in S&&!(S[T]>=0&&S[T]<=100))throw Error(`outlier detection config ${N} parse error: value out of range for percentage (0-100)`)}class ea{constructor(S,T,R,N,O,P,M){if(this.childPolicy=M,M.length>0&&"pick_first"===M[0].getLoadBalancerName())throw Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=null!=S?S:1e4,this.baseEjectionTimeMs=null!=T?T:3e4,this.maxEjectionTimeMs=null!=R?R:3e5,this.maxEjectionPercent=null!=N?N:10,this.successRateEjection=O?Object.assign(Object.assign({},et),O):null,this.failurePercentageEjection=P?Object.assign(Object.assign({},er),P):null}getLoadBalancerName(){return Z}toJsonObject(){return{interval:(0,M.msToDuration)(this.intervalMs),base_ejection_time:(0,M.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,M.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(S=>S.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(S){return new ea(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,S)}static createFromJson(S){var T;if(ei(S,"interval"),ei(S,"base_ejection_time"),ei(S,"max_ejection_time"),es(S,"max_ejection_percent"),"success_rate_ejection"in S){if("object"!=typeof S.success_rate_ejection)throw Error("outlier detection config success_rate_ejection must be an object");en(S.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),es(S.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),en(S.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),en(S.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in S){if("object"!=typeof S.failure_percentage_ejection)throw Error("outlier detection config failure_percentage_ejection must be an object");es(S.failure_percentage_ejection,"threshold","failure_percentage_ejection"),es(S.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),en(S.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),en(S.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new ea(S.interval?(0,M.durationToMs)(S.interval):null,S.base_ejection_time?(0,M.durationToMs)(S.base_ejection_time):null,S.max_ejection_time?(0,M.durationToMs)(S.max_ejection_time):null,null!==(T=S.max_ejection_percent)&&void 0!==T?T:null,S.success_rate_ejection,S.failure_percentage_ejection,S.child_policy.map(U.validateLoadBalancingConfig))}}T.OutlierDetectionLoadBalancingConfig=ea;class eo extends W.BaseSubchannelWrapper{constructor(S,T){super(S),this.mapEntry=T,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=S.getConnectivityState(),S.addConnectivityStateListener((S,T,R,N)=>{if(this.childSubchannelState=R,!this.ejected)for(let S of this.stateListeners)S(this,T,R,N)})}getConnectivityState(){return this.ejected?O.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(S){this.stateListeners.push(S)}removeConnectivityStateListener(S){let T=this.stateListeners.indexOf(S);T>-1&&this.stateListeners.splice(T,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let S=this.mapEntry.subchannelWrappers.indexOf(this);S>=0&&this.mapEntry.subchannelWrappers.splice(S,1)}}eject(){for(let S of(this.ejected=!0,this.stateListeners))S(this,this.childSubchannelState,O.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){for(let S of(this.ejected=!1,this.stateListeners))S(this,O.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}}function eu(){return{success:0,failure:0}}class ec{constructor(){this.activeBucket=eu(),this.inactiveBucket=eu()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=eu()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}}class ed{constructor(S,T){this.wrappedPicker=S,this.countCalls=T}pick(S){let T=this.wrappedPicker.pick(S);if(T.pickResultType!==$.PickResultType.COMPLETE)return T;{let S=T.subchannel,R=S.getMapEntry();if(!R)return Object.assign(Object.assign({},T),{subchannel:S.getWrappedSubchannel()});{let N=T.onCallEnded;return this.countCalls&&(N=S=>{var N;S===P.Status.OK?R.counter.addSuccess():R.counter.addFailure(),null===(N=T.onCallEnded)||void 0===N||N.call(T,S)}),Object.assign(Object.assign({},T),{subchannel:S.getWrappedSubchannel(),onCallEnded:N})}}}}class eh{constructor(S){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new V.ChildLoadBalancerHandler((0,L.createChildChannelControlHelper)(S,{createSubchannel:(T,R)=>{let N=S.createSubchannel(T,R),O=this.addressMap.get((0,K.subchannelAddressToString)(T)),P=new eo(N,O);return(null==O?void 0:O.currentEjectionTimestamp)!==null&&P.eject(),null==O||O.subchannelWrappers.push(P),P},updateState:(T,R)=>{T===O.ConnectivityState.READY?S.updateState(T,new ed(R,this.isCountingEnabled())):S.updateState(T,R)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return null!==this.latestConfig&&(null!==this.latestConfig.getSuccessRateEjectionConfig()||null!==this.latestConfig.getFailurePercentageEjectionConfig())}getCurrentEjectionPercent(){let S=0;for(let T of this.addressMap.values())null!==T.currentEjectionTimestamp&&(S+=1);return 100*S/this.addressMap.size}runSuccessRateCheck(S){if(!this.latestConfig)return;let T=this.latestConfig.getSuccessRateEjectionConfig();if(!T)return;X("Running success rate check");let R=T.request_volume,N=0,O=[];for(let[S,T]of this.addressMap){let P=T.counter.getLastSuccesses(),M=T.counter.getLastFailures();X("Stats for "+S+": successes="+P+" failures="+M+" targetRequestVolume="+R),P+M>=R&&(N+=1,O.push(P/(P+M)))}if(X("Found "+N+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+O+"]"),N<T.minimum_hosts)return;let P=O.reduce((S,T)=>S+T)/O.length,M=0;for(let S of O){let T=S-P;M+=T*T}let L=Math.sqrt(M/O.length),U=P-T.stdev_factor/1e3*L;for(let[N,O]of(X("stdev="+L+" ejectionThreshold="+U),this.addressMap.entries())){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let P=O.counter.getLastSuccesses(),M=O.counter.getLastFailures();if(P+M<R)continue;let L=P/(P+M);if(X("Checking candidate "+N+" successRate="+L),L<U){let R=100*Math.random();X("Candidate "+N+" randomNumber="+R+" enforcement_percentage="+T.enforcement_percentage),R<T.enforcement_percentage&&(X("Ejecting candidate "+N),this.eject(O,S))}}}runFailurePercentageCheck(S){if(!this.latestConfig)return;let T=this.latestConfig.getFailurePercentageEjectionConfig();if(!T)return;X("Running failure percentage check. threshold="+T.threshold+" request volume threshold="+T.request_volume);let R=0;for(let S of this.addressMap.values())S.counter.getLastSuccesses()+S.counter.getLastFailures()>=T.request_volume&&(R+=1);if(!(R<T.minimum_hosts))for(let[R,N]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let O=N.counter.getLastSuccesses(),P=N.counter.getLastFailures();if(X("Candidate successes="+O+" failures="+P),!(O+P<T.request_volume)&&100*P/(P+O)>T.threshold){let O=100*Math.random();X("Candidate "+R+" randomNumber="+O+" enforcement_percentage="+T.enforcement_percentage),O<T.enforcement_percentage&&(X("Ejecting candidate "+R),this.eject(N,S))}}}eject(S,T){for(let T of(S.currentEjectionTimestamp=new Date,S.ejectionTimeMultiplier+=1,S.subchannelWrappers))T.eject()}uneject(S){for(let T of(S.currentEjectionTimestamp=null,S.subchannelWrappers))T.uneject()}switchAllBuckets(){for(let S of this.addressMap.values())S.counter.switchBuckets()}startTimer(S){var T,R;this.ejectionTimer=setTimeout(()=>this.runChecks(),S),null===(R=(T=this.ejectionTimer).unref)||void 0===R||R.call(T)}runChecks(){let S=new Date;if(X("Ejection timer running"),this.switchAllBuckets(),this.latestConfig)for(let[T,R]of(this.timerStartTime=S,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(S),this.runFailurePercentageCheck(S),this.addressMap.entries()))if(null===R.currentEjectionTimestamp)R.ejectionTimeMultiplier>0&&(R.ejectionTimeMultiplier-=1);else{let S=this.latestConfig.getBaseEjectionTimeMs(),N=this.latestConfig.getMaxEjectionTimeMs(),O=new Date(R.currentEjectionTimestamp.getTime());O.setMilliseconds(O.getMilliseconds()+Math.min(S*R.ejectionTimeMultiplier,Math.max(S,N))),O<new Date&&(X("Unejecting "+T),this.uneject(R))}}updateAddressList(S,T,R){if(!(T instanceof ea))return;let N=new Set;for(let T of S)N.add((0,K.subchannelAddressToString)(T));for(let S of N)this.addressMap.has(S)||(X("Adding map entry for "+S),this.addressMap.set(S,{counter:new ec,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let S of this.addressMap.keys())N.has(S)||(X("Removing map entry for "+S),this.addressMap.delete(S));let O=(0,U.getFirstUsableConfig)(T.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(S,O,R),T.getSuccessRateEjectionConfig()||T.getFailurePercentageEjectionConfig()){if(this.timerStartTime){X("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let S=T.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(S)}else X("Starting new timer"),this.timerStartTime=new Date,this.startTimer(T.getIntervalMs()),this.switchAllBuckets()}else for(let S of(X("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer),this.addressMap.values()))this.uneject(S),S.ejectionTimeMultiplier=0;this.latestConfig=T}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return Z}}function ep(){ee&&(0,L.registerLoadBalancerType)(Z,eh,ea)}T.OutlierDetectionLoadBalancer=eh,T.setup=ep},8766:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.setup=T.PickFirstLoadBalancer=T.shuffled=T.PickFirstLoadBalancingConfig=void 0;let N=R(2728),O=R(5199),P=R(3184),M=R(4386),L=R(8905),U="pick_first";function V(S){M.trace(L.LogVerbosity.DEBUG,U,S)}let $="pick_first",K=250;class W{constructor(S){this.shuffleAddressList=S}getLoadBalancerName(){return $}toJsonObject(){return{[$]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(S){if("shuffleAddressList"in S&&"boolean"!=typeof S.shuffleAddressList)throw Error("pick_first config field shuffleAddressList must be a boolean if provided");return new W(!0===S.shuffleAddressList)}}T.PickFirstLoadBalancingConfig=W;class Q{constructor(S){this.subchannel=S}pick(S){return{pickResultType:P.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}}function Y(S){let T=S.slice();for(let S=T.length-1;S>1;S--){let R=Math.floor(Math.random()*(S+1)),N=T[S];T[S]=T[R],T[R]=N}return T}T.shuffled=Y;class X{constructor(S){this.channelControlHelper=S,this.children=[],this.currentState=O.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(S,T,R,N,O)=>{this.onSubchannelStateUpdate(S,T,R,O)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(S=>S.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(O.ConnectivityState.READY,new Q(this.currentPick)):0===this.children.length?this.updateState(O.ConnectivityState.IDLE,new P.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(O.ConnectivityState.TRANSIENT_FAILURE,new P.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(O.ConnectivityState.CONNECTING,new P.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){for(let{subchannel:S}of(this.stickyTransientFailureMode=!0,this.children))S.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(null!==this.currentPick){let S=this.currentPick;this.currentPick=null,S.unref(),S.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(S.getChannelzRef())}}onSubchannelStateUpdate(S,T,R,N){var P;if(null===(P=this.currentPick)||void 0===P?void 0:P.realSubchannelEquals(S)){R!==O.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[T,P]of this.children.entries())if(S.realSubchannelEquals(P.subchannel)){R===O.ConnectivityState.READY&&this.pickSubchannel(P.subchannel),R===O.ConnectivityState.TRANSIENT_FAILURE&&(P.hasReportedTransientFailure=!0,N&&(this.lastError=N),this.maybeEnterStickyTransientFailureMode(),T===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(T+1)),P.subchannel.startConnecting();return}}startNextSubchannelConnecting(S){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[T,R]of this.children.entries())if(T>=S){let S=R.subchannel.getConnectivityState();if(S===O.ConnectivityState.IDLE||S===O.ConnectivityState.CONNECTING){this.startConnecting(T);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(S){var T,R;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=S,this.children[S].subchannel.getConnectivityState()===O.ConnectivityState.IDLE&&(V("Start connecting to subchannel with address "+this.children[S].subchannel.getAddress()),process.nextTick(()=>{var T;null===(T=this.children[S])||void 0===T||T.subchannel.startConnecting()})),this.connectionDelayTimeout=null===(R=(T=setTimeout(()=>{this.startNextSubchannelConnecting(S+1)},K)).unref)||void 0===R?void 0:R.call(T)}pickSubchannel(S){this.currentPick&&S.realSubchannelEquals(this.currentPick)||(V("Pick subchannel with address "+S.getAddress()),this.stickyTransientFailureMode=!1,null!==this.currentPick&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=S,S.ref(),this.channelControlHelper.addChannelzChild(S.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(S,T){V(O.ConnectivityState[this.currentState]+" -> "+O.ConnectivityState[S]),this.currentState=S,this.channelControlHelper.updateState(S,T)}resetSubchannelList(){for(let S of this.children)this.currentPick&&S.subchannel.realSubchannelEquals(this.currentPick)||S.subchannel.removeConnectivityStateListener(this.subchannelStateListener),S.subchannel.unref(),this.channelControlHelper.removeChannelzChild(S.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(S){let T=S.map(S=>({subchannel:this.channelControlHelper.createSubchannel(S,{}),hasReportedTransientFailure:!1}));for(let{subchannel:S}of T)S.ref(),this.channelControlHelper.addChannelzChild(S.getChannelzRef());for(let{subchannel:S}of(this.resetSubchannelList(),this.children=T,this.children))if(S.addConnectivityStateListener(this.subchannelStateListener),S.getConnectivityState()===O.ConnectivityState.READY){this.pickSubchannel(S);return}for(let S of this.children)S.subchannel.getConnectivityState()===O.ConnectivityState.TRANSIENT_FAILURE&&(S.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(S,T){T instanceof W&&(T.getShuffleAddressList()&&(S=Y(S)),this.latestAddressList=S,this.connectToAddressList(S))}exitIdle(){this.currentState===O.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return $}}function Z(){(0,N.registerLoadBalancerType)($,X,W),(0,N.registerDefaultLoadBalancerType)($)}T.PickFirstLoadBalancer=X,T.setup=Z},3887:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.setup=T.RoundRobinLoadBalancer=void 0;let N=R(2728),O=R(5199),P=R(3184),M=R(476),L=R(4386),U=R(8905),V="round_robin";function $(S){L.trace(U.LogVerbosity.DEBUG,V,S)}let K="round_robin";class W{getLoadBalancerName(){return K}constructor(){}toJsonObject(){return{[K]:{}}}static createFromJson(S){return new W}}class Q{constructor(S,T=0){this.subchannelList=S,this.nextIndex=T}pick(S){let T=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:P.PickResultType.COMPLETE,subchannel:T,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}}class Y{constructor(S){this.channelControlHelper=S,this.subchannels=[],this.currentState=O.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(S,T,R,N,P)=>{this.calculateAndUpdateState(),(R===O.ConnectivityState.TRANSIENT_FAILURE||R===O.ConnectivityState.IDLE)&&(P&&(this.lastError=P),this.channelControlHelper.requestReresolution(),S.startConnecting())}}countSubchannelsWithState(S){return this.subchannels.filter(T=>T.getConnectivityState()===S).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(O.ConnectivityState.READY)>0){let S=this.subchannels.filter(S=>S.getConnectivityState()===O.ConnectivityState.READY),T=0;null!==this.currentReadyPicker&&(T=S.indexOf(this.currentReadyPicker.peekNextSubchannel()))<0&&(T=0),this.updateState(O.ConnectivityState.READY,new Q(S,T))}else this.countSubchannelsWithState(O.ConnectivityState.CONNECTING)>0?this.updateState(O.ConnectivityState.CONNECTING,new P.QueuePicker(this)):this.countSubchannelsWithState(O.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(O.ConnectivityState.TRANSIENT_FAILURE,new P.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(O.ConnectivityState.IDLE,new P.QueuePicker(this))}updateState(S,T){$(O.ConnectivityState[this.currentState]+" -> "+O.ConnectivityState[S]),S===O.ConnectivityState.READY?this.currentReadyPicker=T:this.currentReadyPicker=null,this.currentState=S,this.channelControlHelper.updateState(S,T)}resetSubchannelList(){for(let S of this.subchannels)S.removeConnectivityStateListener(this.subchannelStateListener),S.unref(),this.channelControlHelper.removeChannelzChild(S.getChannelzRef());this.subchannels=[]}updateAddressList(S,T){for(let T of(this.resetSubchannelList(),$("Connect to address list "+S.map(S=>(0,M.subchannelAddressToString)(S))),this.subchannels=S.map(S=>this.channelControlHelper.createSubchannel(S,{})),this.subchannels)){T.ref(),T.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(T.getChannelzRef());let S=T.getConnectivityState();(S===O.ConnectivityState.IDLE||S===O.ConnectivityState.TRANSIENT_FAILURE)&&T.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let S of this.subchannels)S.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return K}}function X(){(0,N.registerLoadBalancerType)(K,Y,W)}T.RoundRobinLoadBalancer=Y,T.setup=X},2728:(S,T)=>{"use strict";function R(S,T){var R,N,O,P,M,L,U,V,$,K;return{createSubchannel:null!==(N=null===(R=T.createSubchannel)||void 0===R?void 0:R.bind(T))&&void 0!==N?N:S.createSubchannel.bind(S),updateState:null!==(P=null===(O=T.updateState)||void 0===O?void 0:O.bind(T))&&void 0!==P?P:S.updateState.bind(S),requestReresolution:null!==(L=null===(M=T.requestReresolution)||void 0===M?void 0:M.bind(T))&&void 0!==L?L:S.requestReresolution.bind(S),addChannelzChild:null!==(V=null===(U=T.addChannelzChild)||void 0===U?void 0:U.bind(T))&&void 0!==V?V:S.addChannelzChild.bind(S),removeChannelzChild:null!==(K=null===($=T.removeChannelzChild)||void 0===$?void 0:$.bind(T))&&void 0!==K?K:S.removeChannelzChild.bind(S)}}Object.defineProperty(T,"__esModule",{value:!0}),T.validateLoadBalancingConfig=T.getFirstUsableConfig=T.isLoadBalancerNameRegistered=T.createLoadBalancer=T.registerDefaultLoadBalancerType=T.registerLoadBalancerType=T.createChildChannelControlHelper=void 0,T.createChildChannelControlHelper=R;let N={},O=null;function P(S,T,R){N[S]={LoadBalancer:T,LoadBalancingConfig:R}}function M(S){O=S}function L(S,T){let R=S.getLoadBalancerName();return R in N?new N[R].LoadBalancer(T):null}function U(S){return S in N}function V(S,T=!1){for(let T of S)if(T.getLoadBalancerName() in N)return T;return T&&O?new N[O].LoadBalancingConfig:null}function $(S){if(!(null!==S&&"object"==typeof S))throw Error("Load balancing config must be an object");let T=Object.keys(S);if(1!==T.length)throw Error("Provided load balancing config has multiple conflicting entries");let R=T[0];if(R in N)return N[R].LoadBalancingConfig.createFromJson(S[R]);throw Error(`Unrecognized load balancing config name ${R}`)}T.registerLoadBalancerType=P,T.registerDefaultLoadBalancerType=M,T.createLoadBalancer=L,T.isLoadBalancerNameRegistered=U,T.getFirstUsableConfig=V,T.validateLoadBalancingConfig=$},3911:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.LoadBalancingCall=void 0;let N=R(5199),O=R(8905),P=R(3117),M=R(6598),L=R(3184),U=R(6228),V=R(4386),$=R(6648),K=R(5158),W="load_balancing_call";class Q{constructor(S,T,R,N,O,P,M){var L,V;this.channel=S,this.callConfig=T,this.methodName=R,this.host=N,this.credentials=O,this.deadline=P,this.callNumber=M,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let $=this.methodName.split("/"),K="";$.length>=2&&(K=$[1]);let W=null!==(V=null===(L=(0,U.splitHostPort)(this.host))||void 0===L?void 0:L.host)&&void 0!==V?V:"localhost";this.serviceUrl=`https://${W}/${K}`}trace(S){V.trace(O.LogVerbosity.DEBUG,W,"["+this.callNumber+"] "+S)}outputStatus(S,T){var R,N;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+S.code+' details="'+S.details+'"');let O=Object.assign(Object.assign({},S),{progress:T});null===(R=this.listener)||void 0===R||R.onReceiveStatus(O),null===(N=this.onCallEnded)||void 0===N||N.call(this,O.code)}}doPick(){var S,T;if(this.ended)return;if(!this.metadata)throw Error("doPick called before start");this.trace("Pick called");let R=this.channel.doPick(this.metadata,this.callConfig.pickInformation),U=R.subchannel?"("+R.subchannel.getChannelzRef().id+") "+R.subchannel.getAddress():""+R.subchannel;switch(this.trace("Pick result: "+L.PickResultType[R.pickResultType]+" subchannel: "+U+" status: "+(null===(S=R.status)||void 0===S?void 0:S.code)+" "+(null===(T=R.status)||void 0===T?void 0:T.details)),R.pickResultType){case L.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(S=>{var T,L,V;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let $=this.metadata.clone();if($.merge(S),$.get("authorization").length>1&&this.outputStatus({code:O.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new M.Metadata},"PROCESSED"),R.subchannel.getConnectivityState()!==N.ConnectivityState.READY){this.trace("Picked subchannel "+U+" has state "+N.ConnectivityState[R.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&$.set("grpc-timeout",(0,P.getDeadlineTimeoutString)(this.deadline));try{this.child=R.subchannel.getRealSubchannel().createCall($,this.host,this.methodName,{onReceiveMetadata:S=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(S)},onReceiveMessage:S=>{this.trace("Received message"),this.listener.onReceiveMessage(S)},onReceiveStatus:S=>{this.trace("Received status"),S.rstCode===K.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(S,"REFUSED"):this.outputStatus(S,"PROCESSED")}})}catch(S){this.trace("Failed to start call on picked subchannel "+U+" with error "+S.message),this.outputStatus({code:O.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+S.message,metadata:new M.Metadata},"NOT_STARTED");return}null===(L=(T=this.callConfig).onCommitted)||void 0===L||L.call(T),null===(V=R.onCallStarted)||void 0===V||V.call(R),this.onCallEnded=R.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},S=>{let{code:T,details:R}=(0,$.restrictControlPlaneStatusCode)("number"==typeof S.code?S.code:O.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${S.message}`);this.outputStatus({code:T,details:R,metadata:new M.Metadata},"PROCESSED")});break;case L.PickResultType.DROP:let{code:V,details:W}=(0,$.restrictControlPlaneStatusCode)(R.status.code,R.status.details);setImmediate(()=>{this.outputStatus({code:V,details:W,metadata:R.status.metadata},"DROP")});break;case L.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:S,details:T}=(0,$.restrictControlPlaneStatusCode)(R.status.code,R.status.details);setImmediate(()=>{this.outputStatus({code:S,details:T,metadata:R.status.metadata},"PROCESSED")})}break;case L.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(S,T){var R;this.trace("cancelWithStatus code: "+S+' details: "'+T+'"'),null===(R=this.child)||void 0===R||R.cancelWithStatus(S,T),this.outputStatus({code:S,details:T,metadata:new M.Metadata},"PROCESSED")}getPeer(){var S,T;return null!==(T=null===(S=this.child)||void 0===S?void 0:S.getPeer())&&void 0!==T?T:this.channel.getTarget()}start(S,T){this.trace("start called"),this.listener=T,this.metadata=S,this.doPick()}sendMessageWithContext(S,T){this.trace("write() called with message of length "+T.length),this.child?this.child.sendMessageWithContext(S,T):this.pendingMessage={context:S,message:T}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(S){throw Error("Method not implemented.")}getCallNumber(){return this.callNumber}}T.LoadBalancingCall=Q},4386:(S,T,R)=>{"use strict";var N,O,P,M;Object.defineProperty(T,"__esModule",{value:!0}),T.isTracerEnabled=T.trace=T.log=T.setLoggerVerbosity=T.setLogger=T.getLogger=void 0;let L=R(8905),U=R(7282),V=R(7645).i8,$={error:(S,...T)=>{console.error("E "+S,...T)},info:(S,...T)=>{console.error("I "+S,...T)},debug:(S,...T)=>{console.error("D "+S,...T)}},K=L.LogVerbosity.ERROR;switch((null!==(O=null!==(N=process.env.GRPC_NODE_VERBOSITY)&&void 0!==N?N:process.env.GRPC_VERBOSITY)&&void 0!==O?O:"").toUpperCase()){case"DEBUG":K=L.LogVerbosity.DEBUG;break;case"INFO":K=L.LogVerbosity.INFO;break;case"ERROR":K=L.LogVerbosity.ERROR;break;case"NONE":K=L.LogVerbosity.NONE}let W=()=>$;T.getLogger=W;let Q=S=>{$=S};T.setLogger=Q;let Y=S=>{K=S};T.setLoggerVerbosity=Y;let X=(S,...T)=>{let R;if(S>=K){switch(S){case L.LogVerbosity.DEBUG:R=$.debug;break;case L.LogVerbosity.INFO:R=$.info;break;case L.LogVerbosity.ERROR:R=$.error}R||(R=$.error),R&&R.bind($)(...T)}};T.log=X;let Z=null!==(M=null!==(P=process.env.GRPC_NODE_TRACE)&&void 0!==P?P:process.env.GRPC_TRACE)&&void 0!==M?M:"",ee=new Set,et=new Set;for(let S of Z.split(","))S.startsWith("-")?et.add(S.substring(1)):ee.add(S);let er=ee.has("all");function en(S,R,N){ei(R)&&(0,T.log)(S,new Date().toISOString()+" | v"+V+" "+U.pid+" | "+R+" | "+N)}function ei(S){return!et.has(S)&&(er||ee.has(S))}T.trace=en,T.isTracerEnabled=ei},2900:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.loadPackageDefinition=T.makeClientConstructor=void 0;let N=R(526),O={unary:N.Client.prototype.makeUnaryRequest,server_stream:N.Client.prototype.makeServerStreamRequest,client_stream:N.Client.prototype.makeClientStreamRequest,bidi:N.Client.prototype.makeBidiStreamRequest};function P(S){return["__proto__","prototype","constructor"].includes(S)}function M(S,T,R){R||(R={});class M extends N.Client{}return Object.keys(S).forEach(T=>{let R;if(P(T))return;let N=S[T];if("string"==typeof T&&"$"===T.charAt(0))throw Error("Method names cannot start with $");R=N.requestStream?N.responseStream?"bidi":"client_stream":N.responseStream?"server_stream":"unary";let U=N.requestSerialize,V=N.responseDeserialize,$=L(O[R],N.path,U,V);M.prototype[T]=$,Object.assign(M.prototype[T],N),N.originalName&&!P(N.originalName)&&(M.prototype[N.originalName]=M.prototype[T])}),M.service=S,M.serviceName=T,M}function L(S,T,R,N){return function(...O){return S.call(this,T,R,N,...O)}}function U(S){return"format"in S}function V(S){let T={};for(let R in S)if(Object.prototype.hasOwnProperty.call(S,R)){let N=S[R],O=R.split(".");if(O.some(S=>P(S)))continue;let L=O[O.length-1],V=T;for(let S of O.slice(0,-1))V[S]||(V[S]={}),V=V[S];U(N)?V[L]=N:V[L]=M(N,L,{})}return T}T.makeClientConstructor=M,T.loadPackageDefinition=V},6598:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.Metadata=void 0;let N=R(4386),O=R(8905),P=R(7025),M=/^[0-9a-z_.-]+$/,L=/^[ -~]*$/;function U(S){return M.test(S)}function V(S){return L.test(S)}function $(S){return S.endsWith("-bin")}function K(S){return!S.startsWith("grpc-")}function W(S){return S.toLowerCase()}function Q(S,T){if(!U(S))throw Error('Metadata key "'+S+'" contains illegal characters');if(null!=T){if($(S)){if(!Buffer.isBuffer(T))throw Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(T))throw Error("keys that don't end with '-bin' must have String values");if(!V(T))throw Error('Metadata string value "'+T+'" contains illegal characters')}}}class Y{constructor(S={}){this.internalRepr=new Map,this.options=S}set(S,T){Q(S=W(S),T),this.internalRepr.set(S,[T])}add(S,T){Q(S=W(S),T);let R=this.internalRepr.get(S);void 0===R?this.internalRepr.set(S,[T]):R.push(T)}remove(S){S=W(S),this.internalRepr.delete(S)}get(S){return S=W(S),this.internalRepr.get(S)||[]}getMap(){let S={};for(let[T,R]of this.internalRepr)if(R.length>0){let N=R[0];S[T]=Buffer.isBuffer(N)?Buffer.from(N):N}return S}clone(){let S=new Y(this.options),T=S.internalRepr;for(let[S,R]of this.internalRepr){let N=R.map(S=>Buffer.isBuffer(S)?Buffer.from(S):S);T.set(S,N)}return S}merge(S){for(let[T,R]of S.internalRepr){let S=(this.internalRepr.get(T)||[]).concat(R);this.internalRepr.set(T,S)}}setOptions(S){this.options=S}getOptions(){return this.options}toHttp2Headers(){let S={};for(let[T,R]of this.internalRepr)S[T]=R.map(X);return S}toJSON(){let S={};for(let[T,R]of this.internalRepr)S[T]=R;return S}static fromHttp2Headers(S){let T=new Y;for(let R of Object.keys(S)){if(":"===R.charAt(0))continue;let M=S[R];try{$(R)?Array.isArray(M)?M.forEach(S=>{T.add(R,Buffer.from(S,"base64"))}):void 0!==M&&(K(R)?M.split(",").forEach(S=>{T.add(R,Buffer.from(S.trim(),"base64"))}):T.add(R,Buffer.from(M,"base64"))):Array.isArray(M)?M.forEach(S=>{T.add(R,S)}):void 0!==M&&T.add(R,M)}catch(T){let S=`Failed to add metadata entry ${R}: ${M}. ${(0,P.getErrorMessage)(T)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,N.log)(O.LogVerbosity.ERROR,S)}}return T}}T.Metadata=Y;let X=S=>Buffer.isBuffer(S)?S.toString("base64"):S},3184:(S,T,R)=>{"use strict";var N;Object.defineProperty(T,"__esModule",{value:!0}),T.QueuePicker=T.UnavailablePicker=T.PickResultType=void 0;let O=R(6598),P=R(8905);!function(S){S[S.COMPLETE=0]="COMPLETE",S[S.QUEUE=1]="QUEUE",S[S.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",S[S.DROP=3]="DROP"}(N||(T.PickResultType=N={}));class M{constructor(S){this.status=Object.assign({code:P.Status.UNAVAILABLE,details:"No connection established",metadata:new O.Metadata},S)}pick(S){return{pickResultType:N.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}}T.UnavailablePicker=M;class L{constructor(S){this.loadBalancer=S,this.calledExitIdle=!1}pick(S){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:N.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}}T.QueuePicker=L},9041:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.setup=T.DEFAULT_PORT=void 0;let N=R(5361),O=R(9523),P=R(3837),M=R(8668),L=R(8905),U=R(6598),V=R(4386),$=R(8905),K=R(6228),W=R(1808),Q=R(3339),Y="dns_resolver";function X(S){V.trace($.LogVerbosity.DEBUG,Y,S)}T.DEFAULT_PORT=443;let Z=3e4,ee=P.promisify(O.resolveTxt),et=P.promisify(O.lookup);function er(...S){let T=[];for(let R=0;R<Math.max.apply(null,S.map(S=>S.length));R++)for(let N of S)R<N.length&&T.push(N[R]);return T}class en{constructor(S,R,N){var O,P,M;this.target=S,this.listener=R,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,X("Resolver constructed for target "+(0,K.uriToString)(S));let V=(0,K.splitHostPort)(S.path);null===V?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,W.isIPv4)(V.host)||(0,W.isIPv6)(V.host)?(this.ipResult=[{host:V.host,port:null!==(O=V.port)&&void 0!==O?O:T.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=V.host,this.port=null!==(P=V.port)&&void 0!==P?P:T.DEFAULT_PORT),this.percentage=100*Math.random(),1===N["grpc.service_config_disable_resolution"]&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:L.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,K.uriToString)(this.target)}`,metadata:new U.Metadata};let $={initialDelay:N["grpc.initial_reconnect_backoff_ms"],maxDelay:N["grpc.max_reconnect_backoff_ms"]};this.backoff=new Q.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},$),this.backoff.unref(),this.minTimeBetweenResolutionsMs=null!==(M=N["grpc.dns_min_time_between_resolutions_ms"])&&void 0!==M?M:Z,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(null!==this.ipResult){this.returnedIpResult||(X("Returning IP address for target "+(0,K.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(null===this.dnsHostname)X("Failed to parse DNS address "+(0,K.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:L.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,K.uriToString)(this.target)}`,metadata:new U.Metadata})}),this.stopNextResolutionTimer();else{if(null!==this.pendingLookupPromise)return;X("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let S=this.dnsHostname;this.pendingLookupPromise=et(S,{all:!0}),this.pendingLookupPromise.then(S=>{if(null===this.pendingLookupPromise)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let T=S.filter(S=>4===S.family),R=S.filter(S=>6===S.family);this.latestLookupResult=er(R,T).map(S=>({host:S.address,port:+this.port}));let N="["+this.latestLookupResult.map(S=>S.host+":"+S.port).join(",")+"]";if(X("Resolved addresses for target "+(0,K.uriToString)(this.target)+": "+N),0===this.latestLookupResult.length){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},S=>{null!==this.pendingLookupPromise&&(X("Resolution error for target "+(0,K.uriToString)(this.target)+": "+S.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&null===this.pendingTxtPromise&&(this.pendingTxtPromise=ee(S),this.pendingTxtPromise.then(S=>{if(null!==this.pendingTxtPromise){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,M.extractAndSelectServiceConfig)(S,this.percentage)}catch(S){this.latestServiceConfigError={code:L.Status.UNAVAILABLE,details:`Parsing service config failed with error ${S.message}`,metadata:new U.Metadata}}null!==this.latestLookupResult&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},S=>{}))}}startNextResolutionTimer(){var S,T;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=null===(T=(S=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)||void 0===T?void 0:T.call(S),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){null===this.pendingLookupPromise&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){null===this.pendingLookupPromise&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?X('resolution update delayed by "min time between resolutions" rate limit'):X("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(S){return S.path}}function ei(){(0,N.registerResolver)("dns",en),(0,N.registerDefaultScheme)("dns")}T.setup=ei},8250:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.setup=void 0;let N=R(1808),O=R(8905),P=R(6598),M=R(5361),L=R(6228),U=R(4386),V="ip_resolver";function $(S){U.trace(O.LogVerbosity.DEBUG,V,S)}let K="ipv4",W="ipv6",Q=443;class Y{constructor(S,T,R){var M;this.listener=T,this.addresses=[],this.error=null,this.hasReturnedResult=!1,$("Resolver constructed for target "+(0,L.uriToString)(S));let U=[];if(!(S.scheme===K||S.scheme===W)){this.error={code:O.Status.UNAVAILABLE,details:`Unrecognized scheme ${S.scheme} in IP resolver`,metadata:new P.Metadata};return}for(let T of S.path.split(",")){let R=(0,L.splitHostPort)(T);if(null===R||S.scheme===K&&!(0,N.isIPv4)(R.host)||S.scheme===W&&!(0,N.isIPv6)(R.host)){this.error={code:O.Status.UNAVAILABLE,details:`Failed to parse ${S.scheme} address ${T}`,metadata:new P.Metadata};return}U.push({host:R.host,port:null!==(M=R.port)&&void 0!==M?M:Q})}this.addresses=U,$("Parsed "+S.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(S){return S.path.split(",")[0]}}function X(){(0,M.registerResolver)(K,Y),(0,M.registerResolver)(W,Y)}T.setup=X},4871:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.setup=void 0;let N=R(5361);class O{constructor(S,T,R){let N;this.listener=T,this.addresses=[],this.hasReturnedResult=!1,N=""===S.authority?"/"+S.path:S.path,this.addresses=[{path:N}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(S){return"localhost"}}function P(){(0,N.registerResolver)("unix",O)}T.setup=P},5361:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.mapUriDefaultScheme=T.getDefaultAuthority=T.createResolver=T.registerDefaultScheme=T.registerResolver=void 0;let N=R(6228),O={},P=null;function M(S,T){O[S]=T}function L(S){P=S}function U(S,T,R){if(void 0!==S.scheme&&S.scheme in O)return new O[S.scheme](S,T,R);throw Error(`No resolver could be created for target ${(0,N.uriToString)(S)}`)}function V(S){if(void 0!==S.scheme&&S.scheme in O)return O[S.scheme].getDefaultAuthority(S);throw Error(`Invalid target ${(0,N.uriToString)(S)}`)}function $(S){return void 0!==S.scheme&&S.scheme in O?S:null!==P?{scheme:P,authority:void 0,path:(0,N.uriToString)(S)}:null}T.registerResolver=M,T.registerDefaultScheme=L,T.createResolver=U,T.getDefaultAuthority=V,T.mapUriDefaultScheme=$},1316:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ResolvingCall=void 0;let N=R(8905),O=R(3117),P=R(6598),M=R(4386),L=R(6648),U="resolving_call";class V{constructor(S,T,R,P,M,L){this.channel=S,this.method=T,this.filterStackFactory=P,this.credentials=M,this.callNumber=L,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=R.deadline,this.host=R.host,R.parentCall&&(R.flags&N.Propagate.CANCELLATION&&R.parentCall.on("cancelled",()=>{this.cancelWithStatus(N.Status.CANCELLED,"Cancelled by parent call")}),R.flags&N.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+R.parentCall.getDeadline()),this.deadline=(0,O.minDeadline)(this.deadline,R.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(S){M.trace(N.LogVerbosity.DEBUG,U,"["+this.callNumber+"] "+S)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,O.deadlineToString)(this.deadline));let S=(0,O.getRelativeTimeout)(this.deadline);if(S!==1/0){this.trace("Deadline will be reached in "+S+"ms");let T=()=>{this.cancelWithStatus(N.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};S<=0?process.nextTick(T):this.deadlineTimer=setTimeout(T,S)}}outputStatus(S){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let T=this.filterStack.receiveTrailers(S);this.trace("ended with status: code="+T.code+' details="'+T.details+'"'),this.statusWatchers.forEach(S=>S(T)),process.nextTick(()=>{var S;null===(S=this.listener)||void 0===S||S.onReceiveStatus(T)})}}sendMessageOnChild(S,T){if(!this.child)throw Error("sendMessageonChild called with child not populated");let R=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:T,flags:S.flags})).then(T=>{this.writeFilterPending=!1,R.sendMessageWithContext(S,T.message),this.pendingHalfClose&&R.halfClose()},S=>{this.cancelWithStatus(S.code,S.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw Error("getConfig called before start");let S=this.channel.getConfig(this.method,this.metadata);if("NONE"===S.type){this.channel.queueCallForConfig(this);return}if("ERROR"===S.type){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(S.error);return}let T=S.config;if(T.status!==N.Status.OK){let{code:S,details:R}=(0,L.restrictControlPlaneStatusCode)(T.status,"Failed to route call to method "+this.method);this.outputStatus({code:S,details:R,metadata:new P.Metadata});return}if(T.methodConfig.timeout){let S=new Date;S.setSeconds(S.getSeconds()+T.methodConfig.timeout.seconds),S.setMilliseconds(S.getMilliseconds()+T.methodConfig.timeout.nanos/1e6),this.deadline=(0,O.minDeadline)(this.deadline,S),this.runDeadlineTimer()}this.filterStackFactory.push(T.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(S=>{this.child=this.channel.createInnerCall(T,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(S,{onReceiveMetadata:S=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(S))},onReceiveMessage:S=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(S).then(S=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(S),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},S=>{this.cancelWithStatus(S.code,S.details)})},onReceiveStatus:S=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=S:this.outputStatus(S)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},S=>{this.outputStatus(S)})}reportResolverError(S){var T;(null===(T=this.metadata)||void 0===T?void 0:T.getOptions().waitForReady)?this.channel.queueCallForConfig(this):this.outputStatus(S)}cancelWithStatus(S,T){var R;this.trace("cancelWithStatus code: "+S+' details: "'+T+'"'),null===(R=this.child)||void 0===R||R.cancelWithStatus(S,T),this.outputStatus({code:S,details:T,metadata:new P.Metadata})}getPeer(){var S,T;return null!==(T=null===(S=this.child)||void 0===S?void 0:S.getPeer())&&void 0!==T?T:this.channel.getTarget()}start(S,T){this.trace("start called"),this.metadata=S.clone(),this.listener=T,this.getConfig()}sendMessageWithContext(S,T){this.trace("write() called with message of length "+T.length),this.child?this.sendMessageOnChild(S,T):this.pendingMessage={context:S,message:T}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(S){this.credentials=this.credentials.compose(S)}addStatusWatcher(S){this.statusWatchers.push(S)}getCallNumber(){return this.callNumber}}T.ResolvingCall=V},7039:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ResolvingLoadBalancer=void 0;let N=R(2728),O=R(8668),P=R(5199),M=R(5361),L=R(3184),U=R(3339),V=R(8905),$=R(6598),K=R(4386),W=R(8905),Q=R(6228),Y=R(868),X="resolving_load_balancer";function Z(S){K.trace(W.LogVerbosity.DEBUG,X,S)}let ee=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function et(S,T,R,N){for(let O of R.name)switch(N){case"EMPTY":if(!O.service&&!O.method)return!0;break;case"SERVICE":if(O.service===S&&!O.method)return!0;break;case"SERVICE_AND_METHOD":if(O.service===S&&O.method===T)return!0}return!1}function er(S,T,R,N){for(let O of R)if(et(S,T,O,N))return O;return null}function en(S){return function(T,R){var N,O;let P=T.split("/").filter(S=>S.length>0),M=null!==(N=P[0])&&void 0!==N?N:"",L=null!==(O=P[1])&&void 0!==O?O:"";if(S&&S.methodConfig)for(let T of ee){let R=er(M,L,S.methodConfig,T);if(R)return{methodConfig:R,pickInformation:{},status:V.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:V.Status.OK,dynamicFilterFactories:[]}}}class ei{constructor(S,T,R,K,W){this.target=S,this.channelControlHelper=T,this.onSuccessfulResolution=K,this.onFailedResolution=W,this.latestChildState=P.ConnectivityState.IDLE,this.latestChildPicker=new L.QueuePicker(this),this.currentState=P.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,R["grpc.service_config"]?this.defaultServiceConfig=(0,O.validateServiceConfig)(JSON.parse(R["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(P.ConnectivityState.IDLE,new L.QueuePicker(this)),this.childLoadBalancer=new Y.ChildLoadBalancerHandler({createSubchannel:T.createSubchannel.bind(T),requestReresolution:()=>{this.backoffTimeout.isRunning()?(Z("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(S,T)=>{this.latestChildState=S,this.latestChildPicker=T,this.updateState(S,T)},addChannelzChild:T.addChannelzChild.bind(T),removeChannelzChild:T.removeChannelzChild.bind(T)}),this.innerResolver=(0,M.createResolver)(S,{onSuccessfulResolution:(S,T,R,O,P)=>{var M;this.backoffTimeout.stop(),this.backoffTimeout.reset();let L=null;null===T?null===R?(this.previousServiceConfig=null,L=this.defaultServiceConfig):null===this.previousServiceConfig?this.handleResolutionFailure(R):L=this.previousServiceConfig:(L=T,this.previousServiceConfig=T);let U=null!==(M=null==L?void 0:L.loadBalancingConfig)&&void 0!==M?M:[],K=(0,N.getFirstUsableConfig)(U,!0);if(null===K){this.handleResolutionFailure({code:V.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new $.Metadata});return}this.childLoadBalancer.updateAddressList(S,K,P);let W=null!=L?L:this.defaultServiceConfig;this.onSuccessfulResolution(W,null!=O?O:en(W))},onError:S=>{this.handleResolutionFailure(S)}},R);let Q={initialDelay:R["grpc.initial_reconnect_backoff_ms"],maxDelay:R["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new U.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},Q),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===P.ConnectivityState.IDLE&&this.updateState(P.ConnectivityState.CONNECTING,new L.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(S,T){Z((0,Q.uriToString)(this.target)+" "+P.ConnectivityState[this.currentState]+" -> "+P.ConnectivityState[S]),S===P.ConnectivityState.IDLE&&(T=new L.QueuePicker(this)),this.currentState=S,this.channelControlHelper.updateState(S,T)}handleResolutionFailure(S){this.latestChildState===P.ConnectivityState.IDLE&&(this.updateState(P.ConnectivityState.TRANSIENT_FAILURE,new L.UnavailablePicker(S)),this.onFailedResolution(S))}exitIdle(){(this.currentState===P.ConnectivityState.IDLE||this.currentState===P.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(S,T){throw Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=P.ConnectivityState.IDLE,this.latestChildPicker=new L.QueuePicker(this),this.currentState=P.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}}T.ResolvingLoadBalancer=ei},6230:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.RetryingCall=T.MessageBufferTracker=T.RetryThrottler=void 0;let N=R(8905),O=R(6598),P=R(4386),M="retrying_call";class L{constructor(S,T,R){this.maxTokens=S,this.tokenRatio=T,R?this.tokens=R.tokens*(S/R.maxTokens):this.tokens=S}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}}T.RetryThrottler=L;class U{constructor(S,T){this.totalLimit=S,this.limitPerCall=T,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(S,T){var R;let N=null!==(R=this.allocatedPerCall.get(T))&&void 0!==R?R:0;return!(this.limitPerCall-N<S)&&!(this.totalLimit-this.totalAllocated<S)&&(this.allocatedPerCall.set(T,N+S),this.totalAllocated+=S,!0)}free(S,T){var R;if(this.totalAllocated<S)throw Error(`Invalid buffer allocation state: call ${T} freed ${S} > total allocated ${this.totalAllocated}`);this.totalAllocated-=S;let N=null!==(R=this.allocatedPerCall.get(T))&&void 0!==R?R:0;if(N<S)throw Error(`Invalid buffer allocation state: call ${T} freed ${S} > allocated for call ${N}`);this.allocatedPerCall.set(T,N-S)}freeAll(S){var T;let R=null!==(T=this.allocatedPerCall.get(S))&&void 0!==T?T:0;if(this.totalAllocated<R)throw Error(`Invalid buffer allocation state: call ${S} allocated ${R} > total allocated ${this.totalAllocated}`);this.totalAllocated-=R,this.allocatedPerCall.delete(S)}}T.MessageBufferTracker=U;let V="grpc-previous-rpc-attempts";class ${constructor(S,T,R,N,O,P,M,L,U){if(this.channel=S,this.callConfig=T,this.methodName=R,this.host=N,this.credentials=O,this.deadline=P,this.callNumber=M,this.bufferTracker=L,this.retryThrottler=U,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,T.methodConfig.retryPolicy){this.state="RETRY";let S=T.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(S.initialBackoff.substring(0,S.initialBackoff.length-1))}else T.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(S){P.trace(N.LogVerbosity.DEBUG,M,"["+this.callNumber+"] "+S)}reportStatus(S){this.trace("ended with status: code="+S.code+' details="'+S.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var T;null===(T=this.listener)||void 0===T||T.onReceiveStatus({code:S.code,details:S.details,metadata:S.metadata})})}cancelWithStatus(S,T){for(let{call:R}of(this.trace("cancelWithStatus code: "+S+' details: "'+T+'"'),this.reportStatus({code:S,details:T,metadata:new O.Metadata}),this.underlyingCalls))R.cancelWithStatus(S,T)}getPeer(){return null!==this.committedCallIndex?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(S){var T;return null!==(T=this.writeBuffer[S-this.writeBufferOffset])&&void 0!==T?T:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if("COMMITTED"!==this.state)return;let S=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let T=this.writeBufferOffset;T<S;T++){let S=this.getBufferEntry(T);S.allocated&&this.bufferTracker.free(S.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(S-this.writeBufferOffset),this.writeBufferOffset=S}commitCall(S){if("COMMITTED"!==this.state&&"COMPLETED"!==this.underlyingCalls[S].state){this.trace("Committing call ["+this.underlyingCalls[S].call.getCallNumber()+"] at index "+S),this.state="COMMITTED",this.committedCallIndex=S;for(let T=0;T<this.underlyingCalls.length;T++)T!==S&&"COMPLETED"!==this.underlyingCalls[T].state&&(this.underlyingCalls[T].state="COMPLETED",this.underlyingCalls[T].call.cancelWithStatus(N.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if("COMMITTED"===this.state)return;let S=-1,T=-1;for(let[R,N]of this.underlyingCalls.entries())"ACTIVE"===N.state&&N.nextMessageToSend>S&&(S=N.nextMessageToSend,T=R);-1===T?this.state="TRANSPARENT_ONLY":this.commitCall(T)}isStatusCodeInList(S,T){return S.some(S=>S===T||S.toString().toLowerCase()===N.Status[T].toLowerCase())}getNextRetryBackoffMs(){var S;let T=null===(S=this.callConfig)||void 0===S?void 0:S.methodConfig.retryPolicy;if(!T)return 0;let R=Math.random()*this.nextRetryBackoffSec*1e3,N=Number(T.maxBackoff.substring(0,T.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*T.backoffMultiplier,N),R}maybeRetryCall(S,T){let R;if("RETRY"!==this.state){T(!1);return}let N=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(N.maxAttempts,5)){T(!1);return}if(null===S)R=this.getNextRetryBackoffMs();else if(S<0){this.state="TRANSPARENT_ONLY",T(!1);return}else R=S,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var S,R;if("RETRY"!==this.state){T(!1);return}(null===(R=null===(S=this.retryThrottler)||void 0===S?void 0:S.canRetryCall())||void 0===R||R)&&(T(!0),this.attempts+=1,this.startNewAttempt())},R)}countActiveCalls(){let S=0;for(let T of this.underlyingCalls)(null==T?void 0:T.state)==="ACTIVE"&&(S+=1);return S}handleProcessedStatus(S,T,R){var N,O,P;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(T),this.reportStatus(S);break;case"HEDGING":if(this.isStatusCodeInList(null!==(N=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)&&void 0!==N?N:[],S.code)){let N;if(null===(O=this.retryThrottler)||void 0===O||O.addCallFailed(),null===R)N=0;else if(R<0){this.state="TRANSPARENT_ONLY",this.commitCall(T),this.reportStatus(S);return}else N=R;setTimeout(()=>{this.maybeStartHedgingAttempt(),0===this.countActiveCalls()&&(this.commitCall(T),this.reportStatus(S))},N)}else this.commitCall(T),this.reportStatus(S);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,S.code)?(null===(P=this.retryThrottler)||void 0===P||P.addCallFailed(),this.maybeRetryCall(R,R=>{R||(this.commitCall(T),this.reportStatus(S))})):(this.commitCall(T),this.reportStatus(S))}}getPushback(S){let T=S.get("grpc-retry-pushback-ms");if(0===T.length)return null;try{return parseInt(T[0])}catch(S){return -1}}handleChildStatus(S,T){var R;if("COMPLETED"===this.underlyingCalls[T].state)return;if(this.trace("state="+this.state+" handling status with progress "+S.progress+" from child ["+this.underlyingCalls[T].call.getCallNumber()+"] in state "+this.underlyingCalls[T].state),this.underlyingCalls[T].state="COMPLETED",S.code===N.Status.OK){null===(R=this.retryThrottler)||void 0===R||R.addCallSucceeded(),this.commitCall(T),this.reportStatus(S);return}if("COMMITTED"===this.state){this.reportStatus(S);return}let O=this.getPushback(S.metadata);switch(S.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(S,T,O):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(T),this.reportStatus(S);break;case"PROCESSED":this.handleProcessedStatus(S,T,O)}}maybeStartHedgingAttempt(){if("HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let S=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(S.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var S,T,R;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),"HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let N=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(N.maxAttempts,5))return;let O=null!==(S=N.hedgingDelay)&&void 0!==S?S:"0s",P=Number(O.substring(0,O.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},1e3*P),null===(R=(T=this.hedgingTimer).unref)||void 0===R||R.call(T)}startNewAttempt(){let S=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+S.getCallNumber()+"] for attempt "+this.attempts);let T=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:S,nextMessageToSend:0});let R=this.attempts-1,N=this.initialMetadata.clone();R>0&&N.set(V,`${R}`);let O=!1;S.start(N,{onReceiveMetadata:N=>{this.trace("Received metadata from child ["+S.getCallNumber()+"]"),this.commitCall(T),O=!0,R>0&&N.set(V,`${R}`),"ACTIVE"===this.underlyingCalls[T].state&&this.listener.onReceiveMetadata(N)},onReceiveMessage:R=>{this.trace("Received message from child ["+S.getCallNumber()+"]"),this.commitCall(T),"ACTIVE"===this.underlyingCalls[T].state&&this.listener.onReceiveMessage(R)},onReceiveStatus:N=>{this.trace("Received status from child ["+S.getCallNumber()+"]"),!O&&R>0&&N.metadata.set(V,`${R}`),this.handleChildStatus(N,T)}}),this.sendNextChildMessage(T),this.readStarted&&S.startRead()}start(S,T){this.trace("start called"),this.listener=T,this.initialMetadata=S,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(S){var T,R;let N=this.underlyingCalls[S],O=N.nextMessageToSend;null===(R=(T=this.getBufferEntry(O)).callback)||void 0===R||R.call(T),this.clearSentMessages(),N.nextMessageToSend+=1,this.sendNextChildMessage(S)}sendNextChildMessage(S){let T=this.underlyingCalls[S];if("COMPLETED"!==T.state&&this.getBufferEntry(T.nextMessageToSend)){let R=this.getBufferEntry(T.nextMessageToSend);switch(R.entryType){case"MESSAGE":T.call.sendMessageWithContext({callback:T=>{this.handleChildWriteCompleted(S)}},R.message.message);break;case"HALF_CLOSE":T.nextMessageToSend+=1,T.call.halfClose()}}}sendMessageWithContext(S,T){var R;this.trace("write() called with message of length "+T.length);let N={message:T,flags:S.flags},O=this.getNextBufferIndex(),P={entryType:"MESSAGE",message:N,allocated:this.bufferTracker.allocate(T.length,this.callNumber)};if(this.writeBuffer.push(P),P.allocated)for(let[N,P]of(null===(R=S.callback)||void 0===R||R.call(S),this.underlyingCalls.entries()))"ACTIVE"===P.state&&P.nextMessageToSend===O&&P.call.sendMessageWithContext({callback:S=>{this.handleChildWriteCompleted(N)}},T);else{if(this.commitCallWithMostMessages(),null===this.committedCallIndex)return;let R=this.underlyingCalls[this.committedCallIndex];P.callback=S.callback,"ACTIVE"===R.state&&R.nextMessageToSend===O&&R.call.sendMessageWithContext({callback:S=>{this.handleChildWriteCompleted(this.committedCallIndex)}},T)}}startRead(){for(let S of(this.trace("startRead called"),this.readStarted=!0,this.underlyingCalls))(null==S?void 0:S.state)==="ACTIVE"&&S.call.startRead()}halfClose(){this.trace("halfClose called");let S=this.getNextBufferIndex();for(let T of(this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1}),this.underlyingCalls))(null==T?void 0:T.state)==="ACTIVE"&&T.nextMessageToSend===S&&(T.nextMessageToSend+=1,T.call.halfClose())}setCredentials(S){throw Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}}T.RetryingCall=$},4285:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.Http2ServerCallStream=T.ServerDuplexStreamImpl=T.ServerWritableStreamImpl=T.ServerReadableStreamImpl=T.ServerUnaryCallImpl=void 0;let N=R(2361),O=R(5158),P=R(2781),M=R(9796),L=R(8905),U=R(6598),V=R(9196),$=R(4386),K=R(7025),W="server_call";function Q(S){$.trace(L.LogVerbosity.DEBUG,W,S)}let Y="grpc-message",X="grpc-status",Z="grpc-timeout",ee=/(\d{1,8})\s*([HMSmun])/,et={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},er={"grpc-accept-encoding":"identity,deflate,gzip","grpc-encoding":"identity"},en={[O.constants.HTTP2_HEADER_STATUS]:O.constants.HTTP_STATUS_OK,[O.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},ei={waitForTrailers:!0};class es extends N.EventEmitter{constructor(S,T,R){super(),this.call=S,this.metadata=T,this.request=R,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(S){this.call.sendMetadata(S)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}T.ServerUnaryCallImpl=es;class ea extends P.Readable{constructor(S,T,R,N){super({objectMode:!0}),this.call=S,this.metadata=T,this.deserialize=R,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,N)}_read(S){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(S){this.call.sendMetadata(S)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}T.ServerReadableStreamImpl=ea;class eo extends P.Writable{constructor(S,T,R,N){super({objectMode:!0}),this.call=S,this.metadata=T,this.serialize=R,this.request=N,this.cancelled=!1,this.trailingMetadata=new U.Metadata,this.call.setupSurfaceCall(this),this.on("error",S=>{this.call.sendError(S),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(S){this.call.sendMetadata(S)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(S,T,R){try{let T=this.call.serializeMessage(S);if(!this.call.write(T)){this.call.once("drain",R);return}}catch(S){this.emit("error",{details:(0,K.getErrorMessage)(S),code:L.Status.INTERNAL})}R()}_final(S){this.call.sendStatus({code:L.Status.OK,details:"OK",metadata:this.trailingMetadata}),S(null)}end(S){return S&&(this.trailingMetadata=S),super.end()}}T.ServerWritableStreamImpl=eo;class eu extends P.Duplex{constructor(S,T,R,N,O){super({objectMode:!0}),this.call=S,this.metadata=T,this.serialize=R,this.deserialize=N,this.cancelled=!1,this.trailingMetadata=new U.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,O),this.on("error",S=>{this.call.sendError(S),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(S){this.call.sendMetadata(S)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(S){return S&&(this.trailingMetadata=S),super.end()}}T.ServerDuplexStreamImpl=eu,eu.prototype._read=ea.prototype._read,eu.prototype._write=eo.prototype._write,eu.prototype._final=eo.prototype._final;class ec extends N.EventEmitter{constructor(S,T,R){super(),this.stream=S,this.handler=T,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=L.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=L.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",S=>{}),this.stream.once("close",()=>{var S;Q("Request to method "+(null===(S=this.handler)||void 0===S?void 0:S.path)+" stream closed with rstCode "+this.stream.rstCode),!this.statusSent&&(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:L.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in R&&(this.maxSendMessageSize=R["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in R&&(this.maxReceiveMessageSize=R["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(S,T){let R=S.subarray(5);if("identity"===T)return R;if("deflate"!==T&&"gzip"!==T)return Promise.reject({code:L.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${T}"`});{let S;return S="deflate"===T?M.createInflate():M.createGunzip(),new Promise((T,N)=>{let O=0,P=[];S.on("data",T=>{P.push(T),O+=T.byteLength,-1!==this.maxReceiveMessageSize&&O>this.maxReceiveMessageSize&&(S.destroy(),N({code:L.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),S.on("end",()=>{T(Buffer.concat(P))}),S.write(R),S.end()})}}sendMetadata(S){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let T=S?S.toHttp2Headers():null,R=Object.assign(Object.assign(Object.assign({},en),er),T);this.stream.respond(R,ei)}receiveMetadata(S){let T=U.Metadata.fromHttp2Headers(S);$.isTracerEnabled(W)&&Q("Request to "+this.handler.path+" received headers "+JSON.stringify(T.toJSON()));let R=T.get(Z);if(R.length>0){let S=R[0].toString().match(ee);if(null===S){let S=Error("Invalid deadline");return S.code=L.Status.OUT_OF_RANGE,this.sendError(S),T}let N=+S[1]*et[S[2]]|0,O=new Date;this.deadline=O.setMilliseconds(O.getMilliseconds()+N),this.deadlineTimer=setTimeout(ed,N,this),T.remove(Z)}return T.remove(O.constants.HTTP2_HEADER_ACCEPT_ENCODING),T.remove(O.constants.HTTP2_HEADER_TE),T.remove(O.constants.HTTP2_HEADER_CONTENT_TYPE),T.remove("grpc-accept-encoding"),T}receiveUnaryMessage(S){return new Promise((T,R)=>{let{stream:N}=this,O=0,P=this,M=[],U=this.maxReceiveMessageSize;function V(S){if(O+=S.byteLength,-1!==U&&O>U){N.removeListener("data",V),N.removeListener("end",$),N.removeListener("error",$),R({code:L.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${O} vs. ${U})`});return}M.push(S)}function $(U){if(N.removeListener("data",V),N.removeListener("end",$),N.removeListener("error",$),void 0!==U){R({code:L.Status.INTERNAL,details:U.message});return}if(0===O){R({code:L.Status.INTERNAL,details:"received empty unary message"});return}P.emit("receiveMessage");let K=Buffer.concat(M,O),W=1===K.readUInt8(0)?S:"identity",Q=P.getDecompressedMessage(K,W);if(Buffer.isBuffer(Q)){T(P.deserializeMessageWithInternalError(Q));return}Q.then(S=>T(P.deserializeMessageWithInternalError(S)),T=>R(T.code?T:{code:L.Status.INTERNAL,details:`Received "grpc-encoding" header "${S}" but ${S} decompression failed`}))}this.stream.on("data",V),this.stream.on("end",$),this.stream.on("error",$)})}async deserializeMessageWithInternalError(S){try{return this.deserializeMessage(S)}catch(S){throw{details:(0,K.getErrorMessage)(S),code:L.Status.INTERNAL}}}serializeMessage(S){let T=this.handler.serialize(S),R=T.byteLength,N=Buffer.allocUnsafe(R+5);return N.writeUInt8(0,0),N.writeUInt32BE(R,1),T.copy(N,5),N}deserializeMessage(S){return this.handler.deserialize(S)}async sendUnaryMessage(S,T,R,N){if(!this.checkCancelled()){if(void 0===R&&(R=null),S){!Object.prototype.hasOwnProperty.call(S,"metadata")&&R&&(S.metadata=R),this.sendError(S);return}try{let S=this.serializeMessage(T);this.write(S),this.sendStatus({code:L.Status.OK,details:"OK",metadata:R})}catch(S){this.sendError({details:(0,K.getErrorMessage)(S),code:L.Status.INTERNAL})}}}sendStatus(S){var T,R;if(this.emit("callEnd",S.code),this.emit("streamEnd",S.code===L.Status.OK),!this.checkCancelled()){if(Q("Request to method "+(null===(T=this.handler)||void 0===T?void 0:T.path)+" ended with status code: "+L.Status[S.code]+" details: "+S.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var T;let R=Object.assign({[X]:S.code,[Y]:encodeURI(S.details)},null===(T=S.metadata)||void 0===T?void 0:T.toHttp2Headers());this.stream.sendTrailers(R),this.statusSent=!0}),this.stream.end());else{let T=Object.assign(Object.assign({[X]:S.code,[Y]:encodeURI(S.details)},en),null===(R=S.metadata)||void 0===R?void 0:R.toHttp2Headers());this.stream.respond(T,{endStream:!0}),this.statusSent=!0}}}sendError(S){let T={code:L.Status.UNKNOWN,details:"message"in S?S.message:"Unknown Error",metadata:"metadata"in S&&void 0!==S.metadata?S.metadata:null};"code"in S&&"number"==typeof S.code&&Number.isInteger(S.code)&&(T.code=S.code,"details"in S&&"string"==typeof S.details&&(T.details=S.details)),this.sendStatus(T)}write(S){if(!this.checkCancelled()){if(-1!==this.maxSendMessageSize&&S.length>this.maxSendMessageSize){this.sendError({code:L.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${S.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(S)}}resume(){this.stream.resume()}setupSurfaceCall(S){this.once("cancelled",T=>{S.cancelled=!0,S.emit("cancelled",T)}),this.once("callEnd",T=>S.emit("callEnd",T))}setupReadable(S,T){let R=new V.StreamDecoder(this.maxReceiveMessageSize),N=!1,O=!1,P=!1,M=async()=>{P||!N||O||(P=!0,await this.pushOrBufferMessage(S,null))};this.stream.on("data",async N=>{let P;try{P=R.write(N)}catch(S){this.sendError({code:L.Status.RESOURCE_EXHAUSTED,details:S.message});return}for(let R of(O=!0,this.stream.pause(),P)){let N;this.emit("receiveMessage");let O=1===R.readUInt8(0)?T:"identity";try{N=await this.getDecompressedMessage(R,O)}catch(S){this.sendError(S);return}if(!N)return;await this.pushOrBufferMessage(S,N)}O=!1,this.stream.resume(),await M()}),this.stream.once("end",async()=>{N=!0,await M()})}consumeUnpushedMessages(S){for(this.canPush=!0;this.messagesToPush.length>0;){let T=this.messagesToPush.shift(),R=S.push(T);if(null===T||!1===R){this.canPush=!1;break}}return this.canPush}async pushOrBufferMessage(S,T){this.isPushPending?this.bufferedMessages.push(T):await this.pushMessage(S,T)}async pushMessage(S,T){if(null===T){Q("Received end of stream"),this.canPush?S.push(null):this.messagesToPush.push(null);return}Q("Received message of length "+T.length),this.isPushPending=!0;try{let R=await this.deserializeMessage(T);this.canPush?S.push(R)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(R)}catch(R){this.bufferedMessages.length=0;let T=(0,K.getErrorCode)(R);(null===T||T<L.Status.OK||T>L.Status.UNAUTHENTICATED)&&(T=L.Status.INTERNAL),S.emit("error",{details:(0,K.getErrorMessage)(R),code:T})}this.isPushPending=!1,this.bufferedMessages.length>0&&await this.pushMessage(S,this.bufferedMessages.shift())}getPeer(){var S;let T=null===(S=this.stream.session)||void 0===S?void 0:S.socket;return null!=T&&T.remoteAddress?T.remotePort?`${T.remoteAddress}:${T.remotePort}`:T.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}}function ed(S){let T=Error("Deadline exceeded");T.code=L.Status.DEADLINE_EXCEEDED,S.sendError(T),S.cancelled=!0,S.emit("cancelled","deadline")}T.Http2ServerCallStream=ec},4288:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ServerCredentials=void 0;let N=R(6337);class O{static createInsecure(){return new P}static createSsl(S,T,R=!1){if(null!==S&&!Buffer.isBuffer(S))throw TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(T))throw TypeError("keyCertPairs must be an array");if("boolean"!=typeof R)throw TypeError("checkClientCertificate must be a boolean");let O=[],P=[];for(let S=0;S<T.length;S++){let R=T[S];if(null===R||"object"!=typeof R)throw TypeError(`keyCertPair[${S}] must be an object`);if(!Buffer.isBuffer(R.private_key))throw TypeError(`keyCertPair[${S}].private_key must be a Buffer`);if(!Buffer.isBuffer(R.cert_chain))throw TypeError(`keyCertPair[${S}].cert_chain must be a Buffer`);O.push(R.cert_chain),P.push(R.private_key)}return new M({ca:S||(0,N.getDefaultRootsData)()||void 0,cert:O,key:P,requestCert:R,ciphers:N.CIPHER_SUITES})}}T.ServerCredentials=O;class P extends O{_isSecure(){return!1}_getSettings(){return null}}class M extends O{constructor(S){super(),this.options=S}_isSecure(){return!0}_getSettings(){return this.options}}},1798:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.Server=void 0;let N=R(5158),O=R(8905),P=R(4285),M=R(4288),L=R(5361),U=R(4386),V=R(476),$=R(6228),K=R(4174),W=2147483647,Q=2147483647,Y=2e4,{HTTP2_HEADER_PATH:X}=N.constants,Z="server";function ee(){}function et(S){return{code:O.Status.UNIMPLEMENTED,details:`The server does not implement the method ${S}`}}function er(S,T){let R=et(T);switch(S){case"unary":return(S,T)=>{T(R,null)};case"clientStream":return(S,T)=>{T(R,null)};case"serverStream":return S=>{S.emit("error",R)};case"bidi":return S=>{S.emit("error",R)};default:throw Error(`Invalid handlerType ${S}`)}}class en{constructor(S){var T,R,N,O;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new K.ChannelzTrace,this.callTracker=new K.ChannelzCallTracker,this.listenerChildrenTracker=new K.ChannelzChildrenTracker,this.sessionChildrenTracker=new K.ChannelzChildrenTracker,this.options=null!=S?S:{},0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,K.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=null!==(T=this.options["grpc.max_connection_age_ms"])&&void 0!==T?T:W,this.maxConnectionAgeGraceMs=null!==(R=this.options["grpc.max_connection_age_grace_ms"])&&void 0!==R?R:W,this.keepaliveTimeMs=null!==(N=this.options["grpc.keepalive_time_ms"])&&void 0!==N?N:Q,this.keepaliveTimeoutMs=null!==(O=this.options["grpc.keepalive_timeout_ms"])&&void 0!==O?O:Y,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(S){return()=>{var T,R,N;let O;let P=this.sessions.get(S),M=S.socket,L=M.remoteAddress?(0,V.stringToSubchannelAddress)(M.remoteAddress,M.remotePort):null,U=M.localAddress?(0,V.stringToSubchannelAddress)(M.localAddress,M.localPort):null;if(S.encrypted){let S=M,R=S.getCipher(),N=S.getCertificate(),P=S.getPeerCertificate();O={cipherSuiteStandardName:null!==(T=R.standardName)&&void 0!==T?T:null,cipherSuiteOtherName:R.standardName?null:R.name,localCertificate:N&&"raw"in N?N.raw:null,remoteCertificate:P&&"raw"in P?P.raw:null}}else O=null;return{remoteAddress:L,localAddress:U,security:O,remoteName:null,streamsStarted:P.streamTracker.callsStarted,streamsSucceeded:P.streamTracker.callsSucceeded,streamsFailed:P.streamTracker.callsFailed,messagesSent:P.messagesSent,messagesReceived:P.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:P.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:P.lastMessageSentTimestamp,lastMessageReceivedTimestamp:P.lastMessageReceivedTimestamp,localFlowControlWindow:null!==(R=S.state.localWindowSize)&&void 0!==R?R:null,remoteFlowControlWindow:null!==(N=S.state.remoteWindowSize)&&void 0!==N?N:null}}}trace(S){U.trace(O.LogVerbosity.DEBUG,Z,"("+this.channelzRef.id+") "+S)}addProtoService(){throw Error("Not implemented. Use addService() instead")}addService(S,T){if(null===S||"object"!=typeof S||null===T||"object"!=typeof T)throw Error("addService() requires two objects as arguments");let R=Object.keys(S);if(0===R.length)throw Error("Cannot add an empty service to a server");R.forEach(R=>{let N,O;let P=S[R];N=P.requestStream?P.responseStream?"bidi":"clientStream":P.responseStream?"serverStream":"unary";let M=T[R];if(void 0===M&&"string"==typeof P.originalName&&(M=T[P.originalName]),O=void 0!==M?M.bind(T):er(N,R),!1===this.register(P.path,O,P.responseSerialize,P.requestDeserialize,N))throw Error(`Method handler for ${P.path} already provided.`)})}removeService(S){if(null===S||"object"!=typeof S)throw Error("removeService() requires object as argument");Object.keys(S).forEach(T=>{let R=S[T];this.unregister(R.path)})}bind(S,T){throw Error("Not implemented. Use bindAsync() instead")}bindAsync(S,T,R){if(!0===this.started)throw Error("server is already started");if(this.shutdown)throw Error("bindAsync called after shutdown");if("string"!=typeof S)throw TypeError("port must be a string");if(null===T||!(T instanceof M.ServerCredentials))throw TypeError("creds must be a ServerCredentials object");if("function"!=typeof R)throw TypeError("callback must be a function");let P=(0,$.parseUri)(S);if(null===P)throw Error(`Could not parse port "${S}"`);let W=(0,L.mapUriDefaultScheme)(P);if(null===W)throw Error(`Could not get a default scheme for port "${S}"`);let Q={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?Q.maxSessionMemory=this.options["grpc-node.max_session_memory"]:Q.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(Q.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let Y=(S,T)=>{process.nextTick(()=>R(S,T))},X=()=>{let S;if(T._isSecure()){let R=Object.assign(Q,T._getSettings());R.enableTrace=1===this.options["grpc-node.tls_enable_trace"],(S=N.createSecureServer(R)).on("secureConnection",S=>{S.on("error",S=>{this.trace("An incoming TLS connection closed with error: "+S.message)})})}else S=N.createServer(Q);return S.setTimeout(0,ee),this._setupHandlers(S),S},Z=(S,T,R)=>0===S.length?Promise.resolve({port:T,count:R}):Promise.all(S.map(S=>{let R;this.trace("Attempting to bind "+(0,V.subchannelAddressToString)(S)),R=(0,V.isTcpSubchannelAddress)(S)?{host:S.host,port:T}:S;let N=X();return new Promise((O,P)=>{let M=T=>{this.trace("Failed to bind "+(0,V.subchannelAddressToString)(S)+" with error "+T.message),O(T)};N.once("error",M),N.listen(R,()=>{let S;if(this.shutdown){N.close(),O(Error("bindAsync failed because server is shutdown"));return}let R=N.address();S="string"==typeof R?{path:R}:{host:R.address,port:R.port};let P=(0,K.registerChannelzSocket)((0,V.subchannelAddressToString)(S),()=>({localAddress:S,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(P),this.http2ServerList.push({server:N,channelzRef:P}),this.trace("Successfully bound "+(0,V.subchannelAddressToString)(S)),O("port"in S?S.port:T),N.removeListener("error",M)})})})).then(S=>{let N=0;for(let R of S)if("number"==typeof R&&(N+=1,R!==T))throw Error("Invalid state: multiple port numbers added from single address");return{port:T,count:N+R}}),et=S=>{if(0===S.length)return Promise.resolve({port:0,count:0});let T=S[0],R=X();return new Promise((N,O)=>{let P=R=>{this.trace("Failed to bind "+(0,V.subchannelAddressToString)(T)+" with error "+R.message),N(et(S.slice(1)))};R.once("error",P),R.listen(T,()=>{if(this.shutdown){R.close(),N({port:0,count:0});return}let T=R.address(),O={host:T.address,port:T.port},M=(0,K.registerChannelzSocket)((0,V.subchannelAddressToString)(O),()=>({localAddress:O,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(M),this.http2ServerList.push({server:R,channelzRef:M}),this.trace("Successfully bound "+(0,V.subchannelAddressToString)(O)),N(Z(S.slice(1),T.port,1)),R.removeListener("error",P)})})},er={onSuccessfulResolution:(T,R,N)=>{let P;if(er.onSuccessfulResolution=()=>{},this.shutdown&&Y(Error("bindAsync failed because server is shutdown"),0),0===T.length){Y(Error(`No addresses resolved for port ${S}`),0);return}(P=(0,V.isTcpSubchannelAddress)(T[0])?0===T[0].port?et(T):Z(T,T[0].port,0):Z(T,1,0)).then(S=>{if(0===S.count){let S=`No address added out of total ${T.length} resolved`;U.log(O.LogVerbosity.ERROR,S),Y(Error(S),0)}else S.count<T.length&&U.log(O.LogVerbosity.INFO,`WARNING Only ${S.count} addresses added out of total ${T.length} resolved`),Y(null,S.port)},S=>{let R=`No address added out of total ${T.length} resolved`;U.log(O.LogVerbosity.ERROR,R),Y(Error(R),0)})},onError:S=>{Y(Error(S.details),0)}};(0,L.createResolver)(W,er,this.options).updateResolution()}forceShutdown(){for(let{server:S,channelzRef:T}of this.http2ServerList)S.listening&&S.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(T),(0,K.unregisterChannelzRef)(T))});this.started=!1,this.shutdown=!0,this.sessions.forEach((S,T)=>{T.destroy(N.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,K.unregisterChannelzRef)(this.channelzRef)}register(S,T,R,N,O){return!this.handlers.has(S)&&(this.handlers.set(S,{func:T,serialize:R,deserialize:N,type:O,path:S}),!0)}unregister(S){return this.handlers.delete(S)}start(){if(0===this.http2ServerList.length||this.http2ServerList.every(({server:S})=>!0!==S.listening))throw Error("server must be bound in order to start");if(!0===this.started)throw Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(S){let T=T=>{this.channelzEnabled&&(0,K.unregisterChannelzRef)(this.channelzRef),S(T)},R=0;function N(){0==--R&&T()}for(let{server:S,channelzRef:T}of(this.started=!1,this.shutdown=!0,this.http2ServerList))S.listening&&(R++,S.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(T),(0,K.unregisterChannelzRef)(T)),N()}));this.sessions.forEach((S,T)=>{T.closed||(R+=1,T.close(N))}),0===R&&T()}addHttp2Port(){throw Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(S,T){let R=T[N.constants.HTTP2_HEADER_CONTENT_TYPE];return!!("string"==typeof R&&R.startsWith("application/grpc"))||(S.respond({[N.constants.HTTP2_HEADER_STATUS]:N.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1)}_retrieveHandler(S){this.trace("Received call to method "+S+" at address "+this.serverAddressString);let T=this.handlers.get(S);return void 0===T?(this.trace("No handler registered for method "+S+". Sending UNIMPLEMENTED status."),null):T}_respondWithError(S,T,R=null){let N=new P.Http2ServerCallStream(T,null,this.options);void 0===S.code&&(S.code=O.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),null==R||R.streamTracker.addCallFailed()),N.sendError(S)}_channelzHandler(S,T){let R=this.sessions.get(S.session);if(this.callTracker.addCallStarted(),null==R||R.streamTracker.addCallStarted(),!this._verifyContentType(S,T)){this.callTracker.addCallFailed(),null==R||R.streamTracker.addCallFailed();return}let N=T[X],M=this._retrieveHandler(N);if(!M){this._respondWithError(et(N),S,R);return}let L=new P.Http2ServerCallStream(S,M,this.options);L.once("callEnd",S=>{S===O.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),R&&(L.once("streamEnd",S=>{S?R.streamTracker.addCallSucceeded():R.streamTracker.addCallFailed()}),L.on("sendMessage",()=>{R.messagesSent+=1,R.lastMessageSentTimestamp=new Date}),L.on("receiveMessage",()=>{R.messagesReceived+=1,R.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(L,M,T)||(this.callTracker.addCallFailed(),null==R||R.streamTracker.addCallFailed(),L.sendError({code:O.Status.INTERNAL,details:`Unknown handler type: ${M.type}`}))}_streamHandler(S,T){if(!0!==this._verifyContentType(S,T))return;let R=T[X],N=this._retrieveHandler(R);if(!N){this._respondWithError(et(R),S,null);return}let M=new P.Http2ServerCallStream(S,N,this.options);this._runHandlerForCall(M,N,T)||M.sendError({code:O.Status.INTERNAL,details:`Unknown handler type: ${N.type}`})}_runHandlerForCall(S,T,R){var N;let O=S.receiveMetadata(R),P=null!==(N=O.get("grpc-encoding")[0])&&void 0!==N?N:"identity";O.remove("grpc-encoding");let{type:M}=T;if("unary"===M)ei(S,T,O,P);else if("clientStream"===M)es(S,T,O,P);else if("serverStream"===M)ea(S,T,O,P);else{if("bidi"!==M)return!1;eo(S,T,O,P)}return!0}_setupHandlers(S){if(null===S)return;let T=S.address(),R="null";T&&(R="string"==typeof T?T:T.address+":"+T.port),this.serverAddressString=R;let O=this.channelzEnabled?this._channelzHandler:this._streamHandler;S.on("stream",O.bind(this)),S.on("session",S=>{var T,R,O,P,M;if(!this.started){S.destroy();return}let L=(0,K.registerChannelzSocket)(null!==(T=S.socket.remoteAddress)&&void 0!==T?T:"unknown",this.getChannelzSessionInfoGetter(S),this.channelzEnabled),U={ref:L,streamTracker:new K.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(S,U);let V=S.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+V),this.sessionChildrenTracker.refChild(L));let $=null,Q=null,Y=!1;if(this.maxConnectionAgeMs!==W){let T=this.maxConnectionAgeMs/10,P=Math.random()*T*2-T;$=null===(O=(R=setTimeout(()=>{var T,R;Y=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+V);try{S.goaway(N.constants.NGHTTP2_NO_ERROR,2147483647,Buffer.from("max_age"))}catch(T){S.destroy();return}S.close(),this.maxConnectionAgeGraceMs!==W&&(Q=null===(R=(T=setTimeout(()=>{S.destroy()},this.maxConnectionAgeGraceMs)).unref)||void 0===R?void 0:R.call(T))},this.maxConnectionAgeMs+P)).unref)||void 0===O?void 0:O.call(R)}let X=null===(M=(P=setInterval(()=>{var T,R;let N=null===(R=(T=setTimeout(()=>{Y=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+V),S.close()},this.keepaliveTimeoutMs)).unref)||void 0===R?void 0:R.call(T);try{S.ping((S,T,R)=>{clearTimeout(N)})}catch(T){S.destroy()}},this.keepaliveTimeMs)).unref)||void 0===M?void 0:M.call(P);S.on("close",()=>{this.channelzEnabled&&(Y||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+V),this.sessionChildrenTracker.unrefChild(L),(0,K.unregisterChannelzRef)(L)),$&&clearTimeout($),Q&&clearTimeout(Q),X&&clearTimeout(X),this.sessions.delete(S)})})}}async function ei(S,T,R,N){try{let O=await S.receiveUnaryMessage(N);if(void 0===O||S.cancelled)return;let M=new P.ServerUnaryCallImpl(S,R,O);T.func(M,(T,R,N,O)=>{S.sendUnaryMessage(T,R,N,O)})}catch(T){S.sendError(T)}}function es(S,T,R,N){let O=new P.ServerReadableStreamImpl(S,R,T.deserialize,N);function M(T,R,N,P){O.destroy(),S.sendUnaryMessage(T,R,N,P)}S.cancelled||(O.on("error",M),T.func(O,M))}async function ea(S,T,R,N){try{let O=await S.receiveUnaryMessage(N);if(void 0===O||S.cancelled)return;let M=new P.ServerWritableStreamImpl(S,R,T.serialize,O);T.func(M)}catch(T){S.sendError(T)}}function eo(S,T,R,N){let O=new P.ServerDuplexStreamImpl(S,R,T.serialize,T.deserialize,N);S.cancelled||T.func(O)}T.Server=en},8668:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.extractAndSelectServiceConfig=T.validateServiceConfig=T.validateRetryThrottling=void 0;let N=R(2037),O=R(8905),P=R(2728),M=/^\d+(\.\d{1,9})?s$/,L="node";function U(S){if("service"in S&&""!==S.service){if("string"!=typeof S.service)throw Error(`Invalid method config name: invalid service: expected type string, got ${typeof S.service}`);if(!("method"in S)||""===S.method)return{service:S.service};if("string"!=typeof S.method)throw Error(`Invalid method config name: invalid method: expected type string, got ${typeof S.service}`);return{service:S.service,method:S.method}}if("method"in S&&void 0!==S.method)throw Error("Invalid method config name: method set with empty or unset service");return{}}function V(S){if(!("maxAttempts"in S)||!Number.isInteger(S.maxAttempts)||S.maxAttempts<2)throw Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in S)||"string"!=typeof S.initialBackoff||!M.test(S.initialBackoff))throw Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in S)||"string"!=typeof S.maxBackoff||!M.test(S.maxBackoff))throw Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in S)||"number"!=typeof S.backoffMultiplier||S.backoffMultiplier<=0)throw Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in S&&Array.isArray(S.retryableStatusCodes)))throw Error("Invalid method config retry policy: retryableStatusCodes is required");if(0===S.retryableStatusCodes.length)throw Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let T of S.retryableStatusCodes)if("number"==typeof T){if(!Object.values(O.Status).includes(T))throw Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if("string"==typeof T){if(!Object.values(O.Status).includes(T.toUpperCase()))throw Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:S.maxAttempts,initialBackoff:S.initialBackoff,maxBackoff:S.maxBackoff,backoffMultiplier:S.backoffMultiplier,retryableStatusCodes:S.retryableStatusCodes}}function $(S){if(!("maxAttempts"in S)||!Number.isInteger(S.maxAttempts)||S.maxAttempts<2)throw Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in S&&("string"!=typeof S.hedgingDelay||!M.test(S.hedgingDelay)))throw Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in S&&Array.isArray(S.nonFatalStatusCodes))for(let T of S.nonFatalStatusCodes)if("number"==typeof T){if(!Object.values(O.Status).includes(T))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if("string"==typeof T){if(!Object.values(O.Status).includes(T.toUpperCase()))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let T={maxAttempts:S.maxAttempts};return S.hedgingDelay&&(T.hedgingDelay=S.hedgingDelay),S.nonFatalStatusCodes&&(T.nonFatalStatusCodes=S.nonFatalStatusCodes),T}function K(S){var T;let R={name:[]};if(!("name"in S)||!Array.isArray(S.name))throw Error("Invalid method config: invalid name array");for(let T of S.name)R.name.push(U(T));if("waitForReady"in S){if("boolean"!=typeof S.waitForReady)throw Error("Invalid method config: invalid waitForReady");R.waitForReady=S.waitForReady}if("timeout"in S){if("object"==typeof S.timeout){if(!("seconds"in S.timeout)||"number"!=typeof S.timeout.seconds)throw Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in S.timeout)||"number"!=typeof S.timeout.nanos)throw Error("Invalid method config: invalid timeout.nanos");R.timeout=S.timeout}else if("string"==typeof S.timeout&&M.test(S.timeout)){let N=S.timeout.substring(0,S.timeout.length-1).split(".");R.timeout={seconds:0|N[0],nanos:(null!==(T=N[1])&&void 0!==T?T:0)|0}}else throw Error("Invalid method config: invalid timeout")}if("maxRequestBytes"in S){if("number"!=typeof S.maxRequestBytes)throw Error("Invalid method config: invalid maxRequestBytes");R.maxRequestBytes=S.maxRequestBytes}if("maxResponseBytes"in S){if("number"!=typeof S.maxResponseBytes)throw Error("Invalid method config: invalid maxRequestBytes");R.maxResponseBytes=S.maxResponseBytes}if("retryPolicy"in S){if("hedgingPolicy"in S)throw Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");R.retryPolicy=V(S.retryPolicy)}else"hedgingPolicy"in S&&(R.hedgingPolicy=$(S.hedgingPolicy));return R}function W(S){if(!("maxTokens"in S)||"number"!=typeof S.maxTokens||S.maxTokens<=0||S.maxTokens>1e3)throw Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in S)||"number"!=typeof S.tokenRatio||S.tokenRatio<=0)throw Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+S.maxTokens.toFixed(3),tokenRatio:+S.tokenRatio.toFixed(3)}}function Q(S){let T={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in S){if("string"==typeof S.loadBalancingPolicy)T.loadBalancingPolicy=S.loadBalancingPolicy;else throw Error("Invalid service config: invalid loadBalancingPolicy")}if("loadBalancingConfig"in S){if(Array.isArray(S.loadBalancingConfig))for(let R of S.loadBalancingConfig)T.loadBalancingConfig.push((0,P.validateLoadBalancingConfig)(R));else throw Error("Invalid service config: invalid loadBalancingConfig")}if("methodConfig"in S&&Array.isArray(S.methodConfig))for(let R of S.methodConfig)T.methodConfig.push(K(R));"retryThrottling"in S&&(T.retryThrottling=W(S.retryThrottling));let R=[];for(let S of T.methodConfig)for(let T of S.name){for(let S of R)if(T.service===S.service&&T.method===S.method)throw Error(`Invalid service config: duplicate name ${T.service}/${T.method}`);R.push(T)}return T}function Y(S){if(!("serviceConfig"in S))throw Error("Invalid service config choice: missing service config");let T={serviceConfig:Q(S.serviceConfig)};if("clientLanguage"in S){if(Array.isArray(S.clientLanguage))for(let R of(T.clientLanguage=[],S.clientLanguage))if("string"==typeof R)T.clientLanguage.push(R);else throw Error("Invalid service config choice: invalid clientLanguage");else throw Error("Invalid service config choice: invalid clientLanguage")}if("clientHostname"in S){if(Array.isArray(S.clientHostname))for(let R of(T.clientHostname=[],S.clientHostname))if("string"==typeof R)T.clientHostname.push(R);else throw Error("Invalid service config choice: invalid clientHostname");else throw Error("Invalid service config choice: invalid clientHostname")}if("percentage"in S){if("number"==typeof S.percentage&&0<=S.percentage&&S.percentage<=100)T.percentage=S.percentage;else throw Error("Invalid service config choice: invalid percentage")}let R=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let T in S)if(!R.includes(T))throw Error(`Invalid service config choice: unexpected field ${T}`);return T}function X(S,T){if(!Array.isArray(S))throw Error("Invalid service config list");for(let R of S){let S=Y(R);if("number"!=typeof S.percentage||!(T>S.percentage)){if(Array.isArray(S.clientHostname)){let T=!1;for(let R of S.clientHostname)R===N.hostname()&&(T=!0);if(!T)continue}if(Array.isArray(S.clientLanguage)){let T=!1;for(let R of S.clientLanguage)R===L&&(T=!0);if(!T)continue}return S.serviceConfig}}throw Error("No matching service config found")}function Z(S,T){for(let R of S)if(R.length>0&&R[0].startsWith("grpc_config="))return X(JSON.parse(R.join("").substring(12)),T);return null}T.validateRetryThrottling=W,T.validateServiceConfig=Q,T.extractAndSelectServiceConfig=Z},1192:(S,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.StatusBuilder=void 0;class R{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(S){return this.code=S,this}withDetails(S){return this.details=S,this}withMetadata(S){return this.metadata=S,this}build(){let S={};return null!==this.code&&(S.code=this.code),null!==this.details&&(S.details=this.details),null!==this.metadata&&(S.metadata=this.metadata),S}}T.StatusBuilder=R},9196:(S,T)=>{"use strict";var R;Object.defineProperty(T,"__esModule",{value:!0}),T.StreamDecoder=void 0,function(S){S[S.NO_DATA=0]="NO_DATA",S[S.READING_SIZE=1]="READING_SIZE",S[S.READING_MESSAGE=2]="READING_MESSAGE"}(R||(R={}));class N{constructor(S){this.maxReadMessageLength=S,this.readState=R.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(S){let T,N=0,O=[];for(;N<S.length;)switch(this.readState){case R.NO_DATA:this.readCompressFlag=S.slice(N,N+1),N+=1,this.readState=R.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case R.READING_SIZE:if(T=Math.min(S.length-N,this.readSizeRemaining),S.copy(this.readPartialSize,4-this.readSizeRemaining,N,N+T),this.readSizeRemaining-=T,N+=T,0===this.readSizeRemaining){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),-1!==this.maxReadMessageLength&&this.readMessageSize>this.maxReadMessageLength)throw Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=R.READING_MESSAGE;else{let S=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=R.NO_DATA,O.push(S)}}break;case R.READING_MESSAGE:if(T=Math.min(S.length-N,this.readMessageRemaining),this.readPartialMessage.push(S.slice(N,N+T)),this.readMessageRemaining-=T,N+=T,0===this.readMessageRemaining){let S=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),T=Buffer.concat(S,this.readMessageSize+5);this.readState=R.NO_DATA,O.push(T)}break;default:throw Error("Unexpected read state")}return O}}T.StreamDecoder=N},476:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.stringToSubchannelAddress=T.subchannelAddressToString=T.subchannelAddressEqual=T.isTcpSubchannelAddress=void 0;let N=R(1808);function O(S){return"port"in S}function P(S,T){return!S&&!T||!!S&&!!T&&(O(S)?O(T)&&S.host===T.host&&S.port===T.port:!O(T)&&S.path===T.path)}function M(S){return O(S)?S.host+":"+S.port:S.path}T.isTcpSubchannelAddress=O,T.subchannelAddressEqual=P,T.subchannelAddressToString=M;let L=443;function U(S,T){return(0,N.isIP)(S)?{host:S,port:null!=T?T:L}:{path:S}}T.stringToSubchannelAddress=U},9862:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.Http2SubchannelCall=void 0;let N=R(5158),O=R(2037),P=R(8905),M=R(6598),L=R(9196),U=R(4386),V=R(8905),$="subchannel_call";function K(S){for(let[T,R]of Object.entries(O.constants.errno))if(R===S)return T;return"Unknown system error "+S}class W{constructor(S,T,R,O,U){var V;this.http2Stream=S,this.callEventTracker=T,this.listener=R,this.transport=O,this.callId=U,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=P.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;let $=null!==(V=O.getOptions()["grpc.max_receive_message_length"])&&void 0!==V?V:P.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new L.StreamDecoder($),S.on("response",(S,T)=>{let R="";for(let T of Object.keys(S))R+="		"+T+": "+S[T]+"\n";switch(this.trace("Received server headers:\n"+R),S[":status"]){case 400:this.mappedStatusCode=P.Status.INTERNAL;break;case 401:this.mappedStatusCode=P.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=P.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=P.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=P.Status.UNAVAILABLE;break;default:this.mappedStatusCode=P.Status.UNKNOWN}if(T&N.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(S);else{let T;try{T=M.Metadata.fromHttp2Headers(S)}catch(S){this.endCall({code:P.Status.UNKNOWN,details:S.message,metadata:new M.Metadata});return}this.listener.onReceiveMetadata(T)}}),S.on("trailers",S=>{this.handleTrailers(S)}),S.on("data",S=>{let T;if(!this.statusOutput){this.trace("receive HTTP/2 data frame of length "+S.length);try{T=this.decoder.write(S)}catch(S){this.cancelWithStatus(P.Status.RESOURCE_EXHAUSTED,S.message);return}for(let S of T)this.trace("parsed message of length "+S.length),this.callEventTracker.addMessageReceived(),this.tryPush(S)}}),S.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),S.on("close",()=>{process.nextTick(()=>{var T;let R;if(this.trace("HTTP/2 stream closed with code "+S.rstCode),(null===(T=this.finalStatus)||void 0===T?void 0:T.code)===P.Status.OK)return;let O="";switch(S.rstCode){case N.constants.NGHTTP2_NO_ERROR:if(null!==this.finalStatus)return;R=P.Status.INTERNAL,O=`Received RST_STREAM with code ${S.rstCode}`;break;case N.constants.NGHTTP2_REFUSED_STREAM:R=P.Status.UNAVAILABLE,O="Stream refused by server";break;case N.constants.NGHTTP2_CANCEL:R=P.Status.CANCELLED,O="Call cancelled";break;case N.constants.NGHTTP2_ENHANCE_YOUR_CALM:R=P.Status.RESOURCE_EXHAUSTED,O="Bandwidth exhausted or memory limit exceeded";break;case N.constants.NGHTTP2_INADEQUATE_SECURITY:R=P.Status.PERMISSION_DENIED,O="Protocol not secure enough";break;case N.constants.NGHTTP2_INTERNAL_ERROR:R=P.Status.INTERNAL,null===this.internalError?O=`Received RST_STREAM with code ${S.rstCode} (Internal server error)`:"ECONNRESET"===this.internalError.code||"ETIMEDOUT"===this.internalError.code?(R=P.Status.UNAVAILABLE,O=this.internalError.message):O=`Received RST_STREAM with code ${S.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:R=P.Status.INTERNAL,O=`Received RST_STREAM with code ${S.rstCode}`}this.endCall({code:R,details:O,metadata:new M.Metadata,rstCode:S.rstCode})})}),S.on("error",S=>{"ERR_HTTP2_STREAM_ERROR"!==S.code&&(this.trace("Node error event: message="+S.message+" code="+S.code+" errno="+K(S.errno)+" syscall="+S.syscall),this.internalError=S),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:P.Status.UNAVAILABLE,details:"Connection dropped",metadata:new M.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(S){U.trace(V.LogVerbosity.DEBUG,$,"["+this.callId+"] "+S)}endCall(S){(null===this.finalStatus||this.finalStatus.code===P.Status.OK)&&(this.finalStatus=S,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){null===this.finalStatus||this.finalStatus.code===P.Status.OK&&(!this.readsClosed||0!==this.unpushedReadMessages.length||this.isReadFilterPending||this.isPushPending)||this.outputStatus()}push(S){this.trace("pushing to reader message of length "+(S instanceof Buffer?S.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,this.statusOutput||(this.listener.onReceiveMessage(S),this.maybeOutputStatus())})}tryPush(S){this.canPush?(this.http2Stream.pause(),this.push(S)):(this.trace("unpushedReadMessages.push message of length "+S.length),this.unpushedReadMessages.push(S))}handleTrailers(S){let T;this.callEventTracker.onStreamEnd(!0);let R="";for(let T of Object.keys(S))R+="		"+T+": "+S[T]+"\n";this.trace("Received server trailers:\n"+R);try{T=M.Metadata.fromHttp2Headers(S)}catch(S){T=new M.Metadata}let N=T.getMap(),O=this.mappedStatusCode;if(O===P.Status.UNKNOWN&&"string"==typeof N["grpc-status"]){let S=Number(N["grpc-status"]);S in P.Status&&(O=S,this.trace("received status code "+S+" from server")),T.remove("grpc-status")}let L="";if("string"==typeof N["grpc-message"]){try{L=decodeURI(N["grpc-message"])}catch(S){L=N["grpc-message"]}T.remove("grpc-message"),this.trace('received status details string "'+L+'" from server')}let U={code:O,details:L,metadata:T};this.endCall(U)}destroyHttp2Stream(){var S;if(!this.http2Stream.destroyed){let T;T=(null===(S=this.finalStatus)||void 0===S?void 0:S.code)===P.Status.OK?N.constants.NGHTTP2_NO_ERROR:N.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+T),this.http2Stream.close(T)}}cancelWithStatus(S,T){this.trace("cancelWithStatus code: "+S+' details: "'+T+'"'),this.endCall({code:S,details:T,metadata:new M.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(null!==this.finalStatus&&this.finalStatus.code!==P.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let S=this.unpushedReadMessages.shift();this.push(S);return}this.http2Stream.resume()}sendMessageWithContext(S,T){this.trace("write() called with message of length "+T.length);let R=T=>{process.nextTick(()=>{var R;let N=P.Status.UNAVAILABLE;(null==T?void 0:T.code)==="ERR_STREAM_WRITE_AFTER_END"&&(N=P.Status.INTERNAL),T&&this.cancelWithStatus(N,`Write error: ${T.message}`),null===(R=S.callback)||void 0===R||R.call(S)})};this.trace("sending data chunk of length "+T.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(T,R)}catch(S){this.endCall({code:P.Status.UNAVAILABLE,details:`Write failed with error ${S.message}`,metadata:new M.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}}T.Http2SubchannelCall=W},5074:(S,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.BaseSubchannelWrapper=void 0;class R{constructor(S){this.child=S}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(S){this.child.addConnectivityStateListener(S)}removeConnectivityStateListener(S){this.child.removeConnectivityStateListener(S)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(S){this.child.throttleKeepalive(S)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(S){return this.getRealSubchannel()===S.getRealSubchannel()}}T.BaseSubchannelWrapper=R},760:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.getSubchannelPool=T.SubchannelPool=void 0;let N=R(8007),O=R(2757),P=R(476),M=R(6228),L=R(7431),U=1e4;class V{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let S=!0;for(let T in this.pool){let R=this.pool[T].filter(S=>!S.subchannel.unrefIfOneRef());R.length>0&&(S=!1),this.pool[T]=R}S&&null!==this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var S,T;null===this.cleanupTimer&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},U),null===(T=(S=this.cleanupTimer).unref)||void 0===T||T.call(S))}getOrCreateSubchannel(S,T,R,U){this.ensureCleanupTask();let V=(0,M.uriToString)(S);if(V in this.pool){for(let S of this.pool[V])if((0,P.subchannelAddressEqual)(T,S.subchannelAddress)&&(0,N.channelOptionsEqual)(R,S.channelArguments)&&U._equals(S.channelCredentials))return S.subchannel}let $=new O.Subchannel(S,T,R,U,new L.Http2SubchannelConnector(S));return V in this.pool||(this.pool[V]=[]),this.pool[V].push({subchannelAddress:T,channelArguments:R,channelCredentials:U,subchannel:$}),$.ref(),$}}T.SubchannelPool=V;let $=new V;function K(S){return S?$:new V}T.getSubchannelPool=K},2757:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.Subchannel=void 0;let N=R(5199),O=R(3339),P=R(4386),M=R(8905),L=R(6228),U=R(476),V=R(4174),$="subchannel",K=2147483647;class W{constructor(S,T,R,P,M){var L;this.channelTarget=S,this.subchannelAddress=T,this.options=R,this.credentials=P,this.connector=M,this.connectivityState=N.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new V.ChannelzCallTracker,this.childrenTracker=new V.ChannelzChildrenTracker,this.streamTracker=new V.ChannelzCallTracker;let $={initialDelay:R["grpc.initial_reconnect_backoff_ms"],maxDelay:R["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new O.BackoffTimeout(()=>{this.handleBackoffTimer()},$),this.backoffTimeout.unref(),this.subchannelAddressString=(0,U.subchannelAddressToString)(T),this.keepaliveTime=null!==(L=R["grpc.keepalive_time_ms"])&&void 0!==L?L:-1,0===R["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new V.ChannelzTrace,this.channelzRef=(0,V.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(R,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(S){P.trace(M.LogVerbosity.DEBUG,$,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+S)}refTrace(S){P.trace(M.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+S)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([N.ConnectivityState.TRANSIENT_FAILURE],N.ConnectivityState.CONNECTING):this.transitionToState([N.ConnectivityState.TRANSIENT_FAILURE],N.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let S=this.options;if(S["grpc.keepalive_time_ms"]){let T=Math.min(this.keepaliveTime,K);S=Object.assign(Object.assign({},S),{"grpc.keepalive_time_ms":T})}this.connector.connect(this.subchannelAddress,this.credentials,S).then(S=>{this.transitionToState([N.ConnectivityState.CONNECTING],N.ConnectivityState.READY)?(this.transport=S,this.channelzEnabled&&this.childrenTracker.refChild(S.getChannelzRef()),S.addDisconnectListener(S=>{this.transitionToState([N.ConnectivityState.READY],N.ConnectivityState.IDLE),S&&this.keepaliveTime>0&&(this.keepaliveTime*=2,P.log(M.LogVerbosity.ERROR,`Connection to ${(0,L.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):S.shutdown()},S=>{this.transitionToState([N.ConnectivityState.CONNECTING],N.ConnectivityState.TRANSIENT_FAILURE,`${S}`)})}transitionToState(S,T,R){var O,P;if(-1===S.indexOf(this.connectivityState))return!1;this.trace(N.ConnectivityState[this.connectivityState]+" -> "+N.ConnectivityState[T]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+N.ConnectivityState[T]);let M=this.connectivityState;switch(this.connectivityState=T,T){case N.ConnectivityState.READY:this.stopBackoff();break;case N.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case N.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null===(O=this.transport)||void 0===O||O.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case N.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null===(P=this.transport)||void 0===P||P.shutdown(),this.transport=null;break;default:throw Error(`Invalid state: unknown ConnectivityState ${T}`)}for(let S of this.stateListeners)S(this,M,T,this.keepaliveTime,R);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,0===this.refcount&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,V.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([N.ConnectivityState.CONNECTING,N.ConnectivityState.READY],N.ConnectivityState.IDLE)}))}unrefIfOneRef(){return 1===this.refcount&&(this.unref(),!0)}createCall(S,T,R,N){let O;if(!this.transport)throw Error("Cannot create call, subchannel not READY");return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),O={onCallEnd:S=>{S.code===M.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):O={},this.transport.createCall(S,T,R,N,O)}startConnecting(){process.nextTick(()=>{this.transitionToState([N.ConnectivityState.IDLE],N.ConnectivityState.CONNECTING)||this.connectivityState!==N.ConnectivityState.TRANSIENT_FAILURE||(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(S){this.stateListeners.add(S)}removeConnectivityStateListener(S){this.stateListeners.delete(S)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([N.ConnectivityState.TRANSIENT_FAILURE],N.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(S){return S.getRealSubchannel()===this}throttleKeepalive(S){S>this.keepaliveTime&&(this.keepaliveTime=S)}}T.Subchannel=W},6337:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.getDefaultRootsData=T.CIPHER_SUITES=void 0;let N=R(7147);T.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;let O=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,P=null;function M(){return O?(null===P&&(P=N.readFileSync(O)),P):null}T.getDefaultRootsData=M},7431:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.Http2SubchannelConnector=void 0;let N=R(5158),O=R(4404),P=R(4174),M=R(8905),L=R(9347),U=R(4386),V=R(5361),$=R(476),K=R(6228),W=R(1808),Q=R(9862),Y=R(4391),X="transport",Z="transport_flowctrl",ee=R(7645).i8,{HTTP2_HEADER_AUTHORITY:et,HTTP2_HEADER_CONTENT_TYPE:er,HTTP2_HEADER_METHOD:en,HTTP2_HEADER_PATH:ei,HTTP2_HEADER_TE:es,HTTP2_HEADER_USER_AGENT:ea}=N.constants,eo=2e4,eu=Buffer.from("too_many_pings","ascii");class ec{constructor(S,T,R,O){this.session=S,this.options=R,this.remoteName=O,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=eo,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new P.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,$.subchannelAddressToString)(T),0===R["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,P.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[R["grpc.primary_user_agent"],`grpc-node-js/${ee}`,R["grpc.secondary_user_agent"]].filter(S=>S).join(" "),"grpc.keepalive_time_ms"in R&&(this.keepaliveTimeMs=R["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in R&&(this.keepaliveTimeoutMs=R["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in R?this.keepaliveWithoutCalls=1===R["grpc.keepalive_permit_without_calls"]:this.keepaliveWithoutCalls=!1,S.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),S.once("goaway",(S,T,R)=>{let O=!1;S===N.constants.NGHTTP2_ENHANCE_YOUR_CALM&&R&&R.equals(eu)&&(O=!0),this.trace("connection closed by GOAWAY with code "+S+" and data "+(null==R?void 0:R.toString())),this.reportDisconnectToOwner(O)}),S.once("error",S=>{this.trace("connection closed with error "+S.message)}),U.isTracerEnabled(X)&&(S.on("remoteSettings",T=>{this.trace("new settings received"+(this.session!==S?" on the old connection":"")+": "+JSON.stringify(T))}),S.on("localSettings",T=>{this.trace("local settings acknowledged by remote"+(this.session!==S?" on the old connection":"")+": "+JSON.stringify(T))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var S,T,R;let N;let O=this.session.socket,P=O.remoteAddress?(0,$.stringToSubchannelAddress)(O.remoteAddress,O.remotePort):null,M=O.localAddress?(0,$.stringToSubchannelAddress)(O.localAddress,O.localPort):null;if(this.session.encrypted){let T=O,R=T.getCipher(),P=T.getCertificate(),M=T.getPeerCertificate();N={cipherSuiteStandardName:null!==(S=R.standardName)&&void 0!==S?S:null,cipherSuiteOtherName:R.standardName?null:R.name,localCertificate:P&&"raw"in P?P.raw:null,remoteCertificate:M&&"raw"in M?M.raw:null}}else N=null;return{remoteAddress:P,localAddress:M,security:N,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:null!==(T=this.session.state.localWindowSize)&&void 0!==T?T:null,remoteFlowControlWindow:null!==(R=this.session.state.remoteWindowSize)&&void 0!==R?R:null}}trace(S){U.trace(M.LogVerbosity.DEBUG,X,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+S)}keepaliveTrace(S){U.trace(M.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+S)}flowControlTrace(S){U.trace(M.LogVerbosity.DEBUG,Z,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+S)}internalsTrace(S){U.trace(M.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+S)}reportDisconnectToOwner(S){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(T=>T(S)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let S of this.activeCalls)S.onDisconnect()})}addDisconnectListener(S){this.disconnectListeners.push(S)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var S,T;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),null===(T=(S=this.keepaliveTimeoutId).unref)||void 0===T||T.call(S));try{this.session.ping((S,T,R)=>{S&&(this.keepaliveTrace("Ping failed with error "+S.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch(S){this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var S,T;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):this.keepaliveTimerId||this.keepaliveTimeoutId||(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=null===(T=(S=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)||void 0===T?void 0:T.call(S)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(S){this.activeCalls.delete(S),0===this.activeCalls.size&&this.session.unref()}addActiveCall(S){this.activeCalls.add(S),1!==this.activeCalls.size||(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(S,T,R,N,O){let P,M,L;let U=S.toHttp2Headers();U[et]=T,U[ea]=this.userAgent,U[er]="application/grpc",U[en]="POST",U[ei]=R,U[es]="trailers";try{P=this.session.request(U)}catch(S){throw this.handleDisconnect(),S}return this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed),this.channelzEnabled?(this.streamTracker.addCallStarted(),M={addMessageSent:()=>{var S;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,null===(S=O.addMessageSent)||void 0===S||S.call(O)},addMessageReceived:()=>{var S;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,null===(S=O.addMessageReceived)||void 0===S||S.call(O)},onCallEnd:S=>{var T;null===(T=O.onCallEnd)||void 0===T||T.call(O,S),this.removeActiveCall(L)},onStreamEnd:S=>{var T;S?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),null===(T=O.onStreamEnd)||void 0===T||T.call(O,S)}}):M={addMessageSent:()=>{var S;null===(S=O.addMessageSent)||void 0===S||S.call(O)},addMessageReceived:()=>{var S;null===(S=O.addMessageReceived)||void 0===S||S.call(O)},onCallEnd:S=>{var T;null===(T=O.onCallEnd)||void 0===T||T.call(O,S),this.removeActiveCall(L)},onStreamEnd:S=>{var T;null===(T=O.onStreamEnd)||void 0===T||T.call(O,S)}},L=new Q.Http2SubchannelCall(P,M,N,this,(0,Y.getNextCallNumber)()),this.addActiveCall(L),L}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,P.unregisterChannelzRef)(this.channelzRef)}}class ed{constructor(S){this.channelTarget=S,this.session=null,this.isShutdown=!1}trace(S){U.trace(M.LogVerbosity.DEBUG,X,(0,K.uriToString)(this.channelTarget)+" "+S)}createSession(S,T,R,P){return this.isShutdown?Promise.reject():new Promise((M,L)=>{var U,Q,Y;let X;P.realTarget?(X=(0,K.uriToString)(P.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,K.uriToString)(P.realTarget))):(X=null,this.trace("creating HTTP/2 session to "+(0,$.subchannelAddressToString)(S)));let Z=(0,V.getDefaultAuthority)(null!==(U=P.realTarget)&&void 0!==U?U:this.channelTarget),ee=T._getConnectionOptions()||{};ee.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in R?ee.maxSessionMemory=R["grpc-node.max_session_memory"]:ee.maxSessionMemory=Number.MAX_SAFE_INTEGER;let et="http://";if("secureContext"in ee){if(et="https://",R["grpc.ssl_target_name_override"]){let S=R["grpc.ssl_target_name_override"];ee.checkServerIdentity=(T,R)=>(0,O.checkServerIdentity)(S,R),ee.servername=S}else{let S=null!==(Y=null===(Q=(0,K.splitHostPort)(Z))||void 0===Q?void 0:Q.host)&&void 0!==Y?Y:"localhost";ee.servername=S}P.socket&&(ee.createConnection=(S,T)=>P.socket)}else ee.createConnection=(T,R)=>P.socket?P.socket:W.connect(S);ee=Object.assign(Object.assign(Object.assign({},ee),S),{enableTrace:1===R["grpc-node.tls_enable_trace"]});let er=N.connect(et+Z,ee);this.session=er;let en="Failed to connect";er.unref(),er.once("connect",()=>{er.removeAllListeners(),M(new ec(er,S,R,X)),this.session=null}),er.once("close",()=>{this.session=null,setImmediate(()=>{L(`${en} (${new Date().toISOString()})`)})}),er.once("error",S=>{en=S.message,this.trace("connection failed with error "+en)})})}connect(S,T,R){var N,P;if(this.isShutdown)return Promise.reject();let M=T._getConnectionOptions()||{};if("secureContext"in M){if(M.ALPNProtocols=["h2"],R["grpc.ssl_target_name_override"]){let S=R["grpc.ssl_target_name_override"];M.checkServerIdentity=(T,R)=>(0,O.checkServerIdentity)(S,R),M.servername=S}else if("grpc.http_connect_target"in R){let S=(0,V.getDefaultAuthority)(null!==(N=(0,K.parseUri)(R["grpc.http_connect_target"]))&&void 0!==N?N:{path:"localhost"}),T=(0,K.splitHostPort)(S);M.servername=null!==(P=null==T?void 0:T.host)&&void 0!==P?P:S}R["grpc-node.tls_enable_trace"]&&(M.enableTrace=!0)}return(0,L.getProxiedConnection)(S,R,M).then(N=>this.createSession(S,T,R,N))}shutdown(){var S;this.isShutdown=!0,null===(S=this.session)||void 0===S||S.close(),this.session=null}}T.Http2SubchannelConnector=ed},6228:(S,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.uriToString=T.splitHostPort=T.parseUri=void 0;let R=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function N(S){let T=R.exec(S);return null===T?null:{scheme:T[1],authority:T[2],path:T[3]}}T.parseUri=N;let O=/^\d+$/;function P(S){if(S.startsWith("[")){let T=S.indexOf("]");if(-1===T)return null;let R=S.substring(1,T);if(-1===R.indexOf(":"))return null;if(!(S.length>T+1))return{host:R};if(":"!==S[T+1])return null;{let N=S.substring(T+2);return O.test(N)?{host:R,port:+N}:null}}{let T=S.split(":");return 2!==T.length?{host:S}:O.test(T[1])?{host:T[0],port:+T[1]}:null}}function M(S){let T="";return void 0!==S.scheme&&(T+=S.scheme+":"),void 0!==S.authority&&(T+="//"+S.authority+"/"),T+=S.path}T.splitHostPort=P,T.uriToString=M},4663:(S,T,R)=>{"use strict";var N,O;/**
 * @license
 * Copyright 2018 gRPC authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */N={value:!0},N=N=T.im=T.J_=N=T.Cp=N=N=void 0;let P=R(1232),M=R(7628),L=R(9530),U=R(5670);N=R(5304),N=function(S){return"@type"in S&&"string"==typeof S["@type"]},function(S){S.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",S.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",S.IDEMPOTENT="IDEMPOTENT"}(O=T.Cp||(T.Cp={}));let V={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function $(S,T){return""===S?T:S+"."+T}function K(S){return S instanceof M.Service||S instanceof M.Type||S instanceof M.Enum}function W(S){return S instanceof M.Namespace||S instanceof M.Root}function Q(S,T){let R=$(T,S.name);return K(S)?[[R,S]]:W(S)&&void 0!==S.nested?Object.keys(S.nested).map(T=>Q(S.nested[T],R)).reduce((S,T)=>S.concat(T),[]):[]}function Y(S,T){return function(R){return S.toObject(S.decode(R),T)}}function X(S){return function(T){if(Array.isArray(T))throw Error(`Failed to serialize message: expected object with ${S.name} structure, got array instead`);let R=S.fromObject(T);return S.encode(R).finish()}}function Z(S){return(S||[]).reduce((S,T)=>{for(let[R,N]of Object.entries(T))"uninterpreted_option"===R?S.uninterpreted_option.push(T.uninterpreted_option):S[R]=N;return S},{deprecated:!1,idempotency_level:O.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function ee(S,T,R,N){let O=S.resolvedRequestType,M=S.resolvedResponseType;return{path:"/"+T+"/"+S.name,requestStream:!!S.requestStream,responseStream:!!S.responseStream,requestSerialize:X(O),requestDeserialize:Y(O,R),responseSerialize:X(M),responseDeserialize:Y(M,R),originalName:P(S.name),requestType:er(O,N),responseType:er(M,N),options:Z(S.parsedOptions)}}function et(S,T,R,N){let O={};for(let P of S.methodsArray)O[P.name]=ee(P,T,R,N);return O}function er(S,T){let R=S.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:R.$type.toObject(R,V),fileDescriptorProtos:T}}function en(S,T){let R=S.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:R.$type.toObject(R,V),fileDescriptorProtos:T}}function ei(S,T,R,N){if(S instanceof M.Service)return et(S,T,R,N);if(S instanceof M.Type)return er(S,N);if(S instanceof M.Enum)return en(S,N);throw Error("Type mismatch in reflection object handling")}function es(S,T){let R={};S.resolveAll();let N=S.toDescriptor("proto3").file.map(S=>Buffer.from(L.FileDescriptorProto.encode(S).finish()));for(let[O,P]of Q(S,""))R[O]=ei(P,O,T,N);return R}function ea(S,T){T=T||{};let R=M.Root.fromDescriptor(S);return R.resolveAll(),es(R,T)}function eo(S,T){return es((0,U.loadProtosWithOptionsSync)(S,T),T)}function eu(S,T){T=T||{};let R=M.Root.fromJSON(S);return R.resolveAll(),es(R,T)}N=function(S,T){return(0,U.loadProtosWithOptions)(S,T).then(S=>es(S,T))},T.J_=eo,T.im=eu,N=function(S,T){return ea(L.FileDescriptorSet.decode(S),T)},N=function(S,T){return ea(L.FileDescriptorSet.fromObject(S),T)},(0,U.addCommonProtos)()},5670:(S,T,R)=>{"use strict";/**
 * @license
 * Copyright 2018 gRPC authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */Object.defineProperty(T,"__esModule",{value:!0}),T.addCommonProtos=T.loadProtosWithOptionsSync=T.loadProtosWithOptions=void 0;let N=R(7147),O=R(1017),P=R(7628);function M(S,T){let R=S.resolvePath;S.resolvePath=(S,P)=>{if(O.isAbsolute(P))return P;for(let S of T){let T=O.join(S,P);try{return N.accessSync(T,N.constants.R_OK),T}catch(S){continue}}return process.emitWarning(`${P} not found in any of the include paths ${T}`),R(S,P)}}async function L(S,T){let R=new P.Root;if((T=T||{}).includeDirs){if(!Array.isArray(T.includeDirs))return Promise.reject(Error("The includeDirs option must be an array"));M(R,T.includeDirs)}let N=await R.load(S,T);return N.resolveAll(),N}function U(S,T){let R=new P.Root;if((T=T||{}).includeDirs){if(!Array.isArray(T.includeDirs))throw Error("The includeDirs option must be an array");M(R,T.includeDirs)}let N=R.loadSync(S,T);return N.resolveAll(),N}function V(){let S=R(522),T=R(4552),N=R(7105),O=R(8730);P.common("api",S.nested.google.nested.protobuf.nested),P.common("descriptor",T.nested.google.nested.protobuf.nested),P.common("source_context",N.nested.google.nested.protobuf.nested),P.common("type",O.nested.google.nested.protobuf.nested)}T.loadProtosWithOptions=L,T.loadProtosWithOptionsSync=U,T.addCommonProtos=V},5409:S=>{"use strict";function T(S,T){for(var R=Array(arguments.length-1),N=0,O=2,P=!0;O<arguments.length;)R[N++]=arguments[O++];return new Promise(function(O,M){R[N]=function(S){if(P){if(P=!1,S)M(S);else{for(var T=Array(arguments.length-1),R=0;R<T.length;)T[R++]=arguments[R];O.apply(null,T)}}};try{S.apply(T||null,R)}catch(S){P&&(P=!1,M(S))}})}S.exports=T},1315:(S,T)=>{"use strict";var R=T;R.length=function(S){var T=S.length;if(!T)return 0;for(var R=0;--T%4>1&&"="===S.charAt(T);)++R;return Math.ceil(3*S.length)/4-R};for(var N=Array(64),O=Array(123),P=0;P<64;)O[N[P]=P<26?P+65:P<52?P+71:P<62?P-4:P-59|43]=P++;R.encode=function(S,T,R){for(var O,P=null,M=[],L=0,U=0;T<R;){var V=S[T++];switch(U){case 0:M[L++]=N[V>>2],O=(3&V)<<4,U=1;break;case 1:M[L++]=N[O|V>>4],O=(15&V)<<2,U=2;break;case 2:M[L++]=N[O|V>>6],M[L++]=N[63&V],U=0}L>8191&&((P||(P=[])).push(String.fromCharCode.apply(String,M)),L=0)}return(U&&(M[L++]=N[O],M[L++]=61,1===U&&(M[L++]=61)),P)?(L&&P.push(String.fromCharCode.apply(String,M.slice(0,L))),P.join("")):String.fromCharCode.apply(String,M.slice(0,L))};var M="invalid encoding";R.decode=function(S,T,R){for(var N,P=R,L=0,U=0;U<S.length;){var V=S.charCodeAt(U++);if(61===V&&L>1)break;if(void 0===(V=O[V]))throw Error(M);switch(L){case 0:N=V,L=1;break;case 1:T[R++]=N<<2|(48&V)>>4,N=V,L=2;break;case 2:T[R++]=(15&N)<<4|(60&V)>>2,N=V,L=3;break;case 3:T[R++]=(3&N)<<6|V,L=0}}if(1===L)throw Error(M);return R-P},R.test=function(S){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(S)}},4983:S=>{"use strict";function T(S,R){"string"==typeof S&&(R=S,S=void 0);var N=[];function O(S){if("string"!=typeof S){var R=P();if(T.verbose&&console.log("codegen: "+R),R="return "+R,S){for(var M=Object.keys(S),L=Array(M.length+1),U=Array(M.length),V=0;V<M.length;)L[V]=M[V],U[V]=S[M[V++]];return L[V]=R,Function.apply(null,L).apply(null,U)}return Function(R)()}for(var $=Array(arguments.length-1),K=0;K<$.length;)$[K]=arguments[++K];if(K=0,S=S.replace(/%([%dfijs])/g,function(S,T){var R=$[K++];switch(T){case"d":case"f":return String(Number(R));case"i":return String(Math.floor(R));case"j":return JSON.stringify(R);case"s":return String(R)}return"%"}),K!==$.length)throw Error("parameter count mismatch");return N.push(S),O}function P(T){return"function "+(T||R||"")+"("+(S&&S.join(",")||"")+"){\n  "+N.join("\n  ")+"\n}"}return O.toString=P,O}S.exports=T,T.verbose=!1},3595:S=>{"use strict";function T(){this._listeners={}}S.exports=T,T.prototype.on=function(S,T,R){return(this._listeners[S]||(this._listeners[S]=[])).push({fn:T,ctx:R||this}),this},T.prototype.off=function(S,T){if(void 0===S)this._listeners={};else if(void 0===T)this._listeners[S]=[];else for(var R=this._listeners[S],N=0;N<R.length;)R[N].fn===T?R.splice(N,1):++N;return this},T.prototype.emit=function(S){var T=this._listeners[S];if(T){for(var R=[],N=1;N<arguments.length;)R.push(arguments[N++]);for(N=0;N<T.length;)T[N].fn.apply(T[N++].ctx,R)}return this}},3824:(S,T,R)=>{"use strict";S.exports=P;var N=R(5409),O=R(3421)("fs");function P(S,T,R){return("function"==typeof T?(R=T,T={}):T||(T={}),R)?!T.xhr&&O&&O.readFile?O.readFile(S,function(N,O){return N&&"undefined"!=typeof XMLHttpRequest?P.xhr(S,T,R):N?R(N):R(null,T.binary?O:O.toString("utf8"))}):P.xhr(S,T,R):N(P,this,S,T)}P.xhr=function(S,T,R){var N=new XMLHttpRequest;N.onreadystatechange=function(){if(4===N.readyState){if(0!==N.status&&200!==N.status)return R(Error("status "+N.status));if(T.binary){var S=N.response;if(!S){S=[];for(var O=0;O<N.responseText.length;++O)S.push(255&N.responseText.charCodeAt(O))}return R(null,"undefined"!=typeof Uint8Array?new Uint8Array(S):S)}return R(null,N.responseText)}},T.binary&&("overrideMimeType"in N&&N.overrideMimeType("text/plain; charset=x-user-defined"),N.responseType="arraybuffer"),N.open("GET",S),N.send()}},1708:S=>{"use strict";function T(S){return"undefined"!=typeof Float32Array?function(){var T=new Float32Array([-0]),R=new Uint8Array(T.buffer),N=128===R[3];function O(S,N,O){T[0]=S,N[O]=R[0],N[O+1]=R[1],N[O+2]=R[2],N[O+3]=R[3]}function P(S,N,O){T[0]=S,N[O]=R[3],N[O+1]=R[2],N[O+2]=R[1],N[O+3]=R[0]}function M(S,N){return R[0]=S[N],R[1]=S[N+1],R[2]=S[N+2],R[3]=S[N+3],T[0]}function L(S,N){return R[3]=S[N],R[2]=S[N+1],R[1]=S[N+2],R[0]=S[N+3],T[0]}S.writeFloatLE=N?O:P,S.writeFloatBE=N?P:O,S.readFloatLE=N?M:L,S.readFloatBE=N?L:M}():function(){function T(S,T,R,N){var O=T<0?1:0;if(O&&(T=-T),0===T)S(1/T>0?0:2147483648,R,N);else if(isNaN(T))S(2143289344,R,N);else if(T>34028234663852886e22)S((O<<31|2139095040)>>>0,R,N);else if(T<11754943508222875e-54)S((O<<31|Math.round(T/1401298464324817e-60))>>>0,R,N);else{var P=Math.floor(Math.log(T)/Math.LN2),M=8388607&Math.round(T*Math.pow(2,-P)*8388608);S((O<<31|P+127<<23|M)>>>0,R,N)}}function M(S,T,R){var N=S(T,R),O=(N>>31)*2+1,P=N>>>23&255,M=8388607&N;return 255===P?M?NaN:1/0*O:0===P?1401298464324817e-60*O*M:O*Math.pow(2,P-150)*(M+8388608)}S.writeFloatLE=T.bind(null,R),S.writeFloatBE=T.bind(null,N),S.readFloatLE=M.bind(null,O),S.readFloatBE=M.bind(null,P)}(),"undefined"!=typeof Float64Array?function(){var T=new Float64Array([-0]),R=new Uint8Array(T.buffer),N=128===R[7];function O(S,N,O){T[0]=S,N[O]=R[0],N[O+1]=R[1],N[O+2]=R[2],N[O+3]=R[3],N[O+4]=R[4],N[O+5]=R[5],N[O+6]=R[6],N[O+7]=R[7]}function P(S,N,O){T[0]=S,N[O]=R[7],N[O+1]=R[6],N[O+2]=R[5],N[O+3]=R[4],N[O+4]=R[3],N[O+5]=R[2],N[O+6]=R[1],N[O+7]=R[0]}function M(S,N){return R[0]=S[N],R[1]=S[N+1],R[2]=S[N+2],R[3]=S[N+3],R[4]=S[N+4],R[5]=S[N+5],R[6]=S[N+6],R[7]=S[N+7],T[0]}function L(S,N){return R[7]=S[N],R[6]=S[N+1],R[5]=S[N+2],R[4]=S[N+3],R[3]=S[N+4],R[2]=S[N+5],R[1]=S[N+6],R[0]=S[N+7],T[0]}S.writeDoubleLE=N?O:P,S.writeDoubleBE=N?P:O,S.readDoubleLE=N?M:L,S.readDoubleBE=N?L:M}():function(){function T(S,T,R,N,O,P){var M,L=N<0?1:0;if(L&&(N=-N),0===N)S(0,O,P+T),S(1/N>0?0:2147483648,O,P+R);else if(isNaN(N))S(0,O,P+T),S(2146959360,O,P+R);else if(N>17976931348623157e292)S(0,O,P+T),S((L<<31|2146435072)>>>0,O,P+R);else if(N<22250738585072014e-324)S((M=N/5e-324)>>>0,O,P+T),S((L<<31|M/4294967296)>>>0,O,P+R);else{var U=Math.floor(Math.log(N)/Math.LN2);1024===U&&(U=1023),S(4503599627370496*(M=N*Math.pow(2,-U))>>>0,O,P+T),S((L<<31|U+1023<<20|1048576*M&1048575)>>>0,O,P+R)}}function M(S,T,R,N,O){var P=S(N,O+T),M=S(N,O+R),L=(M>>31)*2+1,U=M>>>20&2047,V=4294967296*(1048575&M)+P;return 2047===U?V?NaN:1/0*L:0===U?5e-324*L*V:L*Math.pow(2,U-1075)*(V+4503599627370496)}S.writeDoubleLE=T.bind(null,R,0,4),S.writeDoubleBE=T.bind(null,N,4,0),S.readDoubleLE=M.bind(null,O,0,4),S.readDoubleBE=M.bind(null,P,4,0)}(),S}function R(S,T,R){T[R]=255&S,T[R+1]=S>>>8&255,T[R+2]=S>>>16&255,T[R+3]=S>>>24}function N(S,T,R){T[R]=S>>>24,T[R+1]=S>>>16&255,T[R+2]=S>>>8&255,T[R+3]=255&S}function O(S,T){return(S[T]|S[T+1]<<8|S[T+2]<<16|S[T+3]<<24)>>>0}function P(S,T){return(S[T]<<24|S[T+1]<<16|S[T+2]<<8|S[T+3])>>>0}S.exports=T(T)},3421:module=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},9419:(S,T)=>{"use strict";var R=T,N=R.isAbsolute=function(S){return/^(?:\/|\w+:)/.test(S)},O=R.normalize=function(S){var T=(S=S.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),R=N(S),O="";R&&(O=T.shift()+"/");for(var P=0;P<T.length;)".."===T[P]?P>0&&".."!==T[P-1]?T.splice(--P,2):R?T.splice(P,1):++P:"."===T[P]?T.splice(P,1):++P;return O+T.join("/")};R.resolve=function(S,T,R){return(R||(T=O(T)),N(T))?T:(R||(S=O(S)),(S=S.replace(/(?:\/|^)[^/]+$/,"")).length?O(S+"/"+T):T)}},7474:S=>{"use strict";function T(S,T,R){var N=R||8192,O=N>>>1,P=null,M=N;return function(R){if(R<1||R>O)return S(R);M+R>N&&(P=S(N),M=0);var L=T.call(P,M,M+=R);return 7&M&&(M=(7|M)+1),L}}S.exports=T},9774:(S,T)=>{"use strict";var R=T;R.length=function(S){for(var T=0,R=0,N=0;N<S.length;++N)(R=S.charCodeAt(N))<128?T+=1:R<2048?T+=2:(64512&R)==55296&&(64512&S.charCodeAt(N+1))==56320?(++N,T+=4):T+=3;return T},R.read=function(S,T,R){if(R-T<1)return"";for(var N,O=null,P=[],M=0;T<R;)(N=S[T++])<128?P[M++]=N:N>191&&N<224?P[M++]=(31&N)<<6|63&S[T++]:N>239&&N<365?(N=((7&N)<<18|(63&S[T++])<<12|(63&S[T++])<<6|63&S[T++])-65536,P[M++]=55296+(N>>10),P[M++]=56320+(1023&N)):P[M++]=(15&N)<<12|(63&S[T++])<<6|63&S[T++],M>8191&&((O||(O=[])).push(String.fromCharCode.apply(String,P)),M=0);return O?(M&&O.push(String.fromCharCode.apply(String,P.slice(0,M))),O.join("")):String.fromCharCode.apply(String,P.slice(0,M))},R.write=function(S,T,R){for(var N,O,P=R,M=0;M<S.length;++M)(N=S.charCodeAt(M))<128?T[R++]=N:(N<2048?T[R++]=N>>6|192:((64512&N)==55296&&(64512&(O=S.charCodeAt(M+1)))==56320?(N=65536+((1023&N)<<10)+(1023&O),++M,T[R++]=N>>18|240,T[R++]=N>>12&63|128):T[R++]=N>>12|224,T[R++]=N>>6&63|128),T[R++]=63&N|128);return R-P}},1232:S=>{var T=1/0,R="[object Symbol]",N=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,O=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,P="\ud800-\udfff",M="\\u0300-\\u036f\\ufe20-\\ufe23",L="\\u20d0-\\u20f0",U="\\u2700-\\u27bf",V="a-z\\xdf-\\xf6\\xf8-\\xff",$="A-Z\\xc0-\\xd6\\xd8-\\xde",K="\\ufe0e\\ufe0f",W="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Q="['’]",Y="["+P+"]",X="["+W+"]",Z="["+M+L+"]",ee="\\d+",et="["+U+"]",er="["+V+"]",en="[^"+P+W+ee+U+V+$+"]",ei="\ud83c[\udffb-\udfff]",es="[^"+P+"]",ea="(?:\ud83c[\udde6-\uddff]){2}",eo="[\ud800-\udbff][\udc00-\udfff]",eu="["+$+"]",ec="\\u200d",ed="(?:"+er+"|"+en+")",eh="(?:"+eu+"|"+en+")",ep="(?:"+Q+"(?:d|ll|m|re|s|t|ve))?",ef="(?:"+Q+"(?:D|LL|M|RE|S|T|VE))?",em="(?:"+Z+"|"+ei+")?",eg="["+K+"]?",ey="(?:"+ec+"(?:"+[es,ea,eo].join("|")+")"+eg+em+")*",ev=eg+em+ey,eb="(?:"+[et,ea,eo].join("|")+")"+ev,eS="(?:"+[es+Z+"?",Z,ea,eo,Y].join("|")+")",eT=RegExp(Q,"g"),eE=RegExp(Z,"g"),eC=RegExp(ei+"(?="+ei+")|"+eS+ev,"g"),ew=RegExp([eu+"?"+er+"+"+ep+"(?="+[X,eu,"$"].join("|")+")",eh+"+"+ef+"(?="+[X,eu+ed,"$"].join("|")+")",eu+"?"+ed+"+"+ep,eu+"+"+ef,ee,eb].join("|"),"g"),e_=RegExp("["+ec+P+M+L+K+"]"),eI=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,eR={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"ss"},eD="object"==typeof global&&global&&global.Object===Object&&global,eA="object"==typeof self&&self&&self.Object===Object&&self,ek=eD||eA||Function("return this")();function eN(S,T,R,N){var O=-1,P=S?S.length:0;for(N&&P&&(R=S[++O]);++O<P;)R=T(R,S[O],O,S);return R}function eO(S){return S.split("")}function ex(S){return S.match(N)||[]}var eP=function(S){return function(T){return null==S?void 0:S[T]}}(eR);function eM(S){return e_.test(S)}function eL(S){return eI.test(S)}function eF(S){return eM(S)?eB(S):eO(S)}function eB(S){return S.match(eC)||[]}function ej(S){return S.match(ew)||[]}var eU=Object.prototype.toString,eV=ek.Symbol,ez=eV?eV.prototype:void 0,eq=ez?ez.toString:void 0;function e$(S,T,R){var N=-1,O=S.length;T<0&&(T=-T>O?0:O+T),(R=R>O?O:R)<0&&(R+=O),O=T>R?0:R-T>>>0,T>>>=0;for(var P=Array(O);++N<O;)P[N]=S[N+T];return P}function eG(S){if("string"==typeof S)return S;if(eQ(S))return eq?eq.call(S):"";var R=S+"";return"0"==R&&1/S==-T?"-0":R}function eK(S,T,R){var N=S.length;return R=void 0===R?N:R,!T&&R>=N?S:e$(S,T,R)}function eW(S){return function(T){var R=eM(T=eY(T))?eF(T):void 0,N=R?R[0]:T.charAt(0),O=R?eK(R,1).join(""):T.slice(1);return N[S]()+O}}function eH(S){return!!S&&"object"==typeof S}function eQ(S){return"symbol"==typeof S||eH(S)&&eU.call(S)==R}function eY(S){return null==S?"":eG(S)}var eJ=function(S){return function(T){return eN(e1(eZ(T).replace(eT,"")),S,"")}}(function(S,T,R){return T=T.toLowerCase(),S+(R?eX(T):T)});function eX(S){return e0(eY(S).toLowerCase())}function eZ(S){return(S=eY(S))&&S.replace(O,eP).replace(eE,"")}var e0=eW("toUpperCase");function e1(S,T,R){return(S=eY(S),void 0===(T=R?void 0:T))?eL(S)?ej(S):ex(S):S.match(T)||[]}S.exports=eJ},7347:S=>{"use strict";var T=Object.defineProperty,R=Object.getOwnPropertyDescriptor,N=Object.getOwnPropertyNames,O=Object.prototype.hasOwnProperty,P=(S,P,M,L)=>{if(P&&"object"==typeof P||"function"==typeof P)for(let U of N(P))O.call(S,U)||U===M||T(S,U,{get:()=>P[U],enumerable:!(L=R(P,U))||L.enumerable});return S},M=S=>P(T({},"__esModule",{value:!0}),S),L={};function U(S){var T;let R=["path"in S&&S.path&&`Path=${S.path}`,"expires"in S&&(S.expires||0===S.expires)&&`Expires=${("number"==typeof S.expires?new Date(S.expires):S.expires).toUTCString()}`,"maxAge"in S&&"number"==typeof S.maxAge&&`Max-Age=${S.maxAge}`,"domain"in S&&S.domain&&`Domain=${S.domain}`,"secure"in S&&S.secure&&"Secure","httpOnly"in S&&S.httpOnly&&"HttpOnly","sameSite"in S&&S.sameSite&&`SameSite=${S.sameSite}`,"priority"in S&&S.priority&&`Priority=${S.priority}`].filter(Boolean);return`${S.name}=${encodeURIComponent(null!=(T=S.value)?T:"")}; ${R.join("; ")}`}function V(S){let T=new Map;for(let R of S.split(/; */)){if(!R)continue;let S=R.indexOf("=");if(-1===S){T.set(R,"true");continue}let[N,O]=[R.slice(0,S),R.slice(S+1)];try{T.set(N,decodeURIComponent(null!=O?O:"true"))}catch{}}return T}function $(S){if(!S)return;let[[T,R],...N]=V(S),{domain:O,expires:P,httponly:M,maxage:L,path:U,samesite:$,secure:W,priority:Y}=Object.fromEntries(N.map(([S,T])=>[S.toLowerCase(),T]));return K({name:T,value:decodeURIComponent(R),domain:O,...P&&{expires:new Date(P)},...M&&{httpOnly:!0},..."string"==typeof L&&{maxAge:Number(L)},path:U,...$&&{sameSite:Q($)},...W&&{secure:!0},...Y&&{priority:X(Y)}})}function K(S){let T={};for(let R in S)S[R]&&(T[R]=S[R]);return T}((S,R)=>{for(var N in R)T(S,N,{get:R[N],enumerable:!0})})(L,{RequestCookies:()=>ee,ResponseCookies:()=>et,parseCookie:()=>V,parseSetCookie:()=>$,stringifyCookie:()=>U}),S.exports=M(L);var W=["strict","lax","none"];function Q(S){return S=S.toLowerCase(),W.includes(S)?S:void 0}var Y=["low","medium","high"];function X(S){return S=S.toLowerCase(),Y.includes(S)?S:void 0}function Z(S){if(!S)return[];var T,R,N,O,P,M=[],L=0;function U(){for(;L<S.length&&/\s/.test(S.charAt(L));)L+=1;return L<S.length}function V(){return"="!==(R=S.charAt(L))&&";"!==R&&","!==R}for(;L<S.length;){for(T=L,P=!1;U();)if(","===(R=S.charAt(L))){for(N=L,L+=1,U(),O=L;L<S.length&&V();)L+=1;L<S.length&&"="===S.charAt(L)?(P=!0,L=O,M.push(S.substring(T,N)),T=L):L=N+1}else L+=1;(!P||L>=S.length)&&M.push(S.substring(T,S.length))}return M}var ee=class{constructor(S){this._parsed=new Map,this._headers=S;let T=S.get("cookie");if(T)for(let[S,R]of V(T))this._parsed.set(S,{name:S,value:R})}[Symbol.iterator](){return this._parsed[Symbol.iterator]()}get size(){return this._parsed.size}get(...S){let T="string"==typeof S[0]?S[0]:S[0].name;return this._parsed.get(T)}getAll(...S){var T;let R=Array.from(this._parsed);if(!S.length)return R.map(([S,T])=>T);let N="string"==typeof S[0]?S[0]:null==(T=S[0])?void 0:T.name;return R.filter(([S])=>S===N).map(([S,T])=>T)}has(S){return this._parsed.has(S)}set(...S){let[T,R]=1===S.length?[S[0].name,S[0].value]:S,N=this._parsed;return N.set(T,{name:T,value:R}),this._headers.set("cookie",Array.from(N).map(([S,T])=>U(T)).join("; ")),this}delete(S){let T=this._parsed,R=Array.isArray(S)?S.map(S=>T.delete(S)):T.delete(S);return this._headers.set("cookie",Array.from(T).map(([S,T])=>U(T)).join("; ")),R}clear(){return this.delete(Array.from(this._parsed.keys())),this}[Symbol.for("edge-runtime.inspect.custom")](){return`RequestCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(S=>`${S.name}=${encodeURIComponent(S.value)}`).join("; ")}},et=class{constructor(S){var T,R,N;this._parsed=new Map,this._headers=S;let O=null!=(N=null!=(R=null==(T=S.getSetCookie)?void 0:T.call(S))?R:S.get("set-cookie"))?N:[];for(let S of Array.isArray(O)?O:Z(O)){let T=$(S);T&&this._parsed.set(T.name,T)}}get(...S){let T="string"==typeof S[0]?S[0]:S[0].name;return this._parsed.get(T)}getAll(...S){var T;let R=Array.from(this._parsed.values());if(!S.length)return R;let N="string"==typeof S[0]?S[0]:null==(T=S[0])?void 0:T.name;return R.filter(S=>S.name===N)}has(S){return this._parsed.has(S)}set(...S){let[T,R,N]=1===S.length?[S[0].name,S[0].value,S[0]]:S,O=this._parsed;return O.set(T,en({name:T,value:R,...N})),er(O,this._headers),this}delete(...S){let[T,R,N]="string"==typeof S[0]?[S[0]]:[S[0].name,S[0].path,S[0].domain];return this.set({name:T,path:R,domain:N,value:"",expires:new Date(0)})}[Symbol.for("edge-runtime.inspect.custom")](){return`ResponseCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(U).join("; ")}};function er(S,T){for(let[,R]of(T.delete("set-cookie"),S)){let S=U(R);T.append("set-cookie",S)}}function en(S={name:"",value:""}){return"number"==typeof S.expires&&(S.expires=new Date(S.expires)),S.maxAge&&(S.expires=new Date(Date.now()+1e3*S.maxAge)),(null===S.path||void 0===S.path)&&(S.path="/"),S}},5419:(S,T,R)=>{"use strict";S.exports=R(517)},8070:(S,T,R)=>{"use strict";var N;N={value:!0},Object.defineProperty(T,"Z",{enumerable:!0,get:function(){return O.NextResponse}});let O=R(457)},514:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),Object.defineProperty(T,"NextURL",{enumerable:!0,get:function(){return $}});let N=R(737),O=R(5418),P=R(283),M=R(3588),L=/(?!^https?:\/\/)(127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}|\[::1\]|localhost)/;function U(S,T){return new URL(String(S).replace(L,"localhost"),T&&String(T).replace(L,"localhost"))}let V=Symbol("NextURLInternal");class ${constructor(S,T,R){let N,O;"object"==typeof T&&"pathname"in T||"string"==typeof T?(N=T,O=R||{}):O=R||T||{},this[V]={url:U(S,N??O.base),options:O,basePath:""},this.analyze()}analyze(){var S,T,R,O,L;let U=(0,M.getNextPathnameInfo)(this[V].url.pathname,{nextConfig:this[V].options.nextConfig,parseData:!0,i18nProvider:this[V].options.i18nProvider}),$=(0,P.getHostname)(this[V].url,this[V].options.headers);this[V].domainLocale=this[V].options.i18nProvider?this[V].options.i18nProvider.detectDomainLocale($):(0,N.detectDomainLocale)(null==(T=this[V].options.nextConfig)?void 0:null==(S=T.i18n)?void 0:S.domains,$);let K=(null==(R=this[V].domainLocale)?void 0:R.defaultLocale)||(null==(L=this[V].options.nextConfig)?void 0:null==(O=L.i18n)?void 0:O.defaultLocale);this[V].url.pathname=U.pathname,this[V].defaultLocale=K,this[V].basePath=U.basePath??"",this[V].buildId=U.buildId,this[V].locale=U.locale??K,this[V].trailingSlash=U.trailingSlash}formatPathname(){return(0,O.formatNextPathnameInfo)({basePath:this[V].basePath,buildId:this[V].buildId,defaultLocale:this[V].options.forceLocale?void 0:this[V].defaultLocale,locale:this[V].locale,pathname:this[V].url.pathname,trailingSlash:this[V].trailingSlash})}formatSearch(){return this[V].url.search}get buildId(){return this[V].buildId}set buildId(S){this[V].buildId=S}get locale(){return this[V].locale??""}set locale(S){var T,R;if(!this[V].locale||!(null==(R=this[V].options.nextConfig)?void 0:null==(T=R.i18n)?void 0:T.locales.includes(S)))throw TypeError(`The NextURL configuration includes no locale "${S}"`);this[V].locale=S}get defaultLocale(){return this[V].defaultLocale}get domainLocale(){return this[V].domainLocale}get searchParams(){return this[V].url.searchParams}get host(){return this[V].url.host}set host(S){this[V].url.host=S}get hostname(){return this[V].url.hostname}set hostname(S){this[V].url.hostname=S}get port(){return this[V].url.port}set port(S){this[V].url.port=S}get protocol(){return this[V].url.protocol}set protocol(S){this[V].url.protocol=S}get href(){let S=this.formatPathname(),T=this.formatSearch();return`${this.protocol}//${this.host}${S}${T}${this.hash}`}set href(S){this[V].url=U(S),this.analyze()}get origin(){return this[V].url.origin}get pathname(){return this[V].url.pathname}set pathname(S){this[V].url.pathname=S}get hash(){return this[V].url.hash}set hash(S){this[V].url.hash=S}get search(){return this[V].url.search}set search(S){this[V].url.search=S}get password(){return this[V].url.password}set password(S){this[V].url.password=S}get username(){return this[V].url.username}set username(S){this[V].url.username=S}get basePath(){return this[V].basePath}set basePath(S){this[V].basePath=S.startsWith("/")?S:`/${S}`}toString(){return this.href}toJSON(){return this.href}[Symbol.for("edge-runtime.inspect.custom")](){return{href:this.href,origin:this.origin,protocol:this.protocol,username:this.username,password:this.password,host:this.host,hostname:this.hostname,port:this.port,pathname:this.pathname,search:this.search,searchParams:this.searchParams,hash:this.hash}}clone(){return new $(String(this),this[V].options)}}},3608:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),function(S,T){for(var R in T)Object.defineProperty(S,R,{enumerable:!0,get:T[R]})}(T,{RequestCookies:function(){return N.RequestCookies},ResponseCookies:function(){return N.ResponseCookies}});let N=R(7347)},457:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),Object.defineProperty(T,"NextResponse",{enumerable:!0,get:function(){return V}});let N=R(514),O=R(8670),P=R(3608),M=Symbol("internal response"),L=new Set([301,302,303,307,308]);function U(S,T){var R;if(null==S?void 0:null==(R=S.request)?void 0:R.headers){if(!(S.request.headers instanceof Headers))throw Error("request.headers must be an instance of Headers");let R=[];for(let[N,O]of S.request.headers)T.set("x-middleware-request-"+N,O),R.push(N);T.set("x-middleware-override-headers",R.join(","))}}class V extends Response{constructor(S,T={}){super(S,T),this[M]={cookies:new P.ResponseCookies(this.headers),url:T.url?new N.NextURL(T.url,{headers:(0,O.toNodeOutgoingHttpHeaders)(this.headers),nextConfig:T.nextConfig}):void 0}}[Symbol.for("edge-runtime.inspect.custom")](){return{cookies:this.cookies,url:this.url,body:this.body,bodyUsed:this.bodyUsed,headers:Object.fromEntries(this.headers),ok:this.ok,redirected:this.redirected,status:this.status,statusText:this.statusText,type:this.type}}get cookies(){return this[M].cookies}static json(S,T){let R=Response.json(S,T);return new V(R.body,R)}static redirect(S,T){let R="number"==typeof T?T:(null==T?void 0:T.status)??307;if(!L.has(R))throw RangeError('Failed to execute "redirect" on "response": Invalid status code');let N="object"==typeof T?T:{},P=new Headers(null==N?void 0:N.headers);return P.set("Location",(0,O.validateURL)(S)),new V(null,{...N,headers:P,status:R})}static rewrite(S,T){let R=new Headers(null==T?void 0:T.headers);return R.set("x-middleware-rewrite",(0,O.validateURL)(S)),U(T,R),new V(null,{...T,headers:R})}static next(S){let T=new Headers(null==S?void 0:S.headers);return T.set("x-middleware-next","1"),U(S,T),new V(null,{...S,headers:T})}}},8670:(S,T)=>{"use strict";function R(S){let T=new Headers;for(let[R,N]of Object.entries(S))for(let S of Array.isArray(N)?N:[N])void 0!==S&&("number"==typeof S&&(S=S.toString()),T.append(R,S));return T}function N(S){var T,R,N,O,P,M=[],L=0;function U(){for(;L<S.length&&/\s/.test(S.charAt(L));)L+=1;return L<S.length}function V(){return"="!==(R=S.charAt(L))&&";"!==R&&","!==R}for(;L<S.length;){for(T=L,P=!1;U();)if(","===(R=S.charAt(L))){for(N=L,L+=1,U(),O=L;L<S.length&&V();)L+=1;L<S.length&&"="===S.charAt(L)?(P=!0,L=O,M.push(S.substring(T,N)),T=L):L=N+1}else L+=1;(!P||L>=S.length)&&M.push(S.substring(T,S.length))}return M}function O(S){let T={},R=[];if(S)for(let[O,P]of S.entries())"set-cookie"===O.toLowerCase()?(R.push(...N(P)),T[O]=1===R.length?R[0]:R):T[O]=P;return T}function P(S){try{return String(new URL(String(S)))}catch(T){throw Error(`URL is malformed "${String(S)}". Please use only absolute URLs - https://nextjs.org/docs/messages/middleware-relative-urls`,{cause:T})}}Object.defineProperty(T,"__esModule",{value:!0}),function(S,T){for(var R in T)Object.defineProperty(S,R,{enumerable:!0,get:T[R]})}(T,{fromNodeOutgoingHttpHeaders:function(){return R},splitCookiesString:function(){return N},toNodeOutgoingHttpHeaders:function(){return O},validateURL:function(){return P}})},283:(S,T)=>{"use strict";function R(S,T){let R;if((null==T?void 0:T.host)&&!Array.isArray(T.host))R=T.host.toString().split(":",1)[0];else{if(!S.hostname)return;R=S.hostname}return R.toLowerCase()}Object.defineProperty(T,"__esModule",{value:!0}),Object.defineProperty(T,"getHostname",{enumerable:!0,get:function(){return R}})},737:(S,T)=>{"use strict";function R(S,T,R){if(S)for(let P of(R&&(R=R.toLowerCase()),S)){var N,O;if(T===(null==(N=P.domain)?void 0:N.split(":",1)[0].toLowerCase())||R===P.defaultLocale.toLowerCase()||(null==(O=P.locales)?void 0:O.some(S=>S.toLowerCase()===R)))return P}}Object.defineProperty(T,"__esModule",{value:!0}),Object.defineProperty(T,"detectDomainLocale",{enumerable:!0,get:function(){return R}})},3935:(S,T)=>{"use strict";function R(S,T){let R;let N=S.split("/");return(T||[]).some(T=>!!N[1]&&N[1].toLowerCase()===T.toLowerCase()&&(R=T,N.splice(1,1),S=N.join("/")||"/",!0)),{pathname:S,detectedLocale:R}}Object.defineProperty(T,"__esModule",{value:!0}),Object.defineProperty(T,"normalizeLocalePath",{enumerable:!0,get:function(){return R}})},8030:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),Object.defineProperty(T,"addLocale",{enumerable:!0,get:function(){return P}});let N=R(3495),O=R(7211);function P(S,T,R,P){if(!T||T===R)return S;let M=S.toLowerCase();return!P&&((0,O.pathHasPrefix)(M,"/api")||(0,O.pathHasPrefix)(M,"/"+T.toLowerCase()))?S:(0,N.addPathPrefix)(S,"/"+T)}},3495:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),Object.defineProperty(T,"addPathPrefix",{enumerable:!0,get:function(){return O}});let N=R(1955);function O(S,T){if(!S.startsWith("/")||!T)return S;let{pathname:R,query:O,hash:P}=(0,N.parsePath)(S);return""+T+R+O+P}},2348:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),Object.defineProperty(T,"addPathSuffix",{enumerable:!0,get:function(){return O}});let N=R(1955);function O(S,T){if(!S.startsWith("/")||!T)return S;let{pathname:R,query:O,hash:P}=(0,N.parsePath)(S);return""+R+T+O+P}},5418:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),Object.defineProperty(T,"formatNextPathnameInfo",{enumerable:!0,get:function(){return L}});let N=R(5545),O=R(3495),P=R(2348),M=R(8030);function L(S){let T=(0,M.addLocale)(S.pathname,S.locale,S.buildId?void 0:S.defaultLocale,S.ignorePrefix);return(S.buildId||!S.trailingSlash)&&(T=(0,N.removeTrailingSlash)(T)),S.buildId&&(T=(0,P.addPathSuffix)((0,O.addPathPrefix)(T,"/_next/data/"+S.buildId),"/"===S.pathname?"index.json":".json")),T=(0,O.addPathPrefix)(T,S.basePath),!S.buildId&&S.trailingSlash?T.endsWith("/")?T:(0,P.addPathSuffix)(T,"/"):(0,N.removeTrailingSlash)(T)}},3588:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),Object.defineProperty(T,"getNextPathnameInfo",{enumerable:!0,get:function(){return M}});let N=R(3935),O=R(7188),P=R(7211);function M(S,T){var R,M;let{basePath:L,i18n:U,trailingSlash:V}=null!=(R=T.nextConfig)?R:{},$={pathname:S,trailingSlash:"/"!==S?S.endsWith("/"):V};L&&(0,P.pathHasPrefix)($.pathname,L)&&($.pathname=(0,O.removePathPrefix)($.pathname,L),$.basePath=L);let K=$.pathname;if($.pathname.startsWith("/_next/data/")&&$.pathname.endsWith(".json")){let S=$.pathname.replace(/^\/_next\/data\//,"").replace(/\.json$/,"").split("/"),R=S[0];$.buildId=R,K="index"!==S[1]?"/"+S.slice(1).join("/"):"/",!0===T.parseData&&($.pathname=K)}if(U){let S=T.i18nProvider?T.i18nProvider.analyze($.pathname):(0,N.normalizeLocalePath)($.pathname,U.locales);$.locale=S.detectedLocale,$.pathname=null!=(M=S.pathname)?M:$.pathname,!S.detectedLocale&&$.buildId&&(S=T.i18nProvider?T.i18nProvider.analyze(K):(0,N.normalizeLocalePath)(K,U.locales)).detectedLocale&&($.locale=S.detectedLocale)}return $}},1955:(S,T)=>{"use strict";function R(S){let T=S.indexOf("#"),R=S.indexOf("?"),N=R>-1&&(T<0||R<T);return N||T>-1?{pathname:S.substring(0,N?R:T),query:N?S.substring(R,T>-1?T:void 0):"",hash:T>-1?S.slice(T):""}:{pathname:S,query:"",hash:""}}Object.defineProperty(T,"__esModule",{value:!0}),Object.defineProperty(T,"parsePath",{enumerable:!0,get:function(){return R}})},7211:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),Object.defineProperty(T,"pathHasPrefix",{enumerable:!0,get:function(){return O}});let N=R(1955);function O(S,T){if("string"!=typeof S)return!1;let{pathname:R}=(0,N.parsePath)(S);return R===T||R.startsWith(T+"/")}},7188:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),Object.defineProperty(T,"removePathPrefix",{enumerable:!0,get:function(){return O}});let N=R(7211);function O(S,T){if(!(0,N.pathHasPrefix)(S,T))return S;let R=S.slice(T.length);return R.startsWith("/")?R:"/"+R}},5545:(S,T)=>{"use strict";function R(S){return S.replace(/\/$/,"")||"/"}Object.defineProperty(T,"__esModule",{value:!0}),Object.defineProperty(T,"removeTrailingSlash",{enumerable:!0,get:function(){return R}})},9530:(S,T,R)=>{"use strict";var N=R(7628);S.exports=T=N.descriptor=N.Root.fromJSON(R(4552)).lookup(".google.protobuf");var O=N.Namespace,P=N.Root,M=N.Enum,L=N.Type,U=N.Field,V=N.MapField,$=N.OneOf,K=N.Service,W=N.Method;function Q(S,R,N){var V=T.FileDescriptorProto.create({name:S.filename||(S.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});ef(N,V),S instanceof P||(V.package=S.fullName.substring(1));for(var $,W=0;W<S.nestedArray.length;++W)($=S._nestedArray[W])instanceof L?V.messageType.push($.toDescriptor(N)):$ instanceof M?V.enumType.push($.toDescriptor()):$ instanceof U?V.extension.push($.toDescriptor(N)):$ instanceof K?V.service.push($.toDescriptor()):$ instanceof O&&Q($,R,N);V.options=ec(S.options,T.FileOptions),V.messageType.length+V.enumType.length+V.extension.length+V.service.length&&R.push(V)}P.fromDescriptor=function(S){"number"==typeof S.length&&(S=T.FileDescriptorSet.decode(S));var R=new P;if(S.file)for(var N,O,V,$=0;$<S.file.length;++$){O=R,(N=S.file[$]).package&&N.package.length&&(O=R.define(N.package));var W=ep(N);if(N.name&&N.name.length&&R.files.push(O.filename=N.name),N.messageType)for(V=0;V<N.messageType.length;++V)O.add(L.fromDescriptor(N.messageType[V],W));if(N.enumType)for(V=0;V<N.enumType.length;++V)O.add(M.fromDescriptor(N.enumType[V],W));if(N.extension)for(V=0;V<N.extension.length;++V)O.add(U.fromDescriptor(N.extension[V],W));if(N.service)for(V=0;V<N.service.length;++V)O.add(K.fromDescriptor(N.service[V],W));var Q=eo(N.options,T.FileOptions);if(Q){var Y=Object.keys(Q);for(V=0;V<Y.length;++V)O.setOption(Y[V],Q[Y[V]])}}return R.resolveAll()},P.prototype.toDescriptor=function(S){var R=T.FileDescriptorSet.create();return Q(this,R.file,S),R};var Y=0;L.fromDescriptor=function(S,R,N){"number"==typeof S.length&&(S=T.DescriptorProto.decode(S));var O,P=new L(S.name.length?S.name:"Type"+Y++,eo(S.options,T.MessageOptions));if(N||(P._edition=R),S.oneofDecl)for(O=0;O<S.oneofDecl.length;++O)P.add($.fromDescriptor(S.oneofDecl[O]));if(S.field)for(O=0;O<S.field.length;++O){var V=U.fromDescriptor(S.field[O],R,!0);P.add(V),S.field[O].hasOwnProperty("oneofIndex")&&P.oneofsArray[S.field[O].oneofIndex].add(V)}if(S.extension)for(O=0;O<S.extension.length;++O)P.add(U.fromDescriptor(S.extension[O],R,!0));if(S.nestedType)for(O=0;O<S.nestedType.length;++O)P.add(L.fromDescriptor(S.nestedType[O],R,!0)),S.nestedType[O].options&&S.nestedType[O].options.mapEntry&&P.setOption("map_entry",!0);if(S.enumType)for(O=0;O<S.enumType.length;++O)P.add(M.fromDescriptor(S.enumType[O],R,!0));if(S.extensionRange&&S.extensionRange.length)for(O=0,P.extensions=[];O<S.extensionRange.length;++O)P.extensions.push([S.extensionRange[O].start,S.extensionRange[O].end]);if(S.reservedRange&&S.reservedRange.length||S.reservedName&&S.reservedName.length){if(P.reserved=[],S.reservedRange)for(O=0;O<S.reservedRange.length;++O)P.reserved.push([S.reservedRange[O].start,S.reservedRange[O].end]);if(S.reservedName)for(O=0;O<S.reservedName.length;++O)P.reserved.push(S.reservedName[O])}return P},L.prototype.toDescriptor=function(S){var R,N,O=T.DescriptorProto.create({name:this.name});for(N=0;N<this.fieldsArray.length;++N)if(O.field.push(R=this._fieldsArray[N].toDescriptor(S)),this._fieldsArray[N]instanceof V){var P=es(this._fieldsArray[N].keyType,this._fieldsArray[N].resolvedKeyType,!1),$=es(this._fieldsArray[N].type,this._fieldsArray[N].resolvedType,!1),K=11===$||14===$?this._fieldsArray[N].resolvedType&&ed(this.parent,this._fieldsArray[N].resolvedType)||this._fieldsArray[N].type:void 0;O.nestedType.push(T.DescriptorProto.create({name:R.typeName,field:[T.FieldDescriptorProto.create({name:"key",number:1,label:1,type:P}),T.FieldDescriptorProto.create({name:"value",number:2,label:1,type:$,typeName:K})],options:T.MessageOptions.create({mapEntry:!0})}))}for(N=0;N<this.oneofsArray.length;++N)O.oneofDecl.push(this._oneofsArray[N].toDescriptor());for(N=0;N<this.nestedArray.length;++N)this._nestedArray[N]instanceof U?O.field.push(this._nestedArray[N].toDescriptor(S)):this._nestedArray[N]instanceof L?O.nestedType.push(this._nestedArray[N].toDescriptor(S)):this._nestedArray[N]instanceof M&&O.enumType.push(this._nestedArray[N].toDescriptor());if(this.extensions)for(N=0;N<this.extensions.length;++N)O.extensionRange.push(T.DescriptorProto.ExtensionRange.create({start:this.extensions[N][0],end:this.extensions[N][1]}));if(this.reserved)for(N=0;N<this.reserved.length;++N)"string"==typeof this.reserved[N]?O.reservedName.push(this.reserved[N]):O.reservedRange.push(T.DescriptorProto.ReservedRange.create({start:this.reserved[N][0],end:this.reserved[N][1]}));return O.options=ec(this.options,T.MessageOptions),O};var X=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;U.fromDescriptor=function(S,R,N){if("number"==typeof S.length&&(S=T.DescriptorProto.decode(S)),"number"!=typeof S.number)throw Error("missing field id");switch(O=S.typeName&&S.typeName.length?S.typeName:en(S.type),S.label){case 1:P=void 0;break;case 2:P="required";break;case 3:P="repeated";break;default:throw Error("illegal label: "+S.label)}var O,P,M=S.extendee;void 0!==S.extendee&&(M=M.length?M:void 0);var L=new U(S.name.length?S.name:"field"+S.number,S.number,O,P,M);if(N||(L._edition=R),L.options=eo(S.options,T.FieldOptions),S.proto3_optional&&(L.options.proto3_optional=!0),S.defaultValue&&S.defaultValue.length){var V=S.defaultValue;switch(V){case"true":case"TRUE":V=!0;break;case"false":case"FALSE":V=!1;break;default:X.exec(V)&&(V=parseInt(V))}L.setOption("default",V)}return ei(S.type)&&("proto3"===R?S.options&&!S.options.packed&&L.setOption("packed",!1):(!R||"proto2"===R)&&S.options&&S.options.packed&&L.setOption("packed",!0)),L},U.prototype.toDescriptor=function(S){var R=T.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)R.type=11,R.typeName=N.util.ucFirst(this.name),R.label=3;else{switch(R.type=es(this.type,this.resolve().resolvedType,this.delimited)){case 10:case 11:case 14:R.typeName=this.resolvedType?ed(this.parent,this.resolvedType):this.type}"repeated"===this.rule?R.label=3:this.required&&"proto2"===S?R.label=2:R.label=1}if(R.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(R.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(R.options=ec(this.options,T.FieldOptions),null!=this.options.default&&(R.defaultValue=String(this.options.default)),this.options.proto3_optional&&(R.proto3_optional=!0)),"proto3"===S?this.packed||((R.options||(R.options=T.FieldOptions.create())).packed=!1):(!S||"proto2"===S)&&this.packed&&((R.options||(R.options=T.FieldOptions.create())).packed=!0),R};var Z=0;M.fromDescriptor=function(S,R,N){"number"==typeof S.length&&(S=T.EnumDescriptorProto.decode(S));var O={};if(S.value)for(var P=0;P<S.value.length;++P){var L=S.value[P].name,U=S.value[P].number||0;O[L&&L.length?L:"NAME"+U]=U}var V=new M(S.name&&S.name.length?S.name:"Enum"+Z++,O,eo(S.options,T.EnumOptions));return N||(V._edition=R),V},M.prototype.toDescriptor=function(){for(var S=[],R=0,N=Object.keys(this.values);R<N.length;++R)S.push(T.EnumValueDescriptorProto.create({name:N[R],number:this.values[N[R]]}));return T.EnumDescriptorProto.create({name:this.name,value:S,options:ec(this.options,T.EnumOptions)})};var ee=0;$.fromDescriptor=function(S){return"number"==typeof S.length&&(S=T.OneofDescriptorProto.decode(S)),new $(S.name&&S.name.length?S.name:"oneof"+ee++)},$.prototype.toDescriptor=function(){return T.OneofDescriptorProto.create({name:this.name})};var et=0;K.fromDescriptor=function(S,R,N){"number"==typeof S.length&&(S=T.ServiceDescriptorProto.decode(S));var O=new K(S.name&&S.name.length?S.name:"Service"+et++,eo(S.options,T.ServiceOptions));if(N||(O._edition=R),S.method)for(var P=0;P<S.method.length;++P)O.add(W.fromDescriptor(S.method[P]));return O},K.prototype.toDescriptor=function(){for(var S=[],R=0;R<this.methodsArray.length;++R)S.push(this._methodsArray[R].toDescriptor());return T.ServiceDescriptorProto.create({name:this.name,method:S,options:ec(this.options,T.ServiceOptions)})};var er=0;function en(S){switch(S){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+S)}function ei(S){switch(S){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function es(S,T,R){switch(S){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(T instanceof M)return 14;if(T instanceof L)return R?10:11;throw Error("illegal type: "+S)}function ea(S,T){for(var R,N,O={},P=0;P<T.fieldsArray.length;++P)if("uninterpretedOption"!==(N=(R=T._fieldsArray[P]).name)&&Object.prototype.hasOwnProperty.call(S,N)){var U=eh(N);R.resolvedType instanceof L?O[U]=ea(S[N],R.resolvedType):R.resolvedType instanceof M?O[U]=R.resolvedType.valuesById[S[N]]:O[U]=S[N]}return O}function eo(S,T){if(S)return ea(T.toObject(S),T)}function eu(S,T){for(var R={},O=Object.keys(S),P=0;P<O.length;++P){var M=O[P],U=N.util.camelCase(M);if(Object.prototype.hasOwnProperty.call(T.fields,U)){var V=T.fields[U];V.resolvedType instanceof L?R[U]=eu(S[M],V.resolvedType):R[U]=S[M],V.repeated&&!Array.isArray(R[U])&&(R[U]=[R[U]])}}return R}function ec(S,T){if(S)return T.fromObject(eu(S,T))}function ed(S,T){var R=S.fullName.split("."),N=T.fullName.split("."),M=0,L=0,U=N.length-1;if(!(S instanceof P)&&T instanceof O)for(;M<R.length&&L<U&&R[M]===N[L];){var V=T.lookup(R[M++],!0);if(null!==V&&V!==T)break;++L}else for(;M<R.length&&L<U&&R[M]===N[L];++M,++L);return N.slice(L).join(".")}function eh(S){return S.substring(0,1)+S.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(S,T){return"_"+T.toLowerCase()})}function ep(S){if("editions"===S.syntax){if(S.edition===T.Edition.EDITION_2023)return"2023";throw Error("Unsupported edition "+S.edition)}return"proto3"===S.syntax?"proto3":"proto2"}function ef(S,R){if(S){if("proto2"===S||"proto3"===S)R.syntax=S;else if(R.syntax="editions","2023"===S)R.edition=T.Edition.EDITION_2023;else throw Error("Unsupported edition "+S)}}W.fromDescriptor=function(S){return"number"==typeof S.length&&(S=T.MethodDescriptorProto.decode(S)),new W(S.name&&S.name.length?S.name:"Method"+er++,"rpc",S.inputType,S.outputType,!!S.clientStreaming,!!S.serverStreaming,eo(S.options,T.MethodOptions))},W.prototype.toDescriptor=function(){return T.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:ec(this.options,T.MethodOptions)})}},7628:(S,T,R)=>{"use strict";S.exports=R(2378)},6353:S=>{"use strict";S.exports=N;var T,R=/\/|\./;function N(S,T){R.test(S)||(S="google/protobuf/"+S+".proto",T={nested:{google:{nested:{protobuf:{nested:T}}}}}),N[S]=T}N("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),N("duration",{Duration:T={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),N("timestamp",{Timestamp:T}),N("empty",{Empty:{fields:{}}}),N("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),N("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),N("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),N.get=function(S){return N[S]||null}},9981:(S,T,R)=>{"use strict";var N=T,O=R(6734),P=R(7454);function M(S,T,R,N){var P=!1;if(T.resolvedType){if(T.resolvedType instanceof O){S("switch(d%s){",N);for(var M=T.resolvedType.values,L=Object.keys(M),U=0;U<L.length;++U)M[L[U]]!==T.typeDefault||P||(S("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',N,N,N),T.repeated||S("break"),P=!0),S("case%j:",L[U])("case %i:",M[L[U]])("m%s=%j",N,M[L[U]])("break");S("}")}else S('if(typeof d%s!=="object")',N)("throw TypeError(%j)",T.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",N,R,N)}else{var V=!1;switch(T.type){case"double":case"float":S("m%s=Number(d%s)",N,N);break;case"uint32":case"fixed32":S("m%s=d%s>>>0",N,N);break;case"int32":case"sint32":case"sfixed32":S("m%s=d%s|0",N,N);break;case"uint64":V=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":S("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",N,N,V)('else if(typeof d%s==="string")',N)("m%s=parseInt(d%s,10)",N,N)('else if(typeof d%s==="number")',N)("m%s=d%s",N,N)('else if(typeof d%s==="object")',N)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",N,N,N,V?"true":"");break;case"bytes":S('if(typeof d%s==="string")',N)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",N,N,N)("else if(d%s.length >= 0)",N)("m%s=d%s",N,N);break;case"string":S("m%s=String(d%s)",N,N);break;case"bool":S("m%s=Boolean(d%s)",N,N)}}return S}function L(S,T,R,N){if(T.resolvedType)T.resolvedType instanceof O?S("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",N,R,N,N,R,N,N):S("d%s=types[%i].toObject(m%s,o)",N,R,N);else{var P=!1;switch(T.type){case"double":case"float":S("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",N,N,N,N);break;case"uint64":P=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":S('if(typeof m%s==="number")',N)("d%s=o.longs===String?String(m%s):m%s",N,N,N)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",N,N,N,N,P?"true":"",N);break;case"bytes":S("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",N,N,N,N,N);break;default:S("d%s=m%s",N,N)}}return S}N.fromObject=function(S){var T=S.fieldsArray,R=P.codegen(["d"],S.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!T.length)return R("return new this.ctor");R("var m=new this.ctor");for(var N=0;N<T.length;++N){var L=T[N].resolve(),U=P.safeProp(L.name);L.map?(R("if(d%s){",U)('if(typeof d%s!=="object")',U)("throw TypeError(%j)",L.fullName+": object expected")("m%s={}",U)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",U),M(R,L,N,U+"[ks[i]]")("}")("}")):L.repeated?(R("if(d%s){",U)("if(!Array.isArray(d%s))",U)("throw TypeError(%j)",L.fullName+": array expected")("m%s=[]",U)("for(var i=0;i<d%s.length;++i){",U),M(R,L,N,U+"[i]")("}")("}")):(L.resolvedType instanceof O||R("if(d%s!=null){",U),M(R,L,N,U),L.resolvedType instanceof O||R("}"))}return R("return m")},N.toObject=function(S){var T=S.fieldsArray.slice().sort(P.compareFieldsById);if(!T.length)return P.codegen()("return {}");for(var R=P.codegen(["m","o"],S.name+"$toObject")("if(!o)")("o={}")("var d={}"),N=[],M=[],U=[],V=0;V<T.length;++V)T[V].partOf||(T[V].resolve().repeated?N:T[V].map?M:U).push(T[V]);if(N.length){for(R("if(o.arrays||o.defaults){"),V=0;V<N.length;++V)R("d%s=[]",P.safeProp(N[V].name));R("}")}if(M.length){for(R("if(o.objects||o.defaults){"),V=0;V<M.length;++V)R("d%s={}",P.safeProp(M[V].name));R("}")}if(U.length){for(R("if(o.defaults){"),V=0;V<U.length;++V){var $=U[V],K=P.safeProp($.name);if($.resolvedType instanceof O)R("d%s=o.enums===String?%j:%j",K,$.resolvedType.valuesById[$.typeDefault],$.typeDefault);else if($.long)R("if(util.Long){")("var n=new util.Long(%i,%i,%j)",$.typeDefault.low,$.typeDefault.high,$.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",K)("}else")("d%s=o.longs===String?%j:%i",K,$.typeDefault.toString(),$.typeDefault.toNumber());else if($.bytes){var W="["+Array.prototype.slice.call($.typeDefault).join(",")+"]";R("if(o.bytes===String)d%s=%j",K,String.fromCharCode.apply(String,$.typeDefault))("else{")("d%s=%s",K,W)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",K,K)("}")}else R("d%s=%j",K,$.typeDefault)}R("}")}var Q=!1;for(V=0;V<T.length;++V){var $=T[V],Y=S._fieldsArray.indexOf($),K=P.safeProp($.name);$.map?(Q||(Q=!0,R("var ks2")),R("if(m%s&&(ks2=Object.keys(m%s)).length){",K,K)("d%s={}",K)("for(var j=0;j<ks2.length;++j){"),L(R,$,Y,K+"[ks2[j]]")("}")):$.repeated?(R("if(m%s&&m%s.length){",K,K)("d%s=[]",K)("for(var j=0;j<m%s.length;++j){",K),L(R,$,Y,K+"[j]")("}")):(R("if(m%s!=null&&m.hasOwnProperty(%j)){",K,$.name),L(R,$,Y,K),$.partOf&&R("if(o.oneofs)")("d%s=%j",P.safeProp($.partOf.name),$.name)),R("}")}return R("return d")}},3951:(S,T,R)=>{"use strict";S.exports=L;var N=R(6734),O=R(816),P=R(7454);function M(S){return"missing required '"+S.name+"'"}function L(S){for(var T=P.codegen(["r","l","e"],S.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(S.fieldsArray.filter(function(S){return S.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()")("if(t===e)")("break")("switch(t>>>3){"),R=0;R<S.fieldsArray.length;++R){var L=S._fieldsArray[R].resolve(),U=L.resolvedType instanceof N?"int32":L.type,V="m"+P.safeProp(L.name);T("case %i: {",L.id),L.map?(T("if(%s===util.emptyObject)",V)("%s={}",V)("var c2 = r.uint32()+r.pos"),void 0!==O.defaults[L.keyType]?T("k=%j",O.defaults[L.keyType]):T("k=null"),void 0!==O.defaults[U]?T("value=%j",O.defaults[U]):T("value=null"),T("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",L.keyType)("case 2:"),void 0===O.basic[U]?T("value=types[%i].decode(r,r.uint32())",R):T("value=r.%s()",U),T("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),T(void 0!==O.long[L.keyType]?'%s[typeof k==="object"?util.longToHash(k):k]=value':"%s[k]=value",V)):L.repeated?(T("if(!(%s&&%s.length))",V,V)("%s=[]",V),void 0!==O.packed[U]&&T("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",V,U)("}else"),void 0===O.basic[U]?T(L.delimited?"%s.push(types[%i].decode(r,undefined,((t&~7)|4)))":"%s.push(types[%i].decode(r,r.uint32()))",V,R):T("%s.push(r.%s())",V,U)):void 0===O.basic[U]?T(L.delimited?"%s=types[%i].decode(r,undefined,((t&~7)|4))":"%s=types[%i].decode(r,r.uint32())",V,R):T("%s=r.%s()",V,U),T("break")("}")}for(T("default:")("r.skipType(t&7)")("break")("}")("}"),R=0;R<S._fieldsArray.length;++R){var $=S._fieldsArray[R];$.required&&T("if(!m.hasOwnProperty(%j))",$.name)("throw util.ProtocolError(%j,{instance:m})",M($))}return T("return m")}},95:(S,T,R)=>{"use strict";S.exports=L;var N=R(6734),O=R(816),P=R(7454);function M(S,T,R,N){return T.delimited?S("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",R,N,(T.id<<3|3)>>>0,(T.id<<3|4)>>>0):S("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",R,N,(T.id<<3|2)>>>0)}function L(S){for(var T,R,L=P.codegen(["m","w"],S.name+"$encode")("if(!w)")("w=Writer.create()"),U=S.fieldsArray.slice().sort(P.compareFieldsById),T=0;T<U.length;++T){var V=U[T].resolve(),$=S._fieldsArray.indexOf(V),K=V.resolvedType instanceof N?"int32":V.type,W=O.basic[K];R="m"+P.safeProp(V.name),V.map?(L("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",R,V.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",R)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(V.id<<3|2)>>>0,8|O.mapKey[V.keyType],V.keyType),void 0===W?L("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",$,R):L(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|W,K,R),L("}")("}")):V.repeated?(L("if(%s!=null&&%s.length){",R,R),V.packed&&void 0!==O.packed[K]?L("w.uint32(%i).fork()",(V.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",R)("w.%s(%s[i])",K,R)("w.ldelim()"):(L("for(var i=0;i<%s.length;++i)",R),void 0===W?M(L,V,$,R+"[i]"):L("w.uint32(%i).%s(%s[i])",(V.id<<3|W)>>>0,K,R)),L("}")):(V.optional&&L("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",R,V.name),void 0===W?M(L,V,$,R):L("w.uint32(%i).%s(%s)",(V.id<<3|W)>>>0,K,R))}return L("return w")}},6734:(S,T,R)=>{"use strict";S.exports=M;var N=R(4184);((M.prototype=Object.create(N.prototype)).constructor=M).className="Enum";var O=R(8727),P=R(7454);function M(S,T,R,O,P,M){if(N.call(this,S,R),T&&"object"!=typeof T)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=O,this.comments=P||{},this.valuesOptions=M,this._valuesFeatures={},this.reserved=void 0,T)for(var L=Object.keys(T),U=0;U<L.length;++U)"number"==typeof T[L[U]]&&(this.valuesById[this.values[L[U]]=T[L[U]]]=L[U])}M.prototype._resolveFeatures=function(S){return S=this._edition||S,N.prototype._resolveFeatures.call(this,S),Object.keys(this.values).forEach(S=>{var T=Object.assign({},this._features);this._valuesFeatures[S]=Object.assign(T,this.valuesOptions&&this.valuesOptions[S]&&this.valuesOptions[S].features)}),this},M.fromJSON=function(S,T){var R=new M(S,T.values,T.options,T.comment,T.comments);return R.reserved=T.reserved,T.edition&&(R._edition=T.edition),R._defaultEdition="proto3",R},M.prototype.toJSON=function(S){var T=!!S&&!!S.keepComments;return P.toObject(["edition",this._editionToJSON(),"options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",T?this.comment:void 0,"comments",T?this.comments:void 0])},M.prototype.add=function(S,T,R,N){if(!P.isString(S))throw TypeError("name must be a string");if(!P.isInteger(T))throw TypeError("id must be an integer");if(void 0!==this.values[S])throw Error("duplicate name '"+S+"' in "+this);if(this.isReservedId(T))throw Error("id "+T+" is reserved in "+this);if(this.isReservedName(S))throw Error("name '"+S+"' is reserved in "+this);if(void 0!==this.valuesById[T]){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+T+" in "+this);this.values[S]=T}else this.valuesById[this.values[S]=T]=S;return N&&(void 0===this.valuesOptions&&(this.valuesOptions={}),this.valuesOptions[S]=N||null),this.comments[S]=R||null,this},M.prototype.remove=function(S){if(!P.isString(S))throw TypeError("name must be a string");var T=this.values[S];if(null==T)throw Error("name '"+S+"' does not exist in "+this);return delete this.valuesById[T],delete this.values[S],delete this.comments[S],this.valuesOptions&&delete this.valuesOptions[S],this},M.prototype.isReservedId=function(S){return O.isReservedId(this.reserved,S)},M.prototype.isReservedName=function(S){return O.isReservedName(this.reserved,S)}},8138:(S,T,R)=>{"use strict";S.exports=V;var N,O=R(4184);((V.prototype=Object.create(O.prototype)).constructor=V).className="Field";var P=R(6734),M=R(816),L=R(7454),U=/^required|optional|repeated$/;function V(S,T,R,N,P,V,$){if(L.isObject(N)?($=P,V=N,N=P=void 0):L.isObject(P)&&($=V,V=P,P=void 0),O.call(this,S,V),!L.isInteger(T)||T<0)throw TypeError("id must be a non-negative integer");if(!L.isString(R))throw TypeError("type must be a string");if(void 0!==N&&!U.test(N=N.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==P&&!L.isString(P))throw TypeError("extend must be a string");"proto3_optional"===N&&(N="optional"),this.rule=N&&"optional"!==N?N:void 0,this.type=R,this.id=T,this.extend=P||void 0,this.repeated="repeated"===N,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!L.Long&&void 0!==M.long[R],this.bytes="bytes"===R,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.comment=$}V.fromJSON=function(S,T){var R=new V(S,T.id,T.type,T.rule,T.extend,T.options,T.comment);return T.edition&&(R._edition=T.edition),R._defaultEdition="proto3",R},Object.defineProperty(V.prototype,"required",{get:function(){return"LEGACY_REQUIRED"===this._features.field_presence}}),Object.defineProperty(V.prototype,"optional",{get:function(){return!this.required}}),Object.defineProperty(V.prototype,"delimited",{get:function(){return this.resolvedType instanceof N&&"DELIMITED"===this._features.message_encoding}}),Object.defineProperty(V.prototype,"packed",{get:function(){return"PACKED"===this._features.repeated_field_encoding}}),Object.defineProperty(V.prototype,"hasPresence",{get:function(){return!this.repeated&&!this.map&&(this.partOf||this.declaringField||this.extensionField||"IMPLICIT"!==this._features.field_presence)}}),V.prototype.setOption=function(S,T,R){return O.prototype.setOption.call(this,S,T,R)},V.prototype.toJSON=function(S){var T=!!S&&!!S.keepComments;return L.toObject(["edition",this._editionToJSON(),"rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",T?this.comment:void 0])},V.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=M.defaults[this.type])?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof N?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof P&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof P||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=L.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var S;L.base64.test(this.typeDefault)?L.base64.decode(this.typeDefault,S=L.newBuffer(L.base64.length(this.typeDefault)),0):L.utf8.write(this.typeDefault,S=L.newBuffer(L.utf8.length(this.typeDefault)),0),this.typeDefault=S}return this.map?this.defaultValue=L.emptyObject:this.repeated?this.defaultValue=L.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof N&&(this.parent.ctor.prototype[this.name]=this.defaultValue),O.prototype.resolve.call(this)},V.prototype._inferLegacyProtoFeatures=function(S){if("proto2"!==S&&"proto3"!==S)return{};var T={};if("required"===this.rule&&(T.field_presence="LEGACY_REQUIRED"),this.parent&&void 0===M.defaults[this.type]){var R=this.parent.get(this.type.split(".").pop());R&&R instanceof N&&R.group&&(T.message_encoding="DELIMITED")}return!0===this.getOption("packed")?T.repeated_field_encoding="PACKED":!1===this.getOption("packed")&&(T.repeated_field_encoding="EXPANDED"),T},V.prototype._resolveFeatures=function(S){return O.prototype._resolveFeatures.call(this,this._edition||S)},V.d=function(S,T,R,N){return"function"==typeof T?T=L.decorateType(T).name:T&&"object"==typeof T&&(T=L.decorateEnum(T).name),function(O,P){L.decorateType(O.constructor).add(new V(P,S,T,R,{default:N}))}},V._configure=function(S){N=S}},2585:(S,T,R)=>{"use strict";var N=S.exports=R(1353);function O(S,T,R){return"function"==typeof T?(R=T,T=new N.Root):T||(T=new N.Root),T.load(S,R)}function P(S,T){return T||(T=new N.Root),T.loadSync(S)}N.build="light",N.load=O,N.loadSync=P,N.encoder=R(95),N.decoder=R(3951),N.verifier=R(7624),N.converter=R(9981),N.ReflectionObject=R(4184),N.Namespace=R(8727),N.Root=R(3852),N.Enum=R(6734),N.Type=R(5006),N.Field=R(8138),N.OneOf=R(7702),N.MapField=R(8751),N.Service=R(8719),N.Method=R(898),N.Message=R(2038),N.wrappers=R(1904),N.types=R(816),N.util=R(7454),N.ReflectionObject._configure(N.Root),N.Namespace._configure(N.Type,N.Service,N.Enum),N.Root._configure(N.Type),N.Field._configure(N.Type)},1353:(S,T,R)=>{"use strict";var N=T;function O(){N.util._configure(),N.Writer._configure(N.BufferWriter),N.Reader._configure(N.BufferReader)}N.build="minimal",N.Writer=R(9822),N.BufferWriter=R(5896),N.Reader=R(1761),N.BufferReader=R(8282),N.util=R(8345),N.rpc=R(8346),N.roots=R(8091),N.configure=O,O()},2378:(S,T,R)=>{"use strict";var N=S.exports=R(2585);N.build="full",N.tokenize=R(1652),N.parse=R(6796),N.common=R(6353),N.Root._configure(N.Type,N.parse,N.common)},8751:(S,T,R)=>{"use strict";S.exports=M;var N=R(8138);((M.prototype=Object.create(N.prototype)).constructor=M).className="MapField";var O=R(816),P=R(7454);function M(S,T,R,O,M,L){if(N.call(this,S,T,O,void 0,void 0,M,L),!P.isString(R))throw TypeError("keyType must be a string");this.keyType=R,this.resolvedKeyType=null,this.map=!0}M.fromJSON=function(S,T){return new M(S,T.id,T.keyType,T.type,T.options,T.comment)},M.prototype.toJSON=function(S){var T=!!S&&!!S.keepComments;return P.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",T?this.comment:void 0])},M.prototype.resolve=function(){if(this.resolved)return this;if(void 0===O.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return N.prototype.resolve.call(this)},M.d=function(S,T,R){return"function"==typeof R?R=P.decorateType(R).name:R&&"object"==typeof R&&(R=P.decorateEnum(R).name),function(N,O){P.decorateType(N.constructor).add(new M(O,S,T,R))}}},2038:(S,T,R)=>{"use strict";S.exports=O;var N=R(8345);function O(S){if(S)for(var T=Object.keys(S),R=0;R<T.length;++R)this[T[R]]=S[T[R]]}O.create=function(S){return this.$type.create(S)},O.encode=function(S,T){return this.$type.encode(S,T)},O.encodeDelimited=function(S,T){return this.$type.encodeDelimited(S,T)},O.decode=function(S){return this.$type.decode(S)},O.decodeDelimited=function(S){return this.$type.decodeDelimited(S)},O.verify=function(S){return this.$type.verify(S)},O.fromObject=function(S){return this.$type.fromObject(S)},O.toObject=function(S,T){return this.$type.toObject(S,T)},O.prototype.toJSON=function(){return this.$type.toObject(this,N.toJSONOptions)}},898:(S,T,R)=>{"use strict";S.exports=P;var N=R(4184);((P.prototype=Object.create(N.prototype)).constructor=P).className="Method";var O=R(7454);function P(S,T,R,P,M,L,U,V,$){if(O.isObject(M)?(U=M,M=L=void 0):O.isObject(L)&&(U=L,L=void 0),!(void 0===T||O.isString(T)))throw TypeError("type must be a string");if(!O.isString(R))throw TypeError("requestType must be a string");if(!O.isString(P))throw TypeError("responseType must be a string");N.call(this,S,U),this.type=T||"rpc",this.requestType=R,this.requestStream=!!M||void 0,this.responseType=P,this.responseStream=!!L||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=V,this.parsedOptions=$}P.fromJSON=function(S,T){return new P(S,T.type,T.requestType,T.responseType,T.requestStream,T.responseStream,T.options,T.comment,T.parsedOptions)},P.prototype.toJSON=function(S){var T=!!S&&!!S.keepComments;return O.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",T?this.comment:void 0,"parsedOptions",this.parsedOptions])},P.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),N.prototype.resolve.call(this))}},8727:(S,T,R)=>{"use strict";S.exports=K;var N,O,P,M=R(4184);((K.prototype=Object.create(M.prototype)).constructor=K).className="Namespace";var L=R(8138),U=R(7454),V=R(7702);function $(S,T){if(S&&S.length){for(var R={},N=0;N<S.length;++N)R[S[N].name]=S[N].toJSON(T);return R}}function K(S,T){M.call(this,S,T),this.nested=void 0,this._nestedArray=null,this._lookupCache={},this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0}function W(S){S._nestedArray=null,S._lookupCache={};for(var T=S;T=T.parent;)T._lookupCache={};return S}K.fromJSON=function(S,T){return new K(S,T.options).addJSON(T.nested)},K.arrayToJSON=$,K.isReservedId=function(S,T){if(S){for(var R=0;R<S.length;++R)if("string"!=typeof S[R]&&S[R][0]<=T&&S[R][1]>T)return!0}return!1},K.isReservedName=function(S,T){if(S){for(var R=0;R<S.length;++R)if(S[R]===T)return!0}return!1},Object.defineProperty(K.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=U.toArray(this.nested))}}),K.prototype.toJSON=function(S){return U.toObject(["options",this.options,"nested",$(this.nestedArray,S)])},K.prototype.addJSON=function(S){var T=this;if(S)for(var R,M=Object.keys(S),U=0;U<M.length;++U)R=S[M[U]],T.add((void 0!==R.fields?N.fromJSON:void 0!==R.values?P.fromJSON:void 0!==R.methods?O.fromJSON:void 0!==R.id?L.fromJSON:K.fromJSON)(M[U],R));return this},K.prototype.get=function(S){return this.nested&&this.nested[S]||null},K.prototype.getEnum=function(S){if(this.nested&&this.nested[S]instanceof P)return this.nested[S].values;throw Error("no such enum: "+S)},K.prototype.add=function(S){if(!(S instanceof L&&void 0!==S.extend||S instanceof N||S instanceof V||S instanceof P||S instanceof O||S instanceof K))throw TypeError("object must be a valid nested object");if(this.nested){var T=this.get(S.name);if(T){if(T instanceof K&&S instanceof K&&!(T instanceof N||T instanceof O)){for(var R=T.nestedArray,M=0;M<R.length;++M)S.add(R[M]);this.remove(T),this.nested||(this.nested={}),S.setOptions(T.options,!0)}else throw Error("duplicate name '"+S.name+"' in "+this)}}else this.nested={};this.nested[S.name]=S,this instanceof N||this instanceof O||this instanceof P||this instanceof L||S._edition||(S._edition=S._defaultEdition),this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0;for(var U=this;U=U.parent;)U._needsRecursiveFeatureResolution=!0,U._needsRecursiveResolve=!0;return S.onAdd(this),W(this)},K.prototype.remove=function(S){if(!(S instanceof M))throw TypeError("object must be a ReflectionObject");if(S.parent!==this)throw Error(S+" is not a member of "+this);return delete this.nested[S.name],Object.keys(this.nested).length||(this.nested=void 0),S.onRemove(this),W(this)},K.prototype.define=function(S,T){if(U.isString(S))S=S.split(".");else if(!Array.isArray(S))throw TypeError("illegal path");if(S&&S.length&&""===S[0])throw Error("path must be relative");for(var R=this;S.length>0;){var N=S.shift();if(R.nested&&R.nested[N]){if(!((R=R.nested[N])instanceof K))throw Error("path conflicts with non-namespace objects")}else R.add(R=new K(N))}return T&&R.addJSON(T),R},K.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;this._resolveFeaturesRecursive(this._edition);var S=this.nestedArray,T=0;for(this.resolve();T<S.length;)S[T]instanceof K?S[T++].resolveAll():S[T++].resolve();return this._needsRecursiveResolve=!1,this},K.prototype._resolveFeaturesRecursive=function(S){return this._needsRecursiveFeatureResolution&&(this._needsRecursiveFeatureResolution=!1,S=this._edition||S,M.prototype._resolveFeaturesRecursive.call(this,S),this.nestedArray.forEach(T=>{T._resolveFeaturesRecursive(S)})),this},K.prototype.lookup=function(S,T,R){if("boolean"==typeof T?(R=T,T=void 0):T&&!Array.isArray(T)&&(T=[T]),U.isString(S)&&S.length){if("."===S)return this.root;S=S.split(".")}else if(!S.length)return this;var N=S.join(".");if(""===S[0])return this.root.lookup(S.slice(1),T);var O=this.root._fullyQualifiedObjects&&this.root._fullyQualifiedObjects["."+N];if(O&&(!T||T.indexOf(O.constructor)>-1)||(O=this._lookupImpl(S,N))&&(!T||T.indexOf(O.constructor)>-1))return O;if(R)return null;for(var P=this;P.parent;){if((O=P.parent._lookupImpl(S,N))&&(!T||T.indexOf(O.constructor)>-1))return O;P=P.parent}return null},K.prototype._lookupImpl=function(S,T){if(Object.prototype.hasOwnProperty.call(this._lookupCache,T))return this._lookupCache[T];var R=this.get(S[0]),N=null;if(R)1===S.length?N=R:R instanceof K&&(S=S.slice(1),N=R._lookupImpl(S,S.join(".")));else for(var O=0;O<this.nestedArray.length;++O)this._nestedArray[O]instanceof K&&(R=this._nestedArray[O]._lookupImpl(S,T))&&(N=R);return this._lookupCache[T]=N,N},K.prototype.lookupType=function(S){var T=this.lookup(S,[N]);if(!T)throw Error("no such type: "+S);return T},K.prototype.lookupEnum=function(S){var T=this.lookup(S,[P]);if(!T)throw Error("no such Enum '"+S+"' in "+this);return T},K.prototype.lookupTypeOrEnum=function(S){var T=this.lookup(S,[N,P]);if(!T)throw Error("no such Type or Enum '"+S+"' in "+this);return T},K.prototype.lookupService=function(S){var T=this.lookup(S,[O]);if(!T)throw Error("no such Service '"+S+"' in "+this);return T},K._configure=function(S,T,R){N=S,O=T,P=R}},4184:(S,T,R)=>{"use strict";S.exports=V,V.className="ReflectionObject";let N=R(7702);var O,P=R(7454),M={enum_type:"OPEN",field_presence:"EXPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"},L={enum_type:"CLOSED",field_presence:"EXPLICIT",json_format:"LEGACY_BEST_EFFORT",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"EXPANDED",utf8_validation:"NONE"},U={enum_type:"OPEN",field_presence:"IMPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"};function V(S,T){if(!P.isString(S))throw TypeError("name must be a string");if(T&&!P.isObject(T))throw TypeError("options must be an object");this.options=T,this.parsedOptions=null,this.name=S,this._edition=null,this._defaultEdition="proto2",this._features={},this._featuresResolved=!1,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(V.prototype,{root:{get:function(){for(var S=this;null!==S.parent;)S=S.parent;return S}},fullName:{get:function(){for(var S=[this.name],T=this.parent;T;)S.unshift(T.name),T=T.parent;return S.join(".")}}}),V.prototype.toJSON=function(){throw Error()},V.prototype.onAdd=function(S){this.parent&&this.parent!==S&&this.parent.remove(this),this.parent=S,this.resolved=!1;var T=S.root;T instanceof O&&T._handleAdd(this)},V.prototype.onRemove=function(S){var T=S.root;T instanceof O&&T._handleRemove(this),this.parent=null,this.resolved=!1},V.prototype.resolve=function(){return this.resolved||this.root instanceof O&&(this.resolved=!0),this},V.prototype._resolveFeaturesRecursive=function(S){return this._resolveFeatures(this._edition||S)},V.prototype._resolveFeatures=function(S){if(!this._featuresResolved){var T={};if(!S)throw Error("Unknown edition for "+this.fullName);var R=Object.assign(this.options?Object.assign({},this.options.features):{},this._inferLegacyProtoFeatures(S));if(this._edition){if("proto2"===S)T=Object.assign({},L);else if("proto3"===S)T=Object.assign({},U);else if("2023"===S)T=Object.assign({},M);else throw Error("Unknown edition: "+S);this._features=Object.assign(T,R||{}),this._featuresResolved=!0;return}if(this.partOf instanceof N){var O=Object.assign({},this.partOf._features);this._features=Object.assign(O,R||{})}else if(this.declaringField);else if(this.parent){var P=Object.assign({},this.parent._features);this._features=Object.assign(P,R||{})}else throw Error("Unable to find a parent for "+this.fullName);this.extensionField&&(this.extensionField._features=this._features),this._featuresResolved=!0}},V.prototype._inferLegacyProtoFeatures=function(){return{}},V.prototype.getOption=function(S){if(this.options)return this.options[S]},V.prototype.setOption=function(S,T,R){return this.options||(this.options={}),/^features\./.test(S)?P.setProperty(this.options,S,T,R):R&&void 0!==this.options[S]||(this.getOption(S)!==T&&(this.resolved=!1),this.options[S]=T),this},V.prototype.setParsedOption=function(S,T,R){this.parsedOptions||(this.parsedOptions=[]);var N=this.parsedOptions;if(R){var O=N.find(function(T){return Object.prototype.hasOwnProperty.call(T,S)});if(O){var M=O[S];P.setProperty(M,R,T)}else(O={})[S]=P.setProperty({},R,T),N.push(O)}else{var L={};L[S]=T,N.push(L)}return this},V.prototype.setOptions=function(S,T){if(S)for(var R=Object.keys(S),N=0;N<R.length;++N)this.setOption(R[N],S[R[N]],T);return this},V.prototype.toString=function(){var S=this.constructor.className,T=this.fullName;return T.length?S+" "+T:S},V.prototype._editionToJSON=function(){if(this._edition&&"proto3"!==this._edition)return this._edition},V._configure=function(S){O=S}},7702:(S,T,R)=>{"use strict";S.exports=M;var N=R(4184);((M.prototype=Object.create(N.prototype)).constructor=M).className="OneOf";var O=R(8138),P=R(7454);function M(S,T,R,O){if(Array.isArray(T)||(R=T,T=void 0),N.call(this,S,R),!(void 0===T||Array.isArray(T)))throw TypeError("fieldNames must be an Array");this.oneof=T||[],this.fieldsArray=[],this.comment=O}function L(S){if(S.parent)for(var T=0;T<S.fieldsArray.length;++T)S.fieldsArray[T].parent||S.parent.add(S.fieldsArray[T])}M.fromJSON=function(S,T){return new M(S,T.oneof,T.options,T.comment)},M.prototype.toJSON=function(S){var T=!!S&&!!S.keepComments;return P.toObject(["options",this.options,"oneof",this.oneof,"comment",T?this.comment:void 0])},M.prototype.add=function(S){if(!(S instanceof O))throw TypeError("field must be a Field");return S.parent&&S.parent!==this.parent&&S.parent.remove(S),this.oneof.push(S.name),this.fieldsArray.push(S),S.partOf=this,L(this),this},M.prototype.remove=function(S){if(!(S instanceof O))throw TypeError("field must be a Field");var T=this.fieldsArray.indexOf(S);if(T<0)throw Error(S+" is not a member of "+this);return this.fieldsArray.splice(T,1),(T=this.oneof.indexOf(S.name))>-1&&this.oneof.splice(T,1),S.partOf=null,this},M.prototype.onAdd=function(S){N.prototype.onAdd.call(this,S);for(var T=this,R=0;R<this.oneof.length;++R){var O=S.get(this.oneof[R]);O&&!O.partOf&&(O.partOf=T,T.fieldsArray.push(O))}L(this)},M.prototype.onRemove=function(S){for(var T,R=0;R<this.fieldsArray.length;++R)(T=this.fieldsArray[R]).parent&&T.parent.remove(T);N.prototype.onRemove.call(this,S)},Object.defineProperty(M.prototype,"isProto3Optional",{get:function(){if(null==this.fieldsArray||1!==this.fieldsArray.length)return!1;var S=this.fieldsArray[0];return null!=S.options&&!0===S.options.proto3_optional}}),M.d=function(){for(var S=Array(arguments.length),T=0;T<arguments.length;)S[T]=arguments[T++];return function(T,R){P.decorateType(T.constructor).add(new M(R,S)),Object.defineProperty(T,R,{get:P.oneOfGetter(S),set:P.oneOfSetter(S)})}}},6796:(S,T,R)=>{"use strict";S.exports=eo,eo.filename=null,eo.defaults={keepCase:!1};var N=R(1652),O=R(3852),P=R(5006),M=R(8138),L=R(8751),U=R(7702),V=R(6734),$=R(8719),K=R(898),W=R(4184),Q=R(816),Y=R(7454),X=/^[1-9][0-9]*$/,Z=/^-?[1-9][0-9]*$/,ee=/^0[x][0-9a-fA-F]+$/,et=/^-?0[x][0-9a-fA-F]+$/,er=/^0[0-7]+$/,en=/^-?0[0-7]+$/,ei=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,es=/^[a-zA-Z_][a-zA-Z_0-9]*$/,ea=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/;function eo(S,T,R){T instanceof O||(R=T,T=new O),R||(R=eo.defaults);var eu,ec,ed,eh,ep=R.preferTrailingComment||!1,ef=N(S,R.alternateCommentMode||!1),em=ef.next,eg=ef.push,ey=ef.peek,ev=ef.skip,eb=ef.cmnt,eS=!0,eT="proto2",eE=T,eC=[],ew={},e_=R.keepCase?function(S){return S}:Y.camelCase;function eI(){eC.forEach(S=>{S._edition=eT,Object.keys(ew).forEach(T=>{void 0===S.getOption(T)&&S.setOption(T,ew[T],!0)})})}function eR(S,T,R){var N=eo.filename;return R||(eo.filename=null),Error("illegal "+(T||"token")+" '"+S+"' ("+(N?N+", ":"")+"line "+ef.line+")")}function eD(){var S,T=[];do{if('"'!==(S=em())&&"'"!==S)throw eR(S);T.push(em()),ev(S),S=ey()}while('"'===S||"'"===S);return T.join("")}function eA(S){var T=em();switch(T){case"'":case'"':return eg(T),eD();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return eN(T,!0)}catch(R){if(S&&ea.test(T))return T;throw eR(T,"value")}}function ek(S,T){do if(T&&('"'===(R=ey())||"'"===R)){var R,N,O=eD();if(S.push(O),eT>=2023)throw eR(O,"id")}else try{S.push([N=eO(em()),ev("to",!0)?eO(em()):N])}catch(N){if(T&&ea.test(R)&&eT>=2023)S.push(R);else throw N}while(ev(",",!0));var P={options:void 0};P.setOption=function(S,T){void 0===this.options&&(this.options={}),this.options[S]=T},eB(P,function(S){if("option"===S)eK(P,S),ev(";");else throw eR(S)},function(){eY(P)})}function eN(S,T){var R=1;switch("-"===S.charAt(0)&&(R=-1,S=S.substring(1)),S){case"inf":case"INF":case"Inf":return 1/0*R;case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(X.test(S))return R*parseInt(S,10);if(ee.test(S))return R*parseInt(S,16);if(er.test(S))return R*parseInt(S,8);if(ei.test(S))return R*parseFloat(S);throw eR(S,"number",T)}function eO(S,T){switch(S){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!T&&"-"===S.charAt(0))throw eR(S,"id");if(Z.test(S))return parseInt(S,10);if(et.test(S))return parseInt(S,16);if(en.test(S))return parseInt(S,8);throw eR(S,"id")}function ex(){if(void 0!==ec)throw eR("package");if(ec=em(),!ea.test(ec))throw eR(ec,"name");eE=eE.define(ec),ev(";")}function eP(){var S,T=ey();switch(T){case"weak":S=eh||(eh=[]),em();break;case"public":em();default:S=ed||(ed=[])}T=eD(),ev(";"),S.push(T)}function eM(){if(ev("="),(eT=eD())<2023)throw eR(eT,"syntax");ev(";")}function eL(){if(ev("="),!["2023"].includes(eT=eD()))throw eR(eT,"edition");ev(";")}function eF(S,T){switch(T){case"option":return eK(S,T),ev(";"),!0;case"message":return ej(S,T),!0;case"enum":return e$(S,T),!0;case"service":return eJ(S,T),!0;case"extend":return eZ(S,T),!0}return!1}function eB(S,T,R){var N,O=ef.line;if(S&&("string"!=typeof S.comment&&(S.comment=eb()),S.filename=eo.filename),ev("{",!0)){for(;"}"!==(N=em());)T(N);ev(";",!0)}else R&&R(),ev(";"),S&&("string"!=typeof S.comment||ep)&&(S.comment=eb(O)||S.comment)}function ej(S,T){if(!es.test(T=em()))throw eR(T,"type name");var R=new P(T);eB(R,function(S){if(!eF(R,S))switch(S){case"map":ez(R,S);break;case"required":if("proto2"!==eT)throw eR(S);case"repeated":eU(R,S);break;case"optional":if("proto3"===eT)eU(R,"proto3_optional");else if("proto2"!==eT)throw eR(S);else eU(R,"optional");break;case"oneof":eq(R,S);break;case"extensions":ek(R.extensions||(R.extensions=[]));break;case"reserved":ek(R.reserved||(R.reserved=[]),!0);break;default:if("proto2"===eT||!ea.test(S))throw eR(S);eg(S),eU(R,"optional")}}),S.add(R),S===eE&&eC.push(R)}function eU(S,T,R){var N=em();if("group"===N){eV(S,T);return}for(;N.endsWith(".")||ey().startsWith(".");)N+=em();if(!ea.test(N))throw eR(N,"type");var O=em();if(!es.test(O))throw eR(O,"name");O=e_(O),ev("=");var P=new M(O,eO(em()),N,T,R);if(eB(P,function(S){if("option"===S)eK(P,S),ev(";");else throw eR(S)},function(){eY(P)}),"proto3_optional"===T){var L=new U("_"+O);P.setOption("proto3_optional",!0),L.add(P),S.add(L)}else S.add(P);S===eE&&eC.push(P)}function eV(S,T){if(eT>=2023)throw eR("group");var R=em();if(!es.test(R))throw eR(R,"name");var N=Y.lcFirst(R);R===N&&(R=Y.ucFirst(R)),ev("=");var O=eO(em()),L=new P(R);L.group=!0;var U=new M(N,O,R,T);U.filename=eo.filename,eB(L,function(S){switch(S){case"option":eK(L,S),ev(";");break;case"required":case"repeated":eU(L,S);break;case"optional":"proto3"===eT?eU(L,"proto3_optional"):eU(L,"optional");break;case"message":ej(L,S);break;case"enum":e$(L,S);break;case"reserved":ek(L.reserved||(L.reserved=[]),!0);break;default:throw eR(S)}}),S.add(L).add(U)}function ez(S){ev("<");var T=em();if(void 0===Q.mapKey[T])throw eR(T,"type");ev(",");var R=em();if(!ea.test(R))throw eR(R,"type");ev(">");var N=em();if(!es.test(N))throw eR(N,"name");ev("=");var O=new L(e_(N),eO(em()),T,R);eB(O,function(S){if("option"===S)eK(O,S),ev(";");else throw eR(S)},function(){eY(O)}),S.add(O)}function eq(S,T){if(!es.test(T=em()))throw eR(T,"name");var R=new U(e_(T));eB(R,function(S){"option"===S?(eK(R,S),ev(";")):(eg(S),eU(R,"optional"))}),S.add(R)}function e$(S,T){if(!es.test(T=em()))throw eR(T,"name");var R=new V(T);eB(R,function(S){switch(S){case"option":eK(R,S),ev(";");break;case"reserved":ek(R.reserved||(R.reserved=[]),!0),void 0===R.reserved&&(R.reserved=[]);break;default:eG(R,S)}}),S.add(R),S===eE&&eC.push(R)}function eG(S,T){if(!es.test(T))throw eR(T,"name");ev("=");var R=eO(em(),!0),N={options:void 0};N.getOption=function(S){return this.options[S]},N.setOption=function(S,T){W.prototype.setOption.call(N,S,T)},N.setParsedOption=function(){},eB(N,function(S){if("option"===S)eK(N,S),ev(";");else throw eR(S)},function(){eY(N)}),S.add(T,R,N.comment,N.parsedOptions||N.options)}function eK(S,T){var R,N,O=!0;for("option"===T&&(T=em());"="!==T;){if("("===T){var P=em();ev(")"),T="("+P+")"}if(O){if(O=!1,T.includes(".")&&!T.includes("(")){var M=T.split(".");R=M[0]+".",T=M[1];continue}R=T}else N=N?N+=T:T;T=em()}var L=eW(S,N?R.concat(N):R);N=N&&"."===N[0]?N.slice(1):N,eQ(S,R=R&&"."===R[R.length-1]?R.slice(0,-1):R,L,N)}function eW(S,T){if(ev("{",!0)){for(var R={};!ev("}",!0);){if(!es.test(eu=em()))throw eR(eu,"name");if(null===eu)throw eR(eu,"end of input");var N,O,P=eu;if(ev(":",!0),"{"===ey())N=eW(S,T+"."+eu);else if("["===ey()){if(N=[],ev("[",!0)){do O=eA(!0),N.push(O);while(ev(",",!0));ev("]"),void 0!==O&&eH(S,T+"."+eu,O)}}else N=eA(!0),eH(S,T+"."+eu,N);var M=R[P];M&&(N=[].concat(M).concat(N)),R[P]=N,ev(",",!0),ev(";",!0)}return R}var L=eA(!0);return eH(S,T,L),L}function eH(S,T,R){if(eE===S&&/^features\./.test(T)){ew[T]=R;return}S.setOption&&S.setOption(T,R)}function eQ(S,T,R,N){S.setParsedOption&&S.setParsedOption(T,R,N)}function eY(S){if(ev("[",!0)){do eK(S,"option");while(ev(",",!0));ev("]")}return S}function eJ(S,T){if(!es.test(T=em()))throw eR(T,"service name");var R=new $(T);eB(R,function(S){if(!eF(R,S)){if("rpc"===S)eX(R,S);else throw eR(S)}}),S.add(R),S===eE&&eC.push(R)}function eX(S,T){var R=eb(),N=T;if(!es.test(T=em()))throw eR(T,"name");var O,P,M,L,U=T;if(ev("("),ev("stream",!0)&&(P=!0),!ea.test(T=em())||(O=T,ev(")"),ev("returns"),ev("("),ev("stream",!0)&&(L=!0),!ea.test(T=em())))throw eR(T);M=T,ev(")");var V=new K(U,N,O,M,P,L);V.comment=R,eB(V,function(S){if("option"===S)eK(V,S),ev(";");else throw eR(S)}),S.add(V)}function eZ(S,T){if(!ea.test(T=em()))throw eR(T,"reference");var R=T;eB(null,function(T){switch(T){case"required":case"repeated":eU(S,T,R);break;case"optional":"proto3"===eT?eU(S,"proto3_optional",R):eU(S,"optional",R);break;default:if("proto2"===eT||!ea.test(T))throw eR(T);eg(T),eU(S,"optional",R)}})}for(;null!==(eu=em());)switch(eu){case"package":if(!eS)throw eR(eu);ex();break;case"import":if(!eS)throw eR(eu);eP();break;case"syntax":if(!eS)throw eR(eu);eM();break;case"edition":if(!eS)throw eR(eu);eL();break;case"option":eK(eE,eu),ev(";",!0);break;default:if(eF(eE,eu)){eS=!1;continue}throw eR(eu)}return eI(),eo.filename=null,{package:ec,imports:ed,weakImports:eh,root:T}}},1761:(S,T,R)=>{"use strict";S.exports=U;var N,O=R(8345),P=O.LongBits,M=O.utf8;function L(S,T){return RangeError("index out of range: "+S.pos+" + "+(T||1)+" > "+S.len)}function U(S){this.buf=S,this.pos=0,this.len=S.length}var V="undefined"!=typeof Uint8Array?function(S){if(S instanceof Uint8Array||Array.isArray(S))return new U(S);throw Error("illegal buffer")}:function(S){if(Array.isArray(S))return new U(S);throw Error("illegal buffer")},$=function(){return O.Buffer?function(S){return(U.create=function(S){return O.Buffer.isBuffer(S)?new N(S):V(S)})(S)}:V};function K(){var S=new P(0,0),T=0;if(this.len-this.pos>4){for(;T<4;++T)if(S.lo=(S.lo|(127&this.buf[this.pos])<<7*T)>>>0,this.buf[this.pos++]<128)return S;if(S.lo=(S.lo|(127&this.buf[this.pos])<<28)>>>0,S.hi=(S.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return S;T=0}else{for(;T<3;++T){if(this.pos>=this.len)throw L(this);if(S.lo=(S.lo|(127&this.buf[this.pos])<<7*T)>>>0,this.buf[this.pos++]<128)return S}return S.lo=(S.lo|(127&this.buf[this.pos++])<<7*T)>>>0,S}if(this.len-this.pos>4){for(;T<5;++T)if(S.hi=(S.hi|(127&this.buf[this.pos])<<7*T+3)>>>0,this.buf[this.pos++]<128)return S}else for(;T<5;++T){if(this.pos>=this.len)throw L(this);if(S.hi=(S.hi|(127&this.buf[this.pos])<<7*T+3)>>>0,this.buf[this.pos++]<128)return S}throw Error("invalid varint encoding")}function W(S,T){return(S[T-4]|S[T-3]<<8|S[T-2]<<16|S[T-1]<<24)>>>0}function Q(){if(this.pos+8>this.len)throw L(this,8);return new P(W(this.buf,this.pos+=4),W(this.buf,this.pos+=4))}U.create=$(),U.prototype._slice=O.Array.prototype.subarray||O.Array.prototype.slice,U.prototype.uint32=function(){var S=4294967295;return function(){if(S=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(S=(S|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(S=(S|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(S=(S|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(S=(S|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return S;if((this.pos+=5)>this.len)throw this.pos=this.len,L(this,10);return S}}(),U.prototype.int32=function(){return 0|this.uint32()},U.prototype.sint32=function(){var S=this.uint32();return S>>>1^-(1&S)|0},U.prototype.bool=function(){return 0!==this.uint32()},U.prototype.fixed32=function(){if(this.pos+4>this.len)throw L(this,4);return W(this.buf,this.pos+=4)},U.prototype.sfixed32=function(){if(this.pos+4>this.len)throw L(this,4);return 0|W(this.buf,this.pos+=4)},U.prototype.float=function(){if(this.pos+4>this.len)throw L(this,4);var S=O.float.readFloatLE(this.buf,this.pos);return this.pos+=4,S},U.prototype.double=function(){if(this.pos+8>this.len)throw L(this,4);var S=O.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,S},U.prototype.bytes=function(){var S=this.uint32(),T=this.pos,R=this.pos+S;if(R>this.len)throw L(this,S);if(this.pos+=S,Array.isArray(this.buf))return this.buf.slice(T,R);if(T===R){var N=O.Buffer;return N?N.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,T,R)},U.prototype.string=function(){var S=this.bytes();return M.read(S,0,S.length)},U.prototype.skip=function(S){if("number"==typeof S){if(this.pos+S>this.len)throw L(this,S);this.pos+=S}else do if(this.pos>=this.len)throw L(this);while(128&this.buf[this.pos++]);return this},U.prototype.skipType=function(S){switch(S){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(S=7&this.uint32());)this.skipType(S);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+S+" at offset "+this.pos)}return this},U._configure=function(S){N=S,U.create=$(),N._configure();var T=O.Long?"toLong":"toNumber";O.merge(U.prototype,{int64:function(){return K.call(this)[T](!1)},uint64:function(){return K.call(this)[T](!0)},sint64:function(){return K.call(this).zzDecode()[T](!1)},fixed64:function(){return Q.call(this)[T](!0)},sfixed64:function(){return Q.call(this)[T](!1)}})}},8282:(S,T,R)=>{"use strict";S.exports=P;var N=R(1761);(P.prototype=Object.create(N.prototype)).constructor=P;var O=R(8345);function P(S){N.call(this,S)}P._configure=function(){O.Buffer&&(P.prototype._slice=O.Buffer.prototype.slice)},P.prototype.string=function(){var S=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+S,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+S,this.len))},P._configure()},3852:(S,T,R)=>{"use strict";S.exports=K;var N,O,P,M=R(8727);((K.prototype=Object.create(M.prototype)).constructor=K).className="Root";var L=R(8138),U=R(6734),V=R(7702),$=R(7454);function K(S){M.call(this,"",S),this.deferred=[],this.files=[],this._edition="proto2",this._fullyQualifiedObjects={}}function W(){}K.fromJSON=function(S,T){return T||(T=new K),S.options&&T.setOptions(S.options),T.addJSON(S.nested).resolveAll()},K.prototype.resolvePath=$.path.resolve,K.prototype.fetch=$.fetch,K.prototype.load=function S(T,R,N){"function"==typeof R&&(N=R,R=void 0);var M=this;if(!N)return $.asPromise(S,M,T,R);var L=N===W;function U(S,T){if(N){if(L)throw S;T&&T.resolveAll();var R=N;N=null,R(S,T)}}function V(S){var T=S.lastIndexOf("google/protobuf/");if(T>-1){var R=S.substring(T);if(R in P)return R}return null}function K(S,T){try{if($.isString(T)&&"{"===T.charAt(0)&&(T=JSON.parse(T)),$.isString(T)){O.filename=S;var N,P=O(T,M,R),K=0;if(P.imports)for(;K<P.imports.length;++K)(N=V(P.imports[K])||M.resolvePath(S,P.imports[K]))&&Q(N);if(P.weakImports)for(K=0;K<P.weakImports.length;++K)(N=V(P.weakImports[K])||M.resolvePath(S,P.weakImports[K]))&&Q(N,!0)}else M.setOptions(T.options).addJSON(T.nested)}catch(S){U(S)}L||Y||U(null,M)}function Q(S,T){if(S=V(S)||S,!(M.files.indexOf(S)>-1)){if(M.files.push(S),S in P){L?K(S,P[S]):(++Y,setTimeout(function(){--Y,K(S,P[S])}));return}if(L){var R;try{R=$.fs.readFileSync(S).toString("utf8")}catch(S){T||U(S);return}K(S,R)}else++Y,M.fetch(S,function(R,O){if(--Y,N){if(R){T?Y||U(null,M):U(R);return}K(S,O)}})}}var Y=0;$.isString(T)&&(T=[T]);for(var X,Z=0;Z<T.length;++Z)(X=M.resolvePath("",T[Z]))&&Q(X);return L?M.resolveAll():Y||U(null,M),M},K.prototype.loadSync=function(S,T){if(!$.isNode)throw Error("not supported");return this.load(S,T,W)},K.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(S){return"'extend "+S.extend+"' in "+S.parent.fullName}).join(", "));return M.prototype.resolveAll.call(this)};var Q=/^[A-Z]/;function Y(S,T){var R=T.parent.lookup(T.extend);if(R){var N=new L(T.fullName,T.id,T.type,T.rule,void 0,T.options);return!!R.get(N.name)||(N.declaringField=T,T.extensionField=N,R.add(N),!0)}return!1}K.prototype._handleAdd=function(S){if(S instanceof L)void 0===S.extend||S.extensionField||Y(this,S)||this.deferred.push(S);else if(S instanceof U)Q.test(S.name)&&(S.parent[S.name]=S.values);else if(!(S instanceof V)){if(S instanceof N)for(var T=0;T<this.deferred.length;)Y(this,this.deferred[T])?this.deferred.splice(T,1):++T;for(var R=0;R<S.nestedArray.length;++R)this._handleAdd(S._nestedArray[R]);Q.test(S.name)&&(S.parent[S.name]=S)}(S instanceof N||S instanceof U||S instanceof L)&&(this._fullyQualifiedObjects[S.fullName]=S)},K.prototype._handleRemove=function(S){if(S instanceof L){if(void 0!==S.extend){if(S.extensionField)S.extensionField.parent.remove(S.extensionField),S.extensionField=null;else{var T=this.deferred.indexOf(S);T>-1&&this.deferred.splice(T,1)}}}else if(S instanceof U)Q.test(S.name)&&delete S.parent[S.name];else if(S instanceof M){for(var R=0;R<S.nestedArray.length;++R)this._handleRemove(S._nestedArray[R]);Q.test(S.name)&&delete S.parent[S.name]}delete this._fullyQualifiedObjects[S.fullName]},K._configure=function(S,T,R){N=S,O=T,P=R}},8091:S=>{"use strict";S.exports={}},8346:(S,T,R)=>{"use strict";T.Service=R(296)},296:(S,T,R)=>{"use strict";S.exports=O;var N=R(8345);function O(S,T,R){if("function"!=typeof S)throw TypeError("rpcImpl must be a function");N.EventEmitter.call(this),this.rpcImpl=S,this.requestDelimited=!!T,this.responseDelimited=!!R}(O.prototype=Object.create(N.EventEmitter.prototype)).constructor=O,O.prototype.rpcCall=function S(T,R,O,P,M){if(!P)throw TypeError("request must be specified");var L=this;if(!M)return N.asPromise(S,L,T,R,O,P);if(!L.rpcImpl){setTimeout(function(){M(Error("already ended"))},0);return}try{return L.rpcImpl(T,R[L.requestDelimited?"encodeDelimited":"encode"](P).finish(),function(S,R){if(S)return L.emit("error",S,T),M(S);if(null===R){L.end(!0);return}if(!(R instanceof O))try{R=O[L.responseDelimited?"decodeDelimited":"decode"](R)}catch(S){return L.emit("error",S,T),M(S)}return L.emit("data",R,T),M(null,R)})}catch(S){L.emit("error",S,T),setTimeout(function(){M(S)},0);return}},O.prototype.end=function(S){return this.rpcImpl&&(S||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},8719:(S,T,R)=>{"use strict";S.exports=L;var N=R(8727);((L.prototype=Object.create(N.prototype)).constructor=L).className="Service";var O=R(898),P=R(7454),M=R(8346);function L(S,T){N.call(this,S,T),this.methods={},this._methodsArray=null}function U(S){return S._methodsArray=null,S}L.fromJSON=function(S,T){var R=new L(S,T.options);if(T.methods)for(var N=Object.keys(T.methods),P=0;P<N.length;++P)R.add(O.fromJSON(N[P],T.methods[N[P]]));return T.nested&&R.addJSON(T.nested),T.edition&&(R._edition=T.edition),R.comment=T.comment,R._defaultEdition="proto3",R},L.prototype.toJSON=function(S){var T=N.prototype.toJSON.call(this,S),R=!!S&&!!S.keepComments;return P.toObject(["edition",this._editionToJSON(),"options",T&&T.options||void 0,"methods",N.arrayToJSON(this.methodsArray,S)||{},"nested",T&&T.nested||void 0,"comment",R?this.comment:void 0])},Object.defineProperty(L.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=P.toArray(this.methods))}}),L.prototype.get=function(S){return this.methods[S]||N.prototype.get.call(this,S)},L.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;N.prototype.resolve.call(this);for(var S=this.methodsArray,T=0;T<S.length;++T)S[T].resolve();return this},L.prototype._resolveFeaturesRecursive=function(S){return this._needsRecursiveFeatureResolution&&(S=this._edition||S,N.prototype._resolveFeaturesRecursive.call(this,S),this.methodsArray.forEach(T=>{T._resolveFeaturesRecursive(S)})),this},L.prototype.add=function(S){if(this.get(S.name))throw Error("duplicate name '"+S.name+"' in "+this);return S instanceof O?(this.methods[S.name]=S,S.parent=this,U(this)):N.prototype.add.call(this,S)},L.prototype.remove=function(S){if(S instanceof O){if(this.methods[S.name]!==S)throw Error(S+" is not a member of "+this);return delete this.methods[S.name],S.parent=null,U(this)}return N.prototype.remove.call(this,S)},L.prototype.create=function(S,T,R){for(var N,O=new M.Service(S,T,R),L=0;L<this.methodsArray.length;++L){var U=P.lcFirst((N=this._methodsArray[L]).resolve().name).replace(/[^$\w_]/g,"");O[U]=P.codegen(["r","c"],P.isReserved(U)?U+"_":U)("return this.rpcCall(m,q,s,r,c)")({m:N,q:N.resolvedRequestType.ctor,s:N.resolvedResponseType.ctor})}return O}},1652:S=>{"use strict";S.exports=K;var T=/[\s{}=;:[\],'"()<>]/g,R=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,N=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,O=/^ *[*/]+ */,P=/^\s*\*?\/*/,M=/\n/g,L=/\s/,U=/\\(.?)/g,V={0:"\x00",r:"\r",n:"\n",t:"	"};function $(S){return S.replace(U,function(S,T){switch(T){case"\\":case"":return T;default:return V[T]||""}})}function K(S,U){S=S.toString();var V=0,K=S.length,W=1,Q=0,Y={},X=[],Z=null;function ee(S){return Error("illegal "+S+" (line "+W+")")}function et(){var T="'"===Z?N:R;T.lastIndex=V-1;var O=T.exec(S);if(!O)throw ee("string");return V=T.lastIndex,eo(Z),Z=null,$(O[1])}function er(T){return S.charAt(T)}function en(T,R,N){var L,V,$={type:S.charAt(T++),lineEmpty:!1,leading:N},K=T-(L=U?2:3);do if(--K<0||"\n"===(V=S.charAt(K))){$.lineEmpty=!0;break}while(" "===V||"	"===V);for(var X=S.substring(T,R).split(M),Z=0;Z<X.length;++Z)X[Z]=X[Z].replace(U?P:O,"").trim();$.text=X.join("\n").trim(),Y[W]=$,Q=W}function ei(T){var R=es(T),N=S.substring(T,R);return/^\s*\/\//.test(N)}function es(S){for(var T=S;T<K&&"\n"!==er(T);)T++;return T}function ea(){if(X.length>0)return X.shift();if(Z)return et();var R,N,O,P,M,$=0===V;do{if(V===K)return null;for(R=!1;L.test(O=er(V));)if("\n"===O&&($=!0,++W),++V===K)return null;if("/"===er(V)){if(++V===K)throw ee("comment");if("/"===er(V)){if(U){if(P=V,M=!1,ei(V-1)){M=!0;do if((V=es(V))===K||(V++,!$))break;while(ei(V))}else V=Math.min(K,es(V)+1);M&&(en(P,V,$),$=!0),W++,R=!0}else{for(M="/"===er(P=V+1);"\n"!==er(++V);)if(V===K)return null;++V,M&&(en(P,V-1,$),$=!0),++W,R=!0}}else{if("*"!==(O=er(V)))return"/";P=V+1,M=U||"*"===er(P);do{if("\n"===O&&++W,++V===K)throw ee("comment");N=O,O=er(V)}while("*"!==N||"/"!==O);++V,M&&(en(P,V-2,$),$=!0),R=!0}}}while(R);var Q=V;if(T.lastIndex=0,!T.test(er(Q++)))for(;Q<K&&!T.test(er(Q));)++Q;var Y=S.substring(V,V=Q);return('"'===Y||"'"===Y)&&(Z=Y),Y}function eo(S){X.push(S)}function eu(){if(!X.length){var S=ea();if(null===S)return null;eo(S)}return X[0]}function ec(S,T){var R=eu();if(R===S)return ea(),!0;if(!T)throw ee("token '"+R+"', '"+S+"' expected");return!1}function ed(S){var T,R=null;return void 0===S?(T=Y[W-1],delete Y[W-1],T&&(U||"*"===T.type||T.lineEmpty)&&(R=T.leading?T.text:null)):(Q<S&&eu(),T=Y[S],delete Y[S],T&&!T.lineEmpty&&(U||"/"===T.type)&&(R=T.leading?null:T.text)),R}return Object.defineProperty({next:ea,peek:eu,push:eo,skip:ec,cmnt:ed},"line",{get:function(){return W}})}K.unescape=$},5006:(S,T,R)=>{"use strict";S.exports=et;var N=R(8727);((et.prototype=Object.create(N.prototype)).constructor=et).className="Type";var O=R(6734),P=R(7702),M=R(8138),L=R(8751),U=R(8719),V=R(2038),$=R(1761),K=R(9822),W=R(7454),Q=R(95),Y=R(3951),X=R(7624),Z=R(9981),ee=R(1904);function et(S,T){N.call(this,S,T),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function er(S){return S._fieldsById=S._fieldsArray=S._oneofsArray=null,delete S.encode,delete S.decode,delete S.verify,S}Object.defineProperties(et.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var S=Object.keys(this.fields),T=0;T<S.length;++T){var R=this.fields[S[T]],N=R.id;if(this._fieldsById[N])throw Error("duplicate id "+N+" in "+this);this._fieldsById[N]=R}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=W.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=W.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=et.generateConstructor(this)())},set:function(S){var T=S.prototype;T instanceof V||((S.prototype=new V).constructor=S,W.merge(S.prototype,T)),S.$type=S.prototype.$type=this,W.merge(S,V,!0),this._ctor=S;for(var R=0;R<this.fieldsArray.length;++R)this._fieldsArray[R].resolve();var N={};for(R=0;R<this.oneofsArray.length;++R)N[this._oneofsArray[R].resolve().name]={get:W.oneOfGetter(this._oneofsArray[R].oneof),set:W.oneOfSetter(this._oneofsArray[R].oneof)};R&&Object.defineProperties(S.prototype,N)}}}),et.generateConstructor=function(S){for(var T,R=W.codegen(["p"],S.name),N=0;N<S.fieldsArray.length;++N)(T=S._fieldsArray[N]).map?R("this%s={}",W.safeProp(T.name)):T.repeated&&R("this%s=[]",W.safeProp(T.name));return R("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},et.fromJSON=function(S,T){var R=new et(S,T.options);R.extensions=T.extensions,R.reserved=T.reserved;for(var V=Object.keys(T.fields),$=0;$<V.length;++$)R.add((void 0!==T.fields[V[$]].keyType?L.fromJSON:M.fromJSON)(V[$],T.fields[V[$]]));if(T.oneofs)for(V=Object.keys(T.oneofs),$=0;$<V.length;++$)R.add(P.fromJSON(V[$],T.oneofs[V[$]]));if(T.nested)for(V=Object.keys(T.nested),$=0;$<V.length;++$){var K=T.nested[V[$]];R.add((void 0!==K.id?M.fromJSON:void 0!==K.fields?et.fromJSON:void 0!==K.values?O.fromJSON:void 0!==K.methods?U.fromJSON:N.fromJSON)(V[$],K))}return T.extensions&&T.extensions.length&&(R.extensions=T.extensions),T.reserved&&T.reserved.length&&(R.reserved=T.reserved),T.group&&(R.group=!0),T.comment&&(R.comment=T.comment),T.edition&&(R._edition=T.edition),R._defaultEdition="proto3",R},et.prototype.toJSON=function(S){var T=N.prototype.toJSON.call(this,S),R=!!S&&!!S.keepComments;return W.toObject(["edition",this._editionToJSON(),"options",T&&T.options||void 0,"oneofs",N.arrayToJSON(this.oneofsArray,S),"fields",N.arrayToJSON(this.fieldsArray.filter(function(S){return!S.declaringField}),S)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",T&&T.nested||void 0,"comment",R?this.comment:void 0])},et.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;N.prototype.resolveAll.call(this);var S=this.oneofsArray;for(R=0;R<S.length;)S[R++].resolve();for(var T=this.fieldsArray,R=0;R<T.length;)T[R++].resolve();return this},et.prototype._resolveFeaturesRecursive=function(S){return this._needsRecursiveFeatureResolution&&(S=this._edition||S,N.prototype._resolveFeaturesRecursive.call(this,S),this.oneofsArray.forEach(T=>{T._resolveFeatures(S)}),this.fieldsArray.forEach(T=>{T._resolveFeatures(S)})),this},et.prototype.get=function(S){return this.fields[S]||this.oneofs&&this.oneofs[S]||this.nested&&this.nested[S]||null},et.prototype.add=function(S){if(this.get(S.name))throw Error("duplicate name '"+S.name+"' in "+this);if(S instanceof M&&void 0===S.extend){if(this._fieldsById?this._fieldsById[S.id]:this.fieldsById[S.id])throw Error("duplicate id "+S.id+" in "+this);if(this.isReservedId(S.id))throw Error("id "+S.id+" is reserved in "+this);if(this.isReservedName(S.name))throw Error("name '"+S.name+"' is reserved in "+this);return S.parent&&S.parent.remove(S),this.fields[S.name]=S,S.message=this,S.onAdd(this),er(this)}return S instanceof P?(this.oneofs||(this.oneofs={}),this.oneofs[S.name]=S,S.onAdd(this),er(this)):N.prototype.add.call(this,S)},et.prototype.remove=function(S){if(S instanceof M&&void 0===S.extend){if(!this.fields||this.fields[S.name]!==S)throw Error(S+" is not a member of "+this);return delete this.fields[S.name],S.parent=null,S.onRemove(this),er(this)}if(S instanceof P){if(!this.oneofs||this.oneofs[S.name]!==S)throw Error(S+" is not a member of "+this);return delete this.oneofs[S.name],S.parent=null,S.onRemove(this),er(this)}return N.prototype.remove.call(this,S)},et.prototype.isReservedId=function(S){return N.isReservedId(this.reserved,S)},et.prototype.isReservedName=function(S){return N.isReservedName(this.reserved,S)},et.prototype.create=function(S){return new this.ctor(S)},et.prototype.setup=function(){for(var S=this.fullName,T=[],R=0;R<this.fieldsArray.length;++R)T.push(this._fieldsArray[R].resolve().resolvedType);this.encode=Q(this)({Writer:K,types:T,util:W}),this.decode=Y(this)({Reader:$,types:T,util:W}),this.verify=X(this)({types:T,util:W}),this.fromObject=Z.fromObject(this)({types:T,util:W}),this.toObject=Z.toObject(this)({types:T,util:W});var N=ee[S];if(N){var O=Object.create(this);O.fromObject=this.fromObject,this.fromObject=N.fromObject.bind(O),O.toObject=this.toObject,this.toObject=N.toObject.bind(O)}return this},et.prototype.encode=function(S,T){return this.setup().encode(S,T)},et.prototype.encodeDelimited=function(S,T){return this.encode(S,T&&T.len?T.fork():T).ldelim()},et.prototype.decode=function(S,T){return this.setup().decode(S,T)},et.prototype.decodeDelimited=function(S){return S instanceof $||(S=$.create(S)),this.decode(S,S.uint32())},et.prototype.verify=function(S){return this.setup().verify(S)},et.prototype.fromObject=function(S){return this.setup().fromObject(S)},et.prototype.toObject=function(S,T){return this.setup().toObject(S,T)},et.d=function(S){return function(T){W.decorateType(T,S)}}},816:(S,T,R)=>{"use strict";var N=T,O=R(7454),P=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function M(S,T){var R=0,N={};for(T|=0;R<S.length;)N[P[R+T]]=S[R++];return N}N.basic=M([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),N.defaults=M([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",O.emptyArray,null]),N.long=M([0,0,0,1,1],7),N.mapKey=M([0,0,0,5,5,0,0,0,1,1,0,2],2),N.packed=M([1,5,0,0,0,5,5,0,0,0,1,1,0])},7454:(S,T,R)=>{"use strict";var N,O,P=S.exports=R(8345),M=R(8091);P.codegen=R(4983),P.fetch=R(3824),P.path=R(9419),P.fs=P.inquire("fs"),P.toArray=function(S){if(S){for(var T=Object.keys(S),R=Array(T.length),N=0;N<T.length;)R[N]=S[T[N++]];return R}return[]},P.toObject=function(S){for(var T={},R=0;R<S.length;){var N=S[R++],O=S[R++];void 0!==O&&(T[N]=O)}return T};var L=/\\/g,U=/"/g;P.isReserved=function(S){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(S)},P.safeProp=function(S){return!/^[$\w_]+$/.test(S)||P.isReserved(S)?'["'+S.replace(L,"\\\\").replace(U,'\\"')+'"]':"."+S},P.ucFirst=function(S){return S.charAt(0).toUpperCase()+S.substring(1)};var V=/_([a-z])/g;P.camelCase=function(S){return S.substring(0,1)+S.substring(1).replace(V,function(S,T){return T.toUpperCase()})},P.compareFieldsById=function(S,T){return S.id-T.id},P.decorateType=function(S,T){if(S.$type)return T&&S.$type.name!==T&&(P.decorateRoot.remove(S.$type),S.$type.name=T,P.decorateRoot.add(S.$type)),S.$type;N||(N=R(5006));var O=new N(T||S.name);return P.decorateRoot.add(O),O.ctor=S,Object.defineProperty(S,"$type",{value:O,enumerable:!1}),Object.defineProperty(S.prototype,"$type",{value:O,enumerable:!1}),O};var $=0;P.decorateEnum=function(S){if(S.$type)return S.$type;O||(O=R(6734));var T=new O("Enum"+$++,S);return P.decorateRoot.add(T),Object.defineProperty(S,"$type",{value:T,enumerable:!1}),T},P.setProperty=function(S,T,R,N){function O(S,T,R){var P=T.shift();if("__proto__"===P||"prototype"===P)return S;if(T.length>0)S[P]=O(S[P]||{},T,R);else{var M=S[P];if(M&&N)return S;M&&(R=[].concat(M).concat(R)),S[P]=R}return S}if("object"!=typeof S)throw TypeError("dst must be an object");if(!T)throw TypeError("path must be specified");return O(S,T=T.split("."),R)},Object.defineProperty(P,"decorateRoot",{get:function(){return M.decorated||(M.decorated=new(R(3852)))}})},2321:(S,T,R)=>{"use strict";S.exports=O;var N=R(8345);function O(S,T){this.lo=S>>>0,this.hi=T>>>0}var P=O.zero=new O(0,0);P.toNumber=function(){return 0},P.zzEncode=P.zzDecode=function(){return this},P.length=function(){return 1};var M=O.zeroHash="\x00\x00\x00\x00\x00\x00\x00\x00";O.fromNumber=function(S){if(0===S)return P;var T=S<0;T&&(S=-S);var R=S>>>0,N=(S-R)/4294967296>>>0;return T&&(N=~N>>>0,R=~R>>>0,++R>4294967295&&(R=0,++N>4294967295&&(N=0))),new O(R,N)},O.from=function(S){if("number"==typeof S)return O.fromNumber(S);if(N.isString(S)){if(!N.Long)return O.fromNumber(parseInt(S,10));S=N.Long.fromString(S)}return S.low||S.high?new O(S.low>>>0,S.high>>>0):P},O.prototype.toNumber=function(S){if(!S&&this.hi>>>31){var T=~this.lo+1>>>0,R=~this.hi>>>0;return T||(R=R+1>>>0),-(T+4294967296*R)}return this.lo+4294967296*this.hi},O.prototype.toLong=function(S){return N.Long?new N.Long(0|this.lo,0|this.hi,!!S):{low:0|this.lo,high:0|this.hi,unsigned:!!S}};var L=String.prototype.charCodeAt;O.fromHash=function(S){return S===M?P:new O((L.call(S,0)|L.call(S,1)<<8|L.call(S,2)<<16|L.call(S,3)<<24)>>>0,(L.call(S,4)|L.call(S,5)<<8|L.call(S,6)<<16|L.call(S,7)<<24)>>>0)},O.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},O.prototype.zzEncode=function(){var S=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^S)>>>0,this.lo=(this.lo<<1^S)>>>0,this},O.prototype.zzDecode=function(){var S=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^S)>>>0,this.hi=(this.hi>>>1^S)>>>0,this},O.prototype.length=function(){var S=this.lo,T=(this.lo>>>28|this.hi<<4)>>>0,R=this.hi>>>24;return 0===R?0===T?S<16384?S<128?1:2:S<2097152?3:4:T<16384?T<128?5:6:T<2097152?7:8:R<128?9:10}},8345:function(S,T,R){"use strict";var N=T;function O(S,T,R){for(var N=Object.keys(T),O=0;O<N.length;++O)void 0!==S[N[O]]&&R||(S[N[O]]=T[N[O]]);return S}function P(S){function T(S,R){if(!(this instanceof T))return new T(S,R);Object.defineProperty(this,"message",{get:function(){return S}}),Error.captureStackTrace?Error.captureStackTrace(this,T):Object.defineProperty(this,"stack",{value:Error().stack||""}),R&&O(this,R)}return T.prototype=Object.create(Error.prototype,{constructor:{value:T,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return S},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),T}N.asPromise=R(5409),N.base64=R(1315),N.EventEmitter=R(3595),N.float=R(1708),N.inquire=R(3421),N.utf8=R(9774),N.pool=R(7474),N.LongBits=R(2321),N.isNode=!!("undefined"!=typeof global&&global&&global.process&&global.process.versions&&global.process.versions.node),N.global=N.isNode&&global||"undefined"!=typeof self&&self||this,N.emptyArray=Object.freeze?Object.freeze([]):[],N.emptyObject=Object.freeze?Object.freeze({}):{},N.isInteger=Number.isInteger||function(S){return"number"==typeof S&&isFinite(S)&&Math.floor(S)===S},N.isString=function(S){return"string"==typeof S||S instanceof String},N.isObject=function(S){return S&&"object"==typeof S},N.isset=N.isSet=function(S,T){var R=S[T];return!!(null!=R&&S.hasOwnProperty(T))&&("object"!=typeof R||(Array.isArray(R)?R.length:Object.keys(R).length)>0)},N.Buffer=function(){try{var S=N.inquire("buffer").Buffer;return S.prototype.utf8Write?S:null}catch(S){return null}}(),N._Buffer_from=null,N._Buffer_allocUnsafe=null,N.newBuffer=function(S){return"number"==typeof S?N.Buffer?N._Buffer_allocUnsafe(S):new N.Array(S):N.Buffer?N._Buffer_from(S):"undefined"==typeof Uint8Array?S:new Uint8Array(S)},N.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,N.Long=N.global.dcodeIO&&N.global.dcodeIO.Long||N.global.Long||N.inquire("long"),N.key2Re=/^true|false|0|1$/,N.key32Re=/^-?(?:0|[1-9][0-9]*)$/,N.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,N.longToHash=function(S){return S?N.LongBits.from(S).toHash():N.LongBits.zeroHash},N.longFromHash=function(S,T){var R=N.LongBits.fromHash(S);return N.Long?N.Long.fromBits(R.lo,R.hi,T):R.toNumber(!!T)},N.merge=O,N.lcFirst=function(S){return S.charAt(0).toLowerCase()+S.substring(1)},N.newError=P,N.ProtocolError=P("ProtocolError"),N.oneOfGetter=function(S){for(var T={},R=0;R<S.length;++R)T[S[R]]=1;return function(){for(var S=Object.keys(this),R=S.length-1;R>-1;--R)if(1===T[S[R]]&&void 0!==this[S[R]]&&null!==this[S[R]])return S[R]}},N.oneOfSetter=function(S){return function(T){for(var R=0;R<S.length;++R)S[R]!==T&&delete this[S[R]]}},N.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},N._configure=function(){var S=N.Buffer;if(!S){N._Buffer_from=N._Buffer_allocUnsafe=null;return}N._Buffer_from=S.from!==Uint8Array.from&&S.from||function(T,R){return new S(T,R)},N._Buffer_allocUnsafe=S.allocUnsafe||function(T){return new S(T)}}},7624:(S,T,R)=>{"use strict";S.exports=U;var N=R(6734),O=R(7454);function P(S,T){return S.name+": "+T+(S.repeated&&"array"!==T?"[]":S.map&&"object"!==T?"{k:"+S.keyType+"}":"")+" expected"}function M(S,T,R,O){if(T.resolvedType){if(T.resolvedType instanceof N){S("switch(%s){",O)("default:")("return%j",P(T,"enum value"));for(var M=Object.keys(T.resolvedType.values),L=0;L<M.length;++L)S("case %i:",T.resolvedType.values[M[L]]);S("break")("}")}else S("{")("var e=types[%i].verify(%s);",R,O)("if(e)")("return%j+e",T.name+".")("}")}else switch(T.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":S("if(!util.isInteger(%s))",O)("return%j",P(T,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":S("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",O,O,O,O)("return%j",P(T,"integer|Long"));break;case"float":case"double":S('if(typeof %s!=="number")',O)("return%j",P(T,"number"));break;case"bool":S('if(typeof %s!=="boolean")',O)("return%j",P(T,"boolean"));break;case"string":S("if(!util.isString(%s))",O)("return%j",P(T,"string"));break;case"bytes":S('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',O,O,O)("return%j",P(T,"buffer"))}return S}function L(S,T,R){switch(T.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":S("if(!util.key32Re.test(%s))",R)("return%j",P(T,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":S("if(!util.key64Re.test(%s))",R)("return%j",P(T,"integer|Long key"));break;case"bool":S("if(!util.key2Re.test(%s))",R)("return%j",P(T,"boolean key"))}return S}function U(S){var T=O.codegen(["m"],S.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),R=S.oneofsArray,N={};R.length&&T("var p={}");for(var U=0;U<S.fieldsArray.length;++U){var V=S._fieldsArray[U].resolve(),$="m"+O.safeProp(V.name);if(V.optional&&T("if(%s!=null&&m.hasOwnProperty(%j)){",$,V.name),V.map)T("if(!util.isObject(%s))",$)("return%j",P(V,"object"))("var k=Object.keys(%s)",$)("for(var i=0;i<k.length;++i){"),L(T,V,"k[i]"),M(T,V,U,$+"[k[i]]")("}");else if(V.repeated)T("if(!Array.isArray(%s))",$)("return%j",P(V,"array"))("for(var i=0;i<%s.length;++i){",$),M(T,V,U,$+"[i]")("}");else{if(V.partOf){var K=O.safeProp(V.partOf.name);1===N[V.partOf.name]&&T("if(p%s===1)",K)("return%j",V.partOf.name+": multiple values"),N[V.partOf.name]=1,T("p%s=1",K)}M(T,V,U,$)}V.optional&&T("}")}return T("return null")}},1904:(S,T,R)=>{"use strict";var N=T,O=R(2038);N[".google.protobuf.Any"]={fromObject:function(S){if(S&&S["@type"]){var T=S["@type"].substring(S["@type"].lastIndexOf("/")+1),R=this.lookup(T);if(R){var N="."===S["@type"].charAt(0)?S["@type"].slice(1):S["@type"];return -1===N.indexOf("/")&&(N="/"+N),this.create({type_url:N,value:R.encode(R.fromObject(S)).finish()})}}return this.fromObject(S)},toObject:function(S,T){var R="type.googleapis.com/",N="",P="";if(T&&T.json&&S.type_url&&S.value){P=S.type_url.substring(S.type_url.lastIndexOf("/")+1),N=S.type_url.substring(0,S.type_url.lastIndexOf("/")+1);var M=this.lookup(P);M&&(S=M.decode(S.value))}if(!(S instanceof this.ctor)&&S instanceof O){var L=S.$type.toObject(S,T),U="."===S.$type.fullName[0]?S.$type.fullName.slice(1):S.$type.fullName;return""===N&&(N=R),P=N+U,L["@type"]=P,L}return this.toObject(S,T)}}},9822:(S,T,R)=>{"use strict";S.exports=K;var N,O=R(8345),P=O.LongBits,M=O.base64,L=O.utf8;function U(S,T,R){this.fn=S,this.len=T,this.next=void 0,this.val=R}function V(){}function $(S){this.head=S.head,this.tail=S.tail,this.len=S.len,this.next=S.states}function K(){this.len=0,this.head=new U(V,0,0),this.tail=this.head,this.states=null}var W=function(){return O.Buffer?function(){return(K.create=function(){return new N})()}:function(){return new K}};function Q(S,T,R){T[R]=255&S}function Y(S,T,R){for(;S>127;)T[R++]=127&S|128,S>>>=7;T[R]=S}function X(S,T){this.len=S,this.next=void 0,this.val=T}function Z(S,T,R){for(;S.hi;)T[R++]=127&S.lo|128,S.lo=(S.lo>>>7|S.hi<<25)>>>0,S.hi>>>=7;for(;S.lo>127;)T[R++]=127&S.lo|128,S.lo=S.lo>>>7;T[R++]=S.lo}function ee(S,T,R){T[R]=255&S,T[R+1]=S>>>8&255,T[R+2]=S>>>16&255,T[R+3]=S>>>24}K.create=W(),K.alloc=function(S){return new O.Array(S)},O.Array!==Array&&(K.alloc=O.pool(K.alloc,O.Array.prototype.subarray)),K.prototype._push=function(S,T,R){return this.tail=this.tail.next=new U(S,T,R),this.len+=T,this},X.prototype=Object.create(U.prototype),X.prototype.fn=Y,K.prototype.uint32=function(S){return this.len+=(this.tail=this.tail.next=new X((S>>>=0)<128?1:S<16384?2:S<2097152?3:S<268435456?4:5,S)).len,this},K.prototype.int32=function(S){return S<0?this._push(Z,10,P.fromNumber(S)):this.uint32(S)},K.prototype.sint32=function(S){return this.uint32((S<<1^S>>31)>>>0)},K.prototype.uint64=function(S){var T=P.from(S);return this._push(Z,T.length(),T)},K.prototype.int64=K.prototype.uint64,K.prototype.sint64=function(S){var T=P.from(S).zzEncode();return this._push(Z,T.length(),T)},K.prototype.bool=function(S){return this._push(Q,1,S?1:0)},K.prototype.fixed32=function(S){return this._push(ee,4,S>>>0)},K.prototype.sfixed32=K.prototype.fixed32,K.prototype.fixed64=function(S){var T=P.from(S);return this._push(ee,4,T.lo)._push(ee,4,T.hi)},K.prototype.sfixed64=K.prototype.fixed64,K.prototype.float=function(S){return this._push(O.float.writeFloatLE,4,S)},K.prototype.double=function(S){return this._push(O.float.writeDoubleLE,8,S)};var et=O.Array.prototype.set?function(S,T,R){T.set(S,R)}:function(S,T,R){for(var N=0;N<S.length;++N)T[R+N]=S[N]};K.prototype.bytes=function(S){var T=S.length>>>0;if(!T)return this._push(Q,1,0);if(O.isString(S)){var R=K.alloc(T=M.length(S));M.decode(S,R,0),S=R}return this.uint32(T)._push(et,T,S)},K.prototype.string=function(S){var T=L.length(S);return T?this.uint32(T)._push(L.write,T,S):this._push(Q,1,0)},K.prototype.fork=function(){return this.states=new $(this),this.head=this.tail=new U(V,0,0),this.len=0,this},K.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new U(V,0,0),this.len=0),this},K.prototype.ldelim=function(){var S=this.head,T=this.tail,R=this.len;return this.reset().uint32(R),R&&(this.tail.next=S.next,this.tail=T,this.len+=R),this},K.prototype.finish=function(){for(var S=this.head.next,T=this.constructor.alloc(this.len),R=0;S;)S.fn(S.val,T,R),R+=S.len,S=S.next;return T},K._configure=function(S){N=S,K.create=W(),N._configure()}},5896:(S,T,R)=>{"use strict";S.exports=P;var N=R(9822);(P.prototype=Object.create(N.prototype)).constructor=P;var O=R(8345);function P(){N.call(this)}function M(S,T,R){S.length<40?O.utf8.write(S,T,R):T.utf8Write?T.utf8Write(S,R):T.write(S,R)}P._configure=function(){P.alloc=O._Buffer_allocUnsafe,P.writeBytesBuffer=O.Buffer&&O.Buffer.prototype instanceof Uint8Array&&"set"===O.Buffer.prototype.set.name?function(S,T,R){T.set(S,R)}:function(S,T,R){if(S.copy)S.copy(T,R,0,S.length);else for(var N=0;N<S.length;)T[R++]=S[N++]}},P.prototype.bytes=function(S){O.isString(S)&&(S=O._Buffer_from(S,"base64"));var T=S.length>>>0;return this.uint32(T),T&&this._push(P.writeBytesBuffer,T,S),this},P.prototype.string=function(S){var T=O.Buffer.byteLength(S);return this.uint32(T),T&&this._push(M,T,S),this},P._configure()},5304:function(S,T){var R;!function(N,O){function P(S){return S.default||S}void 0!==(R=(function(){var S={};return O(S),P(S)}).apply(T,[]))&&(S.exports=R)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,function(S){"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.default=void 0;/**
     * @license
     * Copyright 2009 The Closure Library Authors
     * Copyright 2020 Daniel Wirtz / The long.js Authors.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     *
     * SPDX-License-Identifier: Apache-2.0
     */var T=null;try{T=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function R(S,T,R){this.low=0|S,this.high=0|T,this.unsigned=!!R}function N(S){return!0===(S&&S.__isLong__)}function O(S){var T=Math.clz32(S&-S);return S?31-T:T}R.prototype.__isLong__,Object.defineProperty(R.prototype,"__isLong__",{value:!0}),R.isLong=N;var P={},M={};function L(S,T){var R,N,O;return T?(S>>>=0,(O=0<=S&&S<256)&&(N=M[S]))?N:(R=V(S,0,!0),O&&(M[S]=R),R):(S|=0,(O=-128<=S&&S<128)&&(N=P[S]))?N:(R=V(S,S<0?-1:0,!1),O&&(P[S]=R),R)}function U(S,T){if(isNaN(S))return T?et:ee;if(T){if(S<0)return et;if(S>=Y)return ea}else{if(S<=-X)return eo;if(S+1>=X)return es}return S<0?U(-S,T).neg():V(S%Q|0,S/Q|0,T)}function V(S,T,N){return new R(S,T,N)}R.fromInt=L,R.fromNumber=U,R.fromBits=V;var $=Math.pow;function K(S,T,R){if(0===S.length)throw Error("empty string");if("number"==typeof T?(R=T,T=!1):T=!!T,"NaN"===S||"Infinity"===S||"+Infinity"===S||"-Infinity"===S)return T?et:ee;if((R=R||10)<2||36<R)throw RangeError("radix");if((N=S.indexOf("-"))>0)throw Error("interior hyphen");if(0===N)return K(S.substring(1),T,R).neg();for(var N,O=U($(R,8)),P=ee,M=0;M<S.length;M+=8){var L=Math.min(8,S.length-M),V=parseInt(S.substring(M,M+L),R);if(L<8){var W=U($(R,L));P=P.mul(W).add(U(V))}else P=(P=P.mul(O)).add(U(V))}return P.unsigned=T,P}function W(S,T){return"number"==typeof S?U(S,T):"string"==typeof S?K(S,T):V(S.low,S.high,"boolean"==typeof T?T:S.unsigned)}R.fromString=K,R.fromValue=W;var Q=4294967296,Y=18446744073709552e3,X=0x7fffffffffffffff,Z=L(16777216),ee=L(0);R.ZERO=ee;var et=L(0,!0);R.UZERO=et;var er=L(1);R.ONE=er;var en=L(1,!0);R.UONE=en;var ei=L(-1);R.NEG_ONE=ei;var es=V(-1,2147483647,!1);R.MAX_VALUE=es;var ea=V(-1,-1,!0);R.MAX_UNSIGNED_VALUE=ea;var eo=V(0,-2147483648,!1);R.MIN_VALUE=eo;var eu=R.prototype;eu.toInt=function(){return this.unsigned?this.low>>>0:this.low},eu.toNumber=function(){return this.unsigned?(this.high>>>0)*Q+(this.low>>>0):this.high*Q+(this.low>>>0)},eu.toString=function(S){if((S=S||10)<2||36<S)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(!this.eq(eo))return"-"+this.neg().toString(S);var T=U(S),R=this.div(T),N=R.mul(T).sub(this);return R.toString(S)+N.toInt().toString(S)}for(var O=U($(S,6),this.unsigned),P=this,M="";;){var L=P.div(O),V=(P.sub(L.mul(O)).toInt()>>>0).toString(S);if((P=L).isZero())return V+M;for(;V.length<6;)V="0"+V;M=""+V+M}},eu.getHighBits=function(){return this.high},eu.getHighBitsUnsigned=function(){return this.high>>>0},eu.getLowBits=function(){return this.low},eu.getLowBitsUnsigned=function(){return this.low>>>0},eu.getNumBitsAbs=function(){if(this.isNegative())return this.eq(eo)?64:this.neg().getNumBitsAbs();for(var S=0!=this.high?this.high:this.low,T=31;T>0&&(S&1<<T)==0;T--);return 0!=this.high?T+33:T+1},eu.isSafeInteger=function(){var S=this.high>>21;return!S||!this.unsigned&&-1===S&&!(0===this.low&&-2097152===this.high)},eu.isZero=function(){return 0===this.high&&0===this.low},eu.eqz=eu.isZero,eu.isNegative=function(){return!this.unsigned&&this.high<0},eu.isPositive=function(){return this.unsigned||this.high>=0},eu.isOdd=function(){return(1&this.low)==1},eu.isEven=function(){return(1&this.low)==0},eu.equals=function(S){return N(S)||(S=W(S)),(this.unsigned===S.unsigned||this.high>>>31!=1||S.high>>>31!=1)&&this.high===S.high&&this.low===S.low},eu.eq=eu.equals,eu.notEquals=function(S){return!this.eq(S)},eu.neq=eu.notEquals,eu.ne=eu.notEquals,eu.lessThan=function(S){return 0>this.comp(S)},eu.lt=eu.lessThan,eu.lessThanOrEqual=function(S){return 0>=this.comp(S)},eu.lte=eu.lessThanOrEqual,eu.le=eu.lessThanOrEqual,eu.greaterThan=function(S){return this.comp(S)>0},eu.gt=eu.greaterThan,eu.greaterThanOrEqual=function(S){return this.comp(S)>=0},eu.gte=eu.greaterThanOrEqual,eu.ge=eu.greaterThanOrEqual,eu.compare=function(S){if(N(S)||(S=W(S)),this.eq(S))return 0;var T=this.isNegative(),R=S.isNegative();return T&&!R?-1:!T&&R?1:this.unsigned?S.high>>>0>this.high>>>0||S.high===this.high&&S.low>>>0>this.low>>>0?-1:1:this.sub(S).isNegative()?-1:1},eu.comp=eu.compare,eu.negate=function(){return!this.unsigned&&this.eq(eo)?eo:this.not().add(er)},eu.neg=eu.negate,eu.add=function(S){N(S)||(S=W(S));var T,R,O=this.high>>>16,P=65535&this.high,M=this.low>>>16,L=65535&this.low,U=S.high>>>16,$=65535&S.high,K=S.low>>>16,Q=65535&S.low,Y=0,X=0;return T=0+((R=0+(L+Q))>>>16),R&=65535,T+=M+K,X+=T>>>16,T&=65535,X+=P+$,Y+=X>>>16,X&=65535,Y+=O+U,V(T<<16|R,(Y&=65535)<<16|X,this.unsigned)},eu.subtract=function(S){return N(S)||(S=W(S)),this.add(S.neg())},eu.sub=eu.subtract,eu.multiply=function(S){if(this.isZero())return this;if(N(S)||(S=W(S)),T)return V(T.mul(this.low,this.high,S.low,S.high),T.get_high(),this.unsigned);if(S.isZero())return this.unsigned?et:ee;if(this.eq(eo))return S.isOdd()?eo:ee;if(S.eq(eo))return this.isOdd()?eo:ee;if(this.isNegative())return S.isNegative()?this.neg().mul(S.neg()):this.neg().mul(S).neg();if(S.isNegative())return this.mul(S.neg()).neg();if(this.lt(Z)&&S.lt(Z))return U(this.toNumber()*S.toNumber(),this.unsigned);var R,O,P=this.high>>>16,M=65535&this.high,L=this.low>>>16,$=65535&this.low,K=S.high>>>16,Q=65535&S.high,Y=S.low>>>16,X=65535&S.low,er=0,en=0;return R=0+((O=0+$*X)>>>16),O&=65535,R+=L*X,en+=R>>>16,R&=65535,R+=$*Y,en+=R>>>16,R&=65535,en+=M*X,er+=en>>>16,en&=65535,en+=L*Y,er+=en>>>16,en&=65535,en+=$*Q,er+=en>>>16,en&=65535,er+=P*X+M*Y+L*Q+$*K,V(R<<16|O,(er&=65535)<<16|en,this.unsigned)},eu.mul=eu.multiply,eu.divide=function(S){if(N(S)||(S=W(S)),S.isZero())throw Error("division by zero");if(T){var R,O,P;return this.unsigned||-2147483648!==this.high||-1!==S.low||-1!==S.high?V((this.unsigned?T.div_u:T.div_s)(this.low,this.high,S.low,S.high),T.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?et:ee;if(this.unsigned){if(S.unsigned||(S=S.toUnsigned()),S.gt(this))return et;if(S.gt(this.shru(1)))return en;P=et}else{if(this.eq(eo))return S.eq(er)||S.eq(ei)?eo:S.eq(eo)?er:(R=this.shr(1).div(S).shl(1)).eq(ee)?S.isNegative()?er:ei:(O=this.sub(S.mul(R)),P=R.add(O.div(S)));if(S.eq(eo))return this.unsigned?et:ee;if(this.isNegative())return S.isNegative()?this.neg().div(S.neg()):this.neg().div(S).neg();if(S.isNegative())return this.div(S.neg()).neg();P=ee}for(O=this;O.gte(S);){for(var M=Math.ceil(Math.log(R=Math.max(1,Math.floor(O.toNumber()/S.toNumber())))/Math.LN2),L=M<=48?1:$(2,M-48),K=U(R),Q=K.mul(S);Q.isNegative()||Q.gt(O);)R-=L,Q=(K=U(R,this.unsigned)).mul(S);K.isZero()&&(K=er),P=P.add(K),O=O.sub(Q)}return P},eu.div=eu.divide,eu.modulo=function(S){return(N(S)||(S=W(S)),T)?V((this.unsigned?T.rem_u:T.rem_s)(this.low,this.high,S.low,S.high),T.get_high(),this.unsigned):this.sub(this.div(S).mul(S))},eu.mod=eu.modulo,eu.rem=eu.modulo,eu.not=function(){return V(~this.low,~this.high,this.unsigned)},eu.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},eu.clz=eu.countLeadingZeros,eu.countTrailingZeros=function(){return this.low?O(this.low):O(this.high)+32},eu.ctz=eu.countTrailingZeros,eu.and=function(S){return N(S)||(S=W(S)),V(this.low&S.low,this.high&S.high,this.unsigned)},eu.or=function(S){return N(S)||(S=W(S)),V(this.low|S.low,this.high|S.high,this.unsigned)},eu.xor=function(S){return N(S)||(S=W(S)),V(this.low^S.low,this.high^S.high,this.unsigned)},eu.shiftLeft=function(S){return(N(S)&&(S=S.toInt()),0==(S&=63))?this:S<32?V(this.low<<S,this.high<<S|this.low>>>32-S,this.unsigned):V(0,this.low<<S-32,this.unsigned)},eu.shl=eu.shiftLeft,eu.shiftRight=function(S){return(N(S)&&(S=S.toInt()),0==(S&=63))?this:S<32?V(this.low>>>S|this.high<<32-S,this.high>>S,this.unsigned):V(this.high>>S-32,this.high>=0?0:-1,this.unsigned)},eu.shr=eu.shiftRight,eu.shiftRightUnsigned=function(S){return(N(S)&&(S=S.toInt()),0==(S&=63))?this:S<32?V(this.low>>>S|this.high<<32-S,this.high>>>S,this.unsigned):32===S?V(this.high,0,this.unsigned):V(this.high>>>S-32,0,this.unsigned)},eu.shru=eu.shiftRightUnsigned,eu.shr_u=eu.shiftRightUnsigned,eu.rotateLeft=function(S){var T;return(N(S)&&(S=S.toInt()),0==(S&=63))?this:32===S?V(this.high,this.low,this.unsigned):S<32?(T=32-S,V(this.low<<S|this.high>>>T,this.high<<S|this.low>>>T,this.unsigned)):(S-=32,T=32-S,V(this.high<<S|this.low>>>T,this.low<<S|this.high>>>T,this.unsigned))},eu.rotl=eu.rotateLeft,eu.rotateRight=function(S){var T;return(N(S)&&(S=S.toInt()),0==(S&=63))?this:32===S?V(this.high,this.low,this.unsigned):S<32?(T=32-S,V(this.high<<T|this.low>>>S,this.low<<T|this.high>>>S,this.unsigned)):(S-=32,T=32-S,V(this.low<<T|this.high>>>S,this.high<<T|this.low>>>S,this.unsigned))},eu.rotr=eu.rotateRight,eu.toSigned=function(){return this.unsigned?V(this.low,this.high,!1):this},eu.toUnsigned=function(){return this.unsigned?this:V(this.low,this.high,!0)},eu.toBytes=function(S){return S?this.toBytesLE():this.toBytesBE()},eu.toBytesLE=function(){var S=this.high,T=this.low;return[255&T,T>>>8&255,T>>>16&255,T>>>24,255&S,S>>>8&255,S>>>16&255,S>>>24]},eu.toBytesBE=function(){var S=this.high,T=this.low;return[S>>>24,S>>>16&255,S>>>8&255,255&S,T>>>24,T>>>16&255,T>>>8&255,255&T]},R.fromBytes=function(S,T,N){return N?R.fromBytesLE(S,T):R.fromBytesBE(S,T)},R.fromBytesLE=function(S,T){return new R(S[0]|S[1]<<8|S[2]<<16|S[3]<<24,S[4]|S[5]<<8|S[6]<<16|S[7]<<24,T)},R.fromBytesBE=function(S,T){return new R(S[4]<<24|S[5]<<16|S[6]<<8|S[7],S[0]<<24|S[1]<<16|S[2]<<8|S[3],T)},"function"==typeof BigInt&&(R.fromBigInt=function(S,T){return V(Number(BigInt.asIntN(32,S)),Number(BigInt.asIntN(32,S>>BigInt(32))),T)},R.fromValue=function(S,T){return"bigint"==typeof S?R.fromBigInt(S,T):W(S,T)},eu.toBigInt=function(){var S=BigInt(this.low>>>0);return BigInt(this.unsigned?this.high>>>0:this.high)<<BigInt(32)|S}),S.default=R})},7645:S=>{"use strict";S.exports={i8:"1.9.15"}},522:S=>{"use strict";S.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Api":{"fields":{"name":{"type":"string","id":1},"methods":{"rule":"repeated","type":"Method","id":2},"options":{"rule":"repeated","type":"Option","id":3},"version":{"type":"string","id":4},"sourceContext":{"type":"SourceContext","id":5},"mixins":{"rule":"repeated","type":"Mixin","id":6},"syntax":{"type":"Syntax","id":7}}},"Method":{"fields":{"name":{"type":"string","id":1},"requestTypeUrl":{"type":"string","id":2},"requestStreaming":{"type":"bool","id":3},"responseTypeUrl":{"type":"string","id":4},"responseStreaming":{"type":"bool","id":5},"options":{"rule":"repeated","type":"Option","id":6},"syntax":{"type":"Syntax","id":7}}},"Mixin":{"fields":{"name":{"type":"string","id":1},"root":{"type":"string","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}}}}}}}}')},4552:S=>{"use strict";S.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"options":{"go_package":"google.golang.org/protobuf/types/descriptorpb","java_package":"com.google.protobuf","java_outer_classname":"DescriptorProtos","csharp_namespace":"Google.Protobuf.Reflection","objc_class_prefix":"GPB","cc_enable_arenas":true,"optimize_for":"SPEED"},"nested":{"FileDescriptorSet":{"edition":"proto2","fields":{"file":{"rule":"repeated","type":"FileDescriptorProto","id":1}},"extensions":[[536000000,536000000]]},"Edition":{"edition":"proto2","values":{"EDITION_UNKNOWN":0,"EDITION_LEGACY":900,"EDITION_PROTO2":998,"EDITION_PROTO3":999,"EDITION_2023":1000,"EDITION_2024":1001,"EDITION_1_TEST_ONLY":1,"EDITION_2_TEST_ONLY":2,"EDITION_99997_TEST_ONLY":99997,"EDITION_99998_TEST_ONLY":99998,"EDITION_99999_TEST_ONLY":99999,"EDITION_MAX":2147483647}},"FileDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"package":{"type":"string","id":2},"dependency":{"rule":"repeated","type":"string","id":3},"publicDependency":{"rule":"repeated","type":"int32","id":10},"weakDependency":{"rule":"repeated","type":"int32","id":11},"optionDependency":{"rule":"repeated","type":"string","id":15},"messageType":{"rule":"repeated","type":"DescriptorProto","id":4},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":5},"service":{"rule":"repeated","type":"ServiceDescriptorProto","id":6},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":7},"options":{"type":"FileOptions","id":8},"sourceCodeInfo":{"type":"SourceCodeInfo","id":9},"syntax":{"type":"string","id":12},"edition":{"type":"Edition","id":14}}},"DescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"field":{"rule":"repeated","type":"FieldDescriptorProto","id":2},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":6},"nestedType":{"rule":"repeated","type":"DescriptorProto","id":3},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":4},"extensionRange":{"rule":"repeated","type":"ExtensionRange","id":5},"oneofDecl":{"rule":"repeated","type":"OneofDescriptorProto","id":8},"options":{"type":"MessageOptions","id":7},"reservedRange":{"rule":"repeated","type":"ReservedRange","id":9},"reservedName":{"rule":"repeated","type":"string","id":10},"visibility":{"type":"SymbolVisibility","id":11}},"nested":{"ExtensionRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2},"options":{"type":"ExtensionRangeOptions","id":3}}},"ReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"ExtensionRangeOptions":{"edition":"proto2","fields":{"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999},"declaration":{"rule":"repeated","type":"Declaration","id":2,"options":{"retention":"RETENTION_SOURCE"}},"features":{"type":"FeatureSet","id":50},"verification":{"type":"VerificationState","id":3,"options":{"default":"UNVERIFIED","retention":"RETENTION_SOURCE"}}},"extensions":[[1000,536870911]],"nested":{"Declaration":{"fields":{"number":{"type":"int32","id":1},"fullName":{"type":"string","id":2},"type":{"type":"string","id":3},"reserved":{"type":"bool","id":5},"repeated":{"type":"bool","id":6}},"reserved":[[4,4]]},"VerificationState":{"values":{"DECLARATION":0,"UNVERIFIED":1}}}},"FieldDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":3},"label":{"type":"Label","id":4},"type":{"type":"Type","id":5},"typeName":{"type":"string","id":6},"extendee":{"type":"string","id":2},"defaultValue":{"type":"string","id":7},"oneofIndex":{"type":"int32","id":9},"jsonName":{"type":"string","id":10},"options":{"type":"FieldOptions","id":8},"proto3Optional":{"type":"bool","id":17}},"nested":{"Type":{"values":{"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Label":{"values":{"LABEL_OPTIONAL":1,"LABEL_REPEATED":3,"LABEL_REQUIRED":2}}}},"OneofDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"options":{"type":"OneofOptions","id":2}}},"EnumDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"value":{"rule":"repeated","type":"EnumValueDescriptorProto","id":2},"options":{"type":"EnumOptions","id":3},"reservedRange":{"rule":"repeated","type":"EnumReservedRange","id":4},"reservedName":{"rule":"repeated","type":"string","id":5},"visibility":{"type":"SymbolVisibility","id":6}},"nested":{"EnumReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"EnumValueDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"type":"EnumValueOptions","id":3}}},"ServiceDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"method":{"rule":"repeated","type":"MethodDescriptorProto","id":2},"options":{"type":"ServiceOptions","id":3}}},"MethodDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"inputType":{"type":"string","id":2},"outputType":{"type":"string","id":3},"options":{"type":"MethodOptions","id":4},"clientStreaming":{"type":"bool","id":5},"serverStreaming":{"type":"bool","id":6}}},"FileOptions":{"edition":"proto2","fields":{"javaPackage":{"type":"string","id":1},"javaOuterClassname":{"type":"string","id":8},"javaMultipleFiles":{"type":"bool","id":10},"javaGenerateEqualsAndHash":{"type":"bool","id":20,"options":{"deprecated":true}},"javaStringCheckUtf8":{"type":"bool","id":27},"optimizeFor":{"type":"OptimizeMode","id":9,"options":{"default":"SPEED"}},"goPackage":{"type":"string","id":11},"ccGenericServices":{"type":"bool","id":16},"javaGenericServices":{"type":"bool","id":17},"pyGenericServices":{"type":"bool","id":18},"deprecated":{"type":"bool","id":23},"ccEnableArenas":{"type":"bool","id":31,"options":{"default":true}},"objcClassPrefix":{"type":"string","id":36},"csharpNamespace":{"type":"string","id":37},"swiftPrefix":{"type":"string","id":39},"phpClassPrefix":{"type":"string","id":40},"phpNamespace":{"type":"string","id":41},"phpMetadataNamespace":{"type":"string","id":44},"rubyPackage":{"type":"string","id":45},"features":{"type":"FeatureSet","id":50},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[42,42],"php_generic_services",[38,38]],"nested":{"OptimizeMode":{"values":{"SPEED":1,"CODE_SIZE":2,"LITE_RUNTIME":3}}}},"MessageOptions":{"edition":"proto2","fields":{"messageSetWireFormat":{"type":"bool","id":1},"noStandardDescriptorAccessor":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"mapEntry":{"type":"bool","id":7},"deprecatedLegacyJsonFieldConflicts":{"type":"bool","id":11,"options":{"deprecated":true}},"features":{"type":"FeatureSet","id":12},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4],[5,5],[6,6],[8,8],[9,9]]},"FieldOptions":{"edition":"proto2","fields":{"ctype":{"type":"CType","id":1,"options":{"default":"STRING"}},"packed":{"type":"bool","id":2},"jstype":{"type":"JSType","id":6,"options":{"default":"JS_NORMAL"}},"lazy":{"type":"bool","id":5},"unverifiedLazy":{"type":"bool","id":15},"deprecated":{"type":"bool","id":3},"weak":{"type":"bool","id":10,"options":{"deprecated":true}},"debugRedact":{"type":"bool","id":16},"retention":{"type":"OptionRetention","id":17},"targets":{"rule":"repeated","type":"OptionTargetType","id":19},"editionDefaults":{"rule":"repeated","type":"EditionDefault","id":20},"features":{"type":"FeatureSet","id":21},"featureSupport":{"type":"FeatureSupport","id":22},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4],[18,18]],"nested":{"CType":{"values":{"STRING":0,"CORD":1,"STRING_PIECE":2}},"JSType":{"values":{"JS_NORMAL":0,"JS_STRING":1,"JS_NUMBER":2}},"OptionRetention":{"values":{"RETENTION_UNKNOWN":0,"RETENTION_RUNTIME":1,"RETENTION_SOURCE":2}},"OptionTargetType":{"values":{"TARGET_TYPE_UNKNOWN":0,"TARGET_TYPE_FILE":1,"TARGET_TYPE_EXTENSION_RANGE":2,"TARGET_TYPE_MESSAGE":3,"TARGET_TYPE_FIELD":4,"TARGET_TYPE_ONEOF":5,"TARGET_TYPE_ENUM":6,"TARGET_TYPE_ENUM_ENTRY":7,"TARGET_TYPE_SERVICE":8,"TARGET_TYPE_METHOD":9}},"EditionDefault":{"fields":{"edition":{"type":"Edition","id":3},"value":{"type":"string","id":2}}},"FeatureSupport":{"fields":{"editionIntroduced":{"type":"Edition","id":1},"editionDeprecated":{"type":"Edition","id":2},"deprecationWarning":{"type":"string","id":3},"editionRemoved":{"type":"Edition","id":4}}}}},"OneofOptions":{"edition":"proto2","fields":{"features":{"type":"FeatureSet","id":1},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"EnumOptions":{"edition":"proto2","fields":{"allowAlias":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"deprecatedLegacyJsonFieldConflicts":{"type":"bool","id":6,"options":{"deprecated":true}},"features":{"type":"FeatureSet","id":7},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[5,5]]},"EnumValueOptions":{"edition":"proto2","fields":{"deprecated":{"type":"bool","id":1},"features":{"type":"FeatureSet","id":2},"debugRedact":{"type":"bool","id":3},"featureSupport":{"type":"FieldOptions.FeatureSupport","id":4},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"ServiceOptions":{"edition":"proto2","fields":{"features":{"type":"FeatureSet","id":34},"deprecated":{"type":"bool","id":33},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"MethodOptions":{"edition":"proto2","fields":{"deprecated":{"type":"bool","id":33},"idempotencyLevel":{"type":"IdempotencyLevel","id":34,"options":{"default":"IDEMPOTENCY_UNKNOWN"}},"features":{"type":"FeatureSet","id":35},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"nested":{"IdempotencyLevel":{"values":{"IDEMPOTENCY_UNKNOWN":0,"NO_SIDE_EFFECTS":1,"IDEMPOTENT":2}}}},"UninterpretedOption":{"edition":"proto2","fields":{"name":{"rule":"repeated","type":"NamePart","id":2},"identifierValue":{"type":"string","id":3},"positiveIntValue":{"type":"uint64","id":4},"negativeIntValue":{"type":"int64","id":5},"doubleValue":{"type":"double","id":6},"stringValue":{"type":"bytes","id":7},"aggregateValue":{"type":"string","id":8}},"nested":{"NamePart":{"fields":{"namePart":{"rule":"required","type":"string","id":1},"isExtension":{"rule":"required","type":"bool","id":2}}}}},"FeatureSet":{"edition":"proto2","fields":{"fieldPresence":{"type":"FieldPresence","id":1,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_2023","edition_defaults.value":"EXPLICIT"}},"enumType":{"type":"EnumType","id":2,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"OPEN"}},"repeatedFieldEncoding":{"type":"RepeatedFieldEncoding","id":3,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"PACKED"}},"utf8Validation":{"type":"Utf8Validation","id":4,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"VERIFY"}},"messageEncoding":{"type":"MessageEncoding","id":5,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_LEGACY","edition_defaults.value":"LENGTH_PREFIXED"}},"jsonFormat":{"type":"JsonFormat","id":6,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"ALLOW"}},"enforceNamingStyle":{"type":"EnforceNamingStyle","id":7,"options":{"retention":"RETENTION_SOURCE","targets":"TARGET_TYPE_METHOD","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"STYLE2024"}},"defaultSymbolVisibility":{"type":"VisibilityFeature.DefaultSymbolVisibility","id":8,"options":{"retention":"RETENTION_SOURCE","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"EXPORT_TOP_LEVEL"}}},"extensions":[[1000,9994],[9995,9999],[10000,10000]],"reserved":[[999,999]],"nested":{"FieldPresence":{"values":{"FIELD_PRESENCE_UNKNOWN":0,"EXPLICIT":1,"IMPLICIT":2,"LEGACY_REQUIRED":3}},"EnumType":{"values":{"ENUM_TYPE_UNKNOWN":0,"OPEN":1,"CLOSED":2}},"RepeatedFieldEncoding":{"values":{"REPEATED_FIELD_ENCODING_UNKNOWN":0,"PACKED":1,"EXPANDED":2}},"Utf8Validation":{"values":{"UTF8_VALIDATION_UNKNOWN":0,"VERIFY":2,"NONE":3}},"MessageEncoding":{"values":{"MESSAGE_ENCODING_UNKNOWN":0,"LENGTH_PREFIXED":1,"DELIMITED":2}},"JsonFormat":{"values":{"JSON_FORMAT_UNKNOWN":0,"ALLOW":1,"LEGACY_BEST_EFFORT":2}},"EnforceNamingStyle":{"values":{"ENFORCE_NAMING_STYLE_UNKNOWN":0,"STYLE2024":1,"STYLE_LEGACY":2}},"VisibilityFeature":{"fields":{},"reserved":[[1,536870911]],"nested":{"DefaultSymbolVisibility":{"values":{"DEFAULT_SYMBOL_VISIBILITY_UNKNOWN":0,"EXPORT_ALL":1,"EXPORT_TOP_LEVEL":2,"LOCAL_ALL":3,"STRICT":4}}}}}},"FeatureSetDefaults":{"edition":"proto2","fields":{"defaults":{"rule":"repeated","type":"FeatureSetEditionDefault","id":1},"minimumEdition":{"type":"Edition","id":4},"maximumEdition":{"type":"Edition","id":5}},"nested":{"FeatureSetEditionDefault":{"fields":{"edition":{"type":"Edition","id":3},"overridableFeatures":{"type":"FeatureSet","id":4},"fixedFeatures":{"type":"FeatureSet","id":5}},"reserved":[[1,1],[2,2],"features"]}}},"SourceCodeInfo":{"edition":"proto2","fields":{"location":{"rule":"repeated","type":"Location","id":1}},"extensions":[[536000000,536000000]],"nested":{"Location":{"fields":{"path":{"rule":"repeated","type":"int32","id":1,"options":{"packed":true}},"span":{"rule":"repeated","type":"int32","id":2,"options":{"packed":true}},"leadingComments":{"type":"string","id":3},"trailingComments":{"type":"string","id":4},"leadingDetachedComments":{"rule":"repeated","type":"string","id":6}}}}},"GeneratedCodeInfo":{"edition":"proto2","fields":{"annotation":{"rule":"repeated","type":"Annotation","id":1}},"nested":{"Annotation":{"fields":{"path":{"rule":"repeated","type":"int32","id":1,"options":{"packed":true}},"sourceFile":{"type":"string","id":2},"begin":{"type":"int32","id":3},"end":{"type":"int32","id":4},"semantic":{"type":"Semantic","id":5}},"nested":{"Semantic":{"values":{"NONE":0,"SET":1,"ALIAS":2}}}}}},"SymbolVisibility":{"edition":"proto2","values":{"VISIBILITY_UNSET":0,"VISIBILITY_LOCAL":1,"VISIBILITY_EXPORT":2}}}}}}}}')},7105:S=>{"use strict";S.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')},8730:S=>{"use strict";S.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Type":{"fields":{"name":{"type":"string","id":1},"fields":{"rule":"repeated","type":"Field","id":2},"oneofs":{"rule":"repeated","type":"string","id":3},"options":{"rule":"repeated","type":"Option","id":4},"sourceContext":{"type":"SourceContext","id":5},"syntax":{"type":"Syntax","id":6}}},"Field":{"fields":{"kind":{"type":"Kind","id":1},"cardinality":{"type":"Cardinality","id":2},"number":{"type":"int32","id":3},"name":{"type":"string","id":4},"typeUrl":{"type":"string","id":6},"oneofIndex":{"type":"int32","id":7},"packed":{"type":"bool","id":8},"options":{"rule":"repeated","type":"Option","id":9},"jsonName":{"type":"string","id":10},"defaultValue":{"type":"string","id":11}},"nested":{"Kind":{"values":{"TYPE_UNKNOWN":0,"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Cardinality":{"values":{"CARDINALITY_UNKNOWN":0,"CARDINALITY_OPTIONAL":1,"CARDINALITY_REQUIRED":2,"CARDINALITY_REPEATED":3}}}},"Enum":{"fields":{"name":{"type":"string","id":1},"enumvalue":{"rule":"repeated","type":"EnumValue","id":2},"options":{"rule":"repeated","type":"Option","id":3},"sourceContext":{"type":"SourceContext","id":4},"syntax":{"type":"Syntax","id":5}}},"EnumValue":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"rule":"repeated","type":"Option","id":3}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}},"Any":{"fields":{"type_url":{"type":"string","id":1},"value":{"type":"bytes","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')}};var __webpack_require__=require("../../../webpack-runtime.js");__webpack_require__.C(exports);var __webpack_exec__=S=>__webpack_require__(__webpack_require__.s=S),__webpack_exports__=__webpack_require__.X(0,[638],()=>__webpack_exec__(6520));module.exports=__webpack_exports__})();